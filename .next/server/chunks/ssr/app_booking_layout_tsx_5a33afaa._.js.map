{"version":3,"sources":["../../../../app/booking/layout.tsx","../../../../app/booking/book/components/ProgressIndicator.tsx","../../../../app/booking/book/components/BookingSummary.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { usePathname, useParams } from 'next/navigation';\r\nimport Image from 'next/image';\r\nimport { ProgressIndicator } from './book/components/ProgressIndicator';\r\nimport { BookingFormProvider, useBookingFormContext } from './book/context/BookingFormContext';\r\nimport { useQuery } from '@tanstack/react-query';\r\nimport { useMemo, useState, useEffect, useRef } from 'react';\r\nimport { getServices, getAdditionalServices } from './quote/actions';\r\nimport { getPricingRulesClient } from './book/actions-client';\r\nimport { calculatePriceBreakdownClient } from '@/lib/pricing/calculator-client';\r\nimport { BookingSummary } from './book/components/BookingSummary';\r\nimport { PriceBreakdown } from '@/types/booking';\r\nimport Footer from '@/components/Footer';\r\nimport { findServiceBySlug } from '@/lib/utils/slug';\r\n\r\n// Get step from pathname (supports both with and without slug)\r\nconst getStepFromPath = (pathname: string): number => {\r\n  if (pathname.startsWith('/booking/details')) return 1;\r\n  if (pathname.startsWith('/booking/worker')) return 2;\r\n  if (pathname.startsWith('/booking/submit')) return 3;\r\n  return 1;\r\n};\r\n\r\nfunction BookingLayoutContent({\r\n  children,\r\n}: {\r\n  children: React.ReactNode;\r\n}) {\r\n  const pathname = usePathname();\r\n  const params = useParams();\r\n  const currentStep = getStepFromPath(pathname);\r\n  const serviceSlug = params.serviceSlug as string | undefined;\r\n  \r\n  const {\r\n    formData,\r\n    updateFormData,\r\n    isStepCompleted,\r\n    getDiscountAmount,\r\n    clearDiscountAmount,\r\n    setServicesForSlug,\r\n  } = useBookingFormContext();\r\n\r\n  // Get discount amount from localStorage (reactive)\r\n  // Initialize to 0 to match server render and prevent hydration mismatch\r\n  const [discountAmount, setDiscountAmount] = useState<number>(0);\r\n  const hasClearedDiscountRef = useRef(false);\r\n  \r\n  // Store functions in refs to ensure stable references\r\n  const updateFormDataRef = useRef(updateFormData);\r\n  const clearDiscountAmountRef = useRef(clearDiscountAmount);\r\n  \r\n  // Always update refs to latest functions (they should be stable due to useCallback)\r\n  updateFormDataRef.current = updateFormData;\r\n  clearDiscountAmountRef.current = clearDiscountAmount;\r\n\r\n  // Clear discount code and amount on page refresh/initial load\r\n  // This only runs once on mount (page refresh), not during client-side navigation\r\n  useEffect(() => {\r\n    if (!hasClearedDiscountRef.current) {\r\n      // Clear discount code from formData\r\n      updateFormDataRef.current({ discountCode: '' });\r\n      // Clear discount amount from localStorage\r\n      clearDiscountAmountRef.current();\r\n      setDiscountAmount(0);\r\n      hasClearedDiscountRef.current = true;\r\n    }\r\n  }, []); // Empty array - refs ensure we always have access to latest functions\r\n\r\n  // Sync discount amount from localStorage after mount to prevent hydration mismatch\r\n  useEffect(() => {\r\n    const updateDiscount = () => {\r\n      setDiscountAmount(getDiscountAmount());\r\n    };\r\n    // Listen for custom event when discount is updated\r\n    window.addEventListener('discountUpdated', updateDiscount);\r\n    // Initial load - read from localStorage after mount\r\n    updateDiscount();\r\n    return () => {\r\n      window.removeEventListener('discountUpdated', updateDiscount);\r\n    };\r\n  }, [getDiscountAmount]);\r\n\r\n  // Track previous serviceId to detect changes\r\n  const previousServiceIdRef = useRef<string | undefined>(formData.serviceId);\r\n\r\n  // Reset service-specific fields when service changes\r\n  useEffect(() => {\r\n    const previousServiceId = previousServiceIdRef.current;\r\n    const currentServiceId = formData.serviceId;\r\n\r\n    // Only reset if service actually changed (not on initial load)\r\n    if (previousServiceId && previousServiceId !== currentServiceId) {\r\n      updateFormData({\r\n        additionalServices: [],\r\n        bedrooms: '0',\r\n        bathrooms: '1',\r\n        carpetTypes: [],\r\n        roomStatus: '',\r\n        numberOfFittedRooms: '',\r\n        numberOfLooseCarpets: '',\r\n        cleaningEquipment: '',\r\n        serviceDate: '',\r\n        serviceTime: '',\r\n        serviceDuration: 3.5,\r\n        discountCode: '',\r\n      });\r\n    }\r\n\r\n    // Update the ref for next comparison\r\n    previousServiceIdRef.current = currentServiceId;\r\n  }, [formData.serviceId, updateFormData]);\r\n\r\n  // Fetch services for service name\r\n  const { data: services = [] } = useQuery({\r\n    queryKey: ['services'],\r\n    queryFn: getServices,\r\n    staleTime: 5 * 60 * 1000,\r\n  });\r\n\r\n  // Set services in hook for slug generation\r\n  useEffect(() => {\r\n    if (services.length > 0) {\r\n      setServicesForSlug(services);\r\n    }\r\n  }, [services, setServicesForSlug]);\r\n\r\n  // Validate and set service from slug if present\r\n  useEffect(() => {\r\n    if (serviceSlug && services.length > 0) {\r\n      const service = findServiceBySlug(services, serviceSlug);\r\n      if (service && (!formData.serviceId || formData.serviceId !== service.id)) {\r\n        updateFormData({ serviceId: service.id });\r\n      }\r\n    }\r\n  }, [serviceSlug, services, formData.serviceId, updateFormData]);\r\n\r\n  // Fetch and cache pricing rules (only fetched once)\r\n  const { data: pricingRules = [] } = useQuery({\r\n    queryKey: ['pricing-rules'],\r\n    queryFn: getPricingRulesClient,\r\n    staleTime: 10 * 60 * 1000, // Cache for 10 minutes\r\n  });\r\n\r\n  // Fetch additional services based on selected service\r\n  const { data: additionalServices = [] } = useQuery({\r\n    queryKey: ['additional-services', formData.serviceId],\r\n    queryFn: () => getAdditionalServices(formData.serviceId || undefined),\r\n    enabled: true,\r\n    staleTime: 5 * 60 * 1000,\r\n  });\r\n\r\n  const selectedService = services.find((s) => s.id === formData.serviceId);\r\n\r\n  // Check if selected service is carpet cleaning\r\n  const isCarpetCleaning = selectedService?.name.toLowerCase().includes('carpet') ?? false;\r\n\r\n  // Calculate price breakdown instantly using cached pricing rules\r\n  // This is memoized and recalculates automatically when dependencies change\r\n  // Updates in real-time when cleaningFrequency changes (weekly, bi-weekly, monthly, one-time)\r\n  // IMPORTANT: All formData properties that affect pricing are in the dependency array below to ensure real-time updates\r\n  const priceBreakdown = useMemo<PriceBreakdown>(() => {\r\n    // For carpet cleaning, we don't need bedrooms/bathrooms\r\n    // For other services, we need bedrooms/bathrooms\r\n    const hasRequiredData = isCarpetCleaning\r\n      ? formData.serviceId && pricingRules.length > 0\r\n      : formData.serviceId && formData.bedrooms && formData.bathrooms && pricingRules.length > 0;\r\n\r\n    if (!hasRequiredData) {\r\n      return {\r\n        basePrice: 0,\r\n        bedroomsPrice: 0,\r\n        bathroomsPrice: 0,\r\n        fittedRoomsPrice: 0,\r\n        looseCarpetsPrice: 0,\r\n        additionalServicesPrice: 0,\r\n        equipmentSupplyPrice: 0,\r\n        subtotal: 0,\r\n        frequencyDiscountPercent: 0,\r\n        frequencyDiscountAmount: 0,\r\n        discountAmount,\r\n        serviceFee: 0,\r\n        totalAmount: 0,\r\n      };\r\n    }\r\n\r\n    // Filter additional services to only include those relevant to the selected service type\r\n    // This ensures the price calculation matches what's displayed in the summary\r\n    const relevantAdditionalServiceIds = formData.additionalServices.filter(serviceId =>\r\n      additionalServices.some(s => s.id === serviceId)\r\n    );\r\n\r\n    return calculatePriceBreakdownClient(\r\n      pricingRules,\r\n      formData.serviceId,\r\n      formData.bedrooms || '0',\r\n      formData.bathrooms || '1',\r\n      relevantAdditionalServiceIds,\r\n      formData.cleaningFrequency,\r\n      discountAmount,\r\n      formData.numberOfFittedRooms || '',\r\n      formData.numberOfLooseCarpets || '',\r\n      isCarpetCleaning,\r\n      selectedService?.name,\r\n      formData.cleaningEquipment,\r\n      formData.numberOfCleaners || 1\r\n    );\r\n  }, [\r\n    pricingRules,\r\n    formData.serviceId,\r\n    formData.bedrooms,\r\n    formData.bathrooms,\r\n    // Use JSON.stringify for array dependency to ensure proper change detection\r\n    // This ensures real-time updates when additionalServices array contents change\r\n    JSON.stringify(formData.additionalServices),\r\n    formData.cleaningFrequency, // This triggers real-time recalculation when frequency changes\r\n    formData.numberOfFittedRooms,\r\n    formData.numberOfLooseCarpets,\r\n    formData.cleaningEquipment, // Track equipment selection for price updates\r\n    formData.numberOfCleaners, // Track number of cleaners for price updates\r\n    discountAmount,\r\n    isCarpetCleaning,\r\n    // additionalServices from query - React Query manages cache stability\r\n    // We track it to detect when available services change for the selected service\r\n    additionalServices,\r\n    selectedService?.name,\r\n  ]);\r\n\r\n  // Check if we're on the confirmation page\r\n  const isConfirmationPage = pathname.startsWith('/booking/confirmation');\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-muted/30\">\r\n      {/* Header - Hidden on confirmation page */}\r\n      {!isConfirmationPage && (\r\n        <div className=\"sticky top-0 z-50 bg-white border-b border-border mb-8\">\r\n          <div className=\"container mx-auto px-4 md:px-6 py-4 max-w-7xl\">\r\n            <div className=\"relative flex items-center justify-center\">\r\n              <div className=\"flex items-center gap-2 absolute left-0\">\r\n                <div className=\"w-8 h-8 md:w-10 md:h-10 flex items-center justify-center\">\r\n                  <Image\r\n                    src=\"/logo.png\"\r\n                    alt=\"Shalean Logo\"\r\n                    width={40}\r\n                    height={40}\r\n                    className=\"object-contain\"\r\n                    priority\r\n                  />\r\n                </div>\r\n                <span className=\"hidden md:inline font-bold text-xl text-foreground\">Shalean</span>\r\n              </div>\r\n              <ProgressIndicator \r\n                currentStep={currentStep}\r\n                serviceSlug={serviceSlug || null}\r\n                isStepCompleted={isStepCompleted}\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <main className=\"container mx-auto px-4 md:px-6 py-8 max-w-7xl\">\r\n        {isConfirmationPage ? (\r\n          // On confirmation page, render children directly without grid layout\r\n          children\r\n        ) : (\r\n          // On other booking pages, use grid layout with sidebar\r\n          <div className=\"grid lg:grid-cols-3 gap-8\">\r\n            {/* Main Form */}\r\n            <div className=\"lg:col-span-2 space-y-8\">\r\n              {children}\r\n            </div>\r\n\r\n            {/* Sidebar Summary */}\r\n            <div className=\"hidden lg:block lg:col-span-1\">\r\n              <BookingSummary\r\n                formData={formData}\r\n                priceBreakdown={priceBreakdown}\r\n                serviceName={selectedService?.name}\r\n                additionalServices={additionalServices}\r\n                pricingRules={pricingRules}\r\n              />\r\n            </div>\r\n          </div>\r\n        )}\r\n      </main>\r\n\r\n      {/* Footer - Hidden on confirmation page */}\r\n      {!isConfirmationPage && <Footer />}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function BookingLayout({\r\n  children,\r\n}: {\r\n  children: React.ReactNode;\r\n}) {\r\n  return (\r\n    <BookingFormProvider>\r\n      <BookingLayoutContent>{children}</BookingLayoutContent>\r\n    </BookingFormProvider>\r\n  );\r\n}\r\n\r\n","'use client';\n\nimport { useRouter } from 'next/navigation';\nimport { cn } from '@/lib/utils';\n\ninterface ProgressIndicatorProps {\n  currentStep: number;\n  serviceSlug?: string | null;\n  onStepClick?: (step: number, url: string) => void;\n  isStepCompleted?: (step: number) => boolean;\n}\n\nexport function ProgressIndicator({ currentStep, serviceSlug, onStepClick, isStepCompleted }: ProgressIndicatorProps) {\n  const router = useRouter();\n  \n  const getStepUrl = (step: number): string => {\n    const baseUrls = {\n      1: '/booking/details',\n      2: '/booking/worker',\n      3: '/booking/submit',\n    };\n    const baseUrl = baseUrls[step as keyof typeof baseUrls] || '/booking/details';\n    return serviceSlug ? `${baseUrl}/${serviceSlug}` : baseUrl;\n  };\n\n  const steps = [\n    { number: 1, label: 'Details', url: getStepUrl(1) },\n    { number: 2, label: 'Worker', url: getStepUrl(2) },\n    { number: 3, label: 'Submit', url: getStepUrl(3) },\n  ];\n\n  const handleStepClick = (step: number, url: string) => {\n    // Allow clicking on current step or completed steps (backward navigation)\n    // Prevent clicking on future incomplete steps\n    if (step <= currentStep || (isStepCompleted && isStepCompleted(step))) {\n      if (onStepClick) {\n        onStepClick(step, url);\n      } else {\n        router.push(url);\n      }\n    }\n  };\n\n  const isStepClickable = (step: number) => {\n    return step <= currentStep || (isStepCompleted && isStepCompleted(step));\n  };\n\n  return (\n    <>\n      {/* Desktop Progress Indicator */}\n      <div className=\"hidden md:flex items-center justify-center flex-1\">\n        <div className=\"flex items-center justify-between relative w-[400px]\">\n          {/* Continuous line - connects between circles */}\n          <div className=\"absolute left-4 right-4 top-4 h-0.5 bg-border z-0\"></div>\n          \n          {steps.map((step) => {\n            const isActive = step.number === currentStep;\n            const isCompleted = step.number < currentStep || (isStepCompleted && isStepCompleted(step.number));\n            const isClickable = isStepClickable(step.number);\n            \n            return (\n              <div\n                key={step.number}\n                className={cn(\n                  \"flex flex-col items-center gap-2 relative z-10\",\n                  step.number === 2 && \"absolute left-1/2 -translate-x-1/2\",\n                  isClickable && \"cursor-pointer hover:opacity-80 transition-opacity\",\n                  !isClickable && \"cursor-not-allowed\"\n                )}\n                onClick={() => isClickable && handleStepClick(step.number, step.url)}\n              >\n                <div\n                  className={cn(\n                    \"w-8 h-8 rounded-full border flex items-center justify-center text-sm font-semibold transition-colors\",\n                    isActive && \"bg-primary border-primary text-primary-foreground\",\n                    isCompleted && !isActive && \"bg-muted border border-border text-muted-foreground\",\n                    !isActive && !isCompleted && \"bg-muted border border-border text-foreground\"\n                  )}\n                >\n                  {step.number}\n                </div>\n                <span\n                  className={cn(\n                    \"text-sm font-medium whitespace-nowrap transition-colors\",\n                    isActive && \"text-primary font-semibold\",\n                    isCompleted && !isActive && \"text-muted-foreground\",\n                    !isActive && !isCompleted && \"text-foreground\"\n                  )}\n                >\n                  {step.label}\n                </span>\n              </div>\n            );\n          })}\n        </div>\n      </div>\n\n      {/* Mobile Progress Indicator */}\n      <div className=\"md:hidden flex items-center justify-center flex-1\">\n        <div className=\"flex items-center justify-between relative w-[200px]\">\n          {/* Continuous line - connects between circles */}\n          <div className=\"absolute left-3 right-3 top-3 h-0.5 bg-border z-0\"></div>\n          \n          {steps.map((step) => {\n            const isActive = step.number === currentStep;\n            const isCompleted = step.number < currentStep || (isStepCompleted && isStepCompleted(step.number));\n            const isClickable = isStepClickable(step.number);\n            \n            return (\n              <div\n                key={step.number}\n                className={cn(\n                  \"flex flex-col items-center gap-1 relative z-10\",\n                  step.number === 2 && \"absolute left-1/2 -translate-x-1/2\",\n                  isClickable && \"cursor-pointer hover:opacity-80 transition-opacity\",\n                  !isClickable && \"cursor-not-allowed\"\n                )}\n                onClick={() => isClickable && handleStepClick(step.number, step.url)}\n              >\n                <div\n                  className={cn(\n                    \"w-6 h-6 rounded-full border flex items-center justify-center text-xs font-semibold transition-colors\",\n                    isActive && \"bg-primary border-primary text-primary-foreground\",\n                    isCompleted && !isActive && \"bg-muted border border-border text-muted-foreground\",\n                    !isActive && !isCompleted && \"bg-muted border border-border text-foreground\"\n                  )}\n                >\n                  {step.number}\n                </div>\n                <span\n                  className={cn(\n                    \"text-xs font-medium whitespace-nowrap transition-colors\",\n                    isActive && \"text-primary font-semibold\",\n                    isCompleted && !isActive && \"text-muted-foreground\",\n                    !isActive && !isCompleted && \"text-foreground\"\n                  )}\n                >\n                  {step.label}\n                </span>\n              </div>\n            );\n          })}\n        </div>\n      </div>\n    </>\n  );\n}\n\n","'use client';\r\n\r\nimport { format } from 'date-fns';\r\nimport { Calendar, MapPin, Clock } from 'lucide-react';\r\nimport { BookingFormData, PriceBreakdown, PricingRule } from '@/types/booking';\r\nimport { AdditionalService } from '@/types/quote';\r\nimport { supportsRecurringBookings } from '@/lib/utils/service-validation';\r\nimport { calculateBookingDatesForMonth } from '@/lib/utils/recurring-dates';\r\n\r\ninterface BookingSummaryProps {\r\n  formData: BookingFormData;\r\n  priceBreakdown: PriceBreakdown;\r\n  serviceName?: string;\r\n  additionalServices?: AdditionalService[];\r\n  pricingRules?: PricingRule[];\r\n}\r\n\r\nexport function BookingSummary({ formData, priceBreakdown, serviceName, additionalServices = [], pricingRules = [] }: BookingSummaryProps) {\r\n  // Check if service is carpet cleaning\r\n  const isCarpetCleaning = serviceName?.toLowerCase().includes('carpet') ?? false;\r\n  \r\n  // Check if service supports recurring bookings (for frequency discount display)\r\n  // Only Standard Cleaning and Airbnb Cleaning support recurring bookings\r\n  const supportsRecurring = serviceName ? supportsRecurringBookings(serviceName) : false;\r\n  \r\n  // CRITICAL: Only show frequency discount if:\r\n  // 1. Service name is provided AND supports recurring bookings\r\n  // 2. Discount amount is greater than 0\r\n  // This ensures Deep Cleaning, Move In/Out, and Carpet Cleaning NEVER show discounts\r\n  const shouldShowFrequencyDiscount = Boolean(\r\n    serviceName && \r\n    supportsRecurring && \r\n    priceBreakdown.frequencyDiscountAmount > 0\r\n  );\r\n  \r\n  // Filter additional services to only show those relevant to the selected service type\r\n  const relevantAdditionalServices = formData.additionalServices.filter(serviceId => \r\n    additionalServices.some(s => s.id === serviceId)\r\n  );\r\n  \r\n  // Calculate final subtotal (after all discounts, before service fee)\r\n  const finalSubtotal = priceBreakdown.subtotal - priceBreakdown.frequencyDiscountAmount - priceBreakdown.discountAmount;\r\n\r\n  // Calculate recurring total for the first month\r\n  const isRecurring = formData.cleaningFrequency !== 'one-time';\r\n  const hasServiceDate = Boolean(formData.serviceDate);\r\n  const shouldCalculateRecurringTotal = isRecurring && hasServiceDate && supportsRecurring;\r\n\r\n  // Tip is one-time only (applied to first booking only, not recurring)\r\n  const tipAmount = formData.tipAmount || 0;\r\n\r\n  let numberOfBookingsInMonth = 1;\r\n  let recurringTotal = priceBreakdown.totalAmount + tipAmount; // Single booking: base + tip\r\n\r\n  if (shouldCalculateRecurringTotal) {\r\n    try {\r\n      const startDate = new Date(formData.serviceDate);\r\n      const bookingDates = calculateBookingDatesForMonth(startDate, formData.cleaningFrequency);\r\n      numberOfBookingsInMonth = bookingDates.length;\r\n      // For recurring: multiply base total by number of bookings, then add tip once\r\n      recurringTotal = (priceBreakdown.totalAmount * numberOfBookingsInMonth) + tipAmount;\r\n    } catch (error) {\r\n      // If date parsing fails, fall back to single booking\r\n      console.error('Error calculating recurring total:', error);\r\n      numberOfBookingsInMonth = 1;\r\n      recurringTotal = priceBreakdown.totalAmount + tipAmount;\r\n    }\r\n  }\r\n\r\n  // Get frequency label for display\r\n  const getFrequencyLabel = () => {\r\n    switch (formData.cleaningFrequency) {\r\n      case 'weekly':\r\n        return 'Weekly';\r\n      case 'bi-weekly':\r\n        return 'Bi-Weekly';\r\n      case 'monthly':\r\n        return 'Monthly';\r\n      default:\r\n        return '';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"bg-white rounded-2xl p-6 sticky top-24 space-y-4\">\r\n      <h3 className=\"text-lg font-semibold mb-4\">Booking Summary</h3>\r\n\r\n      {/* Service */}\r\n      <div className=\"flex justify-between text-sm\">\r\n        <span className=\"text-muted-foreground\">Service</span>\r\n        <span className=\"font-medium\">{serviceName || 'Not selected'}</span>\r\n      </div>\r\n\r\n      {/* Price Breakdown */}\r\n      <div className=\"space-y-2 pt-4 border-t border-border\">\r\n        <div className=\"text-sm font-semibold mb-2\">Price Breakdown</div>\r\n        <div className=\"flex justify-between text-sm\">\r\n          <span className=\"text-muted-foreground\">Base Price</span>\r\n          <span>R{priceBreakdown.basePrice.toFixed(2)}</span>\r\n        </div>\r\n        {/* Show bedrooms/bathrooms only for non-carpet services */}\r\n        {!isCarpetCleaning && (priceBreakdown.bedroomsPrice > 0 || priceBreakdown.bathroomsPrice > 0) && (\r\n          <div className=\"flex justify-between text-sm\">\r\n            <span className=\"text-muted-foreground\">Bedrooms & Bathrooms ({formData.bedrooms} bed, {formData.bathrooms} bath)</span>\r\n            <span>R{(priceBreakdown.bedroomsPrice + priceBreakdown.bathroomsPrice).toFixed(2)}</span>\r\n          </div>\r\n        )}\r\n        {/* Show carpet pricing only for carpet cleaning service */}\r\n        {isCarpetCleaning && priceBreakdown.fittedRoomsPrice > 0 && (\r\n          <div className=\"flex justify-between text-sm\">\r\n            <span className=\"text-muted-foreground\">\r\n              Fitted Rooms ({formData.numberOfFittedRooms || 0} room{parseInt(formData.numberOfFittedRooms || '0') !== 1 ? 's' : ''})\r\n            </span>\r\n            <span>R{priceBreakdown.fittedRoomsPrice.toFixed(2)}</span>\r\n          </div>\r\n        )}\r\n        {isCarpetCleaning && priceBreakdown.looseCarpetsPrice > 0 && (\r\n          <div className=\"flex justify-between text-sm\">\r\n            <span className=\"text-muted-foreground\">\r\n              Loose Carpets/Rugs ({formData.numberOfLooseCarpets || 0} carpet{parseInt(formData.numberOfLooseCarpets || '0') !== 1 ? 's' : ''})\r\n            </span>\r\n            <span>R{priceBreakdown.looseCarpetsPrice.toFixed(2)}</span>\r\n          </div>\r\n        )}\r\n        {/* Itemized Additional Services - Only show services relevant to selected service type */}\r\n        {relevantAdditionalServices.length > 0 ? (\r\n          <div className=\"space-y-1\">\r\n            {relevantAdditionalServices.map((serviceId) => {\r\n              const service = additionalServices.find(s => s.id === serviceId);\r\n              const priceRule = pricingRules.find(\r\n                r => r.rule_type === 'additional_service' && r.additional_service_id === serviceId\r\n              );\r\n              const price = priceRule?.price || 0;\r\n              return (\r\n                <div key={serviceId} className=\"flex justify-between text-sm\">\r\n                  <span className=\"text-muted-foreground\">{service?.name || 'Additional Service'}</span>\r\n                  <span>R{price.toFixed(2)}</span>\r\n                </div>\r\n              );\r\n            })}\r\n          </div>\r\n        ) : priceBreakdown.additionalServicesPrice > 0 ? (\r\n          // Fallback: Show total if price > 0 but services not found (shouldn't happen with proper filtering)\r\n          <div className=\"flex justify-between text-sm\">\r\n            <span className=\"text-muted-foreground\">Additional Services</span>\r\n            <span>R{priceBreakdown.additionalServicesPrice.toFixed(2)}</span>\r\n          </div>\r\n        ) : null}\r\n        {/* Equipment Supply Charge - Show when cleaningEquipment is 'yes' */}\r\n        {priceBreakdown.equipmentSupplyPrice > 0 && (\r\n          <div className=\"flex justify-between text-sm\">\r\n            <span className=\"text-muted-foreground\">Equipment & Supplies</span>\r\n            <span>R{priceBreakdown.equipmentSupplyPrice.toFixed(2)}</span>\r\n          </div>\r\n        )}\r\n        {/* Additional Cleaners Charge - Show when more than 1 cleaner is selected */}\r\n        {priceBreakdown.additionalCleanersPrice > 0 && (\r\n          <div className=\"flex justify-between text-sm\">\r\n            <span className=\"text-muted-foreground\">\r\n              Additional Cleaners ({formData.numberOfCleaners - 1} × R250)\r\n            </span>\r\n            <span>R{priceBreakdown.additionalCleanersPrice.toFixed(2)}</span>\r\n          </div>\r\n        )}\r\n        {/* Only show frequency discount for services that support recurring bookings (Standard and Airbnb) */}\r\n        {shouldShowFrequencyDiscount && (\r\n          <div className=\"flex justify-between text-sm text-green-600\">\r\n            <span>Frequency Discount ({priceBreakdown.frequencyDiscountPercent.toFixed(0)}%)</span>\r\n            <span>-R{priceBreakdown.frequencyDiscountAmount.toFixed(2)}</span>\r\n          </div>\r\n        )}\r\n        {priceBreakdown.discountAmount > 0 && (\r\n          <div className=\"flex justify-between text-sm text-green-600\">\r\n            <span>Discount Code{formData.discountCode ? ` (${formData.discountCode})` : ''}</span>\r\n            <span>-R{priceBreakdown.discountAmount.toFixed(2)}</span>\r\n          </div>\r\n        )}\r\n        <div className=\"flex justify-between text-sm font-semibold pt-2 border-t border-border\">\r\n          <span>Subtotal</span>\r\n          <span>R{Math.max(0, finalSubtotal).toFixed(2)}</span>\r\n        </div>\r\n        <div className=\"flex justify-between text-sm\">\r\n          <span className=\"text-muted-foreground\">Service Fee</span>\r\n          <span>R{priceBreakdown.serviceFee.toFixed(2)}</span>\r\n        </div>\r\n        {formData.tipAmount > 0 && (\r\n          <div className=\"flex justify-between text-sm\">\r\n            <span className=\"text-muted-foreground\">\r\n              Tip{isRecurring && shouldCalculateRecurringTotal ? ' (one-time, first booking only)' : ''}\r\n            </span>\r\n            <span>R{formData.tipAmount.toFixed(2)}</span>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Schedule */}\r\n      {formData.serviceDate && (\r\n        <div className=\"pt-4 border-t border-border\">\r\n          <div className=\"flex items-center gap-2 mb-2\">\r\n            <Calendar className=\"w-4 h-4 text-muted-foreground\" />\r\n            <span className=\"text-sm font-semibold\">Schedule</span>\r\n          </div>\r\n          <div className=\"text-sm space-y-1\">\r\n            <div>\r\n              {format(new Date(formData.serviceDate), 'MMMM do, yyyy')} @ {formData.serviceTime}\r\n            </div>\r\n            {formData.serviceDuration && (\r\n              <div className=\"flex items-center gap-1.5 text-muted-foreground\">\r\n                <Clock className=\"w-3.5 h-3.5\" />\r\n                <span>\r\n                  {formData.serviceDuration % 1 === 0 \r\n                    ? `${formData.serviceDuration} hours` \r\n                    : `${formData.serviceDuration.toFixed(1)} hours`}\r\n                </span>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Address */}\r\n      {formData.serviceAddress && (\r\n        <div className=\"pt-4 border-t border-border\">\r\n          <div className=\"flex items-center gap-2 mb-2\">\r\n            <MapPin className=\"w-4 h-4 text-muted-foreground\" />\r\n            <span className=\"text-sm font-semibold\">Address</span>\r\n          </div>\r\n          <div className=\"text-sm\">\r\n            {formData.serviceCity}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Total */}\r\n      <div className=\"pt-4 border-t border-border\">\r\n        <div className=\"flex justify-between items-center\">\r\n          <div>\r\n            <span className=\"text-sm font-semibold block\">\r\n              {shouldCalculateRecurringTotal \r\n                ? `Total (${numberOfBookingsInMonth} ${numberOfBookingsInMonth === 1 ? 'booking' : 'bookings'} this month)`\r\n                : 'Total'}\r\n            </span>\r\n            <span className=\"text-xs text-muted-foreground\">\r\n              {shouldCalculateRecurringTotal \r\n                ? `${getFrequencyLabel()} recurring - All fees included`\r\n                : isRecurring && !hasServiceDate\r\n                ? 'Select a date to see monthly total'\r\n                : 'All fees included'}\r\n            </span>\r\n          </div>\r\n          <div className=\"text-2xl font-bold text-primary\">\r\n            R{shouldCalculateRecurringTotal ? recurringTotal.toFixed(2) : (priceBreakdown.totalAmount + tipAmount).toFixed(2)}\r\n          </div>\r\n        </div>\r\n        {shouldCalculateRecurringTotal && numberOfBookingsInMonth > 1 && (\r\n          <div className=\"mt-2 text-xs text-muted-foreground text-right\">\r\n            (R{priceBreakdown.totalAmount.toFixed(2)} × {numberOfBookingsInMonth}) {tipAmount > 0 ? `+ R${tipAmount.toFixed(2)} tip` : ''} = R{recurringTotal.toFixed(2)}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n\r\n"],"names":[],"mappings":"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"}