module.exports=[60547,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(33217),f=a.i(96221),g=a.i(41675),h=a.i(24987),i=a.i(63519),j=a.i(46842),k=a.i(210);let l=(0,a.i(70106).default)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);var m=a.i(99570),n=a.i(86304),o=a.i(91119),p=a.i(34610),q=a.i(5050);let r=(0,q.createServerReference)("40b70fadc2d78351c0aaaa94538181d6f99823f978",q.callServer,void 0,q.findSourceMapURL,"getCleanerBookingById"),s=(0,q.createServerReference)("40644369c6d186ff3b456047295632caa4127d9b75",q.callServer,void 0,q.findSourceMapURL,"calculateBookingEarnings");var t=a.i(68926),u=a.i(72228),v=a.i(32418),w=a.i(14574),x=a.i(70430),y=a.i(66718),z=a.i(29246),A=a.i(23292);function B({open:a,onOpenChange:d,bookingId:e,onSuccess:g}){let[h,i]=(0,c.useState)(""),[j,k]=(0,c.useState)(""),[l,n]=(0,c.useState)(""),[o,p]=(0,c.useState)(!1),q=async a=>{if(a.preventDefault(),!j||!h)return void A.toast.error("Please provide both date and time");if(!l.trim())return void A.toast.error("Please provide a reason for the delay");p(!0);try{let a=new Date(`${j}T${h}`).toISOString(),b=await fetch("/api/cleaner/report-lateness",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bookingId:e,expectedArrivalTime:a,reason:l.trim()})}),c=await b.json();if(!b.ok||!c.success)throw Error(c.error||"Failed to report lateness");A.toast.success("Lateness reported successfully"),g(),d(!1),k(""),i(""),n("")}catch(a){console.error("Error reporting lateness:",a),A.toast.error(a instanceof Error?a.message:"Failed to report lateness")}finally{p(!1)}},r=new Date().toISOString().split("T")[0];return j||k(r),(0,b.jsx)(w.Dialog,{open:a,onOpenChange:d,children:(0,b.jsxs)(w.DialogContent,{children:[(0,b.jsxs)(w.DialogHeader,{children:[(0,b.jsx)(w.DialogTitle,{children:"Report Lateness"}),(0,b.jsx)(w.DialogDescription,{children:"Inform the customer about your expected arrival time and reason for delay."})]}),(0,b.jsxs)("form",{onSubmit:q,className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(x.Label,{htmlFor:"arrival-date",children:"Expected Arrival Date"}),(0,b.jsx)(y.Input,{id:"arrival-date",type:"date",value:j,onChange:a=>k(a.target.value),min:r,required:!0,disabled:o})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(x.Label,{htmlFor:"arrival-time",children:"Expected Arrival Time"}),(0,b.jsx)(y.Input,{id:"arrival-time",type:"time",value:h,onChange:a=>i(a.target.value),required:!0,disabled:o})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(x.Label,{htmlFor:"reason",children:"Reason for Delay"}),(0,b.jsx)(z.Textarea,{id:"reason",placeholder:"Explain why you will be late (e.g., traffic, previous booking ran over, etc.)",value:l,onChange:a=>n(a.target.value),rows:4,required:!0,disabled:o})]}),(0,b.jsxs)(w.DialogFooter,{children:[(0,b.jsx)(m.Button,{type:"button",variant:"outline",onClick:()=>d(!1),disabled:o,children:"Cancel"}),(0,b.jsx)(m.Button,{type:"submit",disabled:o,children:o?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(f.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Submitting..."]}):"Report Lateness"})]})]})]})})}function C(){let a=(0,d.useParams)(),q=(0,d.useRouter)(),w=a.id,[x,y]=(0,c.useState)(null),[z,A]=(0,c.useState)(null),[C,D]=(0,c.useState)(!0),[E,F]=(0,c.useState)(null),[G,H]=(0,c.useState)(!1),[I,J]=(0,c.useState)(null);(0,e.useQuery)({queryKey:["current-cleaner"],queryFn:async()=>{let a=await (0,p.getCurrentCleaner)();return a.success&&a.cleaner?(A(a.cleaner),a.cleaner):null},staleTime:3e5});let{data:K=[]}=(0,e.useQuery)({queryKey:["additional-services"],queryFn:()=>(0,t.getAdditionalServices)(),staleTime:3e5});if((0,c.useEffect)(()=>{w&&Promise.all([r(w),s(w)]).then(([a,b])=>{a.success&&a.booking?(y(a.booking),F(null)):F(a.error||"Booking not found or unauthorized"),b.success&&b.earnings&&J(b.earnings),D(!1)})},[w]),C)return(0,b.jsx)("div",{className:"flex items-center justify-center py-8 sm:py-12",children:(0,b.jsx)(f.Loader2,{className:"w-6 h-6 sm:w-8 sm:h-8 animate-spin text-primary"})});if(E||!x){let a=E?.toLowerCase().includes("unauthorized");return(0,b.jsx)("div",{className:"flex items-center justify-center py-8 sm:py-12 px-4",children:(0,b.jsxs)("div",{className:"text-center max-w-md",children:[(0,b.jsx)("h1",{className:"text-xl sm:text-2xl font-bold mb-3 sm:mb-4",children:a?"Access Denied":"Booking Not Found"}),(0,b.jsx)("p",{className:"text-sm sm:text-base text-muted-foreground mb-4",children:E||"The booking you are looking for does not exist or you are not authorized to view it."}),(0,b.jsxs)(m.Button,{onClick:()=>q.push("/cleaner/bookings"),className:"w-full sm:w-auto text-xs sm:text-sm h-9 sm:h-10",children:[(0,b.jsx)(k.ArrowLeft,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 mr-1.5 sm:mr-2"}),"Back to Bookings"]})]})})}let L={pending:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-400",confirmed:"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-400",on_my_way:"bg-orange-100 text-orange-800 dark:bg-orange-900/20 dark:text-orange-400",started:"bg-purple-100 text-purple-800 dark:bg-purple-900/20 dark:text-purple-400",completed:"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400",cancelled:"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400"},M={pending:"bg-gray-100 text-gray-800 dark:bg-gray-900/20 dark:text-gray-400",paid:"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400",failed:"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400",refunded:"bg-orange-100 text-orange-800 dark:bg-orange-900/20 dark:text-orange-400"},N=x.status.replace("_"," ").replace(/\b\w/g,a=>a.toUpperCase()),O=["confirmed","on_my_way"].includes(x.status);return(0,b.jsxs)("div",{className:"space-y-4 sm:space-y-6 w-full max-w-full overflow-x-hidden",children:[(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4",children:[(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)(m.Button,{variant:"ghost",onClick:()=>q.push("/cleaner/bookings"),className:"mb-2 sm:mb-4 h-8 sm:h-10 text-xs sm:text-sm px-2 sm:px-4",children:[(0,b.jsx)(k.ArrowLeft,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 mr-1.5 sm:mr-2"}),"Back to Bookings"]}),(0,b.jsx)("h1",{className:"text-2xl sm:text-3xl md:text-4xl font-bold",children:"Booking Details"}),(0,b.jsxs)("p",{className:"text-sm sm:text-base text-muted-foreground mt-1",children:["#",x.booking_number]})]}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-1.5 sm:gap-2",children:[(0,b.jsx)(n.Badge,{className:`${L[x.status]||L.pending} text-sm sm:text-base px-2 sm:px-3 py-0.5`,children:N}),(0,b.jsx)(n.Badge,{variant:"outline",className:`${M[x.payment_status]||M.pending} text-sm sm:text-base px-2 sm:px-3 py-0.5`,children:x.payment_status})]})]}),x.expected_arrival_time&&(0,b.jsx)(o.Card,{className:"border-orange-200 bg-orange-50 dark:bg-orange-900/20",children:(0,b.jsxs)(o.CardContent,{className:"flex items-start gap-3 pt-6",children:[(0,b.jsx)(l,{className:"h-5 w-5 text-orange-600 dark:text-orange-400 flex-shrink-0 mt-0.5"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h3",{className:"font-semibold text-orange-800 dark:text-orange-300 mb-1",children:"Lateness Reported"}),(0,b.jsxs)("p",{className:"text-sm text-orange-700 dark:text-orange-400",children:["Expected arrival: ",(0,u.format)(new Date(x.expected_arrival_time),"MMM d, yyyy h:mm a")]}),x.lateness_reason&&(0,b.jsx)("p",{className:"text-sm text-orange-600 dark:text-orange-400 mt-1",children:x.lateness_reason})]})]})}),z&&(0,b.jsxs)(o.Card,{children:[(0,b.jsx)(o.CardHeader,{children:(0,b.jsx)(o.CardTitle,{children:"Booking Actions"})}),(0,b.jsxs)(o.CardContent,{className:"space-y-4",children:[(0,b.jsx)(v.BookingStatusButton,{booking:x,onStatusUpdate:a=>{y(a)}}),O&&(0,b.jsx)(m.Button,{variant:"outline",onClick:()=>H(!0),className:"w-full sm:w-auto",children:"Report Lateness"})]})]}),(0,b.jsxs)("div",{className:"grid gap-4 sm:gap-6 md:grid-cols-2 w-full max-w-full",children:[(0,b.jsxs)(o.Card,{className:"w-full max-w-full overflow-hidden",children:[(0,b.jsx)(o.CardHeader,{className:"px-4 py-3 sm:px-6 sm:py-4",children:(0,b.jsx)(o.CardTitle,{className:"text-lg sm:text-xl",children:"Service Information"})}),(0,b.jsxs)(o.CardContent,{className:"space-y-3 sm:space-y-4 px-4 pb-4 sm:px-6 sm:pb-6 pt-0",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold text-base sm:text-lg mb-1.5 sm:mb-2",children:"Service Type"}),(0,b.jsx)("p",{className:"text-sm sm:text-base text-muted-foreground",children:x.service_type})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold text-base sm:text-lg mb-1.5 sm:mb-2",children:"Property Details"}),(0,b.jsxs)("p",{className:"text-sm sm:text-base text-muted-foreground",children:[x.bedrooms," Bedrooms, ",x.bathrooms," Bathrooms"]})]}),x.additional_services&&x.additional_services.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold text-base sm:text-lg mb-1.5 sm:mb-2",children:"Additional Services"}),(0,b.jsx)("ul",{className:"list-disc list-inside text-sm sm:text-base text-muted-foreground space-y-1",children:x.additional_services.map((a,c)=>{let d=K.find(b=>b.id===a);return(0,b.jsx)("li",{children:d?.name||a},c)})})]}),x.special_instructions&&(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold text-base sm:text-lg mb-1.5 sm:mb-2",children:"Special Instructions"}),(0,b.jsx)("p",{className:"text-sm sm:text-base text-muted-foreground leading-relaxed whitespace-pre-wrap",children:x.special_instructions})]})]})]}),(0,b.jsxs)(o.Card,{className:"w-full max-w-full overflow-hidden",children:[(0,b.jsx)(o.CardHeader,{className:"px-4 py-3 sm:px-6 sm:py-4",children:(0,b.jsx)(o.CardTitle,{className:"text-lg sm:text-xl",children:"Schedule & Customer"})}),(0,b.jsxs)(o.CardContent,{className:"space-y-3 sm:space-y-4 px-4 pb-4 sm:px-6 sm:pb-6 pt-0",children:[(0,b.jsxs)("div",{className:"flex items-start gap-2",children:[(0,b.jsx)(g.Calendar,{className:"h-5 w-5 text-muted-foreground mt-0.5 flex-shrink-0"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold text-base sm:text-lg mb-1",children:"Date & Time"}),(0,b.jsx)("p",{className:"text-sm sm:text-base text-muted-foreground",children:(0,u.format)(new Date(x.service_date),"EEEE, MMMM d, yyyy")}),(0,b.jsxs)("p",{className:"text-sm sm:text-base text-muted-foreground",children:[x.service_time," (",x.service_duration," hours)"]})]})]}),(0,b.jsxs)("div",{className:"flex items-start gap-2",children:[(0,b.jsx)(h.MapPin,{className:"h-5 w-5 text-muted-foreground mt-0.5 flex-shrink-0"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold text-base sm:text-lg mb-1",children:"Location"}),(0,b.jsxs)("p",{className:"text-sm sm:text-base text-muted-foreground",children:[x.service_address,x.service_apt_unit&&`, ${x.service_apt_unit}`]}),(0,b.jsxs)("p",{className:"text-sm sm:text-base text-muted-foreground",children:[x.service_suburb,", ",x.service_city]})]})]}),(0,b.jsxs)("div",{className:"flex items-start gap-2",children:[(0,b.jsx)(j.User,{className:"h-5 w-5 text-muted-foreground mt-0.5 flex-shrink-0"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold text-base sm:text-lg mb-1",children:"Customer"}),(0,b.jsxs)("p",{className:"text-sm sm:text-base text-muted-foreground",children:[x.customer_first_name," ",x.customer_last_name]})]})]}),(0,b.jsxs)("div",{className:"flex items-start gap-2",children:[(0,b.jsx)(i.Phone,{className:"h-5 w-5 text-muted-foreground mt-0.5 flex-shrink-0"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold text-base sm:text-lg mb-1",children:"Contact"}),(0,b.jsx)("a",{href:`tel:${x.customer_phone}`,className:"text-sm sm:text-base text-primary hover:underline block",children:x.customer_phone}),(0,b.jsx)("a",{href:`mailto:${x.customer_email}`,className:"text-sm sm:text-base text-primary hover:underline block",children:x.customer_email})]})]})]})]}),(0,b.jsxs)(o.Card,{className:"w-full max-w-full overflow-hidden md:col-span-2",children:[(0,b.jsx)(o.CardHeader,{className:"px-4 py-3 sm:px-6 sm:py-4",children:(0,b.jsx)(o.CardTitle,{className:"text-lg sm:text-xl",children:"Your Earnings"})}),(0,b.jsx)(o.CardContent,{className:"px-4 pb-4 sm:px-6 sm:pb-6 pt-0",children:I?(0,b.jsxs)("div",{className:"space-y-2 text-sm sm:text-base",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Base Earnings"}),(0,b.jsxs)("span",{children:["R",I.baseEarnings.toFixed(2)]})]}),I.tipAmount>0&&(0,b.jsxs)("div",{className:"flex justify-between text-primary",children:[(0,b.jsx)("span",{children:"Tip"}),(0,b.jsxs)("span",{children:["R",I.tipAmount.toFixed(2)]})]}),(0,b.jsxs)("div",{className:"flex justify-between border-t pt-2 mt-2 font-semibold text-base sm:text-lg",children:[(0,b.jsx)("span",{children:"Total Earnings"}),(0,b.jsxs)("span",{children:["R",I.totalEarnings.toFixed(2)]})]}),"paid"===x.payment_status?(0,b.jsx)("p",{className:"text-xs text-green-600 dark:text-green-400 mt-2",children:"Payment confirmed - Earnings available"}):(0,b.jsx)("p",{className:"text-xs text-yellow-600 dark:text-yellow-400 mt-2",children:"Projected earnings - Payment pending"})]}):(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Calculating earnings..."})})]})]}),z&&(0,b.jsx)(B,{open:G,onOpenChange:H,bookingId:x.id,onSuccess:()=>{Promise.all([r(w),s(w)]).then(([a,b])=>{a.success&&a.booking?y(a.booking):F(a.error||"Failed to refresh booking"),b.success&&b.earnings&&J(b.earnings)})}})]})}a.s(["default",()=>C],60547)}];

//# sourceMappingURL=app_cleaner_%28dashboard%29_bookings_%5Bid%5D_page_tsx_95325d81._.js.map