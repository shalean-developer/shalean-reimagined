module.exports=[99570,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(11011),e=a.i(187),f=a.i(68114);let g=(0,e.cva)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-semibold ring-offset-background transition-all duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-button hover:shadow-lg hover:-translate-y-0.5",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",hero:"bg-primary text-primary-foreground shadow-button hover:shadow-lg hover:-translate-y-0.5 hover:bg-primary/90",heroOutline:"border-2 border-primary bg-transparent text-primary hover:bg-primary hover:text-primary-foreground",cta:"bg-primary text-primary-foreground shadow-button hover:shadow-lg hover:-translate-y-1 hover:bg-primary/90"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-12 rounded-lg px-6",xl:"h-14 rounded-xl px-8 text-base",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),h=c.forwardRef(({className:a,variant:c,size:e,asChild:h=!1,...i},j)=>{let k=h?d.Slot:"button";return(0,b.jsx)(k,{className:(0,f.cn)(g({variant:c,size:e,className:a})),ref:j,...i})});h.displayName="Button",a.s(["Button",()=>h,"buttonVariants",()=>g])},38783,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactServerDOMTurbopackClient},88347,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d,e={ACTION_HMR_REFRESH:function(){return k},ACTION_NAVIGATE:function(){return h},ACTION_REFRESH:function(){return g},ACTION_RESTORE:function(){return i},ACTION_SERVER_ACTION:function(){return l},ACTION_SERVER_PATCH:function(){return j},PrefetchKind:function(){return m}};for(var f in e)Object.defineProperty(c,f,{enumerable:!0,get:e[f]});let g="refresh",h="navigate",i="restore",j="server-patch",k="hmr-refresh",l="server-action";var m=((d={}).AUTO="auto",d.FULL="full",d);("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},67009,(a,b,c)=>{"use strict";function d(a){return null!==a&&"object"==typeof a&&"then"in a&&"function"==typeof a.then}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"isThenable",{enumerable:!0,get:function(){return d}})},90841,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={dispatchAppRouterAction:function(){return i},useActionQueue:function(){return j}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=a.r(33463)._(a.r(72131)),g=a.r(67009),h=null;function i(a){if(null===h)throw Object.defineProperty(Error("Internal Next.js error: Router action dispatched before initialization."),"__NEXT_ERROR_CODE",{value:"E668",enumerable:!1,configurable:!0});h(a)}function j(a){let[b,c]=f.default.useState(a.state);h=b=>a.dispatch(b,c);let d=(0,f.useMemo)(()=>b,[b]);return(0,g.isThenable)(d)?(0,f.use)(d):d}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},20611,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"callServer",{enumerable:!0,get:function(){return g}});let d=a.r(72131),e=a.r(88347),f=a.r(90841);async function g(a,b){return new Promise((c,g)=>{(0,d.startTransition)(()=>{(0,f.dispatchAppRouterAction)({type:e.ACTION_SERVER_ACTION,actionId:a,actionArgs:b,resolve:c,reject:g})})})}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},1722,(a,b,c)=>{"use strict";let d;Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"findSourceMapURL",{enumerable:!0,get:function(){return d}});("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},8591,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"useMergedRef",{enumerable:!0,get:function(){return e}});let d=a.r(72131);function e(a,b){let c=(0,d.useRef)(null),e=(0,d.useRef)(null);return(0,d.useCallback)(d=>{if(null===d){let a=c.current;a&&(c.current=null,a());let b=e.current;b&&(e.current=null,b())}else a&&(c.current=f(a,d)),b&&(e.current=f(b,d))},[a,b])}function f(a,b){if("function"!=typeof a)return a.current=b,()=>{a.current=null};{let c=a(b);return"function"==typeof c?c:()=>a(null)}}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},92434,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"warnOnce",{enumerable:!0,get:function(){return d}});let d=a=>{}},68063,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={getDeploymentId:function(){return f},getDeploymentIdQueryOrEmptyString:function(){return g}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});function f(){return!1}function g(){return""}},67453,a=>{"use strict";let b=(0,a.i(70106).default)("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);a.s(["CheckCircle2",()=>b],67453)},43108,a=>{"use strict";let b=(0,a.i(70106).default)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);a.s(["Lock",()=>b],43108)},11046,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(67453),f=a.i(33508),g=a.i(43108),h=a.i(99570),i=a.i(38246);function j(){let a=(0,d.useRouter)(),j=(0,d.useSearchParams)().get("reference"),[k,l]=(0,c.useState)(!0),[m,n]=(0,c.useState)(null),[o,p]=(0,c.useState)(null);(0,c.useEffect)(()=>{if(!j){p("Payment reference is missing"),l(!1);return}(async()=>{try{let b,c,d=j?.startsWith("VOUCHER_");if(d)return void a.push(`/voucher/success?reference=${j}`);let e=!1;for(let a=0;a<3;a++)try{if(b=await fetch(`/api/paystack/verify?reference=${j}`),c=await b.json(),b.ok&&!c.error&&c.status&&c.data&&"success"===c.data.status){e=!0;break}if(c.data&&"pending"===c.data.status&&a<2){await new Promise(a=>setTimeout(a,2e3));continue}break}catch(b){if(console.error(`Verification attempt ${a+1} failed:`,b),a<2){await new Promise(a=>setTimeout(a,2e3));continue}}if(!e&&(console.warn("Paystack verification failed, trying booking verification as fallback"),!d&&!j?.startsWith("CREDIT_")&&!j?.startsWith("VOUCHER_")))try{let b=await fetch("/api/bookings/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reference:j})}),d=await b.json();if(b.ok&&d.success){if(console.log("Booking verified successfully via fallback:",d),d.bookingIds&&d.bookingIds.length>0){let b=d.bookingIds[0];a.push(`/booking/confirmation/${b}?payment=success`);return}e=!0,c={status:!0,data:{status:"success",amount:100*(d.paidAmount||0),currency:"ZAR"}}}else{let a=d.error||d.message||"Unknown error";d.details&&d.details,console.warn("Booking verification fallback failed:",{success:d.success,error:a,details:d.details,status:b.status,fullResponse:d})}}catch(a){console.error("Booking verification fallback also failed:",a)}if(!e){if(d)return void a.push(`/voucher/success?reference=${j}`);let b=c?.error||(c?.data?.status?`Payment status: ${c.data.status}`:null)||"Payment verification failed. Please contact support if this issue persists.";p(b),l(!1);return}if(e&&c&&c.data){let b=c.data.amount/100,d=c.data.metadata||{},e="credit_purchase"===d.transaction_type||j?.startsWith("CREDIT_");if("voucher_purchase"===d.transaction_type||j?.startsWith("VOUCHER_"))return void a.push(`/voucher/success?reference=${j}`);if(e)try{let a=await fetch("/api/credit/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reference:j})}),b=await a.json();if(a.ok&&b.success)console.log("Credit allocation result:",b),b.alreadyCredited||console.log(`Successfully credited R${b.amount} to account. New balance: R${b.balance}`);else{console.error("Credit allocation failed:",b);try{let a=await fetch("/api/credit/retry",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reference:j})}),b=await a.json();a.ok&&b.success&&console.log("Credit allocated via retry endpoint:",b)}catch(a){console.error("Retry endpoint also failed:",a)}}}catch(a){console.error("Error allocating credits:",a)}else try{let b=await fetch("/api/bookings/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reference:j})}),c=await b.json();if(b.ok&&c.success){if(console.log("Booking verification result:",c),!c.alreadyVerified&&c.bookingIds&&c.bookingIds.length>0||c.alreadyVerified&&c.bookingIds&&c.bookingIds.length>0){let b=c.bookingIds[0];a.push(`/booking/confirmation/${b}?payment=success`);return}}else{let a=c.error||c.message||"Unknown error";c.details&&c.details,console.error("Booking verification failed:",{success:c.success,error:a,details:c.details,status:b.status,fullResponse:c})}}catch(a){console.error("Error verifying booking:",a)}n({amount:b,currency:c.data.currency||"ZAR",status:c.data.status,customerEmail:c.data.customer?.email,isCreditPurchase:e})}else{if(d)return void a.push(`/voucher/success?reference=${j}`);p("Payment verification failed. Please contact support if this issue persists.")}}catch(b){if(console.error("Error verifying payment:",b),j?.startsWith("VOUCHER_"))return void a.push(`/voucher/success?reference=${j}`);p("Failed to verify payment. Please contact support if this issue persists.")}finally{l(!1)}})()},[j]);let q=()=>{m?.isCreditPurchase?a.push("/dashboard/shaleancred"):a.push("/")};return k?(0,b.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center p-4",children:(0,b.jsxs)("div",{className:"bg-white rounded-lg p-8 shadow-lg text-center",children:[(0,b.jsx)("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Verifying payment..."})]})}):o||!m?(0,b.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center p-4",children:(0,b.jsxs)("div",{className:"bg-white rounded-lg p-8 shadow-lg text-center max-w-md",children:[(0,b.jsx)("div",{className:"w-16 h-16 rounded-full bg-red-100 flex items-center justify-center mx-auto mb-4",children:(0,b.jsx)(f.X,{className:"w-10 h-10 text-red-600"})}),(0,b.jsx)("h1",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Payment Error"}),(0,b.jsx)("p",{className:"text-gray-600 mb-6",children:o||"Unable to verify payment"}),(0,b.jsx)(h.Button,{onClick:q,children:"Return to Home"})]})}):(0,b.jsxs)("div",{className:"min-h-screen bg-gray-100 flex flex-col items-center justify-center p-4",children:[(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow-lg max-w-md w-full relative",children:[(0,b.jsx)("button",{onClick:q,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors z-10","aria-label":"Close",children:(0,b.jsx)(f.X,{className:"w-5 h-5"})}),(0,b.jsxs)("div",{className:"p-8 text-center",children:[(0,b.jsx)("div",{className:"w-20 h-20 rounded-full bg-green-100 flex items-center justify-center mx-auto mb-6",children:(0,b.jsx)(e.CheckCircle2,{className:"w-12 h-12 text-green-600"})}),(0,b.jsx)("h1",{className:"text-2xl font-bold text-gray-800 mb-2",children:m.isCreditPurchase?"ShaleanCred Purchase Successful":"Payment Successful"}),(0,b.jsx)("p",{className:"text-gray-600 mb-6",children:m.isCreditPurchase?(0,b.jsxs)(b.Fragment,{children:["You successfully purchased ",(0,b.jsxs)("strong",{children:["R",m.amount.toFixed(2)]})," ShaleanCred.",(0,b.jsx)("br",{}),"Your credits have been added to your account."]}):(0,b.jsxs)(b.Fragment,{children:["You paid ",m.currency," ",m.amount.toFixed(2)," to Shalean Cleaning Services"]})}),(0,b.jsx)("div",{className:"flex flex-col sm:flex-row gap-4 justify-center mt-6",children:m.isCreditPurchase?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(h.Button,{asChild:!0,variant:"outline",size:"lg",children:(0,b.jsx)(i.default,{href:"/dashboard/shaleancred",children:"View ShaleanCred"})}),(0,b.jsx)(h.Button,{asChild:!0,variant:"default",size:"lg",children:(0,b.jsx)(i.default,{href:"/dashboard",children:"Go to Dashboard"})})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(h.Button,{asChild:!0,variant:"outline",size:"lg",children:(0,b.jsx)(i.default,{href:"/dashboard",children:"View Dashboard"})}),(0,b.jsx)(h.Button,{asChild:!0,variant:"default",size:"lg",children:(0,b.jsx)(i.default,{href:"/",children:"Go back to home"})})]})})]})]}),(0,b.jsxs)("div",{className:"mt-8 flex items-center gap-2 text-gray-700 text-sm",children:[(0,b.jsx)(g.Lock,{className:"w-4 h-4"}),(0,b.jsx)("span",{children:"Secured by"}),(0,b.jsx)("span",{className:"font-bold text-blue-600",children:"paystack"})]})]})}function k(){return(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center p-4",children:(0,b.jsxs)("div",{className:"bg-white rounded-lg p-8 shadow-lg text-center",children:[(0,b.jsx)("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Loading..."})]})}),children:(0,b.jsx)(j,{})})}a.s(["default",()=>k])}];

//# sourceMappingURL=_1e1be3fd._.js.map