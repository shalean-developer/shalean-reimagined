module.exports=[11733,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(99570),e=a.i(66718),f=a.i(70430),g=a.i(80701),h=a.i(63658),i=a.i(33508);function j({code:a,onClose:j,onSuccess:k}){let[l,m]=(0,c.useState)(!1),[n,o]=(0,c.useState)({}),[p,q]=(0,c.useState)({code:a?.code||"",discount_type:a?.discount_type||"percentage",discount_value:a?.discount_value?.toString()||"",max_discount_amount:a?.max_discount_amount?.toString()||"",min_purchase_amount:a?.min_purchase_amount?.toString()||"",max_uses:a?.max_uses?.toString()||"",valid_from:a?.valid_from||"",valid_until:a?.valid_until||"",is_active:a?.is_active??!0}),r=async b=>{b.preventDefault(),o({}),m(!0);try{let b={code:p.code.trim().toUpperCase(),discount_type:p.discount_type,discount_value:parseFloat(p.discount_value),valid_from:p.valid_from,valid_until:p.valid_until,is_active:p.is_active};p.max_discount_amount.trim()&&(b.max_discount_amount=parseFloat(p.max_discount_amount)),p.min_purchase_amount.trim()&&(b.min_purchase_amount=parseFloat(p.min_purchase_amount)),p.max_uses.trim()&&(b.max_uses=parseInt(p.max_uses,10));let c=a?`/api/discount-codes/${a.id}`:"/api/discount-codes",d=a?"PUT":"POST",e=await fetch(c,{method:d,headers:{"Content-Type":"application/json"},body:JSON.stringify(b)}),f=await e.json();if(!e.ok){f.error?o({submit:f.error}):f.details?o({submit:f.details}):o({submit:"Failed to save discount code"}),m(!1);return}k()}catch(a){console.error("Error saving discount code:",a),o({submit:a instanceof Error?a.message:"An unexpected error occurred"}),m(!1)}},s=(a,b)=>{q(c=>({...c,[a]:b})),n[a]&&o(b=>{let c={...b};return delete c[a],c})};return(0,b.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,b.jsxs)("div",{className:"bg-background rounded-lg shadow-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsxs)("div",{className:"sticky top-0 bg-background border-b p-6 flex justify-between items-center",children:[(0,b.jsx)("h2",{className:"text-2xl font-bold",children:a?"Edit Discount Code":"Create Discount Code"}),(0,b.jsx)(d.Button,{variant:"ghost",size:"icon",onClick:j,children:(0,b.jsx)(i.X,{className:"w-4 h-4"})})]}),(0,b.jsxs)("form",{onSubmit:r,className:"p-6 space-y-6",children:[n.submit&&(0,b.jsx)("div",{className:"bg-destructive/10 text-destructive p-3 rounded-md text-sm",children:n.submit}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(f.Label,{htmlFor:"code",children:["Code ",(0,b.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,b.jsx)(e.Input,{id:"code",value:p.code,onChange:a=>s("code",a.target.value.toUpperCase()),placeholder:"SAVE10",required:!0,disabled:!!a}),n.code&&(0,b.jsx)("p",{className:"text-sm text-destructive",children:n.code})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(f.Label,{htmlFor:"discount_type",children:["Discount Type ",(0,b.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,b.jsxs)(g.Select,{value:p.discount_type,onValueChange:a=>s("discount_type",a),children:[(0,b.jsx)(g.SelectTrigger,{id:"discount_type",children:(0,b.jsx)(g.SelectValue,{})}),(0,b.jsxs)(g.SelectContent,{children:[(0,b.jsx)(g.SelectItem,{value:"percentage",children:"Percentage (%)"}),(0,b.jsx)(g.SelectItem,{value:"fixed",children:"Fixed Amount (R)"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(f.Label,{htmlFor:"discount_value",children:["Discount Value ",(0,b.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,b.jsx)(e.Input,{id:"discount_value",type:"number",step:"0.01",min:"0",max:"percentage"===p.discount_type?"100":void 0,value:p.discount_value,onChange:a=>s("discount_value",a.target.value),placeholder:"percentage"===p.discount_type?"10":"50.00",required:!0}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"percentage"===p.discount_type?"Enter percentage (0-100)":"Enter amount in ZAR"})]}),"percentage"===p.discount_type&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(f.Label,{htmlFor:"max_discount_amount",children:"Max Discount Amount (R)"}),(0,b.jsx)(e.Input,{id:"max_discount_amount",type:"number",step:"0.01",min:"0",value:p.max_discount_amount,onChange:a=>s("max_discount_amount",a.target.value),placeholder:"100.00"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Optional: Maximum discount amount for percentage discounts"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(f.Label,{htmlFor:"min_purchase_amount",children:"Min Purchase Amount (R)"}),(0,b.jsx)(e.Input,{id:"min_purchase_amount",type:"number",step:"0.01",min:"0",value:p.min_purchase_amount,onChange:a=>s("min_purchase_amount",a.target.value),placeholder:"100.00"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Optional: Minimum purchase amount required to use this code"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(f.Label,{htmlFor:"max_uses",children:"Max Uses"}),(0,b.jsx)(e.Input,{id:"max_uses",type:"number",min:"1",step:"1",value:p.max_uses,onChange:a=>s("max_uses",a.target.value),placeholder:"100"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Optional: Maximum number of times this code can be used"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(f.Label,{htmlFor:"valid_from",children:["Valid From ",(0,b.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,b.jsx)(e.Input,{id:"valid_from",type:"date",value:p.valid_from,onChange:a=>s("valid_from",a.target.value),required:!0})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(f.Label,{htmlFor:"valid_until",children:["Valid Until ",(0,b.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,b.jsx)(e.Input,{id:"valid_until",type:"date",value:p.valid_until,onChange:a=>s("valid_until",a.target.value),required:!0})]})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(h.Switch,{id:"is_active",checked:p.is_active,onCheckedChange:a=>s("is_active",a)}),(0,b.jsx)(f.Label,{htmlFor:"is_active",children:"Active"})]}),a&&(0,b.jsxs)("div",{className:"bg-muted p-4 rounded-md",children:[(0,b.jsx)("p",{className:"text-sm font-medium mb-2",children:"Usage Statistics"}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Used: ",a.used_count," / ",a.max_uses||"∞"]})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[(0,b.jsx)(d.Button,{type:"button",variant:"outline",onClick:j,children:"Cancel"}),(0,b.jsx)(d.Button,{type:"submit",disabled:l,children:l?"Saving...":a?"Update":"Create"})]})]})]})})}var k=a.i(6015),l=a.i(86304),m=a.i(99464),n=a.i(81560),o=a.i(96221),p=a.i(72228);function q({codes:a,loading:c,onEdit:e,onDelete:f}){return c?(0,b.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,b.jsx)(o.Loader2,{className:"w-6 h-6 animate-spin text-muted-foreground"})}):0===a.length?(0,b.jsxs)("div",{className:"text-center py-12 bg-muted/50 rounded-lg",children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"No discount codes found."}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-2",children:"Create your first discount code to get started."})]}):(0,b.jsx)("div",{className:"border rounded-lg overflow-hidden",children:(0,b.jsxs)(k.Table,{children:[(0,b.jsx)(k.TableHeader,{children:(0,b.jsxs)(k.TableRow,{children:[(0,b.jsx)(k.TableHead,{children:"Code"}),(0,b.jsx)(k.TableHead,{children:"Type"}),(0,b.jsx)(k.TableHead,{children:"Value"}),(0,b.jsx)(k.TableHead,{children:"Status"}),(0,b.jsx)(k.TableHead,{children:"Usage"}),(0,b.jsx)(k.TableHead,{children:"Valid From"}),(0,b.jsx)(k.TableHead,{children:"Valid Until"}),(0,b.jsx)(k.TableHead,{className:"text-right",children:"Actions"})]})}),(0,b.jsx)(k.TableBody,{children:a.map(a=>{let c,g=(c=new Date,new Date(a.valid_until)<c),h=null!==a.max_uses&&a.used_count>=a.max_uses,i=!a.is_active;return(0,b.jsxs)(k.TableRow,{children:[(0,b.jsx)(k.TableCell,{className:"font-mono font-medium",children:a.code}),(0,b.jsx)(k.TableCell,{children:(0,b.jsx)(l.Badge,{variant:"outline",children:"percentage"===a.discount_type?"Percentage":"Fixed"})}),(0,b.jsxs)(k.TableCell,{className:"font-medium",children:["percentage"===a.discount_type?`${a.discount_value}%`:`R${a.discount_value.toFixed(2)}`,a.max_discount_amount&&"percentage"===a.discount_type&&(0,b.jsxs)("span",{className:"text-xs text-muted-foreground ml-1",children:["(max R",a.max_discount_amount.toFixed(2),")"]})]}),(0,b.jsx)(k.TableCell,{children:(0,b.jsxs)("div",{className:"flex flex-col gap-1",children:[i?(0,b.jsx)(l.Badge,{variant:"secondary",children:"Inactive"}):g?(0,b.jsx)(l.Badge,{variant:"destructive",children:"Expired"}):h?(0,b.jsx)(l.Badge,{variant:"secondary",children:"Maxed Out"}):(0,b.jsx)(l.Badge,{variant:"default",children:"Active"}),a.min_purchase_amount&&(0,b.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Min: R",a.min_purchase_amount.toFixed(2)]})]})}),(0,b.jsxs)(k.TableCell,{children:[a.used_count," / ",a.max_uses||"∞"]}),(0,b.jsx)(k.TableCell,{className:"text-sm text-muted-foreground",children:(0,p.format)(new Date(a.valid_from),"MMM dd, yyyy")}),(0,b.jsx)(k.TableCell,{className:"text-sm text-muted-foreground",children:(0,p.format)(new Date(a.valid_until),"MMM dd, yyyy")}),(0,b.jsx)(k.TableCell,{className:"text-right",children:(0,b.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,b.jsx)(d.Button,{variant:"ghost",size:"icon",onClick:()=>e(a),children:(0,b.jsx)(m.Pencil,{className:"w-4 h-4"})}),(0,b.jsx)(d.Button,{variant:"ghost",size:"icon",onClick:()=>f(a.id),children:(0,b.jsx)(n.Trash2,{className:"w-4 h-4"})})]})})]},a.id)})})]})})}var r=a.i(15618);function s(){let[a,e]=(0,c.useState)([]),[f,g]=(0,c.useState)(!0),[h,i]=(0,c.useState)(!1),[k,l]=(0,c.useState)(null),[m,n]=(0,c.useState)(0),o=async()=>{try{g(!0);let a=await fetch("/api/discount-codes?limit=100");if(!a.ok)throw Error("Failed to fetch discount codes");let b=await a.json();e(b.data||[])}catch(a){console.error("Error fetching discount codes:",a)}finally{g(!1)}};(0,c.useEffect)(()=>{o()},[m]);let p=()=>{i(!1),l(null),n(a=>a+1)},s=async a=>{if(confirm("Are you sure you want to delete this discount code?"))try{let b=await fetch(`/api/discount-codes/${a}`,{method:"DELETE"});if(!b.ok){let a=await b.json();throw Error(a.error||"Failed to delete discount code")}n(a=>a+1)}catch(a){console.error("Error deleting discount code:",a),alert(a instanceof Error?a.message:"Failed to delete discount code")}};return(0,b.jsxs)("div",{className:"container mx-auto px-4 py-8 max-w-7xl",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold",children:"Discount Codes"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-1",children:"Manage promotional discount codes for your booking system"})]}),(0,b.jsxs)(d.Button,{onClick:()=>{l(null),i(!0)},className:"gap-2",children:[(0,b.jsx)(r.Plus,{className:"w-4 h-4"}),"Create Discount Code"]})]}),h&&(0,b.jsx)(j,{code:k,onClose:p,onSuccess:p}),(0,b.jsx)(q,{codes:a,loading:f,onEdit:a=>{l(a),i(!0)},onDelete:s})]})}a.s(["default",()=>s],11733)}];

//# sourceMappingURL=app_admin_discount-codes_page_tsx_d6181472._.js.map