module.exports=[55687,a=>{"use strict";var b=a.i(87924),c=a.i(50944),d=a.i(71987),e=a.i(68114);function f({currentStep:a,serviceSlug:d,onStepClick:f,isStepCompleted:g}){let h=(0,c.useRouter)(),i=a=>{let b={1:"/booking/details",2:"/booking/worker",3:"/booking/submit"}[a]||"/booking/details";return d?`${b}/${d}`:b},j=[{number:1,label:"Details",url:i(1)},{number:2,label:"Worker",url:i(2)},{number:3,label:"Submit",url:i(3)}],k=(b,c)=>{(b<=a||g&&g(b))&&(f?f(b,c):h.push(c))},l=b=>b<=a||g&&g(b);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"hidden md:flex items-center justify-center flex-1",children:(0,b.jsxs)("div",{className:"flex items-center justify-between relative w-[400px]",children:[(0,b.jsx)("div",{className:"absolute left-4 right-4 top-4 h-0.5 bg-border z-0"}),j.map(c=>{let d=c.number===a,f=c.number<a||g&&g(c.number),h=l(c.number);return(0,b.jsxs)("div",{className:(0,e.cn)("flex flex-col items-center gap-2 relative z-10",2===c.number&&"absolute left-1/2 -translate-x-1/2",h&&"cursor-pointer hover:opacity-80 transition-opacity",!h&&"cursor-not-allowed"),onClick:()=>h&&k(c.number,c.url),children:[(0,b.jsx)("div",{className:(0,e.cn)("w-8 h-8 rounded-full border flex items-center justify-center text-sm font-semibold transition-colors",d&&"bg-primary border-primary text-primary-foreground",f&&!d&&"bg-muted border border-border text-muted-foreground",!d&&!f&&"bg-muted border border-border text-foreground"),children:c.number}),(0,b.jsx)("span",{className:(0,e.cn)("text-sm font-medium whitespace-nowrap transition-colors",d&&"text-primary font-semibold",f&&!d&&"text-muted-foreground",!d&&!f&&"text-foreground"),children:c.label})]},c.number)})]})}),(0,b.jsx)("div",{className:"md:hidden flex items-center justify-center flex-1",children:(0,b.jsxs)("div",{className:"flex items-center justify-between relative w-[200px]",children:[(0,b.jsx)("div",{className:"absolute left-3 right-3 top-3 h-0.5 bg-border z-0"}),j.map(c=>{let d=c.number===a,f=c.number<a||g&&g(c.number),h=l(c.number);return(0,b.jsxs)("div",{className:(0,e.cn)("flex flex-col items-center gap-1 relative z-10",2===c.number&&"absolute left-1/2 -translate-x-1/2",h&&"cursor-pointer hover:opacity-80 transition-opacity",!h&&"cursor-not-allowed"),onClick:()=>h&&k(c.number,c.url),children:[(0,b.jsx)("div",{className:(0,e.cn)("w-6 h-6 rounded-full border flex items-center justify-center text-xs font-semibold transition-colors",d&&"bg-primary border-primary text-primary-foreground",f&&!d&&"bg-muted border border-border text-muted-foreground",!d&&!f&&"bg-muted border border-border text-foreground"),children:c.number}),(0,b.jsx)("span",{className:(0,e.cn)("text-xs font-medium whitespace-nowrap transition-colors",d&&"text-primary font-semibold",f&&!d&&"text-muted-foreground",!d&&!f&&"text-foreground"),children:c.label})]},c.number)})]})})]})}var g=a.i(18873),h=a.i(33217),i=a.i(72131),j=a.i(76287),k=a.i(68926),l=a.i(42496),m=a.i(4020),n=a.i(72228),o=a.i(41675),p=a.i(24987),q=a.i(41710),r=a.i(49455),s=a.i(3244);function t({formData:a,priceBreakdown:c,serviceName:d,additionalServices:e=[],pricingRules:f=[]}){let g=d?.toLowerCase().includes("carpet")??!1,h=!!d&&(0,r.supportsRecurringBookings)(d),i=!!(d&&h&&c.frequencyDiscountAmount>0),j=a.additionalServices.filter(a=>e.some(b=>b.id===a)),k=c.subtotal-c.frequencyDiscountAmount-c.discountAmount,l="one-time"!==a.cleaningFrequency,m=!!a.serviceDate,t=l&&m&&h,u=a.tipAmount||0,v=1,w=c.totalAmount+u;if(t)try{let b=new Date(a.serviceDate);v=(0,s.calculateBookingDatesForMonth)(b,a.cleaningFrequency).length,w=c.totalAmount*v+u}catch(a){console.error("Error calculating recurring total:",a),v=1,w=c.totalAmount+u}return(0,b.jsxs)("div",{className:"bg-white rounded-2xl p-6 sticky top-24 space-y-4",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Booking Summary"}),(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Service"}),(0,b.jsx)("span",{className:"font-medium",children:d||"Not selected"})]}),(0,b.jsxs)("div",{className:"space-y-2 pt-4 border-t border-border",children:[(0,b.jsx)("div",{className:"text-sm font-semibold mb-2",children:"Price Breakdown"}),(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Base Price"}),(0,b.jsxs)("span",{children:["R",c.basePrice.toFixed(2)]})]}),!g&&(c.bedroomsPrice>0||c.bathroomsPrice>0)&&(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsxs)("span",{className:"text-muted-foreground",children:["Bedrooms & Bathrooms (",a.bedrooms," bed, ",a.bathrooms," bath)"]}),(0,b.jsxs)("span",{children:["R",(c.bedroomsPrice+c.bathroomsPrice).toFixed(2)]})]}),g&&c.fittedRoomsPrice>0&&(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsxs)("span",{className:"text-muted-foreground",children:["Fitted Rooms (",a.numberOfFittedRooms||0," room",1!==parseInt(a.numberOfFittedRooms||"0")?"s":"",")"]}),(0,b.jsxs)("span",{children:["R",c.fittedRoomsPrice.toFixed(2)]})]}),g&&c.looseCarpetsPrice>0&&(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsxs)("span",{className:"text-muted-foreground",children:["Loose Carpets/Rugs (",a.numberOfLooseCarpets||0," carpet",1!==parseInt(a.numberOfLooseCarpets||"0")?"s":"",")"]}),(0,b.jsxs)("span",{children:["R",c.looseCarpetsPrice.toFixed(2)]})]}),j.length>0?(0,b.jsx)("div",{className:"space-y-1",children:j.map(a=>{let c=e.find(b=>b.id===a),d=f.find(b=>"additional_service"===b.rule_type&&b.additional_service_id===a),g=d?.price||0;return(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:c?.name||"Additional Service"}),(0,b.jsxs)("span",{children:["R",g.toFixed(2)]})]},a)})}):c.additionalServicesPrice>0?(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Additional Services"}),(0,b.jsxs)("span",{children:["R",c.additionalServicesPrice.toFixed(2)]})]}):null,c.equipmentSupplyPrice>0&&(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Equipment & Supplies"}),(0,b.jsxs)("span",{children:["R",c.equipmentSupplyPrice.toFixed(2)]})]}),c.additionalCleanersPrice>0&&(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsxs)("span",{className:"text-muted-foreground",children:["Additional Cleaners (",a.numberOfCleaners-1," × R250)"]}),(0,b.jsxs)("span",{children:["R",c.additionalCleanersPrice.toFixed(2)]})]}),i&&(0,b.jsxs)("div",{className:"flex justify-between text-sm text-green-600",children:[(0,b.jsxs)("span",{children:["Frequency Discount (",c.frequencyDiscountPercent.toFixed(0),"%)"]}),(0,b.jsxs)("span",{children:["-R",c.frequencyDiscountAmount.toFixed(2)]})]}),c.discountAmount>0&&(0,b.jsxs)("div",{className:"flex justify-between text-sm text-green-600",children:[(0,b.jsxs)("span",{children:["Discount Code",a.discountCode?` (${a.discountCode})`:""]}),(0,b.jsxs)("span",{children:["-R",c.discountAmount.toFixed(2)]})]}),(0,b.jsxs)("div",{className:"flex justify-between text-sm font-semibold pt-2 border-t border-border",children:[(0,b.jsx)("span",{children:"Subtotal"}),(0,b.jsxs)("span",{children:["R",Math.max(0,k).toFixed(2)]})]}),(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Service Fee"}),(0,b.jsxs)("span",{children:["R",c.serviceFee.toFixed(2)]})]}),a.tipAmount>0&&(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsxs)("span",{className:"text-muted-foreground",children:["Tip",l&&t?" (one-time, first booking only)":""]}),(0,b.jsxs)("span",{children:["R",a.tipAmount.toFixed(2)]})]})]}),a.serviceDate&&(0,b.jsxs)("div",{className:"pt-4 border-t border-border",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)(o.Calendar,{className:"w-4 h-4 text-muted-foreground"}),(0,b.jsx)("span",{className:"text-sm font-semibold",children:"Schedule"})]}),(0,b.jsxs)("div",{className:"text-sm space-y-1",children:[(0,b.jsxs)("div",{children:[(0,n.format)(new Date(a.serviceDate),"MMMM do, yyyy")," @ ",a.serviceTime]}),a.serviceDuration&&(0,b.jsxs)("div",{className:"flex items-center gap-1.5 text-muted-foreground",children:[(0,b.jsx)(q.Clock,{className:"w-3.5 h-3.5"}),(0,b.jsx)("span",{children:a.serviceDuration%1==0?`${a.serviceDuration} hours`:`${a.serviceDuration.toFixed(1)} hours`})]})]})]}),a.serviceAddress&&(0,b.jsxs)("div",{className:"pt-4 border-t border-border",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)(p.MapPin,{className:"w-4 h-4 text-muted-foreground"}),(0,b.jsx)("span",{className:"text-sm font-semibold",children:"Address"})]}),(0,b.jsx)("div",{className:"text-sm",children:a.serviceCity})]}),(0,b.jsxs)("div",{className:"pt-4 border-t border-border",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-sm font-semibold block",children:t?`Total (${v} ${1===v?"booking":"bookings"} this month)`:"Total"}),(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:t?`${(()=>{switch(a.cleaningFrequency){case"weekly":return"Weekly";case"bi-weekly":return"Bi-Weekly";case"monthly":return"Monthly";default:return""}})()} recurring - All fees included`:l&&!m?"Select a date to see monthly total":"All fees included"})]}),(0,b.jsxs)("div",{className:"text-2xl font-bold text-primary",children:["R",t?w.toFixed(2):(c.totalAmount+u).toFixed(2)]})]}),t&&v>1&&(0,b.jsxs)("div",{className:"mt-2 text-xs text-muted-foreground text-right",children:["(R",c.totalAmount.toFixed(2)," × ",v,") ",u>0?`+ R${u.toFixed(2)} tip`:""," = R",w.toFixed(2)]})]})]})}var u=a.i(56283),v=a.i(47565);function w({children:a}){let e=(0,c.usePathname)(),n=(0,c.useParams)(),o=e.startsWith("/booking/details")?1:e.startsWith("/booking/worker")?2:e.startsWith("/booking/submit")?3:1,p=n.serviceSlug,{formData:q,updateFormData:r,isStepCompleted:s,getDiscountAmount:w,clearDiscountAmount:x,setServicesForSlug:y}=(0,g.useBookingFormContext)(),[z,A]=(0,i.useState)(0),B=(0,i.useRef)(!1),C=(0,i.useRef)(r),D=(0,i.useRef)(x);C.current=r,D.current=x,(0,i.useEffect)(()=>{B.current||(C.current({discountCode:""}),D.current(),A(0),B.current=!0)},[]),(0,i.useEffect)(()=>{let a=()=>{A(w())};return window.addEventListener("discountUpdated",a),a(),()=>{window.removeEventListener("discountUpdated",a)}},[w]);let E=(0,i.useRef)(q.serviceId);(0,i.useEffect)(()=>{let a=E.current,b=q.serviceId;a&&a!==b&&r({additionalServices:[],bedrooms:"0",bathrooms:"1",carpetTypes:[],roomStatus:"",numberOfFittedRooms:"",numberOfLooseCarpets:"",cleaningEquipment:"",serviceDate:"",serviceTime:"",serviceDuration:3.5,discountCode:""}),E.current=b},[q.serviceId,r]);let{data:F=[]}=(0,h.useQuery)({queryKey:["services"],queryFn:j.getServices,staleTime:3e5});(0,i.useEffect)(()=>{F.length>0&&y(F)},[F,y]),(0,i.useEffect)(()=>{if(p&&F.length>0){let a=(0,v.findServiceBySlug)(F,p);a&&(!q.serviceId||q.serviceId!==a.id)&&r({serviceId:a.id})}},[p,F,q.serviceId,r]);let{data:G=[]}=(0,h.useQuery)({queryKey:["pricing-rules"],queryFn:l.getPricingRulesClient,staleTime:6e5}),{data:H=[]}=(0,h.useQuery)({queryKey:["additional-services",q.serviceId],queryFn:()=>(0,k.getAdditionalServices)(q.serviceId||void 0),enabled:!0,staleTime:3e5}),I=F.find(a=>a.id===q.serviceId),J=I?.name.toLowerCase().includes("carpet")??!1,K=(0,i.useMemo)(()=>{if(!(J?q.serviceId&&G.length>0:q.serviceId&&q.bedrooms&&q.bathrooms&&G.length>0))return{basePrice:0,bedroomsPrice:0,bathroomsPrice:0,fittedRoomsPrice:0,looseCarpetsPrice:0,additionalServicesPrice:0,equipmentSupplyPrice:0,additionalCleanersPrice:0,subtotal:0,frequencyDiscountPercent:0,frequencyDiscountAmount:0,discountAmount:z,serviceFee:0,totalAmount:0};let a=q.additionalServices.filter(a=>H.some(b=>b.id===a));return(0,m.calculatePriceBreakdownClient)(G,q.serviceId,q.bedrooms||"0",q.bathrooms||"1",a,q.cleaningFrequency,z,q.numberOfFittedRooms||"",q.numberOfLooseCarpets||"",J,I?.name,q.cleaningEquipment,q.numberOfCleaners||1)},[G,q.serviceId,q.bedrooms,q.bathrooms,JSON.stringify(q.additionalServices),q.cleaningFrequency,q.numberOfFittedRooms,q.numberOfLooseCarpets,q.cleaningEquipment,q.numberOfCleaners,z,J,H,I?.name]),L=e.startsWith("/booking/confirmation");return(0,b.jsxs)("div",{className:"min-h-screen bg-muted/30",children:[!L&&(0,b.jsx)("div",{className:"sticky top-0 z-50 bg-white border-b border-border mb-8",children:(0,b.jsx)("div",{className:"container mx-auto px-4 md:px-6 py-4 max-w-7xl",children:(0,b.jsxs)("div",{className:"relative flex items-center justify-center",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 absolute left-0",children:[(0,b.jsx)("div",{className:"w-8 h-8 md:w-10 md:h-10 flex items-center justify-center",children:(0,b.jsx)(d.default,{src:"/logo.png",alt:"Shalean Logo",width:40,height:40,className:"object-contain",priority:!0})}),(0,b.jsx)("span",{className:"hidden md:inline font-bold text-xl text-foreground",children:"Shalean"})]}),(0,b.jsx)(f,{currentStep:o,serviceSlug:p||null,isStepCompleted:s})]})})}),(0,b.jsx)("main",{className:"container mx-auto px-4 md:px-6 py-8 max-w-7xl",children:L?a:(0,b.jsxs)("div",{className:"grid lg:grid-cols-3 gap-8",children:[(0,b.jsx)("div",{className:"lg:col-span-2 space-y-8",children:a}),(0,b.jsx)("div",{className:"hidden lg:block lg:col-span-1",children:(0,b.jsx)(t,{formData:q,priceBreakdown:K,serviceName:I?.name,additionalServices:H,pricingRules:G})})]})}),!L&&(0,b.jsx)(u.default,{})]})}function x({children:a}){return(0,b.jsx)(g.BookingFormProvider,{children:(0,b.jsx)(w,{children:a})})}a.s(["default",()=>x],55687)}];

//# sourceMappingURL=app_booking_layout_tsx_5a33afaa._.js.map