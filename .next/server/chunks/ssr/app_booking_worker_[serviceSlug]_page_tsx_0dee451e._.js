module.exports=[32055,a=>{"use strict";var b=a.i(87924),c=a.i(50944),d=a.i(72131),e=a.i(33217),f=a.i(99570),g=a.i(210),h=a.i(18873),i=a.i(70430),j=a.i(66718),k=a.i(80701),l=a.i(24987),m=a.i(21374),n=a.i(67453),o=a.i(70106);let p=(0,o.default)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),q=(0,o.default)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);var r=a.i(81010),s=a.i(41675),t=a.i(97063),u=a.i(42496),v=a.i(72233),w=a.i(86304),x=a.i(50104),y=a.i(30553),z="Progress",[A,B]=(0,x.createContextScope)(z),[C,D]=A(z),E=d.forwardRef((a,c)=>{var d,e;let{__scopeProgress:f,value:g=null,max:h,getValueLabel:i=H,...j}=a;(h||0===h)&&!K(h)&&console.error((d=`${h}`,`Invalid prop \`max\` of value \`${d}\` supplied to \`Progress\`. Only numbers greater than 0 are valid max values. Defaulting to \`100\`.`));let k=K(h)?h:100;null===g||L(g,k)||console.error((e=`${g}`,`Invalid prop \`value\` of value \`${e}\` supplied to \`Progress\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or 100 if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`));let l=L(g,k)?g:null,m=J(l)?i(l,k):void 0;return(0,b.jsx)(C,{scope:f,value:l,max:k,children:(0,b.jsx)(y.Primitive.div,{"aria-valuemax":k,"aria-valuemin":0,"aria-valuenow":J(l)?l:void 0,"aria-valuetext":m,role:"progressbar","data-state":I(l,k),"data-value":l??void 0,"data-max":k,...j,ref:c})})});E.displayName=z;var F="ProgressIndicator",G=d.forwardRef((a,c)=>{let{__scopeProgress:d,...e}=a,f=D(F,d);return(0,b.jsx)(y.Primitive.div,{"data-state":I(f.value,f.max),"data-value":f.value??void 0,"data-max":f.max,...e,ref:c})});function H(a,b){return`${Math.round(a/b*100)}%`}function I(a,b){return null==a?"indeterminate":a===b?"complete":"loading"}function J(a){return"number"==typeof a}function K(a){return J(a)&&!isNaN(a)&&a>0}function L(a,b){return J(a)&&!isNaN(a)&&a<=b&&a>=0}G.displayName=F;var M=a.i(68114);let N=d.forwardRef(({className:a,value:c,...d},e)=>(0,b.jsx)(E,{ref:e,className:(0,M.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",a),...d,children:(0,b.jsx)(G,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(c||0)}%)`}})}));N.displayName=E.displayName;var O=a.i(12916),P=a.i(39338),Q=a.i(49455);let R=[{value:"one-time",label:"One-Time",subtitle:"Single session",icon:r.Home,discount:null},{value:"weekly",label:"Weekly",subtitle:"Every week",icon:s.Calendar,discount:"Save 15%"},{value:"bi-weekly",label:"Bi-Weekly",subtitle:"Every 2 weeks",icon:s.Calendar,discount:"Save 10%"},{value:"monthly",label:"Monthly",subtitle:"Once a month",icon:s.Calendar,discount:"Save 5%"}];function S({formData:a,updateFormData:c}){let[f,g]=(0,d.useState)([]),[h,o]=(0,d.useState)(!0),[r,s]=(0,d.useState)("best-match"),[x,y]=(0,d.useState)(!1),{data:z=[]}=(0,e.useQuery)({queryKey:["services"],queryFn:P.getServices,staleTime:3e5}),A=z.find(b=>b.id===a.serviceId),B=A?.name||"",C=(0,Q.supportsRecurringBookings)(B),D=(0,Q.getAvailableFrequencies)(B);return(0,d.useEffect)(()=>{y(!0)},[]),(0,d.useEffect)(()=>{B&&!(0,Q.isValidFrequencyForService)(B,a.cleaningFrequency)&&c({cleaningFrequency:"one-time"})},[B,a.cleaningFrequency,c]),(0,d.useEffect)(()=>{!async function(){o(!0);try{let b=await (0,u.getAvailableCleanersWithCriteriaClient)({serviceSuburb:a.serviceSuburb,serviceDate:a.serviceDate,serviceTime:a.serviceTime,serviceDuration:a.serviceDuration});if(b.success&&b.cleaners){let a=(0,O.sortCleanersByCriteria)(b.cleaners,r);g(a)}else g([]),console.warn("Failed to fetch cleaners:",b.error)}catch(a){console.error("Error fetching cleaners:",a),g([])}finally{o(!1)}}()},[a.serviceSuburb,a.serviceDate,a.serviceTime,a.serviceDuration,r]),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-2xl font-bold text-foreground mb-2",children:"Schedule & Cleaner"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Choose your preferred date and time."})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(l.MapPin,{className:"w-5 h-5 text-primary"}),(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Service Address"})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid md:grid-cols-[2fr_1fr] gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{children:"Street Address *"}),(0,b.jsx)(j.Input,{placeholder:"e.g., 123 Nelson Mandela Avenue",value:a.serviceAddress,onChange:a=>c({serviceAddress:a.target.value})})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{children:"Apt / Unit"}),(0,b.jsx)(j.Input,{placeholder:"e.g., Apt 4B, Unit 12",value:a.serviceAptUnit,onChange:a=>c({serviceAptUnit:a.target.value})})]})]}),(0,b.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{children:"Suburb *"}),(0,b.jsx)(j.Input,{value:a.serviceSuburb,onChange:a=>c({serviceSuburb:a.target.value})})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{children:"City *"}),(0,b.jsx)(j.Input,{value:a.serviceCity,onChange:a=>c({serviceCity:a.target.value})})]})]})]})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:a.numberOfCleaners>1?`Select ${a.numberOfCleaners} cleaners`:"Select your preferred cleaner"}),a.numberOfCleaners>1&&(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:[(a.preferredCleanerIds||[]).length," of ",a.numberOfCleaners," selected"]})]}),x&&(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(i.Label,{htmlFor:"sort-criteria",className:"text-sm text-muted-foreground",children:"Sort by:"}),(0,b.jsxs)(k.Select,{value:r,onValueChange:a=>s(a),children:[(0,b.jsx)(k.SelectTrigger,{id:"sort-criteria",className:"w-[180px]",children:(0,b.jsx)(k.SelectValue,{})}),(0,b.jsxs)(k.SelectContent,{children:[(0,b.jsx)(k.SelectItem,{value:"best-match",children:"Best Match"}),(0,b.jsx)(k.SelectItem,{value:"highest-rated",children:"Highest Rated"}),(0,b.jsx)(k.SelectItem,{value:"most-reliable",children:"Most Reliable"}),(0,b.jsx)(k.SelectItem,{value:"most-experienced",children:"Most Experienced"})]})]})]})]}),h?(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"Loading cleaners..."}):(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[0===f.length&&1===a.numberOfCleaners&&(0,b.jsxs)("button",{type:"button",onClick:()=>c({preferredCleanerIds:[]}),className:`relative p-4 rounded-xl border-2 transition-all text-left ${0===(a.preferredCleanerIds||[]).length?"border-primary bg-primary/5":"border-border hover:border-primary/50 bg-background"}`,children:[0===(a.preferredCleanerIds||[]).length&&(0,b.jsx)("div",{className:"absolute top-2 right-2 w-5 h-5 rounded-full bg-primary flex items-center justify-center",children:(0,b.jsx)(n.CheckCircle2,{className:"w-3 h-3 text-primary-foreground"})}),(0,b.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,b.jsx)("div",{className:"w-12 h-12 rounded-full bg-muted flex items-center justify-center",children:(0,b.jsx)("span",{className:"text-lg",children:"?"})}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"font-semibold text-sm",children:"No preference"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Best available"})]})]})]}),f.map(d=>{let e=a.preferredCleanerIds||[],f=e.includes(d.id),g=d.reliability_score||0,h=g>=80,i=!1!==d.isAvailableForSlot,j=!0===d.bookingConflict,k=a.numberOfCleaners>1,l=k&&e.length>=a.numberOfCleaners,o=j||l&&!f;return(0,b.jsxs)("button",{type:"button",onClick:()=>{!o&&(k?f?c({preferredCleanerIds:e.filter(a=>a!==d.id)}):e.length<a.numberOfCleaners&&c({preferredCleanerIds:[...e,d.id]}):c({preferredCleanerIds:f?[]:[d.id]}))},disabled:o,className:`relative p-4 rounded-xl border-2 transition-all text-left ${f?"border-primary bg-primary/5":o?"border-destructive/50 bg-muted/50 opacity-60 cursor-not-allowed":"border-border hover:border-primary/50 bg-background"}`,children:[f&&(0,b.jsx)("div",{className:"absolute top-2 right-2 w-5 h-5 rounded-full bg-primary flex items-center justify-center z-10",children:(0,b.jsx)(n.CheckCircle2,{className:"w-3 h-3 text-primary-foreground"})}),!j&&i&&a.serviceDate&&a.serviceTime&&(0,b.jsxs)(w.Badge,{variant:"default",className:"absolute top-2 left-2 text-xs bg-green-500 hover:bg-green-600",children:[(0,b.jsx)(n.CheckCircle2,{className:"w-3 h-3 mr-1"}),"Available"]}),j&&(0,b.jsxs)(w.Badge,{variant:"destructive",className:"absolute top-2 left-2 text-xs",children:[(0,b.jsx)(p,{className:"w-3 h-3 mr-1"}),"Booked"]}),h&&!j&&(0,b.jsxs)(w.Badge,{variant:"secondary",className:"absolute top-2 left-2 text-xs bg-blue-500 hover:bg-blue-600 text-white",children:[(0,b.jsx)(q,{className:"w-3 h-3 mr-1"}),"High Reliability"]}),(0,b.jsxs)("div",{className:"flex flex-col gap-3 mt-6",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[d.avatar_url||d.photo_url?(0,b.jsxs)(v.Avatar,{className:"w-14 h-14",children:[(0,b.jsx)(v.AvatarImage,{src:d.avatar_url||d.photo_url||"",alt:d.name}),(0,b.jsx)(v.AvatarFallback,{children:d.name.charAt(0)})]}):(0,b.jsx)("div",{className:"w-14 h-14 rounded-full bg-muted flex items-center justify-center",children:(0,b.jsx)("span",{className:"text-xl font-semibold",children:d.name.charAt(0)})}),(0,b.jsxs)("div",{className:"flex-1 text-left min-w-0",children:[(0,b.jsx)("p",{className:"font-semibold text-sm flex items-baseline gap-1",title:d.name,children:(()=>{let a=d.name.trim().split(/\s+/);if(a.length<=1)return(0,b.jsx)("span",{className:"truncate",children:d.name});let c=a[0],e=a.slice(1).join(" ");return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("span",{className:"whitespace-nowrap",children:c}),e&&(0,b.jsxs)("span",{className:"truncate min-w-0",children:[" ",e]})]})})()}),d.rating&&(0,b.jsxs)("div",{className:"flex items-center gap-1 mt-1",children:[(0,b.jsx)(m.Star,{className:"w-3 h-3 fill-yellow-400 text-yellow-400"}),(0,b.jsx)("span",{className:"text-xs font-medium",children:d.rating.toFixed(1)})]})]})]}),g>0&&(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Reliability"}),(0,b.jsx)("span",{className:"font-semibold",children:(0,O.formatReliabilityScore)(g)})]}),(0,b.jsx)(N,{value:g,className:"h-2"})]}),(0,b.jsxs)("div",{className:"space-y-1 text-xs text-muted-foreground",children:[d.specialties&&d.specialties.length>0&&(0,b.jsx)("p",{className:"line-clamp-1",children:d.specialties.slice(0,2).join(", ")}),d.years_experience&&(0,b.jsxs)("p",{children:[d.years_experience," year",d.years_experience>1?"s":""," experience"]}),void 0!==d.total_bookings&&d.total_bookings>0&&(0,b.jsxs)("p",{children:[d.total_bookings," booking",d.total_bookings>1?"s":""]})]})]})]},d.id)})]}),a.numberOfCleaners>1&&(a.preferredCleanerIds||[]).length>=a.numberOfCleaners&&(0,b.jsxs)("p",{className:"text-sm text-muted-foreground text-center",children:["You've selected ",a.numberOfCleaners," cleaners. You can deselect any cleaner to choose a different one."]}),a.numberOfCleaners>1&&(a.preferredCleanerIds||[]).length<a.numberOfCleaners&&f.length>0&&(0,b.jsxs)("p",{className:"text-sm text-muted-foreground text-center",children:["Please select ",a.numberOfCleaners-(a.preferredCleanerIds||[]).length," more cleaner",a.numberOfCleaners-(a.preferredCleanerIds||[]).length>1?"s":"","."]})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"How often do you need cleaning?"}),!C&&B&&(0,b.jsxs)("div",{className:"group relative",children:[(0,b.jsx)(t.Info,{className:"w-4 h-4 text-muted-foreground cursor-help"}),(0,b.jsx)("div",{className:"absolute left-0 top-6 z-10 w-64 p-2 bg-popover border rounded-md shadow-md opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none text-xs",children:"Recurring bookings are only available for Standard Cleaning and Airbnb Cleaning services."})]})]}),(0,b.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:R.map(d=>{let e=a.cleaningFrequency===d.value,f=D.includes(d.value),g=!f;return(0,b.jsx)("button",{type:"button",onClick:a=>{a.preventDefault(),f&&c({cleaningFrequency:d.value})},disabled:g,className:`relative p-4 rounded-xl border-2 transition-all ${e?"border-primary bg-primary/5":g?"border-border bg-muted/30 opacity-50 cursor-not-allowed":"border-border hover:border-primary/50 bg-background"}`,title:g?"Recurring bookings are only available for Standard Cleaning and Airbnb Cleaning":void 0,children:(0,b.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[d.icon&&(0,b.jsx)(d.icon,{className:`w-6 h-6 ${g?"text-muted-foreground":"text-primary"}`}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:`font-semibold ${g?"text-muted-foreground":""}`,children:d.label}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:d.subtitle}),d.discount&&f&&C&&(0,b.jsx)("p",{className:"text-xs text-green-600 font-medium mt-1",children:d.discount})]})]})},d.value)})})]})]})}var T=a.i(47565),U=a.i(23292);function V(){let a=(0,c.useParams)(),i=(0,c.useRouter)(),j=(0,c.useSearchParams)(),k=a.serviceSlug,{formData:l,updateFormData:m,validateCurrentStep:n,nextStep:o,previousStep:p,setServicesForSlug:q}=(0,h.useBookingFormContext)(),{data:r=[]}=(0,e.useQuery)({queryKey:["services"],queryFn:P.getServices,staleTime:3e5});return(0,d.useEffect)(()=>{r.length>0&&q(r)},[r,q]),(0,d.useEffect)(()=>{let a=j.get("ref");a&&!l.referralCode&&m({referralCode:a})},[j,l.referralCode,m]),(0,d.useEffect)(()=>{if(r.length>0){if(!k)return void i.replace("/booking/details");let a=(0,T.findServiceBySlug)(r,k);if(!a){U.toast.error("Invalid service selected"),i.replace("/booking/details");return}l.serviceId&&l.serviceId===a.id||m({serviceId:a.id})}},[k,r.length]),(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"bg-white rounded-xl p-6 max-w-[576px] mx-auto",children:(0,b.jsx)(S,{formData:l,updateFormData:m})}),(0,b.jsxs)("div",{className:"flex justify-between max-w-[576px] mx-auto mt-6",children:[(0,b.jsxs)(f.Button,{variant:"outline",onClick:()=>{if(k){let a=l.referralCode||j.get("ref"),b=a?`/booking/details/${k}?ref=${a}`:`/booking/details/${k}`;i.push(b)}else p()},children:[(0,b.jsx)(g.ArrowLeft,{className:"w-4 h-4 mr-2"}),"Back"]}),(0,b.jsx)("div",{className:"ml-auto",children:(0,b.jsxs)(f.Button,{onClick:a=>{a.preventDefault(),a.stopPropagation(),(a=>{a?.preventDefault(),a?.stopPropagation();let b=n();if(console.log("Worker handleNext - Validation:",b,"FormData:",l,"serviceSlug:",k),!b.valid)return b.errors.forEach(a=>U.toast.error(a));if(k){let a=l.referralCode||j.get("ref"),b=a?`/booking/submit/${k}?ref=${a}`:`/booking/submit/${k}`;console.log("Navigating to:",b),i.replace(b)}else console.log("No serviceSlug, using nextStep"),o()})(a)},type:"button",children:["Continue",(0,b.jsx)(g.ArrowLeft,{className:"w-4 h-4 ml-2 rotate-180"})]})})]})]})}function W(){return(0,b.jsx)(d.Suspense,{fallback:(0,b.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,b.jsx)("div",{className:"text-center",children:(0,b.jsx)("p",{className:"text-muted-foreground",children:"Loading..."})})}),children:(0,b.jsx)(V,{})})}a.s(["default",()=>W],32055)}];

//# sourceMappingURL=app_booking_worker_%5BserviceSlug%5D_page_tsx_0dee451e._.js.map