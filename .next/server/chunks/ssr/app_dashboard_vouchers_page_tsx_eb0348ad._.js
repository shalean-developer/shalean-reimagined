module.exports=[32700,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(75083),f=a.i(6015),g=a.i(91119),h=a.i(99570),i=a.i(80701),j=a.i(13749),k=a.i(50522),l=a.i(96221),m=a.i(66718),n=a.i(70430),o=a.i(23292),p=a.i(5050);let q=(0,p.createServerReference)("7081e40464f3c3699fd146e4be7b7e793fd9b413be",p.callServer,void 0,p.findSourceMapURL,"redeemVoucher"),r=(0,p.createServerReference)("6003e3002eac71bb39708c3f3b82e5b64ef1e083f9",p.callServer,void 0,p.findSourceMapURL,"getVoucherRedemptions");var s=a.i(60090);function t(){let a=(0,d.useSearchParams)(),p=(0,d.useRouter)(),[t,u]=(0,c.useState)("redeem"),[v,w]=(0,c.useState)(""),[x,y]=(0,c.useState)(5),[z,A]=(0,c.useState)(1),[B,C]=(0,c.useState)(""),[D,E]=(0,c.useState)(""),[F,G]=(0,c.useState)([]),[H,I]=(0,c.useState)([]),[J,K]=(0,c.useState)(!1),[L,M]=(0,c.useState)(!1),[N,O]=(0,c.useState)(!1),[P,Q]=(0,c.useState)(!1);(0,c.useEffect)(()=>{R()},[]),(0,c.useEffect)(()=>{(async()=>{let b=await (0,s.getAuthenticatedUser)(),c="",d="";if(b.success&&b.email)c=b.email;else{let b=a.get("email"),e=a.get("phone"),f=localStorage.getItem("dashboard_email"),g=localStorage.getItem("dashboard_phone");c=b||f||"",d=e||g||""}(c||d)&&(C(c),E(d),Q(!0),S(c,d||void 0))})()},[a]),(0,c.useEffect)(()=>{"history"===t&&B&&S(B,D||void 0)},[t,B,D]);let R=async()=>{try{M(!0);let a=await fetch("/api/voucher/list?status=active&limit=100"),b=await a.json();a.ok&&b.success&&b.vouchers?I(b.vouchers):console.error("Error loading vouchers:",b.error)}catch(a){console.error("Error loading vouchers:",a)}finally{M(!1)}},S=async(a,b)=>{try{K(!0);let c=await r(a,b);c.success&&c.redemptions?G(c.redemptions):c.error&&(console.error("Error loading voucher history:",c.error),"No redemptions found"!==c.error&&o.toast.error(c.error))}catch(a){console.error("Error loading voucher history:",a),o.toast.error("Failed to load voucher history")}finally{K(!1)}},T=async a=>{if(a.preventDefault(),!v.trim())return void o.toast.error("Please enter a voucher code");if(!B&&!D)return void o.toast.error("Please provide your email or phone number");try{O(!0);let a=await q(v.trim(),B,D||void 0);a.success?(o.toast.success(`Voucher redeemed successfully! R${a.amount?.toFixed(2)} has been added to your ShaleanCred balance.`),w(""),"history"===t&&B&&S(B,D||void 0)):o.toast.error(a.error||"Failed to redeem voucher")}catch(a){console.error("Error redeeming voucher:",a),o.toast.error("An unexpected error occurred")}finally{O(!1)}},U=F.length,V=Math.ceil(U/x)||1,W=(z-1)*x,X=W+x,Y=F.slice(W,X),Z=0===U?0:W+1,$=Math.min(X,U),_=a=>new Date(a).toLocaleDateString("en-ZA",{year:"numeric",month:"short",day:"numeric"});return(0,b.jsxs)("div",{className:"space-y-4 sm:space-y-6 w-full max-w-full overflow-x-hidden",children:[(0,b.jsx)("div",{children:(0,b.jsx)("h1",{className:"text-2xl sm:text-3xl md:text-4xl font-bold",children:"Vouchers"})}),(0,b.jsxs)(e.Tabs,{value:t,onValueChange:u,className:"w-full",children:[(0,b.jsxs)(e.TabsList,{className:"h-auto bg-transparent p-0 gap-6 border-b border-border rounded-none",children:[(0,b.jsx)(e.TabsTrigger,{value:"redeem",className:"px-0 py-2 rounded-none border-b-2 border-transparent data-[state=active]:border-primary data-[state=active]:bg-transparent data-[state=active]:shadow-none",children:"Redeem"}),(0,b.jsx)(e.TabsTrigger,{value:"history",className:"px-0 py-2 rounded-none border-b-2 border-transparent data-[state=active]:border-primary data-[state=active]:bg-transparent data-[state=active]:shadow-none",children:"History"})]}),(0,b.jsxs)(e.TabsContent,{value:"redeem",className:"mt-6 space-y-6",children:[(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h2",{className:"text-xl font-bold",children:"Redeem Gift Voucher"}),(0,b.jsxs)("form",{onSubmit:T,className:"space-y-3",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(n.Label,{htmlFor:"voucher-code",children:"Gift Voucher Code"}),(0,b.jsx)(m.Input,{id:"voucher-code",type:"text",placeholder:"Enter voucher code",value:v,onChange:a=>w(a.target.value.toUpperCase()),className:"w-full",disabled:N})]}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Gift voucher will be redeemed into ShaleanCred"}),(0,b.jsx)(h.Button,{variant:"default",className:"w-full sm:w-auto",type:"submit",disabled:N||!v.trim(),children:N?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(l.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Redeeming..."]}):"Redeem Gift Voucher"})]})]}),(0,b.jsx)("div",{className:"border-t border-border"}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h2",{className:"text-xl font-bold",children:"Available Gift Vouchers"}),L?(0,b.jsxs)("div",{className:"py-8 text-center",children:[(0,b.jsx)(l.Loader2,{className:"h-6 w-6 animate-spin mx-auto mb-2"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Loading vouchers..."})]}):0===H.length?(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"No available vouchers at this time."}):(0,b.jsx)("div",{className:"border rounded-lg overflow-hidden",children:(0,b.jsxs)(f.Table,{children:[(0,b.jsx)(f.TableHeader,{children:(0,b.jsxs)(f.TableRow,{children:[(0,b.jsx)(f.TableHead,{children:"Voucher Code"}),(0,b.jsx)(f.TableHead,{children:"Amount"}),(0,b.jsx)(f.TableHead,{children:"Status"}),(0,b.jsx)(f.TableHead,{children:"Created"}),(0,b.jsx)(f.TableHead,{children:"Valid Until"})]})}),(0,b.jsx)(f.TableBody,{children:H.map(a=>(0,b.jsxs)(f.TableRow,{children:[(0,b.jsx)(f.TableCell,{className:"text-sm font-mono",children:a.code}),(0,b.jsxs)(f.TableCell,{className:"text-sm font-medium",children:["R",a.amount.toFixed(2)]}),(0,b.jsx)(f.TableCell,{className:"text-sm",children:(0,b.jsx)("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${"active"===a.status?"bg-green-100 text-green-800":"redeemed"===a.status?"bg-gray-100 text-gray-800":"bg-red-100 text-red-800"}`,children:a.status})}),(0,b.jsx)(f.TableCell,{className:"text-sm text-muted-foreground",children:a.created_at?"string"==typeof a.created_at?_(a.created_at):new Date(a.created_at).toLocaleDateString("en-ZA",{year:"numeric",month:"short",day:"numeric"}):"N/A"}),(0,b.jsx)(f.TableCell,{className:"text-sm text-muted-foreground",children:a.valid_until?"string"==typeof a.valid_until&&a.valid_until.includes("T")?_(a.valid_until):new Date(a.valid_until).toLocaleDateString("en-ZA",{year:"numeric",month:"short",day:"numeric"}):"No expiry"})]},a.id))})]})})]}),(0,b.jsx)("div",{className:"border-t border-border"}),(0,b.jsxs)(g.Card,{children:[(0,b.jsx)(g.CardHeader,{children:(0,b.jsx)(g.CardTitle,{children:"Buy a Gift Voucher"})}),(0,b.jsxs)(g.CardContent,{className:"space-y-4",children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Looking to buy a gift voucher? You buy a gift voucher and send it to someone special who's in need of a good clean."}),(0,b.jsx)(h.Button,{variant:"default",onClick:()=>p.push("/get-voucher"),children:"Buy Vouchers"})]})]})]}),(0,b.jsxs)(e.TabsContent,{value:"history",className:"mt-6 space-y-6",children:[(0,b.jsxs)("div",{className:"space-y-4",children:[J?(0,b.jsxs)("div",{className:"py-12 text-center",children:[(0,b.jsx)(l.Loader2,{className:"h-6 w-6 animate-spin mx-auto mb-2"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Loading voucher history..."})]}):(0,b.jsx)(b.Fragment,{children:(0,b.jsx)("div",{className:"border rounded-lg overflow-hidden",children:(0,b.jsxs)(f.Table,{children:[(0,b.jsx)(f.TableHeader,{children:(0,b.jsxs)(f.TableRow,{children:[(0,b.jsx)(f.TableHead,{children:"Date"}),(0,b.jsx)(f.TableHead,{children:"Voucher Code"}),(0,b.jsx)(f.TableHead,{children:"Amount"})]})}),(0,b.jsx)(f.TableBody,{children:0===Y.length?(0,b.jsx)(f.TableRow,{children:(0,b.jsx)(f.TableCell,{colSpan:3,className:"text-center py-8 text-muted-foreground",children:"No voucher redemptions found"})}):Y.map(a=>(0,b.jsxs)(f.TableRow,{children:[(0,b.jsx)(f.TableCell,{className:"text-sm",children:_(a.redeemed_at)}),(0,b.jsx)(f.TableCell,{className:"text-sm font-mono",children:a.voucher_code}),(0,b.jsxs)(f.TableCell,{className:"text-sm font-medium",children:["R",a.amount.toFixed(2)]})]},a.id))})]})})}),U>0&&(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("div",{className:"flex items-center gap-2",children:(0,b.jsxs)(i.Select,{value:x.toString(),onValueChange:a=>{y(Number(a)),A(1)},children:[(0,b.jsx)(i.SelectTrigger,{className:"w-[120px] h-9",children:(0,b.jsx)(i.SelectValue,{})}),(0,b.jsxs)(i.SelectContent,{children:[(0,b.jsx)(i.SelectItem,{value:"5",children:"5 Items"}),(0,b.jsx)(i.SelectItem,{value:"10",children:"10 Items"}),(0,b.jsx)(i.SelectItem,{value:"20",children:"20 Items"}),(0,b.jsx)(i.SelectItem,{value:"50",children:"50 Items"})]})]})}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(h.Button,{variant:"default",size:"sm",onClick:()=>{z>1&&A(z-1)},disabled:1===z,className:"h-9",children:(0,b.jsx)(j.ChevronLeft,{className:"h-4 w-4"})}),(0,b.jsxs)("span",{className:"text-sm text-muted-foreground px-2",children:[Z,"-",$," of ",U]}),(0,b.jsx)(h.Button,{variant:"default",size:"sm",onClick:()=>{z<V&&A(z+1)},disabled:z>=V,className:"h-9",children:(0,b.jsx)(k.ChevronRight,{className:"h-4 w-4"})})]})]}),0===U&&(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("div",{className:"flex items-center gap-2",children:(0,b.jsxs)(i.Select,{value:x.toString(),onValueChange:a=>{y(Number(a)),A(1)},children:[(0,b.jsx)(i.SelectTrigger,{className:"w-[120px] h-9",children:(0,b.jsx)(i.SelectValue,{})}),(0,b.jsxs)(i.SelectContent,{children:[(0,b.jsx)(i.SelectItem,{value:"5",children:"5 Items"}),(0,b.jsx)(i.SelectItem,{value:"10",children:"10 Items"}),(0,b.jsx)(i.SelectItem,{value:"20",children:"20 Items"}),(0,b.jsx)(i.SelectItem,{value:"50",children:"50 Items"})]})]})}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(h.Button,{variant:"default",size:"sm",disabled:!0,className:"h-9",children:(0,b.jsx)(j.ChevronLeft,{className:"h-4 w-4"})}),(0,b.jsx)("span",{className:"text-sm text-muted-foreground px-2",children:"1-0 of 0"}),(0,b.jsx)(h.Button,{variant:"default",size:"sm",disabled:!0,className:"h-9",children:(0,b.jsx)(k.ChevronRight,{className:"h-4 w-4"})})]})]})]}),(0,b.jsxs)(g.Card,{children:[(0,b.jsx)(g.CardHeader,{children:(0,b.jsx)(g.CardTitle,{children:"Buy a Gift Voucher"})}),(0,b.jsxs)(g.CardContent,{className:"space-y-4",children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Looking to buy a gift voucher? You buy a gift voucher and send it to someone special who's in need of a good clean."}),(0,b.jsx)(h.Button,{variant:"default",onClick:()=>p.push("/get-voucher"),children:"Buy Vouchers"})]})]})]})]})]})}a.s(["default",()=>t],32700)}];

//# sourceMappingURL=app_dashboard_vouchers_page_tsx_eb0348ad._.js.map