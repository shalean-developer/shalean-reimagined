module.exports=[48839,a=>{"use strict";var b=a.i(87924),c=a.i(50944),d=a.i(72131),e=a.i(33217),f=a.i(99570),g=a.i(210),h=a.i(18873),i=a.i(70430),j=a.i(66718),k=a.i(46842),l=a.i(92258),m=a.i(63519),n=a.i(24987),o=a.i(41675),p=a.i(41710),q=a.i(99464),r=a.i(43108),s=a.i(81010),t=a.i(70106);let u=(0,t.default)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),v=(0,t.default)("Package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["path",{d:"m3.3 7 7.703 4.734a2 2 0 0 0 1.994 0L20.7 7",key:"yx3hmr"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]),w=(0,t.default)("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]),x=(0,t.default)("Coins",[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]]);var y=a.i(72228),z=a.i(76287),A=a.i(68926),B=a.i(95445),C=a.i(3244),D=a.i(49455);function E({formData:a,priceBreakdown:c,updateFormData:g,onValidateDiscountCode:h,onProceedToPayment:t,isProcessing:E=!1}){var F;let[G,H]=(0,d.useState)(a.discountCode||""),[I,J]=(0,d.useState)(!1),[K,L]=(0,d.useState)(!1);(0,d.useEffect)(()=>{(async()=>{let a=(0,B.createClient)(),{data:{user:b}}=await a.auth.getUser();L(!!b)})();let{data:{subscription:a}}=(0,B.createClient)().auth.onAuthStateChange((a,b)=>{L(!!b?.user)});return()=>{a.unsubscribe()}},[]);let{data:M=0,isLoading:N}=(0,e.useQuery)({queryKey:["credit-balance",K],queryFn:async()=>{try{let a=await fetch("/api/profile/balance");if(401===a.status)return L(!1),0;if(a.ok){let b=await a.json();return b.success&&b.balance||0}return console.warn("Failed to fetch credit balance:",a.status,a.statusText),0}catch(a){return console.error("Error fetching credit balance:",a),0}},enabled:K,staleTime:3e4,retry:!1}),{data:O=[]}=(0,e.useQuery)({queryKey:["services"],queryFn:z.getServices,staleTime:3e5}),{data:P=[]}=(0,e.useQuery)({queryKey:["additional-services",a.serviceId],queryFn:()=>(0,A.getAdditionalServices)(a.serviceId||void 0),enabled:!!a.serviceId,staleTime:3e5}),Q=O.find(b=>b.id===a.serviceId),R=Q?.name||"Standard Cleaning",S=R?.toLowerCase().includes("carpet")??!1,T=(0,D.requiresTeamBooking)(R),U=a.additionalServices.map(a=>P.find(b=>b.id===a)).filter(a=>void 0!==a),{data:V=[]}=(0,e.useQuery)({queryKey:["cleaners",JSON.stringify(a.preferredCleanerIds)],queryFn:async()=>{if(!a.preferredCleanerIds||0===a.preferredCleanerIds.length)return[];let b=(0,B.createClient)(),{data:c}=await b.from("cleaners").select("id, name, avatar_url, photo_url").in("id",a.preferredCleanerIds);return c||[]},enabled:!T&&a.preferredCleanerIds&&a.preferredCleanerIds.length>0,staleTime:3e5}),W=c.subtotal-c.frequencyDiscountAmount-c.discountAmount,X=(0,D.supportsRecurringBookings)(R),Y="one-time"!==a.cleaningFrequency,Z=!!a.serviceDate,$=Y&&Z&&X,_=a.tipAmount||0,aa=1,ab=c.totalAmount+_;if($)try{let b=new Date(a.serviceDate);aa=(0,C.calculateBookingDatesForMonth)(b,a.cleaningFrequency).length,ab=c.totalAmount*aa+_}catch(a){console.error("Error calculating recurring total:",a),aa=1,ab=c.totalAmount+_}let ac=$?ab:c.totalAmount+_,ad=a.useCredits||!1,ae=Math.round(100*ac)/100,af=Math.round(100*M)/100,ag=Math.round(100*(a.creditsAmount||0))/100,ah=ad?Math.min(ag,af,ae):0,ai=Math.max(0,Math.round((ae-ah)*100)/100),aj=async()=>{J(!0),await h(G),J(!1)};return(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-2xl font-bold text-foreground mb-1",children:"Review Your Booking"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Please review your booking details before confirming."})]}),(0,b.jsxs)("div",{className:"bg-white rounded-xl p-4 border border-border",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:T?"Team":"Cleaner"}),(0,b.jsx)("button",{type:"button",className:"text-primary",children:(0,b.jsx)(q.Pencil,{className:"w-4 h-4"})})]}),(0,b.jsxs)("div",{className:"bg-primary text-primary-foreground rounded-lg p-3 mb-3",children:[(0,b.jsx)("p",{className:"text-xs mb-1",children:"An upfront tip for"}),T?a.teamNumber?(0,b.jsxs)("p",{className:"font-bold text-base",children:["Team ",a.teamNumber]}):(0,b.jsx)("p",{className:"font-bold text-base",children:"No team selected"}):V.length>0?(0,b.jsx)("div",{className:"space-y-1",children:V.map(a=>(0,b.jsx)("p",{className:"font-bold text-base",children:a.name},a.id))}):(0,b.jsx)("p",{className:"font-bold text-base",children:"No preference - Best available"})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)(i.Label,{className:"mb-2 block text-sm",children:["Tip amount",Y&&$&&(0,b.jsx)("span",{className:"text-xs text-muted-foreground font-normal ml-1",children:"(one-time, first booking only)"})]}),(0,b.jsxs)("div",{className:"flex gap-2 flex-wrap items-center",children:[[0,25,50,75,100].map(c=>(0,b.jsxs)("button",{type:"button",onClick:()=>g({tipAmount:c}),className:`px-3 py-1.5 rounded-full border-2 transition-all text-sm ${a.tipAmount===c?"border-primary bg-primary text-primary-foreground":"border-border hover:border-primary/50"}`,children:["R",c]},c)),(0,b.jsx)(j.Input,{type:"number",value:a.tipAmount||"",onChange:a=>g({tipAmount:parseFloat(a.target.value)||0}),placeholder:"Custom",className:"w-24 h-8 text-sm"})]})]})]}),(0,b.jsxs)("div",{className:"bg-white rounded-xl p-4 border border-border",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Contact & Address"}),(0,b.jsx)("button",{type:"button",className:"text-primary",children:(0,b.jsx)(q.Pencil,{className:"w-4 h-4"})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{children:"First Name *"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(k.User,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),(0,b.jsx)(j.Input,{placeholder:"e.g., Thabo",className:"pl-10",value:a.customerFirstName,onChange:a=>g({customerFirstName:a.target.value})})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{children:"Last Name *"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(k.User,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),(0,b.jsx)(j.Input,{placeholder:"e.g., Mokoena",className:"pl-10",value:a.customerLastName,onChange:a=>g({customerLastName:a.target.value})})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{children:"Email Address *"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(l.Mail,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),(0,b.jsx)(j.Input,{type:"email",placeholder:"e.g., thabo@example.com",className:"pl-10",value:a.customerEmail,onChange:a=>g({customerEmail:a.target.value})})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{children:"Phone Number *"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(m.Phone,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),(0,b.jsx)(j.Input,{placeholder:"0821234567 or +27821234567",className:"pl-10",value:a.customerPhone,onChange:a=>g({customerPhone:a.target.value})})]})]}),(0,b.jsxs)("div",{className:"space-y-2 md:col-span-2",children:[(0,b.jsx)(i.Label,{children:"Address *"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(n.MapPin,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),(0,b.jsx)(j.Input,{placeholder:"Street address, Suburb, City",className:"pl-10",value:[a.serviceAddress,a.serviceAptUnit,a.serviceSuburb,a.serviceCity].filter(Boolean).join(", "),onChange:a=>{g({serviceAddress:a.target.value})}})]})]})]})]}),(0,b.jsx)("div",{className:"space-y-3",children:(0,b.jsxs)("div",{className:"bg-white rounded-xl p-4 border border-border",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"What You're Booking"}),(0,b.jsx)("button",{type:"button",className:"text-primary",children:(0,b.jsx)(q.Pencil,{className:"w-4 h-4"})})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"pb-3 border-b border-border",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)(w,{className:"w-4 h-4 text-primary"}),(0,b.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Service"})]}),(0,b.jsx)("p",{className:"text-base font-semibold text-foreground",children:R}),a.cleaningFrequency&&"one-time"!==a.cleaningFrequency&&(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["Frequency: ",{"one-time":"One-time",weekly:"Weekly","bi-weekly":"Bi-weekly",monthly:"Monthly"}[F=a.cleaningFrequency]||F]})]}),S?(a.carpetTypes.length>0||a.numberOfFittedRooms||a.numberOfLooseCarpets||a.roomStatus)&&(0,b.jsxs)("div",{className:"pb-3 border-b border-border",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)(s.Home,{className:"w-4 h-4 text-primary"}),(0,b.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Carpet Details"})]}),(0,b.jsxs)("div",{className:"space-y-2 text-sm",children:[a.carpetTypes.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Carpet Types: "}),(0,b.jsx)("span",{className:"font-medium capitalize",children:a.carpetTypes.join(", ")})]}),a.numberOfFittedRooms&&(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Fitted Rooms: "}),(0,b.jsx)("span",{className:"font-medium",children:a.numberOfFittedRooms})]}),a.numberOfLooseCarpets&&(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Loose Carpets/Rugs: "}),(0,b.jsx)("span",{className:"font-medium",children:a.numberOfLooseCarpets})]}),a.roomStatus&&(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Room Status: "}),(0,b.jsx)("span",{className:"font-medium capitalize",children:a.roomStatus.replace(/-/g," ")})]})]})]}):(parseInt(a.bedrooms)>0||parseInt(a.bathrooms)>0)&&(0,b.jsxs)("div",{className:"pb-3 border-b border-border",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)(s.Home,{className:"w-4 h-4 text-primary"}),(0,b.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Property Details"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Bedrooms: "}),(0,b.jsx)("span",{className:"font-medium",children:a.bedrooms})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Bathrooms: "}),(0,b.jsx)("span",{className:"font-medium",children:a.bathrooms})]})]})]}),U.length>0&&(0,b.jsxs)("div",{className:"pb-3 border-b border-border",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)(w,{className:"w-4 h-4 text-primary"}),(0,b.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Additional Services"})]}),(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:U.map(a=>(0,b.jsx)("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-primary/10 text-primary border border-primary/20",children:a.name},a.id))})]}),(a.numberOfCleaners>1||"yes"===a.cleaningEquipment||a.serviceDuration)&&(0,b.jsxs)("div",{className:"pb-3 border-b border-border space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)(v,{className:"w-4 h-4 text-primary"}),(0,b.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Service Options"})]}),a.numberOfCleaners>1&&(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(u,{className:"w-4 h-4 text-primary"}),(0,b.jsxs)("span",{className:"text-sm text-muted-foreground",children:[(0,b.jsx)("span",{className:"font-medium",children:a.numberOfCleaners})," cleaner",a.numberOfCleaners>1?"s":""," assigned",a.numberOfCleaners>1&&(0,b.jsxs)("span",{className:"text-xs ml-1",children:["(+R",((a.numberOfCleaners-1)*250).toFixed(2),")"]})]})]}),"yes"===a.cleaningEquipment&&(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(v,{className:"w-4 h-4 text-primary"}),(0,b.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Equipment & supplies included",c.equipmentSupplyPrice>0&&(0,b.jsxs)("span",{className:"text-xs ml-1",children:["(+R",c.equipmentSupplyPrice.toFixed(2),")"]})]})]}),a.serviceDuration&&(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(p.Clock,{className:"w-4 h-4 text-primary"}),(0,b.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Estimated duration: ",(0,b.jsxs)("span",{className:"font-medium",children:[a.serviceDuration," hours"]})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,b.jsx)(o.Calendar,{className:"w-4 h-4 text-primary"}),(0,b.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Schedule"})]}),(0,b.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Date"}),(0,b.jsx)("span",{className:"font-medium",children:a.serviceDate?(0,y.format)(new Date(a.serviceDate),"EEE, MMM d, yyyy"):"Not set"})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Time"}),(0,b.jsx)("span",{className:"font-medium",children:a.serviceTime||"Not set"})]})]})]})]})]})}),(0,b.jsxs)("div",{className:"bg-primary/5 rounded-xl p-4 border border-primary/20",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:$?`Total Amount (${aa} ${1===aa?"booking":"bookings"} this month)`:"Total Amount"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:$?`${(()=>{switch(a.cleaningFrequency){case"weekly":return"Weekly";case"bi-weekly":return"Bi-Weekly";case"monthly":return"Monthly";default:return""}})()} recurring - All fees included`:Y&&!Z?"Select a date to see monthly total":"All fees included"})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsxs)("p",{className:`text-2xl font-bold ${ad&&ah>0?"line-through text-muted-foreground":"text-primary"}`,children:["R",$?ab.toFixed(2):(c.totalAmount+_).toFixed(2)]}),ad&&ah>0&&(0,b.jsxs)("p",{className:"text-2xl font-bold text-primary mt-1",children:["R",ai.toFixed(2)]})]})]}),$&&aa>1&&(0,b.jsxs)("div",{className:"mb-3 text-xs text-muted-foreground text-right",children:["(R",c.totalAmount.toFixed(2)," Ã— ",aa,") ",_>0?`+ R${_.toFixed(2)} tip`:""," = R",ab.toFixed(2)]}),(0,b.jsxs)("div",{className:"space-y-1.5 mb-3 pt-3 border-t border-border",children:[(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Service & rooms"}),(0,b.jsxs)("span",{children:["R",Math.max(0,W).toFixed(2)]})]}),(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Service fee"}),(0,b.jsxs)("span",{children:["+R",c.serviceFee.toFixed(2)]})]}),_>0&&(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsxs)("span",{className:"text-muted-foreground",children:["Tip",Y&&$?" (one-time, first booking only)":""]}),(0,b.jsxs)("span",{children:["+R",_.toFixed(2)]})]})]}),(0,b.jsxs)("div",{className:"mb-3",children:[(0,b.jsx)(i.Label,{className:"mb-1.5 block text-sm",children:"Have a discount code?"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(j.Input,{placeholder:"Enter discount code",value:G,onChange:a=>H(a.target.value),className:"h-9 text-sm"}),(0,b.jsx)(f.Button,{type:"button",variant:"outline",onClick:aj,disabled:I||!G,className:"h-9",children:"Apply"})]})]}),K&&(0,b.jsxs)("div",{className:"mb-3 p-3 bg-secondary/50 rounded-lg border border-border",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)(x,{className:"w-4 h-4 text-primary"}),(0,b.jsx)(i.Label,{className:"text-sm font-medium",children:"Use ShaleanCred"})]}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mb-2",children:["You have ",(0,b.jsxs)("span",{className:"font-semibold text-primary",children:["R",M.toFixed(2)]})," ShaleanCred available"]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)("input",{type:"checkbox",id:"use-credits",checked:ad,disabled:N||M<=0,onChange:a=>{if(N||M<=0)return;let b=a.target.checked;g({useCredits:b,creditsAmount:b?Math.min(M,ac):0})},className:"w-4 h-4 rounded border-gray-300 text-primary focus:ring-primary disabled:opacity-50 disabled:cursor-not-allowed"}),(0,b.jsxs)("label",{htmlFor:"use-credits",className:`text-sm ${!N&&M>0?"cursor-pointer":"cursor-not-allowed opacity-50"}`,children:["Use ShaleanCred for this booking",N&&(0,b.jsx)("span",{className:"text-xs text-muted-foreground block mt-1",children:"Loading balance..."}),!N&&M<=0&&(0,b.jsx)("span",{className:"text-xs text-muted-foreground block mt-1",children:"No ShaleanCred available"})]})]}),ad&&(0,b.jsxs)("div",{className:"mt-2",children:[(0,b.jsxs)(i.Label,{className:"mb-1.5 block text-xs",children:["Amount to use (max R",Math.min(M,ac).toFixed(2),")"]}),(0,b.jsx)(j.Input,{type:"number",min:"0",max:Math.min(M,ac),step:"0.01",value:ah>0?ah.toFixed(2):"",onChange:a=>{g({creditsAmount:Math.round(100*Math.min(Math.max(0,Math.round(100*(parseFloat(a.target.value.replace(",","."))||0))/100),Math.min(M,ac)))/100})},onBlur:a=>{ah>0&&g({creditsAmount:Math.min(Math.round(100*ah)/100,Math.min(M,ac))})},className:"h-9 text-sm",placeholder:"0.00"}),ah>0&&(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["Remaining to pay: ",(0,b.jsxs)("span",{className:"font-semibold",children:["R",ai.toFixed(2)]})]})]})]}),ad&&ah>0&&(0,b.jsxs)("div",{className:"mb-3 p-2 bg-primary/10 rounded border border-primary/20",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"After ShaleanCred:"}),(0,b.jsxs)("span",{className:"font-bold text-primary",children:["R",ai.toFixed(2)]})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center text-xs text-muted-foreground mt-1",children:[(0,b.jsx)("span",{children:"Credits applied:"}),(0,b.jsxs)("span",{children:["-R",ah.toFixed(2)]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mb-3",children:[(0,b.jsx)(r.Lock,{className:"w-3.5 h-3.5"}),(0,b.jsx)("span",{children:"Secure payment powered by Paystack"})]}),(0,b.jsx)(f.Button,{type:"button",className:"w-full",size:"lg",onClick:t,disabled:E,children:E?"Processing...":"Confirm & Pay"})]})]})}var F=a.i(5050);let G=(0,F.createServerReference)("401cc942bd1fec2a89e1c8763701789a801eea4e1a",F.callServer,void 0,F.findSourceMapURL,"createBookingDraft"),H=(0,F.createServerReference)("404aead3639ed9de2f929e911fb1265e0d2203b602",F.callServer,void 0,F.findSourceMapURL,"initializePaymentForBooking"),I=(0,F.createServerReference)("604c7c923397241e6d37d64bf3a465ebd2b1552a85",F.callServer,void 0,F.findSourceMapURL,"validateDiscountCode");var J=a.i(42496),K=a.i(4020),L=a.i(47565),M=a.i(23292);function N(){let a=(0,c.useParams)(),i=(0,c.useRouter)(),j=(0,c.useSearchParams)(),k=a.serviceSlug,{formData:l,updateFormData:m,validateCurrentStep:n,previousStep:o,getDiscountAmount:p,setDiscountAmount:q,setServicesForSlug:r}=(0,h.useBookingFormContext)(),[s,t]=(0,d.useState)(0),[u,v]=(0,d.useState)(!1),[w,x]=(0,d.useState)(null),y=(0,d.useRef)(l.serviceId),{data:B=[]}=(0,e.useQuery)({queryKey:["services"],queryFn:z.getServices,staleTime:3e5});(0,d.useEffect)(()=>{B.length>0&&r(B)},[B,r]),(0,d.useEffect)(()=>{let a=j.get("ref");a&&!l.referralCode&&m({referralCode:a})},[j,l.referralCode,m]),(0,d.useEffect)(()=>{if(B.length>0){if(!k)return void i.replace("/booking/details");let a=(0,L.findServiceBySlug)(B,k);if(!a){M.toast.error("Invalid service selected"),i.replace("/booking/details");return}l.serviceId&&l.serviceId===a.id||m({serviceId:a.id})}},[k,B.length]),(0,d.useEffect)(()=>{let a=()=>{t(p())};return window.addEventListener("discountUpdated",a),a(),()=>{window.removeEventListener("discountUpdated",a)}},[p]),(0,d.useEffect)(()=>{let a=y.current,b=l.serviceId;a&&a!==b&&(m({additionalServices:[],bedrooms:"0",bathrooms:"1",carpetTypes:[],roomStatus:"",numberOfFittedRooms:"",numberOfLooseCarpets:"",cleaningEquipment:"",serviceDate:"",serviceTime:"",serviceDuration:3.5,discountCode:""}),t(0)),y.current=b},[l.serviceId,m]);let{data:C=[]}=(0,e.useQuery)({queryKey:["pricing-rules"],queryFn:J.getPricingRulesClient,staleTime:6e5}),{data:F=[]}=(0,e.useQuery)({queryKey:["additional-services",l.serviceId],queryFn:()=>(0,A.getAdditionalServices)(l.serviceId||void 0),enabled:!0,staleTime:3e5}),N=B.find(a=>a.id===l.serviceId),O=N?.name.toLowerCase().includes("carpet")??!1,P=(0,d.useMemo)(()=>{if(!(O?l.serviceId&&C.length>0:l.serviceId&&l.bedrooms&&l.bathrooms&&C.length>0))return{basePrice:0,bedroomsPrice:0,bathroomsPrice:0,fittedRoomsPrice:0,looseCarpetsPrice:0,additionalServicesPrice:0,equipmentSupplyPrice:0,additionalCleanersPrice:0,subtotal:0,frequencyDiscountPercent:0,frequencyDiscountAmount:0,discountAmount:s,serviceFee:0,totalAmount:0};let a=l.additionalServices.filter(a=>F.some(b=>b.id===a));return(0,K.calculatePriceBreakdownClient)(C,l.serviceId,l.bedrooms||"0",l.bathrooms||"1",a,l.cleaningFrequency,s,l.numberOfFittedRooms||"",l.numberOfLooseCarpets||"",O,N?.name,l.cleaningEquipment,l.numberOfCleaners||1)},[C,l.serviceId,l.bedrooms,l.bathrooms,JSON.stringify(l.additionalServices),l.cleaningFrequency,l.numberOfFittedRooms,l.numberOfLooseCarpets,l.cleaningEquipment,l.numberOfCleaners,s,O,F,N?.name]),Q=async a=>{if(!a.trim())return void M.toast.error("Please enter a discount code");let b=P.subtotal-P.frequencyDiscountAmount,c=await I(a,b);c.valid?(m({discountCode:a}),t(c.discountAmount),q(c.discountAmount),window.dispatchEvent(new Event("discountUpdated")),M.toast.success("Discount code applied successfully!")):M.toast.error(c.error||"Invalid discount code")},R=async()=>{let a=n();if(!a.valid)return void a.errors.forEach(a=>M.toast.error(a));if(N){if((0,D.requiresTeamBooking)(N.name)){if(!l.teamNumber||l.teamNumber<1||l.teamNumber>3)return void M.toast.error("Please select a team (1, 2, or 3) for this service")}else if(null!==l.teamNumber&&void 0!==l.teamNumber)return void M.toast.error("Team selection is only available for Deep Cleaning and Move In/Out services")}v(!0);try{let a=await G(l);if(!a.success||!a.bookingId&&!a.bookingIds){M.toast.error(a.error||"Failed to create booking"),v(!1);return}let b=a.bookingIds||(a.bookingId?[a.bookingId]:[]);if(x(b[0]),l.useCredits&&l.creditsAmount&&l.creditsAmount>0)try{let a=await fetch("/api/bookings/use-credits",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bookingIds:b,creditsAmount:l.creditsAmount})}),c=await a.json();if(!a.ok||!c.success){M.toast.error(c.error||"Failed to use ShaleanCred"),v(!1);return}M.toast.success(`Applied R${l.creditsAmount.toFixed(2)} ShaleanCred to your booking`)}catch(a){console.error("Error using credits:",a),M.toast.error("Failed to use ShaleanCred. Please try again."),v(!1);return}let c=await H(b.length>1?b:b[0]);if(!c.success){M.toast.error(c.error||"Failed to initialize payment"),v(!1);return}if(!c.authorizationUrl){M.toast.success("Booking confirmed! Payment completed with ShaleanCred."),i.push(`/booking/confirmation/${b[0]}`);return}window.location.href=c.authorizationUrl}catch(a){console.error("Error processing payment:",a),M.toast.error("An unexpected error occurred. Please try again."),v(!1)}};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"bg-white rounded-xl p-6 max-w-[576px] mx-auto",children:(0,b.jsx)(E,{formData:l,priceBreakdown:P,updateFormData:m,onValidateDiscountCode:Q,onProceedToPayment:R,isProcessing:u})}),(0,b.jsx)("div",{className:"flex justify-between max-w-[576px] mx-auto mt-6",children:(0,b.jsxs)(f.Button,{variant:"outline",onClick:()=>{if(k){let a=l.referralCode||j.get("ref"),b=a?`/booking/worker/${k}?ref=${a}`:`/booking/worker/${k}`;i.push(b)}else o()},children:[(0,b.jsx)(g.ArrowLeft,{className:"w-4 h-4 mr-2"}),"Back"]})})]})}function O(){return(0,b.jsx)(d.Suspense,{fallback:(0,b.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,b.jsx)("div",{className:"text-center",children:(0,b.jsx)("p",{className:"text-muted-foreground",children:"Loading..."})})}),children:(0,b.jsx)(N,{})})}a.s(["default",()=>O],48839)}];

//# sourceMappingURL=app_booking_submit_%5BserviceSlug%5D_page_tsx_23d670e0._.js.map