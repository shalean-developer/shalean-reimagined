module.exports=[48839,a=>{"use strict";var b=a.i(87924),c=a.i(50944),d=a.i(72131),e=a.i(33217),f=a.i(99570),g=a.i(210),h=a.i(18873),i=a.i(70430),j=a.i(66718),k=a.i(46842),l=a.i(92258),m=a.i(63519),n=a.i(24987),o=a.i(41675),p=a.i(41710),q=a.i(99464),r=a.i(43108),s=a.i(81010),t=a.i(70106);let u=(0,t.default)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),v=(0,t.default)("Package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["path",{d:"m3.3 7 7.703 4.734a2 2 0 0 0 1.994 0L20.7 7",key:"yx3hmr"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]),w=(0,t.default)("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);var x=a.i(72228),y=a.i(39338),z=a.i(46663),A=a.i(95445),B=a.i(3244),C=a.i(49455);function D({formData:a,priceBreakdown:c,updateFormData:g,onValidateDiscountCode:h,onProceedToPayment:t,isProcessing:D=!1}){var E;let[F,G]=(0,d.useState)(a.discountCode||""),[H,I]=(0,d.useState)(!1),{data:J=[]}=(0,e.useQuery)({queryKey:["services"],queryFn:y.getServices,staleTime:3e5}),{data:K=[]}=(0,e.useQuery)({queryKey:["additional-services",a.serviceId],queryFn:()=>(0,z.getAdditionalServices)(a.serviceId||void 0),enabled:!!a.serviceId,staleTime:3e5}),L=J.find(b=>b.id===a.serviceId),M=L?.name||"Standard Cleaning",N=M?.toLowerCase().includes("carpet")??!1,O=a.additionalServices.map(a=>K.find(b=>b.id===a)).filter(a=>void 0!==a),{data:P=[]}=(0,e.useQuery)({queryKey:["cleaners",JSON.stringify(a.preferredCleanerIds)],queryFn:async()=>{if(!a.preferredCleanerIds||0===a.preferredCleanerIds.length)return[];let b=(0,A.createClient)(),{data:c}=await b.from("cleaners").select("id, name, avatar_url, photo_url").in("id",a.preferredCleanerIds);return c||[]},enabled:a.preferredCleanerIds&&a.preferredCleanerIds.length>0,staleTime:3e5}),Q=c.subtotal-c.frequencyDiscountAmount-c.discountAmount,R=(0,C.supportsRecurringBookings)(M),S="one-time"!==a.cleaningFrequency,T=!!a.serviceDate,U=S&&T&&R,V=a.tipAmount||0,W=1,X=c.totalAmount+V;if(U)try{let b=new Date(a.serviceDate);W=(0,B.calculateBookingDatesForMonth)(b,a.cleaningFrequency).length,X=c.totalAmount*W+V}catch(a){console.error("Error calculating recurring total:",a),W=1,X=c.totalAmount+V}let Y=async()=>{I(!0),await h(F),I(!1)};return(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-2xl font-bold text-foreground mb-1",children:"Review Your Booking"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Please review your booking details before confirming."})]}),(0,b.jsxs)("div",{className:"bg-white rounded-xl p-4 border border-border",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Cleaner"}),(0,b.jsx)("button",{type:"button",className:"text-primary",children:(0,b.jsx)(q.Pencil,{className:"w-4 h-4"})})]}),(0,b.jsxs)("div",{className:"bg-primary text-primary-foreground rounded-lg p-3 mb-3",children:[(0,b.jsx)("p",{className:"text-xs mb-1",children:"An upfront tip for"}),P.length>0?(0,b.jsx)("div",{className:"space-y-1",children:P.map(a=>(0,b.jsx)("p",{className:"font-bold text-base",children:a.name},a.id))}):(0,b.jsx)("p",{className:"font-bold text-base",children:"No preference - Best available"})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)(i.Label,{className:"mb-2 block text-sm",children:["Tip amount",S&&U&&(0,b.jsx)("span",{className:"text-xs text-muted-foreground font-normal ml-1",children:"(one-time, first booking only)"})]}),(0,b.jsxs)("div",{className:"flex gap-2 flex-wrap items-center",children:[[0,25,50,75,100].map(c=>(0,b.jsxs)("button",{type:"button",onClick:()=>g({tipAmount:c}),className:`px-3 py-1.5 rounded-full border-2 transition-all text-sm ${a.tipAmount===c?"border-primary bg-primary text-primary-foreground":"border-border hover:border-primary/50"}`,children:["R",c]},c)),(0,b.jsx)(j.Input,{type:"number",value:a.tipAmount||"",onChange:a=>g({tipAmount:parseFloat(a.target.value)||0}),placeholder:"Custom",className:"w-24 h-8 text-sm"})]})]})]}),(0,b.jsxs)("div",{className:"bg-white rounded-xl p-4 border border-border",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Contact & Address"}),(0,b.jsx)("button",{type:"button",className:"text-primary",children:(0,b.jsx)(q.Pencil,{className:"w-4 h-4"})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{children:"First Name *"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(k.User,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),(0,b.jsx)(j.Input,{placeholder:"e.g., Thabo",className:"pl-10",value:a.customerFirstName,onChange:a=>g({customerFirstName:a.target.value})})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{children:"Last Name *"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(k.User,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),(0,b.jsx)(j.Input,{placeholder:"e.g., Mokoena",className:"pl-10",value:a.customerLastName,onChange:a=>g({customerLastName:a.target.value})})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{children:"Email Address *"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(l.Mail,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),(0,b.jsx)(j.Input,{type:"email",placeholder:"e.g., thabo@example.com",className:"pl-10",value:a.customerEmail,onChange:a=>g({customerEmail:a.target.value})})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{children:"Phone Number *"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(m.Phone,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),(0,b.jsx)(j.Input,{placeholder:"0821234567 or +27821234567",className:"pl-10",value:a.customerPhone,onChange:a=>g({customerPhone:a.target.value})})]})]}),(0,b.jsxs)("div",{className:"space-y-2 md:col-span-2",children:[(0,b.jsx)(i.Label,{children:"Address *"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(n.MapPin,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),(0,b.jsx)(j.Input,{placeholder:"Street address, Suburb, City",className:"pl-10",value:[a.serviceAddress,a.serviceAptUnit,a.serviceSuburb,a.serviceCity].filter(Boolean).join(", "),onChange:a=>{g({serviceAddress:a.target.value})}})]})]})]})]}),(0,b.jsx)("div",{className:"space-y-3",children:(0,b.jsxs)("div",{className:"bg-white rounded-xl p-4 border border-border",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"What You're Booking"}),(0,b.jsx)("button",{type:"button",className:"text-primary",children:(0,b.jsx)(q.Pencil,{className:"w-4 h-4"})})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"pb-3 border-b border-border",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)(w,{className:"w-4 h-4 text-primary"}),(0,b.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Service"})]}),(0,b.jsx)("p",{className:"text-base font-semibold text-foreground",children:M}),a.cleaningFrequency&&"one-time"!==a.cleaningFrequency&&(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["Frequency: ",{"one-time":"One-time",weekly:"Weekly","bi-weekly":"Bi-weekly",monthly:"Monthly"}[E=a.cleaningFrequency]||E]})]}),N?(a.carpetTypes.length>0||a.numberOfFittedRooms||a.numberOfLooseCarpets||a.roomStatus)&&(0,b.jsxs)("div",{className:"pb-3 border-b border-border",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)(s.Home,{className:"w-4 h-4 text-primary"}),(0,b.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Carpet Details"})]}),(0,b.jsxs)("div",{className:"space-y-2 text-sm",children:[a.carpetTypes.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Carpet Types: "}),(0,b.jsx)("span",{className:"font-medium capitalize",children:a.carpetTypes.join(", ")})]}),a.numberOfFittedRooms&&(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Fitted Rooms: "}),(0,b.jsx)("span",{className:"font-medium",children:a.numberOfFittedRooms})]}),a.numberOfLooseCarpets&&(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Loose Carpets/Rugs: "}),(0,b.jsx)("span",{className:"font-medium",children:a.numberOfLooseCarpets})]}),a.roomStatus&&(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Room Status: "}),(0,b.jsx)("span",{className:"font-medium capitalize",children:a.roomStatus.replace(/-/g," ")})]})]})]}):(parseInt(a.bedrooms)>0||parseInt(a.bathrooms)>0)&&(0,b.jsxs)("div",{className:"pb-3 border-b border-border",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)(s.Home,{className:"w-4 h-4 text-primary"}),(0,b.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Property Details"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Bedrooms: "}),(0,b.jsx)("span",{className:"font-medium",children:a.bedrooms})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Bathrooms: "}),(0,b.jsx)("span",{className:"font-medium",children:a.bathrooms})]})]})]}),O.length>0&&(0,b.jsxs)("div",{className:"pb-3 border-b border-border",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)(w,{className:"w-4 h-4 text-primary"}),(0,b.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Additional Services"})]}),(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:O.map(a=>(0,b.jsx)("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-primary/10 text-primary border border-primary/20",children:a.name},a.id))})]}),(a.numberOfCleaners>1||"yes"===a.cleaningEquipment||a.serviceDuration)&&(0,b.jsxs)("div",{className:"pb-3 border-b border-border space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)(v,{className:"w-4 h-4 text-primary"}),(0,b.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Service Options"})]}),a.numberOfCleaners>1&&(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(u,{className:"w-4 h-4 text-primary"}),(0,b.jsxs)("span",{className:"text-sm text-muted-foreground",children:[(0,b.jsx)("span",{className:"font-medium",children:a.numberOfCleaners})," cleaner",a.numberOfCleaners>1?"s":""," assigned",a.numberOfCleaners>1&&(0,b.jsxs)("span",{className:"text-xs ml-1",children:["(+R",((a.numberOfCleaners-1)*250).toFixed(2),")"]})]})]}),"yes"===a.cleaningEquipment&&(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(v,{className:"w-4 h-4 text-primary"}),(0,b.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Equipment & supplies included",c.equipmentSupplyPrice>0&&(0,b.jsxs)("span",{className:"text-xs ml-1",children:["(+R",c.equipmentSupplyPrice.toFixed(2),")"]})]})]}),a.serviceDuration&&(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(p.Clock,{className:"w-4 h-4 text-primary"}),(0,b.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Estimated duration: ",(0,b.jsxs)("span",{className:"font-medium",children:[a.serviceDuration," hours"]})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,b.jsx)(o.Calendar,{className:"w-4 h-4 text-primary"}),(0,b.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Schedule"})]}),(0,b.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Date"}),(0,b.jsx)("span",{className:"font-medium",children:a.serviceDate?(0,x.format)(new Date(a.serviceDate),"EEE, MMM d, yyyy"):"Not set"})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Time"}),(0,b.jsx)("span",{className:"font-medium",children:a.serviceTime||"Not set"})]})]})]})]})]})}),(0,b.jsxs)("div",{className:"bg-primary/5 rounded-xl p-4 border border-primary/20",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:U?`Total Amount (${W} ${1===W?"booking":"bookings"} this month)`:"Total Amount"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:U?`${(()=>{switch(a.cleaningFrequency){case"weekly":return"Weekly";case"bi-weekly":return"Bi-Weekly";case"monthly":return"Monthly";default:return""}})()} recurring - All fees included`:S&&!T?"Select a date to see monthly total":"All fees included"})]}),(0,b.jsx)("div",{className:"text-right",children:(0,b.jsxs)("p",{className:"text-2xl font-bold text-primary",children:["R",U?X.toFixed(2):(c.totalAmount+V).toFixed(2)]})})]}),U&&W>1&&(0,b.jsxs)("div",{className:"mb-3 text-xs text-muted-foreground text-right",children:["(R",c.totalAmount.toFixed(2)," Ã— ",W,") ",V>0?`+ R${V.toFixed(2)} tip`:""," = R",X.toFixed(2)]}),(0,b.jsxs)("div",{className:"space-y-1.5 mb-3 pt-3 border-t border-border",children:[(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Service & rooms"}),(0,b.jsxs)("span",{children:["R",Math.max(0,Q).toFixed(2)]})]}),(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Service fee"}),(0,b.jsxs)("span",{children:["+R",c.serviceFee.toFixed(2)]})]}),V>0&&(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsxs)("span",{className:"text-muted-foreground",children:["Tip",S&&U?" (one-time, first booking only)":""]}),(0,b.jsxs)("span",{children:["+R",V.toFixed(2)]})]})]}),(0,b.jsxs)("div",{className:"mb-3",children:[(0,b.jsx)(i.Label,{className:"mb-1.5 block text-sm",children:"Have a discount code?"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(j.Input,{placeholder:"Enter discount code",value:F,onChange:a=>G(a.target.value),className:"h-9 text-sm"}),(0,b.jsx)(f.Button,{type:"button",variant:"outline",onClick:Y,disabled:H||!F,className:"h-9",children:"Apply"})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mb-3",children:[(0,b.jsx)(r.Lock,{className:"w-3.5 h-3.5"}),(0,b.jsx)("span",{children:"Secure payment powered by Paystack"})]}),(0,b.jsx)(f.Button,{type:"button",className:"w-full",size:"lg",onClick:t,disabled:D,children:D?"Processing...":"Confirm & Pay"})]})]})}var E=a.i(5050);let F=(0,E.createServerReference)("4058c82389d1b0af01e0ab7f3166467c8d163c3dfb",E.callServer,void 0,E.findSourceMapURL,"createBookingDraft"),G=(0,E.createServerReference)("40856064b0b8a033c99fb4eb0cd1dcbe900869365a",E.callServer,void 0,E.findSourceMapURL,"initializePaymentForBooking"),H=(0,E.createServerReference)("60bf64c7595e42167f2bb61b3c1cf32233840f6b11",E.callServer,void 0,E.findSourceMapURL,"validateDiscountCode");var I=a.i(42496),J=a.i(4020),K=a.i(47565),L=a.i(23292);function M(){let a=(0,c.useParams)(),i=(0,c.useRouter)(),j=(0,c.useSearchParams)(),k=a.serviceSlug,{formData:l,updateFormData:m,validateCurrentStep:n,previousStep:o,getDiscountAmount:p,setDiscountAmount:q,setServicesForSlug:r}=(0,h.useBookingFormContext)(),[s,t]=(0,d.useState)(0),[u,v]=(0,d.useState)(!1),[w,x]=(0,d.useState)(null),A=(0,d.useRef)(l.serviceId),{data:B=[]}=(0,e.useQuery)({queryKey:["services"],queryFn:y.getServices,staleTime:3e5});(0,d.useEffect)(()=>{B.length>0&&r(B)},[B,r]),(0,d.useEffect)(()=>{let a=j.get("ref");a&&!l.referralCode&&m({referralCode:a})},[j,l.referralCode,m]),(0,d.useEffect)(()=>{if(B.length>0){if(!k)return void i.replace("/booking/details");let a=(0,K.findServiceBySlug)(B,k);if(!a){L.toast.error("Invalid service selected"),i.replace("/booking/details");return}l.serviceId&&l.serviceId===a.id||m({serviceId:a.id})}},[k,B.length]),(0,d.useEffect)(()=>{let a=()=>{t(p())};return window.addEventListener("discountUpdated",a),a(),()=>{window.removeEventListener("discountUpdated",a)}},[p]),(0,d.useEffect)(()=>{let a=A.current,b=l.serviceId;a&&a!==b&&(m({additionalServices:[],bedrooms:"0",bathrooms:"1",carpetTypes:[],roomStatus:"",numberOfFittedRooms:"",numberOfLooseCarpets:"",cleaningEquipment:"",serviceDate:"",serviceTime:"",serviceDuration:3.5,discountCode:""}),t(0)),A.current=b},[l.serviceId,m]);let{data:C=[]}=(0,e.useQuery)({queryKey:["pricing-rules"],queryFn:I.getPricingRulesClient,staleTime:6e5}),{data:E=[]}=(0,e.useQuery)({queryKey:["additional-services",l.serviceId],queryFn:()=>(0,z.getAdditionalServices)(l.serviceId||void 0),enabled:!0,staleTime:3e5}),M=B.find(a=>a.id===l.serviceId),N=M?.name.toLowerCase().includes("carpet")??!1,O=(0,d.useMemo)(()=>{if(!(N?l.serviceId&&C.length>0:l.serviceId&&l.bedrooms&&l.bathrooms&&C.length>0))return{basePrice:0,bedroomsPrice:0,bathroomsPrice:0,fittedRoomsPrice:0,looseCarpetsPrice:0,additionalServicesPrice:0,equipmentSupplyPrice:0,subtotal:0,frequencyDiscountPercent:0,frequencyDiscountAmount:0,discountAmount:s,serviceFee:0,totalAmount:0};let a=l.additionalServices.filter(a=>E.some(b=>b.id===a));return(0,J.calculatePriceBreakdownClient)(C,l.serviceId,l.bedrooms||"0",l.bathrooms||"1",a,l.cleaningFrequency,s,l.numberOfFittedRooms||"",l.numberOfLooseCarpets||"",N,M?.name,l.cleaningEquipment,l.numberOfCleaners||1)},[C,l.serviceId,l.bedrooms,l.bathrooms,JSON.stringify(l.additionalServices),l.cleaningFrequency,l.numberOfFittedRooms,l.numberOfLooseCarpets,l.cleaningEquipment,l.numberOfCleaners,s,N,E,M?.name]),P=async a=>{if(!a.trim())return void L.toast.error("Please enter a discount code");let b=O.subtotal-O.frequencyDiscountAmount,c=await H(a,b);c.valid?(m({discountCode:a}),t(c.discountAmount),q(c.discountAmount),window.dispatchEvent(new Event("discountUpdated")),L.toast.success("Discount code applied successfully!")):L.toast.error(c.error||"Invalid discount code")},Q=async()=>{let a=n();if(!a.valid)return void a.errors.forEach(a=>L.toast.error(a));v(!0);try{let a=await F(l);if(!a.success||!a.bookingId&&!a.bookingIds){L.toast.error(a.error||"Failed to create booking"),v(!1);return}let b=a.bookingIds||(a.bookingId?[a.bookingId]:[]);x(b[0]);let c=await G(b.length>1?b:b[0]);if(!c.success||!c.authorizationUrl){L.toast.error(c.error||"Failed to initialize payment"),v(!1);return}window.location.href=c.authorizationUrl}catch(a){console.error("Error processing payment:",a),L.toast.error("An unexpected error occurred. Please try again."),v(!1)}};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"bg-white rounded-xl p-6 max-w-[576px] mx-auto",children:(0,b.jsx)(D,{formData:l,priceBreakdown:O,updateFormData:m,onValidateDiscountCode:P,onProceedToPayment:Q,isProcessing:u})}),(0,b.jsx)("div",{className:"flex justify-between max-w-[576px] mx-auto mt-6",children:(0,b.jsxs)(f.Button,{variant:"outline",onClick:()=>{if(k){let a=l.referralCode||j.get("ref"),b=a?`/booking/worker/${k}?ref=${a}`:`/booking/worker/${k}`;i.push(b)}else o()},children:[(0,b.jsx)(g.ArrowLeft,{className:"w-4 h-4 mr-2"}),"Back"]})})]})}function N(){return(0,b.jsx)(d.Suspense,{fallback:(0,b.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,b.jsx)("div",{className:"text-center",children:(0,b.jsx)("p",{className:"text-muted-foreground",children:"Loading..."})})}),children:(0,b.jsx)(M,{})})}a.s(["default",()=>N],48839)}];

//# sourceMappingURL=app_booking_submit_%5BserviceSlug%5D_page_tsx_23d670e0._.js.map