module.exports=[39338,a=>{"use strict";var b=a.i(5050);let c=(0,b.createServerReference)("0026c99b1fc5a300062834048bb7384d6673cbd3b4",b.callServer,void 0,b.findSourceMapURL,"getServices");a.s(["getServices",()=>c])},47565,a=>{"use strict";function b(a){return a.toLowerCase().trim().replace(/\//g,"-").replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,"")}function c(a,c){return a.find(a=>b(a.name)===c)}function d(a,c){let d=a.find(a=>a.id===c);return d?b(d.name):void 0}a.s(["findServiceBySlug",()=>c,"generateSlug",()=>b,"getServiceSlugById",()=>d])},18873,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(47565);let f="shalean_booking_form_draft",g="shalean_booking_discount_amount",h=a=>a.startsWith("/booking/details")?1:a.startsWith("/booking/worker")?2:a.startsWith("/booking/submit")?3:1,i={serviceId:"",bedrooms:"0",bathrooms:"1",additionalServices:[],cleaningEquipment:"",serviceDate:"",serviceTime:"",serviceDuration:3.5,specialInstructions:"",carpetTypes:[],roomStatus:"",numberOfFittedRooms:"",numberOfLooseCarpets:"",numberOfCleaners:1,serviceAddress:"",serviceAptUnit:"",serviceSuburb:"",serviceCity:"",preferredCleanerIds:[],cleaningFrequency:"one-time",customerFirstName:"",customerLastName:"",customerEmail:"",customerPhone:"",tipAmount:0,discountCode:"",referralCode:""},j=(0,c.createContext)(void 0);function k({children:a}){let k=function(){let a,b=(0,d.useRouter)(),j=(0,d.usePathname)(),[k,l]=(0,c.useState)(i),[m,n]=(0,c.useState)(!1),[o,p]=(0,c.useState)([]),q=h(j),r=(a=j.match(/\/booking\/(details|worker|submit)\/([^/]+)/))?a[2]:null;(0,c.useEffect)(()=>{try{let a=localStorage.getItem(f),b=localStorage.getItem("shalean_referral_code");if(a){let c=JSON.parse(a);void 0!==c.preferredCleanerId&&void 0===c.preferredCleanerIds&&(c.preferredCleanerIds=c.preferredCleanerId?[c.preferredCleanerId]:[],delete c.preferredCleanerId),Array.isArray(c.preferredCleanerIds)||(c.preferredCleanerIds=[]),b&&!c.referralCode&&(c.referralCode=b),l({...i,...c})}else b&&l({...i,referralCode:b})}catch(a){console.error("Error loading form draft:",a)}},[]),(0,c.useEffect)(()=>{if(m)try{localStorage.setItem(f,JSON.stringify(k))}catch(a){console.error("Error saving form draft:",a)}},[k,m]);let s=(0,c.useCallback)(a=>{l(b=>{let c={...b,...a};return void 0===c.preferredCleanerIds||Array.isArray(c.preferredCleanerIds)||(c.preferredCleanerIds=[]),n(!0),c})},[]),t=(0,c.useCallback)(()=>{l(i),n(!1);try{localStorage.removeItem(f),localStorage.removeItem(g)}catch(a){console.error("Error clearing form draft:",a)}b.push("/booking/details")},[b]),u=(0,c.useCallback)((a,b)=>{let c={1:"/booking/details",2:"/booking/worker",3:"/booking/submit"}[a];if(!c)return"/booking/details";let d=b;return d||(d=r),!d&&k.serviceId&&o.length>0&&(d=(0,e.getServiceSlugById)(o,k.serviceId)||null),d?`${c}/${d}`:c},[k.serviceId,o,r]),v=(0,c.useCallback)(()=>{if(q<3){let a=u(q+1);b.push(a)}},[q,b,u]),w=(0,c.useCallback)(()=>{if(q>1){let a=u(q-1);b.push(a)}},[q,b,u]),x=(0,c.useCallback)(a=>{if(a>=1&&a<=3){let c=u(a);b.push(c)}},[b,u]),y=(0,c.useCallback)(a=>{let c=h(a);c>=1&&c<=3&&b.push(a)},[b]),z=(0,c.useCallback)(a=>{p(a)},[]),A=(0,c.useCallback)(()=>{let a=[];return k.serviceId||a.push("Please select a service"),k.serviceDate||a.push("Please select a date"),k.serviceTime||a.push("Please select a time"),k.serviceTime&&(!k.serviceDuration||k.serviceDuration<3.5||k.serviceDuration>10)&&a.push("Service duration must be between 3.5 and 10 hours"),{valid:0===a.length,errors:a}},[k]),B=(0,c.useCallback)(()=>{let a=[];return k.serviceAddress.trim()||a.push("Please enter service address"),k.serviceSuburb.trim()||a.push("Please enter suburb"),k.serviceCity.trim()||a.push("Please enter city"),k.numberOfCleaners>1&&(k.preferredCleanerIds||[]).length!==k.numberOfCleaners&&a.push(`Please select exactly ${k.numberOfCleaners} cleaners`),{valid:0===a.length,errors:a}},[k]),C=(0,c.useCallback)(()=>{let a=[];return k.customerFirstName.trim()||a.push("Please enter your first name"),k.customerLastName.trim()||a.push("Please enter your last name"),k.customerEmail.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(k.customerEmail)||a.push("Please enter a valid email address"):a.push("Please enter your email"),k.customerPhone.trim()||a.push("Please enter your phone number"),{valid:0===a.length,errors:a}},[k]),D=(0,c.useCallback)(()=>{switch(q){case 1:return A();case 2:return B();case 3:return C();default:return{valid:!1,errors:["Invalid step"]}}},[q,A,B,C]),E=(0,c.useCallback)(a=>{switch(a){case 1:return A().valid;case 2:return A().valid&&B().valid;case 3:return A().valid&&B().valid&&C().valid;default:return!1}},[A,B,C]),F=(0,c.useCallback)(()=>{try{let a=localStorage.getItem(g);return a?parseFloat(a):0}catch(a){return console.error("Error reading discount amount:",a),0}},[]);return{currentStep:q,serviceSlug:r,formData:k,updateFormData:s,resetForm:t,nextStep:v,previousStep:w,goToStep:x,goToStepByUrl:y,getStepUrl:u,setServicesForSlug:z,isStepCompleted:E,getDiscountAmount:F,setDiscountAmount:(0,c.useCallback)(a=>{try{localStorage.setItem(g,a.toString())}catch(a){console.error("Error saving discount amount:",a)}},[]),clearDiscountAmount:(0,c.useCallback)(()=>{try{localStorage.removeItem(g)}catch(a){console.error("Error clearing discount amount:",a)}},[]),validateStep1:A,validateStep2:B,validateStep3:C,validateCurrentStep:D}}();return(0,b.jsx)(j.Provider,{value:k,children:a})}function l(){let a=(0,c.useContext)(j);if(void 0===a)throw Error("useBookingFormContext must be used within a BookingFormProvider");return a}a.s(["BookingFormProvider",()=>k,"useBookingFormContext",()=>l],18873)},42496,12916,a=>{"use strict";var b=a.i(95445);function c(a){let b=a.total_bookings||0,c=a.completed_bookings||0,d=a.on_time_bookings||0,e=a.rating||0;if(0===b)return 50;let f=10*Math.min(b/50,1),g=c/b*40+d/b*30+e/5*20+f;return Math.round(100*(g=Math.max(0,Math.min(100,g))))/100}function d(a){return null==a?"N/A":`${a.toFixed(0)}%`}function e(a,b){let c=[...a];switch(b){case"best-match":default:c.sort((a,b)=>{let c=.6*(a.reliability_score||0)+.4*(a.rating||0);return .6*(b.reliability_score||0)+.4*(b.rating||0)-c});break;case"highest-rated":c.sort((a,b)=>(b.rating||0)-(a.rating||0));break;case"most-reliable":c.sort((a,b)=>(b.reliability_score||0)-(a.reliability_score||0));break;case"most-experienced":c.sort((a,b)=>(b.years_experience||0)-(a.years_experience||0))}return c}function f(a){let b=a.total_bookings||0,c=a.completed_bookings||0;return 0===b?0:Math.round(c/b*100)}function g(a){let b=a.total_bookings||0,c=a.on_time_bookings||0;return 0===b?0:Math.round(c/b*100)}async function h(){try{let a=(0,b.createClient)(),{data:c,error:d}=await a.from("pricing_rules").select("*").eq("is_active",!0).order("display_order",{ascending:!0});if(d)return console.error("Error fetching pricing rules:",d),[];return c||[]}catch(a){return console.error("Unexpected error fetching pricing rules:",a),[]}}async function i(a,c,d,e){try{let f=(0,b.createClient)(),{data:g,error:h}=await f.from("bookings").select("service_time, service_duration").eq("preferred_cleaner_id",a).eq("service_date",c).in("status",["pending","confirmed"]);if(h)return console.error("Error checking booking conflicts:",h),!1;if(!g||0===g.length)return!1;let[i,j]=d.split(":").map(Number),k=60*i+j,l=Math.round(60*e),m=k+l;for(let a of g){if(!a.service_time)continue;let[b,c]=a.service_time.split(":").slice(0,2).map(Number),d=60*b+c,e=Math.round(("number"==typeof a.service_duration?a.service_duration:parseFloat(a.service_duration||"0"))*60),f=d+e;if(k<f&&m>d)return!0}return!1}catch(a){return console.error("Unexpected error checking booking conflict:",a),!1}}async function j(a){try{let d=(0,b.createClient)(),{serviceSuburb:e,serviceDate:h,serviceTime:j,serviceDuration:k=3,minRating:l=0,minReliabilityScore:m=0}=a,n=d.from("cleaners").select("*").eq("is_active",!0),{data:o,error:p}=await n.order("reliability_score",{ascending:!1,nullsFirst:!1}).order("rating",{ascending:!1}).order("name",{ascending:!0});if(p)return console.error("Error fetching cleaners:",p),{success:!1,error:"Failed to fetch cleaners"};let q=o||[];if(q=q.filter(a=>!1!==a.is_available),e&&q.length>0){let a=e.toLowerCase().trim();q=q.filter(b=>!b.areas||0===b.areas.length||b.areas.some(b=>{let c=b.toLowerCase();return c.includes(a)||a.includes(c)}))}if(h){let a=new Date(h).getDay();q=q.filter(b=>!1!==b[({0:"available_sunday",1:"available_monday",2:"available_tuesday",3:"available_wednesday",4:"available_thursday",5:"available_friday",6:"available_saturday"})[a]])}l>0&&(q=q.filter(a=>(a.rating||0)>=l)),m>0&&(q=q.filter(a=>(a.reliability_score||0)>=m));let r=await Promise.all(q.map(async a=>{let b=!0,d=!1;h&&j&&k&&(b=!(d=await i(a.id,h,j,k)));let e=a.reliability_score??c(a);return{...a,reliability_score:e,isAvailableForSlot:b,bookingConflict:d,completionRate:f(a),onTimeRate:g(a)}}));return r.sort((a,b)=>{let c=.6*(a.reliability_score||0)+.4*(a.rating||0);return .6*(b.reliability_score||0)+.4*(b.rating||0)-c}),{success:!0,cleaners:r}}catch(a){return console.error("Unexpected error fetching cleaners with criteria:",a),{success:!1,error:a instanceof Error?a.message:"An unexpected error occurred"}}}a.s(["calculateCompletionRate",()=>f,"calculateOnTimeRate",()=>g,"calculateReliabilityScore",()=>c,"formatReliabilityScore",()=>d,"sortCleanersByCriteria",()=>e],12916),a.s(["getAvailableCleanersWithCriteriaClient",()=>j,"getPricingRulesClient",()=>h],42496)},49455,a=>{"use strict";function b(a){if(!a)return!1;let b=a.toLowerCase().trim();return!!(b.includes("standard")||b.includes("airbnb"))}function c(a){return b(a)?["one-time","weekly","bi-weekly","monthly"]:["one-time"]}function d(a,b){return c(a).includes(b)}a.s(["getAvailableFrequencies",()=>c,"isValidFrequencyForService",()=>d,"supportsRecurringBookings",()=>b])},4020,a=>{"use strict";var b=a.i(49455);function c(a,d,e,f,g,h,i=0,j="",k="",l=!1,m,n,o=1){let p=a.find(a=>"base_price"===a.rule_type&&a.service_id===d),q=p?.price||0,r=a.find(a=>"bedroom"===a.rule_type&&a.rule_value===e),s=l?0:r?.price||0,t=a.find(a=>"bathroom"===a.rule_type&&a.rule_value===f),u=l?0:t?.price||0,v=a.find(a=>"fitted_room"===a.rule_type&&"per_room"===a.rule_key),w=v?.price?(parseFloat(j)||0)*(v.price||0):0,x=a.find(a=>"loose_carpet"===a.rule_type&&"per_carpet"===a.rule_key),y=x?.price?(parseFloat(k)||0)*(x.price||0):0,z=0;for(let b of g){let c=a.find(a=>"additional_service"===a.rule_type&&a.additional_service_id===b);z+=c?.price||0}let A=0;"yes"===n&&m&&(0,b.supportsRecurringBookings)(m)&&(A=500);let B=0;m&&(0,b.supportsRecurringBookings)(m)&&o>1&&(B=250*Math.max(0,Math.min(o-1,4)));let C=q+s+u+w+y+z+A+B,D=0,E=0;if("one-time"!==h&&m&&""!==m.trim()&&(0,b.supportsRecurringBookings)(m)){let b=a.find(a=>"frequency_discount"===a.rule_type&&a.rule_value===h);E=C*(D=b?.percentage||0)/100}let F=C-E,G=Math.max(0,F-i),H=a.find(a=>"service_fee"===a.rule_type),I=F*(H?.percentage||0)/100;return{basePrice:q,bedroomsPrice:s,bathroomsPrice:u,fittedRoomsPrice:w,looseCarpetsPrice:y,additionalServicesPrice:z,equipmentSupplyPrice:A,additionalCleanersPrice:B,subtotal:C,frequencyDiscountPercent:D,frequencyDiscountAmount:E,discountAmount:i,serviceFee:I,totalAmount:G+I}}a.s(["calculatePriceBreakdownClient",()=>c])},3244,a=>{"use strict";function b(a,b){let c=[],d=new Date(a),e=d.getMonth(),f=d.getFullYear(),g=new Date(f,e+1,0).getDate();switch(b){case"one-time":case"monthly":default:c.push(new Date(a));break;case"weekly":d.getDay();let h=new Date(f,e,d.getDate());for(;h.getMonth()===e&&h.getDate()<=g;)c.push(new Date(h)),h.setDate(h.getDate()+7);break;case"bi-weekly":let i=new Date(f,e,d.getDate());for(;i.getMonth()===e&&i.getDate()<=g;)c.push(new Date(i)),i.setDate(i.getDate()+14)}return c}a.s(["calculateBookingDatesForMonth",()=>b])}];

//# sourceMappingURL=_3a38d9a0._.js.map