{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/27825/shalean-v2/shalean-reimagined/app/booking/book/components/ProgressIndicator.tsx"],"sourcesContent":["'use client';\n\nimport { useRouter } from 'next/navigation';\nimport { cn } from '@/lib/utils';\n\ninterface ProgressIndicatorProps {\n  currentStep: number;\n  serviceSlug?: string | null;\n  onStepClick?: (step: number, url: string) => void;\n  isStepCompleted?: (step: number) => boolean;\n}\n\nexport function ProgressIndicator({ currentStep, serviceSlug, onStepClick, isStepCompleted }: ProgressIndicatorProps) {\n  const router = useRouter();\n  \n  const getStepUrl = (step: number): string => {\n    const baseUrls = {\n      1: '/booking/details',\n      2: '/booking/worker',\n      3: '/booking/submit',\n    };\n    const baseUrl = baseUrls[step as keyof typeof baseUrls] || '/booking/details';\n    return serviceSlug ? `${baseUrl}/${serviceSlug}` : baseUrl;\n  };\n\n  const steps = [\n    { number: 1, label: 'Details', url: getStepUrl(1) },\n    { number: 2, label: 'Worker', url: getStepUrl(2) },\n    { number: 3, label: 'Submit', url: getStepUrl(3) },\n  ];\n\n  const handleStepClick = (step: number, url: string) => {\n    // Allow clicking on current step or completed steps (backward navigation)\n    // Prevent clicking on future incomplete steps\n    if (step <= currentStep || (isStepCompleted && isStepCompleted(step))) {\n      if (onStepClick) {\n        onStepClick(step, url);\n      } else {\n        router.push(url);\n      }\n    }\n  };\n\n  const isStepClickable = (step: number) => {\n    return step <= currentStep || (isStepCompleted && isStepCompleted(step));\n  };\n\n  return (\n    <>\n      {/* Desktop Progress Indicator */}\n      <div className=\"hidden md:flex items-center justify-center flex-1\">\n        <div className=\"flex items-center justify-between relative w-[400px]\">\n          {/* Continuous line - connects between circles */}\n          <div className=\"absolute left-4 right-4 top-4 h-0.5 bg-border z-0\"></div>\n          \n          {steps.map((step) => {\n            const isActive = step.number === currentStep;\n            const isCompleted = step.number < currentStep || (isStepCompleted && isStepCompleted(step.number));\n            const isClickable = isStepClickable(step.number);\n            \n            return (\n              <div\n                key={step.number}\n                className={cn(\n                  \"flex flex-col items-center gap-2 relative z-10\",\n                  step.number === 2 && \"absolute left-1/2 -translate-x-1/2\",\n                  isClickable && \"cursor-pointer hover:opacity-80 transition-opacity\",\n                  !isClickable && \"cursor-not-allowed\"\n                )}\n                onClick={() => isClickable && handleStepClick(step.number, step.url)}\n              >\n                <div\n                  className={cn(\n                    \"w-8 h-8 rounded-full border flex items-center justify-center text-sm font-semibold transition-colors\",\n                    isActive && \"bg-primary border-primary text-primary-foreground\",\n                    isCompleted && !isActive && \"bg-muted border border-border text-muted-foreground\",\n                    !isActive && !isCompleted && \"bg-muted border border-border text-foreground\"\n                  )}\n                >\n                  {step.number}\n                </div>\n                <span\n                  className={cn(\n                    \"text-sm font-medium whitespace-nowrap transition-colors\",\n                    isActive && \"text-primary font-semibold\",\n                    isCompleted && !isActive && \"text-muted-foreground\",\n                    !isActive && !isCompleted && \"text-foreground\"\n                  )}\n                >\n                  {step.label}\n                </span>\n              </div>\n            );\n          })}\n        </div>\n      </div>\n\n      {/* Mobile Progress Indicator */}\n      <div className=\"md:hidden flex items-center justify-center flex-1\">\n        <div className=\"flex items-center justify-between relative w-[200px]\">\n          {/* Continuous line - connects between circles */}\n          <div className=\"absolute left-3 right-3 top-3 h-0.5 bg-border z-0\"></div>\n          \n          {steps.map((step) => {\n            const isActive = step.number === currentStep;\n            const isCompleted = step.number < currentStep || (isStepCompleted && isStepCompleted(step.number));\n            const isClickable = isStepClickable(step.number);\n            \n            return (\n              <div\n                key={step.number}\n                className={cn(\n                  \"flex flex-col items-center gap-1 relative z-10\",\n                  step.number === 2 && \"absolute left-1/2 -translate-x-1/2\",\n                  isClickable && \"cursor-pointer hover:opacity-80 transition-opacity\",\n                  !isClickable && \"cursor-not-allowed\"\n                )}\n                onClick={() => isClickable && handleStepClick(step.number, step.url)}\n              >\n                <div\n                  className={cn(\n                    \"w-6 h-6 rounded-full border flex items-center justify-center text-xs font-semibold transition-colors\",\n                    isActive && \"bg-primary border-primary text-primary-foreground\",\n                    isCompleted && !isActive && \"bg-muted border border-border text-muted-foreground\",\n                    !isActive && !isCompleted && \"bg-muted border border-border text-foreground\"\n                  )}\n                >\n                  {step.number}\n                </div>\n                <span\n                  className={cn(\n                    \"text-xs font-medium whitespace-nowrap transition-colors\",\n                    isActive && \"text-primary font-semibold\",\n                    isCompleted && !isActive && \"text-muted-foreground\",\n                    !isActive && !isCompleted && \"text-foreground\"\n                  )}\n                >\n                  {step.label}\n                </span>\n              </div>\n            );\n          })}\n        </div>\n      </div>\n    </>\n  );\n}\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 187, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/27825/shalean-v2/shalean-reimagined/src/lib/utils/slug.ts"],"sourcesContent":["import { Service } from '@/types/quote';\r\n\r\n/**\r\n * Generate a URL-friendly slug from a service name\r\n * Examples:\r\n * - \"Standard Cleaning\" → \"standard-cleaning\"\r\n * - \"Move In/Out\" → \"move-in-out\"\r\n * - \"Airbnb Cleaning\" → \"airbnb-cleaning\"\r\n */\r\nexport function generateSlug(name: string): string {\r\n  return name\r\n    .toLowerCase()\r\n    .trim()\r\n    // Replace slashes with hyphens\r\n    .replace(/\\//g, '-')\r\n    // Replace spaces and special characters with hyphens\r\n    .replace(/[^\\w\\s-]/g, '')\r\n    .replace(/\\s+/g, '-')\r\n    // Remove multiple consecutive hyphens\r\n    .replace(/-+/g, '-')\r\n    // Remove leading/trailing hyphens\r\n    .replace(/^-+|-+$/g, '');\r\n}\r\n\r\n/**\r\n * Find a service by its slug\r\n */\r\nexport function findServiceBySlug(services: Service[], slug: string): Service | undefined {\r\n  return services.find(service => generateSlug(service.name) === slug);\r\n}\r\n\r\n/**\r\n * Get the slug for a service by its ID\r\n */\r\nexport function getServiceSlugById(services: Service[], serviceId: string): string | undefined {\r\n  const service = services.find(s => s.id === serviceId);\r\n  return service ? generateSlug(service.name) : undefined;\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;;;AASO,SAAS,aAAa,IAAY;IACvC,OAAO,KACJ,WAAW,GACX,IAAI,EACL,+BAA+B;KAC9B,OAAO,CAAC,OAAO,IAChB,qDAAqD;KACpD,OAAO,CAAC,aAAa,IACrB,OAAO,CAAC,QAAQ,IACjB,sCAAsC;KACrC,OAAO,CAAC,OAAO,IAChB,kCAAkC;KACjC,OAAO,CAAC,YAAY;AACzB;AAKO,SAAS,kBAAkB,QAAmB,EAAE,IAAY;IACjE,OAAO,SAAS,IAAI,CAAC,CAAA,UAAW,aAAa,QAAQ,IAAI,MAAM;AACjE;AAKO,SAAS,mBAAmB,QAAmB,EAAE,SAAiB;IACvE,MAAM,UAAU,SAAS,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;IAC5C,OAAO,UAAU,aAAa,QAAQ,IAAI,IAAI;AAChD"}},
    {"offset": {"line": 216, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/27825/shalean-v2/shalean-reimagined/app/booking/book/hooks/useBookingForm.ts"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport { useRouter, usePathname } from 'next/navigation';\r\nimport { BookingFormData } from '@/types/booking';\r\nimport { getServiceSlugById } from '@/lib/utils/slug';\r\nimport { Service } from '@/types/quote';\r\n\r\nconst STORAGE_KEY = 'shalean_booking_form_draft';\r\nconst DISCOUNT_AMOUNT_KEY = 'shalean_booking_discount_amount';\r\n\r\n// URL to step mapping (supports both with and without slug)\r\nconst getStepFromPath = (pathname: string): number => {\r\n  if (pathname.startsWith('/booking/details')) return 1;\r\n  if (pathname.startsWith('/booking/worker')) return 2;\r\n  if (pathname.startsWith('/booking/submit')) return 3;\r\n  return 1;\r\n};\r\n\r\n// Extract service slug from pathname\r\nconst extractServiceSlug = (pathname: string): string | null => {\r\n  const match = pathname.match(/\\/booking\\/(details|worker|submit)\\/([^/]+)/);\r\n  return match ? match[2] : null;\r\n};\r\n\r\nconst defaultFormData: BookingFormData = {\r\n  // Step 1\r\n  serviceId: '',\r\n  bedrooms: '0',\r\n  bathrooms: '1',\r\n  additionalServices: [],\r\n  cleaningEquipment: '',\r\n  serviceDate: '',\r\n  serviceTime: '',\r\n  serviceDuration: 3.5,\r\n  specialInstructions: '',\r\n  // Carpet Cleaning specific fields\r\n  carpetTypes: [],\r\n  roomStatus: '',\r\n  numberOfFittedRooms: '',\r\n  numberOfLooseCarpets: '',\r\n  numberOfCleaners: 1,\r\n  \r\n  // Step 2\r\n  serviceAddress: '',\r\n  serviceAptUnit: '',\r\n  serviceSuburb: '',\r\n  serviceCity: '',\r\n  preferredCleanerIds: [],\r\n  cleaningFrequency: 'one-time',\r\n  \r\n  // Step 3\r\n  customerFirstName: '',\r\n  customerLastName: '',\r\n  customerEmail: '',\r\n  customerPhone: '',\r\n  tipAmount: 0,\r\n  discountCode: '',\r\n  referralCode: '',\r\n};\r\n\r\nexport function useBookingForm() {\r\n  const router = useRouter();\r\n  const pathname = usePathname();\r\n  const [formData, setFormData] = useState<BookingFormData>(defaultFormData);\r\n  const [isDirty, setIsDirty] = useState(false);\r\n  const [services, setServices] = useState<Service[]>([]);\r\n\r\n  // Get current step from URL\r\n  const currentStep = getStepFromPath(pathname);\r\n  \r\n  // Get service slug from URL\r\n  const serviceSlug = extractServiceSlug(pathname);\r\n\r\n  // Load draft from localStorage on mount\r\n  useEffect(() => {\r\n    try {\r\n      const saved = localStorage.getItem(STORAGE_KEY);\r\n      const savedReferralCode = localStorage.getItem('shalean_referral_code');\r\n      \r\n      if (saved) {\r\n        const parsed = JSON.parse(saved);\r\n        // Migrate old preferredCleanerId to preferredCleanerIds array\r\n        if (parsed.preferredCleanerId !== undefined && parsed.preferredCleanerIds === undefined) {\r\n          parsed.preferredCleanerIds = parsed.preferredCleanerId ? [parsed.preferredCleanerId] : [];\r\n          delete parsed.preferredCleanerId; // Remove old field\r\n        }\r\n        // Ensure preferredCleanerIds is always an array\r\n        if (!Array.isArray(parsed.preferredCleanerIds)) {\r\n          parsed.preferredCleanerIds = [];\r\n        }\r\n        // Preserve referral code from localStorage if not in saved data\r\n        if (savedReferralCode && !parsed.referralCode) {\r\n          parsed.referralCode = savedReferralCode;\r\n        }\r\n        setFormData({ ...defaultFormData, ...parsed });\r\n      } else if (savedReferralCode) {\r\n        // If no saved form data but referral code exists, set it\r\n        setFormData({ ...defaultFormData, referralCode: savedReferralCode });\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading form draft:', error);\r\n    }\r\n  }, []);\r\n\r\n  // Auto-save to localStorage when form data changes\r\n  useEffect(() => {\r\n    if (isDirty) {\r\n      try {\r\n        localStorage.setItem(STORAGE_KEY, JSON.stringify(formData));\r\n      } catch (error) {\r\n        console.error('Error saving form draft:', error);\r\n      }\r\n    }\r\n  }, [formData, isDirty]);\r\n\r\n  const updateFormData = useCallback((updates: Partial<BookingFormData>) => {\r\n    setFormData((prev) => {\r\n      const updated = { ...prev, ...updates };\r\n      // Ensure preferredCleanerIds is always an array\r\n      if (updated.preferredCleanerIds !== undefined && !Array.isArray(updated.preferredCleanerIds)) {\r\n        updated.preferredCleanerIds = [];\r\n      }\r\n      setIsDirty(true);\r\n      return updated;\r\n    });\r\n  }, []);\r\n\r\n  const resetForm = useCallback(() => {\r\n    setFormData(defaultFormData);\r\n    setIsDirty(false);\r\n    try {\r\n      localStorage.removeItem(STORAGE_KEY);\r\n      localStorage.removeItem(DISCOUNT_AMOUNT_KEY);\r\n    } catch (error) {\r\n      console.error('Error clearing form draft:', error);\r\n    }\r\n    router.push('/booking/details');\r\n  }, [router]);\r\n\r\n  // Get URL for a step, preserving service slug if available\r\n  const getStepUrl = useCallback((step: number, slug?: string | null): string => {\r\n    const stepPaths = {\r\n      1: '/booking/details',\r\n      2: '/booking/worker',\r\n      3: '/booking/submit',\r\n    };\r\n    \r\n    const baseUrl = stepPaths[step as keyof typeof stepPaths];\r\n    if (!baseUrl) return '/booking/details';\r\n    \r\n    // Priority: provided slug > current URL slug > generate from formData > no slug\r\n    let finalSlug = slug;\r\n    \r\n    // If no slug provided, use current URL slug\r\n    if (!finalSlug) {\r\n      finalSlug = serviceSlug;\r\n    }\r\n    \r\n    // If still no slug, try to generate from formData (only if services are loaded)\r\n    if (!finalSlug && formData.serviceId && services.length > 0) {\r\n      finalSlug = getServiceSlugById(services, formData.serviceId) || null;\r\n    }\r\n    \r\n    return finalSlug ? `${baseUrl}/${finalSlug}` : baseUrl;\r\n  }, [formData.serviceId, services, serviceSlug]);\r\n\r\n  const nextStep = useCallback(() => {\r\n    if (currentStep < 3) {\r\n      const nextStepNumber = currentStep + 1;\r\n      const nextUrl = getStepUrl(nextStepNumber);\r\n      // Always navigate to next step\r\n      router.push(nextUrl);\r\n    }\r\n  }, [currentStep, router, getStepUrl]);\r\n\r\n  const previousStep = useCallback(() => {\r\n    if (currentStep > 1) {\r\n      const prevUrl = getStepUrl(currentStep - 1);\r\n      router.push(prevUrl);\r\n    }\r\n  }, [currentStep, router, getStepUrl]);\r\n\r\n  const goToStep = useCallback((step: number) => {\r\n    if (step >= 1 && step <= 3) {\r\n      const url = getStepUrl(step);\r\n      router.push(url);\r\n    }\r\n  }, [router, getStepUrl]);\r\n\r\n  const goToStepByUrl = useCallback((url: string) => {\r\n    const step = getStepFromPath(url);\r\n    if (step >= 1 && step <= 3) {\r\n      router.push(url);\r\n    }\r\n  }, [router]);\r\n\r\n  // Set services for slug generation\r\n  const setServicesForSlug = useCallback((servicesList: Service[]) => {\r\n    setServices(servicesList);\r\n  }, []);\r\n\r\n  // Validation for each step\r\n  const validateStep1 = useCallback((): { valid: boolean; errors: string[] } => {\r\n    const errors: string[] = [];\r\n\r\n    if (!formData.serviceId) {\r\n      errors.push('Please select a service');\r\n    }\r\n    if (!formData.serviceDate) {\r\n      errors.push('Please select a date');\r\n    }\r\n    if (!formData.serviceTime) {\r\n      errors.push('Please select a time');\r\n    }\r\n    if (formData.serviceTime && (!formData.serviceDuration || formData.serviceDuration < 3.5 || formData.serviceDuration > 10)) {\r\n      errors.push('Service duration must be between 3.5 and 10 hours');\r\n    }\r\n    // Only require cleaning equipment for Standard and Airbnb services\r\n    // Note: We can't check service name here without services data, so we'll check in the component\r\n    // For now, we'll make it optional and validate in the component if needed\r\n\r\n    return { valid: errors.length === 0, errors };\r\n  }, [formData]);\r\n\r\n  const validateStep2 = useCallback((): { valid: boolean; errors: string[] } => {\r\n    const errors: string[] = [];\r\n\r\n    if (!formData.serviceAddress.trim()) {\r\n      errors.push('Please enter service address');\r\n    }\r\n    if (!formData.serviceSuburb.trim()) {\r\n      errors.push('Please enter suburb');\r\n    }\r\n    if (!formData.serviceCity.trim()) {\r\n      errors.push('Please enter city');\r\n    }\r\n\r\n    // Validate cleaner selection count\r\n    if (formData.numberOfCleaners > 1) {\r\n      const selectedCleaners = formData.preferredCleanerIds || [];\r\n      if (selectedCleaners.length !== formData.numberOfCleaners) {\r\n        errors.push(`Please select exactly ${formData.numberOfCleaners} cleaners`);\r\n      }\r\n    }\r\n    // For single cleaner (numberOfCleaners === 1), no validation needed - user can select 0 or 1\r\n\r\n    return { valid: errors.length === 0, errors };\r\n  }, [formData]);\r\n\r\n  const validateStep3 = useCallback((): { valid: boolean; errors: string[] } => {\r\n    const errors: string[] = [];\r\n\r\n    if (!formData.customerFirstName.trim()) {\r\n      errors.push('Please enter your first name');\r\n    }\r\n    if (!formData.customerLastName.trim()) {\r\n      errors.push('Please enter your last name');\r\n    }\r\n    if (!formData.customerEmail.trim()) {\r\n      errors.push('Please enter your email');\r\n    } else if (!/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(formData.customerEmail)) {\r\n      errors.push('Please enter a valid email address');\r\n    }\r\n    if (!formData.customerPhone.trim()) {\r\n      errors.push('Please enter your phone number');\r\n    }\r\n\r\n    return { valid: errors.length === 0, errors };\r\n  }, [formData]);\r\n\r\n  const validateCurrentStep = useCallback((): { valid: boolean; errors: string[] } => {\r\n    switch (currentStep) {\r\n      case 1:\r\n        return validateStep1();\r\n      case 2:\r\n        return validateStep2();\r\n      case 3:\r\n        return validateStep3();\r\n      default:\r\n        return { valid: false, errors: ['Invalid step'] };\r\n    }\r\n  }, [currentStep, validateStep1, validateStep2, validateStep3]);\r\n\r\n  // Check if a step is completed (for navigation validation)\r\n  const isStepCompleted = useCallback((step: number): boolean => {\r\n    switch (step) {\r\n      case 1:\r\n        return validateStep1().valid;\r\n      case 2:\r\n        return validateStep1().valid && validateStep2().valid;\r\n      case 3:\r\n        return validateStep1().valid && validateStep2().valid && validateStep3().valid;\r\n      default:\r\n        return false;\r\n    }\r\n  }, [validateStep1, validateStep2, validateStep3]);\r\n\r\n  // Get discount amount from localStorage\r\n  const getDiscountAmount = useCallback((): number => {\r\n    try {\r\n      const saved = localStorage.getItem(DISCOUNT_AMOUNT_KEY);\r\n      return saved ? parseFloat(saved) : 0;\r\n    } catch (error) {\r\n      console.error('Error reading discount amount:', error);\r\n      return 0;\r\n    }\r\n  }, []);\r\n\r\n  // Set discount amount in localStorage\r\n  const setDiscountAmount = useCallback((amount: number) => {\r\n    try {\r\n      localStorage.setItem(DISCOUNT_AMOUNT_KEY, amount.toString());\r\n    } catch (error) {\r\n      console.error('Error saving discount amount:', error);\r\n    }\r\n  }, []);\r\n\r\n  // Clear discount amount\r\n  const clearDiscountAmount = useCallback(() => {\r\n    try {\r\n      localStorage.removeItem(DISCOUNT_AMOUNT_KEY);\r\n    } catch (error) {\r\n      console.error('Error clearing discount amount:', error);\r\n    }\r\n  }, []);\r\n\r\n  return {\r\n    currentStep,\r\n    serviceSlug,\r\n    formData,\r\n    updateFormData,\r\n    resetForm,\r\n    nextStep,\r\n    previousStep,\r\n    goToStep,\r\n    goToStepByUrl,\r\n    getStepUrl,\r\n    setServicesForSlug,\r\n    isStepCompleted,\r\n    getDiscountAmount,\r\n    setDiscountAmount,\r\n    clearDiscountAmount,\r\n    validateStep1,\r\n    validateStep2,\r\n    validateStep3,\r\n    validateCurrentStep,\r\n  };\r\n}\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 643, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/27825/shalean-v2/shalean-reimagined/app/booking/book/context/BookingFormContext.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { createContext, useContext, ReactNode } from 'react';\r\nimport { useBookingForm } from '../hooks/useBookingForm';\r\n\r\ninterface BookingFormContextValue {\r\n  currentStep: number;\r\n  serviceSlug: string | null;\r\n  formData: ReturnType<typeof useBookingForm>['formData'];\r\n  updateFormData: ReturnType<typeof useBookingForm>['updateFormData'];\r\n  resetForm: ReturnType<typeof useBookingForm>['resetForm'];\r\n  nextStep: ReturnType<typeof useBookingForm>['nextStep'];\r\n  previousStep: ReturnType<typeof useBookingForm>['previousStep'];\r\n  goToStep: ReturnType<typeof useBookingForm>['goToStep'];\r\n  goToStepByUrl: ReturnType<typeof useBookingForm>['goToStepByUrl'];\r\n  getStepUrl: ReturnType<typeof useBookingForm>['getStepUrl'];\r\n  setServicesForSlug: ReturnType<typeof useBookingForm>['setServicesForSlug'];\r\n  isStepCompleted: ReturnType<typeof useBookingForm>['isStepCompleted'];\r\n  getDiscountAmount: ReturnType<typeof useBookingForm>['getDiscountAmount'];\r\n  setDiscountAmount: ReturnType<typeof useBookingForm>['setDiscountAmount'];\r\n  clearDiscountAmount: ReturnType<typeof useBookingForm>['clearDiscountAmount'];\r\n  validateStep1: ReturnType<typeof useBookingForm>['validateStep1'];\r\n  validateStep2: ReturnType<typeof useBookingForm>['validateStep2'];\r\n  validateStep3: ReturnType<typeof useBookingForm>['validateStep3'];\r\n  validateCurrentStep: ReturnType<typeof useBookingForm>['validateCurrentStep'];\r\n}\r\n\r\nconst BookingFormContext = createContext<BookingFormContextValue | undefined>(undefined);\r\n\r\nexport function BookingFormProvider({ children }: { children: ReactNode }) {\r\n  const bookingForm = useBookingForm();\r\n\r\n  return (\r\n    <BookingFormContext.Provider value={bookingForm}>\r\n      {children}\r\n    </BookingFormContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useBookingFormContext() {\r\n  const context = useContext(BookingFormContext);\r\n  if (context === undefined) {\r\n    throw new Error('useBookingFormContext must be used within a BookingFormProvider');\r\n  }\r\n  return context;\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;;;AAHA;;;AA2BA,MAAM,mCAAqB,IAAA,8KAAa,EAAsC;AAEvE,SAAS,oBAAoB,EAAE,QAAQ,EAA2B;;IACvE,MAAM,cAAc,IAAA,sKAAc;IAElC,qBACE,6LAAC,mBAAmB,QAAQ;QAAC,OAAO;kBACjC;;;;;;AAGP;GARgB;;QACM,sKAAc;;;KADpB;AAUT,SAAS;;IACd,MAAM,UAAU,IAAA,2KAAU,EAAC;IAC3B,IAAI,YAAY,WAAW;QACzB,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT;IANgB"}},
    {"offset": {"line": 694, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/27825/shalean-v2/shalean-reimagined/app/booking/quote/actions.ts"],"sourcesContent":["'use server';\r\n\r\nimport { createClient } from '@/lib/supabase/server';\r\nimport { QuoteFormData, QuoteStatus, Quote, Service, AdditionalService, HomeDetailOption, CleaningEquipment } from '@/types/quote';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\nexport interface SaveQuoteResult {\r\n  success: boolean;\r\n  data?: Quote;\r\n  error?: string;\r\n}\r\n\r\n/**\r\n * Save or update a quote draft\r\n */\r\nexport async function saveQuoteDraft(\r\n  email: string,\r\n  formData: QuoteFormData\r\n): Promise<SaveQuoteResult> {\r\n  try {\r\n    if (!email || !email.trim()) {\r\n      return { success: false, error: 'Email is required' };\r\n    }\r\n\r\n    const supabase = await createClient();\r\n\r\n    // Check if a draft already exists for this email\r\n    const { data: existingDraft } = await supabase\r\n      .from('quotes')\r\n      .select('id')\r\n      .eq('email', email.trim().toLowerCase())\r\n      .eq('status', 'draft')\r\n      .order('updated_at', { ascending: false })\r\n      .limit(1)\r\n      .single();\r\n\r\n    if (existingDraft) {\r\n      // Update existing draft\r\n      const { data, error } = await supabase\r\n        .from('quotes')\r\n        .update({\r\n          form_data: formData,\r\n          updated_at: new Date().toISOString(),\r\n        })\r\n        .eq('id', existingDraft.id)\r\n        .select()\r\n        .single();\r\n\r\n      if (error) {\r\n        console.error('Error updating quote draft:', error);\r\n        return { success: false, error: error.message };\r\n      }\r\n\r\n      return { success: true, data: data as Quote };\r\n    } else {\r\n      // Create new draft\r\n      const { data, error } = await supabase\r\n        .from('quotes')\r\n        .insert({\r\n          email: email.trim().toLowerCase(),\r\n          status: 'draft',\r\n          form_data: formData,\r\n        })\r\n        .select()\r\n        .single();\r\n\r\n      if (error) {\r\n        console.error('Error creating quote draft:', error);\r\n        return { success: false, error: error.message };\r\n      }\r\n\r\n      return { success: true, data: data as Quote };\r\n    }\r\n  } catch (error) {\r\n    console.error('Unexpected error saving quote draft:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'An unexpected error occurred',\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Get the latest draft quote for an email\r\n */\r\nexport async function getQuoteDraft(email: string): Promise<Quote | null> {\r\n  try {\r\n    if (!email || !email.trim()) {\r\n      return null;\r\n    }\r\n\r\n    const supabase = await createClient();\r\n\r\n    const { data, error } = await supabase\r\n      .from('quotes')\r\n      .select('*')\r\n      .eq('email', email.trim().toLowerCase())\r\n      .eq('status', 'draft')\r\n      .order('updated_at', { ascending: false })\r\n      .limit(1)\r\n      .single();\r\n\r\n    if (error) {\r\n      // If no draft exists, that's okay - return null\r\n      if (error.code === 'PGRST116') {\r\n        return null;\r\n      }\r\n      console.error('Error fetching quote draft:', error);\r\n      return null;\r\n    }\r\n\r\n    return data as Quote;\r\n  } catch (error) {\r\n    console.error('Unexpected error fetching quote draft:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get all quotes (drafts and submitted) for an email\r\n */\r\nexport async function getQuotesByEmail(email: string): Promise<Quote[]> {\r\n  try {\r\n    if (!email || !email.trim()) {\r\n      return [];\r\n    }\r\n\r\n    const supabase = await createClient();\r\n\r\n    const { data, error } = await supabase\r\n      .from('quotes')\r\n      .select('*')\r\n      .eq('email', email.trim().toLowerCase())\r\n      .order('updated_at', { ascending: false });\r\n\r\n    if (error) {\r\n      console.error('Error fetching quotes:', error);\r\n      return [];\r\n    }\r\n\r\n    return (data || []) as Quote[];\r\n  } catch (error) {\r\n    console.error('Unexpected error fetching quotes:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Submit a quote (change status from draft to submitted)\r\n */\r\nexport async function submitQuote(\r\n  email: string,\r\n  formData: QuoteFormData\r\n): Promise<SaveQuoteResult> {\r\n  try {\r\n    if (!email || !email.trim()) {\r\n      return { success: false, error: 'Email is required' };\r\n    }\r\n\r\n    const supabase = await createClient();\r\n\r\n    // Check if a draft exists for this email\r\n    const { data: existingDraft } = await supabase\r\n      .from('quotes')\r\n      .select('id')\r\n      .eq('email', email.trim().toLowerCase())\r\n      .eq('status', 'draft')\r\n      .order('updated_at', { ascending: false })\r\n      .limit(1)\r\n      .single();\r\n\r\n    if (existingDraft) {\r\n      // Update existing draft to submitted\r\n      const { data, error } = await supabase\r\n        .from('quotes')\r\n        .update({\r\n          status: 'submitted',\r\n          form_data: formData,\r\n          updated_at: new Date().toISOString(),\r\n        })\r\n        .eq('id', existingDraft.id)\r\n        .select()\r\n        .single();\r\n\r\n      if (error) {\r\n        console.error('Error submitting quote:', error);\r\n        return { success: false, error: error.message };\r\n      }\r\n\r\n      revalidatePath('/booking/quote');\r\n      return { success: true, data: data as Quote };\r\n    } else {\r\n      // Create new submitted quote\r\n      const { data, error } = await supabase\r\n        .from('quotes')\r\n        .insert({\r\n          email: email.trim().toLowerCase(),\r\n          status: 'submitted',\r\n          form_data: formData,\r\n        })\r\n        .select()\r\n        .single();\r\n\r\n      if (error) {\r\n        console.error('Error creating submitted quote:', error);\r\n        return { success: false, error: error.message };\r\n      }\r\n\r\n      revalidatePath('/booking/quote');\r\n      return { success: true, data: data as Quote };\r\n    }\r\n  } catch (error) {\r\n    console.error('Unexpected error submitting quote:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'An unexpected error occurred',\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Get all active services ordered by display_order\r\n */\r\nexport async function getServices(): Promise<Service[]> {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    const { data, error } = await supabase\r\n      .from('services')\r\n      .select('*')\r\n      .eq('is_active', true)\r\n      .order('display_order', { ascending: true });\r\n\r\n    if (error) {\r\n      console.error('Error fetching services:', error);\r\n      return [];\r\n    }\r\n\r\n    return (data || []) as Service[];\r\n  } catch (error) {\r\n    console.error('Unexpected error fetching services:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get additional services, optionally filtered by main service\r\n */\r\nexport async function getAdditionalServices(serviceId?: string): Promise<AdditionalService[]> {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    if (serviceId) {\r\n      // Get additional services filtered by service rules\r\n      const { data, error } = await supabase\r\n        .from('service_additional_service_rules')\r\n        .select(`\r\n          additional_service_id,\r\n          additional_services:additional_service_id(*)\r\n        `)\r\n        .eq('service_id', serviceId);\r\n\r\n      if (error) {\r\n        console.error('Error fetching additional services by service:', error);\r\n        return [];\r\n      }\r\n\r\n      // Extract and format the additional services\r\n      const additionalServices = (data || [])\r\n        .map((rule: any) => rule.additional_services)\r\n        .filter((service: AdditionalService) => service && service.is_active)\r\n        .sort((a: AdditionalService, b: AdditionalService) => a.display_order - b.display_order);\r\n\r\n      return additionalServices as AdditionalService[];\r\n    } else {\r\n      // Get all active additional services\r\n      const { data, error } = await supabase\r\n        .from('additional_services')\r\n        .select('*')\r\n        .eq('is_active', true)\r\n        .order('display_order', { ascending: true });\r\n\r\n      if (error) {\r\n        console.error('Error fetching all additional services:', error);\r\n        return [];\r\n      }\r\n\r\n      return (data || []) as AdditionalService[];\r\n    }\r\n  } catch (error) {\r\n    console.error('Unexpected error fetching additional services:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get home detail options for a specific type (bedrooms, bathrooms, carpet_type, room_status)\r\n */\r\nexport async function getHomeDetailOptions(optionType: string): Promise<HomeDetailOption[]> {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    const { data, error } = await supabase\r\n      .from('home_detail_options')\r\n      .select('*')\r\n      .eq('option_type', optionType)\r\n      .eq('is_active', true)\r\n      .order('display_order', { ascending: true });\r\n\r\n    if (error) {\r\n      console.error(`Error fetching home detail options for ${optionType}:`, error);\r\n      return [];\r\n    }\r\n\r\n    return (data || []) as HomeDetailOption[];\r\n  } catch (error) {\r\n    console.error(`Unexpected error fetching home detail options for ${optionType}:`, error);\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get all active cleaning equipment ordered by display_order\r\n */\r\nexport async function getCleaningEquipment(): Promise<CleaningEquipment[]> {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    const { data, error } = await supabase\r\n      .from('cleaning_equipment')\r\n      .select('*')\r\n      .eq('is_active', true)\r\n      .order('display_order', { ascending: true });\r\n\r\n    if (error) {\r\n      console.error('Error fetching cleaning equipment:', error);\r\n      return [];\r\n    }\r\n\r\n    return (data || []) as CleaningEquipment[];\r\n  } catch (error) {\r\n    console.error('Unexpected error fetching cleaning equipment:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;;MA+NsB,wBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA,+CAAA"}},
    {"offset": {"line": 711, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/27825/shalean-v2/shalean-reimagined/app/booking/quote/actions.ts"],"sourcesContent":["'use server';\r\n\r\nimport { createClient } from '@/lib/supabase/server';\r\nimport { QuoteFormData, QuoteStatus, Quote, Service, AdditionalService, HomeDetailOption, CleaningEquipment } from '@/types/quote';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\nexport interface SaveQuoteResult {\r\n  success: boolean;\r\n  data?: Quote;\r\n  error?: string;\r\n}\r\n\r\n/**\r\n * Save or update a quote draft\r\n */\r\nexport async function saveQuoteDraft(\r\n  email: string,\r\n  formData: QuoteFormData\r\n): Promise<SaveQuoteResult> {\r\n  try {\r\n    if (!email || !email.trim()) {\r\n      return { success: false, error: 'Email is required' };\r\n    }\r\n\r\n    const supabase = await createClient();\r\n\r\n    // Check if a draft already exists for this email\r\n    const { data: existingDraft } = await supabase\r\n      .from('quotes')\r\n      .select('id')\r\n      .eq('email', email.trim().toLowerCase())\r\n      .eq('status', 'draft')\r\n      .order('updated_at', { ascending: false })\r\n      .limit(1)\r\n      .single();\r\n\r\n    if (existingDraft) {\r\n      // Update existing draft\r\n      const { data, error } = await supabase\r\n        .from('quotes')\r\n        .update({\r\n          form_data: formData,\r\n          updated_at: new Date().toISOString(),\r\n        })\r\n        .eq('id', existingDraft.id)\r\n        .select()\r\n        .single();\r\n\r\n      if (error) {\r\n        console.error('Error updating quote draft:', error);\r\n        return { success: false, error: error.message };\r\n      }\r\n\r\n      return { success: true, data: data as Quote };\r\n    } else {\r\n      // Create new draft\r\n      const { data, error } = await supabase\r\n        .from('quotes')\r\n        .insert({\r\n          email: email.trim().toLowerCase(),\r\n          status: 'draft',\r\n          form_data: formData,\r\n        })\r\n        .select()\r\n        .single();\r\n\r\n      if (error) {\r\n        console.error('Error creating quote draft:', error);\r\n        return { success: false, error: error.message };\r\n      }\r\n\r\n      return { success: true, data: data as Quote };\r\n    }\r\n  } catch (error) {\r\n    console.error('Unexpected error saving quote draft:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'An unexpected error occurred',\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Get the latest draft quote for an email\r\n */\r\nexport async function getQuoteDraft(email: string): Promise<Quote | null> {\r\n  try {\r\n    if (!email || !email.trim()) {\r\n      return null;\r\n    }\r\n\r\n    const supabase = await createClient();\r\n\r\n    const { data, error } = await supabase\r\n      .from('quotes')\r\n      .select('*')\r\n      .eq('email', email.trim().toLowerCase())\r\n      .eq('status', 'draft')\r\n      .order('updated_at', { ascending: false })\r\n      .limit(1)\r\n      .single();\r\n\r\n    if (error) {\r\n      // If no draft exists, that's okay - return null\r\n      if (error.code === 'PGRST116') {\r\n        return null;\r\n      }\r\n      console.error('Error fetching quote draft:', error);\r\n      return null;\r\n    }\r\n\r\n    return data as Quote;\r\n  } catch (error) {\r\n    console.error('Unexpected error fetching quote draft:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get all quotes (drafts and submitted) for an email\r\n */\r\nexport async function getQuotesByEmail(email: string): Promise<Quote[]> {\r\n  try {\r\n    if (!email || !email.trim()) {\r\n      return [];\r\n    }\r\n\r\n    const supabase = await createClient();\r\n\r\n    const { data, error } = await supabase\r\n      .from('quotes')\r\n      .select('*')\r\n      .eq('email', email.trim().toLowerCase())\r\n      .order('updated_at', { ascending: false });\r\n\r\n    if (error) {\r\n      console.error('Error fetching quotes:', error);\r\n      return [];\r\n    }\r\n\r\n    return (data || []) as Quote[];\r\n  } catch (error) {\r\n    console.error('Unexpected error fetching quotes:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Submit a quote (change status from draft to submitted)\r\n */\r\nexport async function submitQuote(\r\n  email: string,\r\n  formData: QuoteFormData\r\n): Promise<SaveQuoteResult> {\r\n  try {\r\n    if (!email || !email.trim()) {\r\n      return { success: false, error: 'Email is required' };\r\n    }\r\n\r\n    const supabase = await createClient();\r\n\r\n    // Check if a draft exists for this email\r\n    const { data: existingDraft } = await supabase\r\n      .from('quotes')\r\n      .select('id')\r\n      .eq('email', email.trim().toLowerCase())\r\n      .eq('status', 'draft')\r\n      .order('updated_at', { ascending: false })\r\n      .limit(1)\r\n      .single();\r\n\r\n    if (existingDraft) {\r\n      // Update existing draft to submitted\r\n      const { data, error } = await supabase\r\n        .from('quotes')\r\n        .update({\r\n          status: 'submitted',\r\n          form_data: formData,\r\n          updated_at: new Date().toISOString(),\r\n        })\r\n        .eq('id', existingDraft.id)\r\n        .select()\r\n        .single();\r\n\r\n      if (error) {\r\n        console.error('Error submitting quote:', error);\r\n        return { success: false, error: error.message };\r\n      }\r\n\r\n      revalidatePath('/booking/quote');\r\n      return { success: true, data: data as Quote };\r\n    } else {\r\n      // Create new submitted quote\r\n      const { data, error } = await supabase\r\n        .from('quotes')\r\n        .insert({\r\n          email: email.trim().toLowerCase(),\r\n          status: 'submitted',\r\n          form_data: formData,\r\n        })\r\n        .select()\r\n        .single();\r\n\r\n      if (error) {\r\n        console.error('Error creating submitted quote:', error);\r\n        return { success: false, error: error.message };\r\n      }\r\n\r\n      revalidatePath('/booking/quote');\r\n      return { success: true, data: data as Quote };\r\n    }\r\n  } catch (error) {\r\n    console.error('Unexpected error submitting quote:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'An unexpected error occurred',\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Get all active services ordered by display_order\r\n */\r\nexport async function getServices(): Promise<Service[]> {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    const { data, error } = await supabase\r\n      .from('services')\r\n      .select('*')\r\n      .eq('is_active', true)\r\n      .order('display_order', { ascending: true });\r\n\r\n    if (error) {\r\n      console.error('Error fetching services:', error);\r\n      return [];\r\n    }\r\n\r\n    return (data || []) as Service[];\r\n  } catch (error) {\r\n    console.error('Unexpected error fetching services:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get additional services, optionally filtered by main service\r\n */\r\nexport async function getAdditionalServices(serviceId?: string): Promise<AdditionalService[]> {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    if (serviceId) {\r\n      // Get additional services filtered by service rules\r\n      const { data, error } = await supabase\r\n        .from('service_additional_service_rules')\r\n        .select(`\r\n          additional_service_id,\r\n          additional_services:additional_service_id(*)\r\n        `)\r\n        .eq('service_id', serviceId);\r\n\r\n      if (error) {\r\n        console.error('Error fetching additional services by service:', error);\r\n        return [];\r\n      }\r\n\r\n      // Extract and format the additional services\r\n      const additionalServices = (data || [])\r\n        .map((rule: any) => rule.additional_services)\r\n        .filter((service: AdditionalService) => service && service.is_active)\r\n        .sort((a: AdditionalService, b: AdditionalService) => a.display_order - b.display_order);\r\n\r\n      return additionalServices as AdditionalService[];\r\n    } else {\r\n      // Get all active additional services\r\n      const { data, error } = await supabase\r\n        .from('additional_services')\r\n        .select('*')\r\n        .eq('is_active', true)\r\n        .order('display_order', { ascending: true });\r\n\r\n      if (error) {\r\n        console.error('Error fetching all additional services:', error);\r\n        return [];\r\n      }\r\n\r\n      return (data || []) as AdditionalService[];\r\n    }\r\n  } catch (error) {\r\n    console.error('Unexpected error fetching additional services:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get home detail options for a specific type (bedrooms, bathrooms, carpet_type, room_status)\r\n */\r\nexport async function getHomeDetailOptions(optionType: string): Promise<HomeDetailOption[]> {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    const { data, error } = await supabase\r\n      .from('home_detail_options')\r\n      .select('*')\r\n      .eq('option_type', optionType)\r\n      .eq('is_active', true)\r\n      .order('display_order', { ascending: true });\r\n\r\n    if (error) {\r\n      console.error(`Error fetching home detail options for ${optionType}:`, error);\r\n      return [];\r\n    }\r\n\r\n    return (data || []) as HomeDetailOption[];\r\n  } catch (error) {\r\n    console.error(`Unexpected error fetching home detail options for ${optionType}:`, error);\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get all active cleaning equipment ordered by display_order\r\n */\r\nexport async function getCleaningEquipment(): Promise<CleaningEquipment[]> {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    const { data, error } = await supabase\r\n      .from('cleaning_equipment')\r\n      .select('*')\r\n      .eq('is_active', true)\r\n      .order('display_order', { ascending: true });\r\n\r\n    if (error) {\r\n      console.error('Error fetching cleaning equipment:', error);\r\n      return [];\r\n    }\r\n\r\n    return (data || []) as CleaningEquipment[];\r\n  } catch (error) {\r\n    console.error('Unexpected error fetching cleaning equipment:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;;MAwPsB,wBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA,yDAAA"}},
    {"offset": {"line": 728, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/27825/shalean-v2/shalean-reimagined/src/lib/supabase/client.ts"],"sourcesContent":["'use client'\r\n\r\nimport { createBrowserClient } from '@supabase/ssr'\r\n\r\nexport function createClient() {\r\n  return createBrowserClient(\r\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\r\n  )\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAMI;AAJJ;AAAA;AAFA;;AAIO,SAAS;IACd,OAAO,IAAA,oMAAmB;AAI5B"}},
    {"offset": {"line": 747, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/27825/shalean-v2/shalean-reimagined/src/lib/utils/cleaner-utils.ts"],"sourcesContent":["import { Cleaner, CleanerWithAvailability } from '@/types/booking';\r\n\r\nexport type SortCriteria = 'best-match' | 'highest-rated' | 'most-reliable' | 'most-experienced';\r\n\r\n/**\r\n * Calculate reliability score from booking metrics\r\n * Formula:\r\n * - Completion Rate (40%): (completed_bookings / total_bookings) * 40\r\n * - On-Time Rate (30%): (on_time_bookings / total_bookings) * 30\r\n * - Rating Factor (20%): (rating / 5.0) * 20\r\n * - Booking Volume (10%): min(total_bookings / 50, 1) * 10\r\n */\r\nexport function calculateReliabilityScore(cleaner: Cleaner): number {\r\n  const totalBookings = cleaner.total_bookings || 0;\r\n  const completedBookings = cleaner.completed_bookings || 0;\r\n  const onTimeBookings = cleaner.on_time_bookings || 0;\r\n  const rating = cleaner.rating || 0;\r\n\r\n  // If no bookings, return default score of 50\r\n  if (totalBookings === 0) {\r\n    return 50.0;\r\n  }\r\n\r\n  // Calculate completion rate score (40% weight)\r\n  const completionRateScore = (completedBookings / totalBookings) * 40.0;\r\n\r\n  // Calculate on-time rate score (30% weight)\r\n  const onTimeRateScore = (onTimeBookings / totalBookings) * 30.0;\r\n\r\n  // Calculate rating score (20% weight)\r\n  const ratingScore = (rating / 5.0) * 20.0;\r\n\r\n  // Calculate volume score (10% weight) - normalized to max 50 bookings\r\n  const volumeScore = Math.min(totalBookings / 50.0, 1.0) * 10.0;\r\n\r\n  // Calculate final score\r\n  let finalScore = completionRateScore + onTimeRateScore + ratingScore + volumeScore;\r\n\r\n  // Ensure score is between 0 and 100\r\n  finalScore = Math.max(0.0, Math.min(100.0, finalScore));\r\n\r\n  return Math.round(finalScore * 100) / 100; // Round to 2 decimal places\r\n}\r\n\r\n/**\r\n * Format reliability score for display\r\n */\r\nexport function formatReliabilityScore(score: number | null | undefined): string {\r\n  if (score === null || score === undefined) {\r\n    return 'N/A';\r\n  }\r\n  return `${score.toFixed(0)}%`;\r\n}\r\n\r\n/**\r\n * Sort cleaners by selected criteria\r\n */\r\nexport function sortCleanersByCriteria(\r\n  cleaners: CleanerWithAvailability[],\r\n  criteria: SortCriteria\r\n): CleanerWithAvailability[] {\r\n  const sorted = [...cleaners];\r\n\r\n  switch (criteria) {\r\n    case 'best-match':\r\n      // Sort by: reliability_score (60%) + rating (40%)\r\n      sorted.sort((a, b) => {\r\n        const scoreA = (a.reliability_score || 0) * 0.6 + (a.rating || 0) * 0.4;\r\n        const scoreB = (b.reliability_score || 0) * 0.6 + (b.rating || 0) * 0.4;\r\n        return scoreB - scoreA;\r\n      });\r\n      break;\r\n\r\n    case 'highest-rated':\r\n      sorted.sort((a, b) => (b.rating || 0) - (a.rating || 0));\r\n      break;\r\n\r\n    case 'most-reliable':\r\n      sorted.sort((a, b) => (b.reliability_score || 0) - (a.reliability_score || 0));\r\n      break;\r\n\r\n    case 'most-experienced':\r\n      sorted.sort((a, b) => (b.years_experience || 0) - (a.years_experience || 0));\r\n      break;\r\n\r\n    default:\r\n      // Default to best-match\r\n      sorted.sort((a, b) => {\r\n        const scoreA = (a.reliability_score || 0) * 0.6 + (a.rating || 0) * 0.4;\r\n        const scoreB = (b.reliability_score || 0) * 0.6 + (b.rating || 0) * 0.4;\r\n        return scoreB - scoreA;\r\n      });\r\n  }\r\n\r\n  return sorted;\r\n}\r\n\r\n/**\r\n * Calculate completion rate for a cleaner\r\n */\r\nexport function calculateCompletionRate(cleaner: Cleaner): number {\r\n  const total = cleaner.total_bookings || 0;\r\n  const completed = cleaner.completed_bookings || 0;\r\n  if (total === 0) return 0;\r\n  return Math.round((completed / total) * 100);\r\n}\r\n\r\n/**\r\n * Calculate on-time rate for a cleaner\r\n */\r\nexport function calculateOnTimeRate(cleaner: Cleaner): number {\r\n  const total = cleaner.total_bookings || 0;\r\n  const onTime = cleaner.on_time_bookings || 0;\r\n  if (total === 0) return 0;\r\n  return Math.round((onTime / total) * 100);\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;;;;;;;AAYO,SAAS,0BAA0B,OAAgB;IACxD,MAAM,gBAAgB,QAAQ,cAAc,IAAI;IAChD,MAAM,oBAAoB,QAAQ,kBAAkB,IAAI;IACxD,MAAM,iBAAiB,QAAQ,gBAAgB,IAAI;IACnD,MAAM,SAAS,QAAQ,MAAM,IAAI;IAEjC,6CAA6C;IAC7C,IAAI,kBAAkB,GAAG;QACvB,OAAO;IACT;IAEA,+CAA+C;IAC/C,MAAM,sBAAsB,AAAC,oBAAoB,gBAAiB;IAElE,4CAA4C;IAC5C,MAAM,kBAAkB,AAAC,iBAAiB,gBAAiB;IAE3D,sCAAsC;IACtC,MAAM,cAAc,AAAC,SAAS,MAAO;IAErC,sEAAsE;IACtE,MAAM,cAAc,KAAK,GAAG,CAAC,gBAAgB,MAAM,OAAO;IAE1D,wBAAwB;IACxB,IAAI,aAAa,sBAAsB,kBAAkB,cAAc;IAEvE,oCAAoC;IACpC,aAAa,KAAK,GAAG,CAAC,KAAK,KAAK,GAAG,CAAC,OAAO;IAE3C,OAAO,KAAK,KAAK,CAAC,aAAa,OAAO,KAAK,4BAA4B;AACzE;AAKO,SAAS,uBAAuB,KAAgC;IACrE,IAAI,UAAU,QAAQ,UAAU,WAAW;QACzC,OAAO;IACT;IACA,OAAO,GAAG,MAAM,OAAO,CAAC,GAAG,CAAC,CAAC;AAC/B;AAKO,SAAS,uBACd,QAAmC,EACnC,QAAsB;IAEtB,MAAM,SAAS;WAAI;KAAS;IAE5B,OAAQ;QACN,KAAK;YACH,kDAAkD;YAClD,OAAO,IAAI,CAAC,CAAC,GAAG;gBACd,MAAM,SAAS,CAAC,EAAE,iBAAiB,IAAI,CAAC,IAAI,MAAM,CAAC,EAAE,MAAM,IAAI,CAAC,IAAI;gBACpE,MAAM,SAAS,CAAC,EAAE,iBAAiB,IAAI,CAAC,IAAI,MAAM,CAAC,EAAE,MAAM,IAAI,CAAC,IAAI;gBACpE,OAAO,SAAS;YAClB;YACA;QAEF,KAAK;YACH,OAAO,IAAI,CAAC,CAAC,GAAG,IAAM,CAAC,EAAE,MAAM,IAAI,CAAC,IAAI,CAAC,EAAE,MAAM,IAAI,CAAC;YACtD;QAEF,KAAK;YACH,OAAO,IAAI,CAAC,CAAC,GAAG,IAAM,CAAC,EAAE,iBAAiB,IAAI,CAAC,IAAI,CAAC,EAAE,iBAAiB,IAAI,CAAC;YAC5E;QAEF,KAAK;YACH,OAAO,IAAI,CAAC,CAAC,GAAG,IAAM,CAAC,EAAE,gBAAgB,IAAI,CAAC,IAAI,CAAC,EAAE,gBAAgB,IAAI,CAAC;YAC1E;QAEF;YACE,wBAAwB;YACxB,OAAO,IAAI,CAAC,CAAC,GAAG;gBACd,MAAM,SAAS,CAAC,EAAE,iBAAiB,IAAI,CAAC,IAAI,MAAM,CAAC,EAAE,MAAM,IAAI,CAAC,IAAI;gBACpE,MAAM,SAAS,CAAC,EAAE,iBAAiB,IAAI,CAAC,IAAI,MAAM,CAAC,EAAE,MAAM,IAAI,CAAC,IAAI;gBACpE,OAAO,SAAS;YAClB;IACJ;IAEA,OAAO;AACT;AAKO,SAAS,wBAAwB,OAAgB;IACtD,MAAM,QAAQ,QAAQ,cAAc,IAAI;IACxC,MAAM,YAAY,QAAQ,kBAAkB,IAAI;IAChD,IAAI,UAAU,GAAG,OAAO;IACxB,OAAO,KAAK,KAAK,CAAC,AAAC,YAAY,QAAS;AAC1C;AAKO,SAAS,oBAAoB,OAAgB;IAClD,MAAM,QAAQ,QAAQ,cAAc,IAAI;IACxC,MAAM,SAAS,QAAQ,gBAAgB,IAAI;IAC3C,IAAI,UAAU,GAAG,OAAO;IACxB,OAAO,KAAK,KAAK,CAAC,AAAC,SAAS,QAAS;AACvC"}},
    {"offset": {"line": 839, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/27825/shalean-v2/shalean-reimagined/app/booking/book/actions-client.ts"],"sourcesContent":["'use client';\r\n\r\nimport { createClient } from '@/lib/supabase/client';\r\nimport { PricingRule, Cleaner, CleanerWithAvailability } from '@/types/booking';\r\nimport { calculateReliabilityScore, calculateCompletionRate, calculateOnTimeRate } from '@/lib/utils/cleaner-utils';\r\n\r\n/**\r\n * Client-side action to fetch pricing rules\r\n * This can be called from client components and cached with React Query\r\n */\r\nexport async function getPricingRulesClient(): Promise<PricingRule[]> {\r\n  try {\r\n    const supabase = createClient();\r\n\r\n    const { data, error } = await supabase\r\n      .from('pricing_rules')\r\n      .select('*')\r\n      .eq('is_active', true)\r\n      .order('display_order', { ascending: true });\r\n\r\n    if (error) {\r\n      console.error('Error fetching pricing rules:', error);\r\n      return [];\r\n    }\r\n\r\n    return (data || []) as PricingRule[];\r\n  } catch (error) {\r\n    console.error('Unexpected error fetching pricing rules:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Client-side action to fetch available cleaners\r\n * This can be called from client components\r\n */\r\nexport async function getAvailableCleanersClient(serviceSuburb?: string): Promise<{\r\n  success: boolean;\r\n  cleaners?: Cleaner[];\r\n  error?: string;\r\n}> {\r\n  try {\r\n    const supabase = createClient();\r\n\r\n    // Build query - only filter by is_active\r\n    let query = supabase\r\n      .from('cleaners')\r\n      .select('*')\r\n      .eq('is_active', true);\r\n\r\n    const { data, error } = await query\r\n      .order('rating', { ascending: false })\r\n      .order('name', { ascending: true });\r\n\r\n    if (error) {\r\n      console.error('Error fetching cleaners:', error);\r\n      return { success: false, error: 'Failed to fetch cleaners' };\r\n    }\r\n\r\n    let cleaners = data || [];\r\n\r\n    // Filter by is_available if the column exists (client-side filter as fallback)\r\n    cleaners = cleaners.filter((cleaner) => {\r\n      // If is_available column doesn't exist or is null/undefined, include the cleaner\r\n      // Otherwise, only include if is_available is true\r\n      return cleaner.is_available !== false;\r\n    });\r\n\r\n    // Filter by area if suburb is provided\r\n    if (serviceSuburb && cleaners.length > 0) {\r\n      const suburbLower = serviceSuburb.toLowerCase().trim();\r\n      cleaners = cleaners.filter((cleaner) => {\r\n        // If cleaner has no areas specified, include them (they serve all areas)\r\n        if (!cleaner.areas || cleaner.areas.length === 0) {\r\n          return true;\r\n        }\r\n        // Check if any area matches the suburb (case-insensitive partial match)\r\n        return cleaner.areas.some((area: string) => {\r\n          const areaLower = area.toLowerCase();\r\n          return areaLower.includes(suburbLower) || suburbLower.includes(areaLower);\r\n        });\r\n      });\r\n    }\r\n\r\n    return { success: true, cleaners: cleaners as Cleaner[] };\r\n  } catch (error) {\r\n    console.error('Unexpected error fetching cleaners:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'An unexpected error occurred',\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Check if a cleaner has a booking conflict for a specific date and time slot (client-side)\r\n */\r\nexport async function checkCleanerBookingConflictClient(\r\n  cleanerId: string,\r\n  serviceDate: string,\r\n  serviceTime: string,\r\n  serviceDuration: number\r\n): Promise<boolean> {\r\n  try {\r\n    const supabase = createClient();\r\n\r\n    // Query bookings for this cleaner on the specified date\r\n    const { data: bookings, error } = await supabase\r\n      .from('bookings')\r\n      .select('service_time, service_duration')\r\n      .eq('preferred_cleaner_id', cleanerId)\r\n      .eq('service_date', serviceDate)\r\n      .in('status', ['pending', 'confirmed']);\r\n\r\n    if (error) {\r\n      console.error('Error checking booking conflicts:', error);\r\n      return false; // Assume no conflict on error\r\n    }\r\n\r\n    if (!bookings || bookings.length === 0) {\r\n      return false; // No bookings, no conflict\r\n    }\r\n\r\n    // Parse the new booking start time\r\n    const [newStartHours, newStartMinutes] = serviceTime.split(':').map(Number);\r\n    const newStartTimeMinutes = newStartHours * 60 + newStartMinutes;\r\n    const serviceDurationMinutes = Math.round(serviceDuration * 60);\r\n    const newEndTimeMinutes = newStartTimeMinutes + serviceDurationMinutes;\r\n\r\n    // Check each existing booking for overlap\r\n    for (const booking of bookings) {\r\n      if (!booking.service_time) continue;\r\n\r\n      // Parse booking start time\r\n      const [bookingStartHours, bookingStartMinutes] = booking.service_time\r\n        .split(':')\r\n        .slice(0, 2)\r\n        .map(Number);\r\n      const bookingStartTimeMinutes = bookingStartHours * 60 + bookingStartMinutes;\r\n\r\n      // Parse booking duration\r\n      const bookingDurationMinutes = Math.round(\r\n        (typeof booking.service_duration === 'number'\r\n          ? booking.service_duration\r\n          : parseFloat(booking.service_duration || '0')) * 60\r\n      );\r\n      const bookingEndTimeMinutes = bookingStartTimeMinutes + bookingDurationMinutes;\r\n\r\n      // Check for overlap: new start < existing end AND new end > existing start\r\n      if (newStartTimeMinutes < bookingEndTimeMinutes && newEndTimeMinutes > bookingStartTimeMinutes) {\r\n        return true; // Conflict found\r\n      }\r\n    }\r\n\r\n    return false; // No conflicts\r\n  } catch (error) {\r\n    console.error('Unexpected error checking booking conflict:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Get available cleaners with enhanced filtering criteria (client-side)\r\n * Filters by: Location, Availability, Booking conflicts\r\n * Sorts by: Reliability Score, Rating\r\n */\r\nexport async function getAvailableCleanersWithCriteriaClient(params: {\r\n  serviceSuburb?: string;\r\n  serviceDate?: string;\r\n  serviceTime?: string;\r\n  serviceDuration?: number;\r\n  minRating?: number;\r\n  minReliabilityScore?: number;\r\n}): Promise<{\r\n  success: boolean;\r\n  cleaners?: CleanerWithAvailability[];\r\n  error?: string;\r\n}> {\r\n  try {\r\n    const supabase = createClient();\r\n    const {\r\n      serviceSuburb,\r\n      serviceDate,\r\n      serviceTime,\r\n      serviceDuration = 3,\r\n      minRating = 0,\r\n      minReliabilityScore = 0,\r\n    } = params;\r\n\r\n    // Build base query\r\n    let query = supabase\r\n      .from('cleaners')\r\n      .select('*')\r\n      .eq('is_active', true);\r\n\r\n    const { data, error } = await query\r\n      .order('reliability_score', { ascending: false, nullsFirst: false })\r\n      .order('rating', { ascending: false })\r\n      .order('name', { ascending: true });\r\n\r\n    if (error) {\r\n      console.error('Error fetching cleaners:', error);\r\n      return { success: false, error: 'Failed to fetch cleaners' };\r\n    }\r\n\r\n    let cleaners = (data || []) as Cleaner[];\r\n\r\n    // Filter by is_available\r\n    cleaners = cleaners.filter((cleaner) => cleaner.is_available !== false);\r\n\r\n    // Filter by location (suburb)\r\n    if (serviceSuburb && cleaners.length > 0) {\r\n      const suburbLower = serviceSuburb.toLowerCase().trim();\r\n      cleaners = cleaners.filter((cleaner) => {\r\n        if (!cleaner.areas || cleaner.areas.length === 0) {\r\n          return true; // Serve all areas\r\n        }\r\n        return cleaner.areas.some((area: string) => {\r\n          const areaLower = area.toLowerCase();\r\n          return areaLower.includes(suburbLower) || suburbLower.includes(areaLower);\r\n        });\r\n      });\r\n    }\r\n\r\n    // Filter by day of week availability if date is provided\r\n    if (serviceDate) {\r\n      const date = new Date(serviceDate);\r\n      const dayOfWeek = date.getDay(); // 0 = Sunday, 1 = Monday, etc.\r\n      cleaners = cleaners.filter((cleaner) => {\r\n        const dayMap: Record<number, keyof Cleaner> = {\r\n          0: 'available_sunday',\r\n          1: 'available_monday',\r\n          2: 'available_tuesday',\r\n          3: 'available_wednesday',\r\n          4: 'available_thursday',\r\n          5: 'available_friday',\r\n          6: 'available_saturday',\r\n        };\r\n        const dayField = dayMap[dayOfWeek];\r\n        return cleaner[dayField] !== false;\r\n      });\r\n    }\r\n\r\n    // Filter by minimum rating\r\n    if (minRating > 0) {\r\n      cleaners = cleaners.filter((cleaner) => (cleaner.rating || 0) >= minRating);\r\n    }\r\n\r\n    // Filter by minimum reliability score\r\n    if (minReliabilityScore > 0) {\r\n      cleaners = cleaners.filter((cleaner) => (cleaner.reliability_score || 0) >= minReliabilityScore);\r\n    }\r\n\r\n    // Enrich cleaners with availability and booking conflict information\r\n    const enrichedCleaners: CleanerWithAvailability[] = await Promise.all(\r\n      cleaners.map(async (cleaner) => {\r\n        let isAvailableForSlot = true;\r\n        let bookingConflict = false;\r\n\r\n        // Check booking conflict if date and time are provided\r\n        if (serviceDate && serviceTime && serviceDuration) {\r\n          bookingConflict = await checkCleanerBookingConflictClient(\r\n            cleaner.id,\r\n            serviceDate,\r\n            serviceTime,\r\n            serviceDuration\r\n          );\r\n          isAvailableForSlot = !bookingConflict;\r\n        }\r\n\r\n        // Calculate reliability score if not present\r\n        const reliabilityScore = cleaner.reliability_score ?? calculateReliabilityScore(cleaner);\r\n\r\n        return {\r\n          ...cleaner,\r\n          reliability_score: reliabilityScore,\r\n          isAvailableForSlot,\r\n          bookingConflict,\r\n          completionRate: calculateCompletionRate(cleaner),\r\n          onTimeRate: calculateOnTimeRate(cleaner),\r\n        };\r\n      })\r\n    );\r\n\r\n    // Sort by reliability score and rating\r\n    enrichedCleaners.sort((a, b) => {\r\n      const scoreA = (a.reliability_score || 0) * 0.6 + (a.rating || 0) * 0.4;\r\n      const scoreB = (b.reliability_score || 0) * 0.6 + (b.rating || 0) * 0.4;\r\n      return scoreB - scoreA;\r\n    });\r\n\r\n    return { success: true, cleaners: enrichedCleaners };\r\n  } catch (error) {\r\n    console.error('Unexpected error fetching cleaners with criteria:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'An unexpected error occurred',\r\n    };\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1069, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/27825/shalean-v2/shalean-reimagined/src/lib/utils/service-validation.ts"],"sourcesContent":["/**\r\n * Service validation utilities for recurring bookings\r\n * \r\n * Only Standard Cleaning and Airbnb Cleaning support recurring bookings.\r\n * All other services (Deep Cleaning, Move In/Out, Carpet Cleaning) are One-Time only.\r\n */\r\n\r\n/**\r\n * Check if a service supports recurring bookings\r\n * @param serviceName - The name of the service (case-insensitive)\r\n * @returns true if the service supports recurring bookings, false otherwise\r\n */\r\nexport function supportsRecurringBookings(serviceName: string): boolean {\r\n  if (!serviceName) return false;\r\n  \r\n  const normalizedName = serviceName.toLowerCase().trim();\r\n  \r\n  // Standard Cleaning supports recurring\r\n  if (normalizedName.includes('standard')) {\r\n    return true;\r\n  }\r\n  \r\n  // Airbnb Cleaning supports recurring\r\n  if (normalizedName.includes('airbnb')) {\r\n    return true;\r\n  }\r\n  \r\n  // All other services are One-Time only\r\n  return false;\r\n}\r\n\r\n/**\r\n * Get available frequencies for a service\r\n * @param serviceName - The name of the service (case-insensitive)\r\n * @returns Array of available frequency options\r\n */\r\nexport function getAvailableFrequencies(\r\n  serviceName: string\r\n): ('one-time' | 'weekly' | 'bi-weekly' | 'monthly')[] {\r\n  if (supportsRecurringBookings(serviceName)) {\r\n    return ['one-time', 'weekly', 'bi-weekly', 'monthly'];\r\n  }\r\n  \r\n  // Non-supported services only allow One-Time\r\n  return ['one-time'];\r\n}\r\n\r\n/**\r\n * Check if a frequency is valid for a service\r\n * @param serviceName - The name of the service\r\n * @param frequency - The frequency to check\r\n * @returns true if the frequency is valid for the service\r\n */\r\nexport function isValidFrequencyForService(\r\n  serviceName: string,\r\n  frequency: 'one-time' | 'weekly' | 'bi-weekly' | 'monthly'\r\n): boolean {\r\n  const availableFrequencies = getAvailableFrequencies(serviceName);\r\n  return availableFrequencies.includes(frequency);\r\n}\r\n\r\n"],"names":[],"mappings":"AAAA;;;;;CAKC,GAED;;;;CAIC;;;;;;;;AACM,SAAS,0BAA0B,WAAmB;IAC3D,IAAI,CAAC,aAAa,OAAO;IAEzB,MAAM,iBAAiB,YAAY,WAAW,GAAG,IAAI;IAErD,uCAAuC;IACvC,IAAI,eAAe,QAAQ,CAAC,aAAa;QACvC,OAAO;IACT;IAEA,qCAAqC;IACrC,IAAI,eAAe,QAAQ,CAAC,WAAW;QACrC,OAAO;IACT;IAEA,uCAAuC;IACvC,OAAO;AACT;AAOO,SAAS,wBACd,WAAmB;IAEnB,IAAI,0BAA0B,cAAc;QAC1C,OAAO;YAAC;YAAY;YAAU;YAAa;SAAU;IACvD;IAEA,6CAA6C;IAC7C,OAAO;QAAC;KAAW;AACrB;AAQO,SAAS,2BACd,WAAmB,EACnB,SAA0D;IAE1D,MAAM,uBAAuB,wBAAwB;IACrD,OAAO,qBAAqB,QAAQ,CAAC;AACvC"}},
    {"offset": {"line": 1125, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/27825/shalean-v2/shalean-reimagined/src/lib/pricing/calculator-client.ts"],"sourcesContent":["'use client';\r\n\r\nimport { PricingRule, PriceBreakdown } from '@/types/booking';\r\nimport { supportsRecurringBookings } from '@/lib/utils/service-validation';\r\n\r\n/**\r\n * Client-side price calculation using cached pricing rules\r\n * This is instant and doesn't require server calls\r\n */\r\nexport function calculatePriceBreakdownClient(\r\n  pricingRules: PricingRule[],\r\n  serviceId: string,\r\n  bedrooms: string,\r\n  bathrooms: string,\r\n  additionalServiceIds: string[],\r\n  cleaningFrequency: 'one-time' | 'weekly' | 'bi-weekly' | 'monthly',\r\n  discountAmount: number = 0,\r\n  numberOfFittedRooms: string = '',\r\n  numberOfLooseCarpets: string = '',\r\n  isCarpetCleaning: boolean = false,\r\n  serviceName?: string,\r\n  cleaningEquipment?: 'yes' | 'no' | '',\r\n  numberOfCleaners: number = 1\r\n): PriceBreakdown {\r\n  // Equipment supply charge constant\r\n  const EQUIPMENT_SUPPLY_CHARGE = 500;\r\n  \r\n  // Additional cleaner charge constant (R250 per additional cleaner)\r\n  const ADDITIONAL_CLEANER_CHARGE = 250;\r\n  // Base price\r\n  const basePriceRule = pricingRules.find(\r\n    (rule) => rule.rule_type === 'base_price' && rule.service_id === serviceId\r\n  );\r\n  const basePrice = basePriceRule?.price || 0;\r\n\r\n  // Bedroom price (only for non-carpet services)\r\n  const bedroomRule = pricingRules.find(\r\n    (rule) => rule.rule_type === 'bedroom' && rule.rule_value === bedrooms\r\n  );\r\n  const bedroomsPrice = isCarpetCleaning ? 0 : (bedroomRule?.price || 0);\r\n\r\n  // Bathroom price (only for non-carpet services)\r\n  const bathroomRule = pricingRules.find(\r\n    (rule) => rule.rule_type === 'bathroom' && rule.rule_value === bathrooms\r\n  );\r\n  const bathroomsPrice = isCarpetCleaning ? 0 : (bathroomRule?.price || 0);\r\n\r\n  // Carpet pricing (for carpet cleaning service)\r\n  // Fitted rooms price (per room)\r\n  const fittedRoomRule = pricingRules.find(\r\n    (rule) => rule.rule_type === 'fitted_room' && rule.rule_key === 'per_room'\r\n  );\r\n  const fittedRoomsPrice = fittedRoomRule?.price \r\n    ? (parseFloat(numberOfFittedRooms) || 0) * (fittedRoomRule.price || 0)\r\n    : 0;\r\n\r\n  // Loose carpets price (per carpet/rug)\r\n  const looseCarpetRule = pricingRules.find(\r\n    (rule) => rule.rule_type === 'loose_carpet' && rule.rule_key === 'per_carpet'\r\n  );\r\n  const looseCarpetsPrice = looseCarpetRule?.price\r\n    ? (parseFloat(numberOfLooseCarpets) || 0) * (looseCarpetRule.price || 0)\r\n    : 0;\r\n\r\n  // Additional services price\r\n  let additionalServicesPrice = 0;\r\n  for (const serviceId of additionalServiceIds) {\r\n    const serviceRule = pricingRules.find(\r\n      (rule) => rule.rule_type === 'additional_service' && rule.additional_service_id === serviceId\r\n    );\r\n    additionalServicesPrice += serviceRule?.price || 0;\r\n  }\r\n\r\n  // Equipment supply charge - only for Standard and Airbnb services when user selects 'yes'\r\n  let equipmentSupplyPrice = 0;\r\n  if (cleaningEquipment === 'yes' && serviceName && supportsRecurringBookings(serviceName)) {\r\n    equipmentSupplyPrice = EQUIPMENT_SUPPLY_CHARGE;\r\n  }\r\n\r\n  // Additional cleaners charge - only for Standard and Airbnb services\r\n  // First cleaner is included in base price, charge for each additional cleaner\r\n  let additionalCleanersPrice = 0;\r\n  if (serviceName && supportsRecurringBookings(serviceName) && numberOfCleaners > 1) {\r\n    const additionalCleanersCount = Math.max(0, Math.min(numberOfCleaners - 1, 4)); // Max 4 additional (total 5 cleaners)\r\n    additionalCleanersPrice = additionalCleanersCount * ADDITIONAL_CLEANER_CHARGE;\r\n  }\r\n\r\n  // Subtotal before discounts\r\n  const subtotal = basePrice + bedroomsPrice + bathroomsPrice + fittedRoomsPrice + looseCarpetsPrice + additionalServicesPrice + equipmentSupplyPrice + additionalCleanersPrice;\r\n\r\n  // Frequency discount - only apply to Standard and Airbnb cleaning services\r\n  let frequencyDiscountPercent = 0;\r\n  let frequencyDiscountAmount = 0;\r\n  \r\n  // Only apply frequency discount if ALL conditions are met:\r\n  // 1. Frequency is not one-time\r\n  // 2. Service name is provided (not undefined, not empty)\r\n  // 3. Service supports recurring bookings (Standard or Airbnb only)\r\n  if (cleaningFrequency !== 'one-time' && serviceName && serviceName.trim() !== '') {\r\n    if (supportsRecurringBookings(serviceName)) {\r\n      const discountRule = pricingRules.find(\r\n        (rule) => rule.rule_type === 'frequency_discount' && rule.rule_value === cleaningFrequency\r\n      );\r\n      frequencyDiscountPercent = discountRule?.percentage || 0;\r\n      frequencyDiscountAmount = (subtotal * frequencyDiscountPercent) / 100;\r\n    }\r\n    // Explicitly: If service doesn't support recurring, discount remains 0\r\n    // This ensures Deep Cleaning, Move In/Out, and Carpet Cleaning NEVER get discounts\r\n  }\r\n\r\n  // Subtotal after frequency discount\r\n  const subtotalAfterFrequencyDiscount = subtotal - frequencyDiscountAmount;\r\n\r\n  // Apply discount code (passed in as discountAmount)\r\n  const finalSubtotal = Math.max(0, subtotalAfterFrequencyDiscount - discountAmount);\r\n\r\n  // Service fee (calculated on subtotal after frequency discount, before discount code)\r\n  const feeRule = pricingRules.find(\r\n    (rule) => rule.rule_type === 'service_fee'\r\n  );\r\n  const serviceFeePercentage = feeRule?.percentage || 0;\r\n  const serviceFee = (subtotalAfterFrequencyDiscount * serviceFeePercentage) / 100;\r\n\r\n  // Total amount (subtotal after all discounts + service fee)\r\n  const totalAmount = finalSubtotal + serviceFee;\r\n\r\n  return {\r\n    basePrice,\r\n    bedroomsPrice,\r\n    bathroomsPrice,\r\n    fittedRoomsPrice,\r\n    looseCarpetsPrice,\r\n    additionalServicesPrice,\r\n    equipmentSupplyPrice,\r\n    additionalCleanersPrice,\r\n    subtotal,\r\n    frequencyDiscountPercent,\r\n    frequencyDiscountAmount,\r\n    discountAmount,\r\n    serviceFee,\r\n    totalAmount\r\n  };\r\n}\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1223, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/27825/shalean-v2/shalean-reimagined/src/lib/utils/recurring-dates.ts"],"sourcesContent":["/**\r\n * Calculate all booking dates for the current month based on frequency\r\n * @param startDate - The initial booking date selected by the user\r\n * @param frequency - 'one-time' | 'weekly' | 'bi-weekly' | 'monthly'\r\n * @returns Array of dates for bookings in the current month\r\n */\r\nexport function calculateBookingDatesForMonth(\r\n  startDate: Date,\r\n  frequency: 'one-time' | 'weekly' | 'bi-weekly' | 'monthly'\r\n): Date[] {\r\n  const dates: Date[] = [];\r\n  const currentDate = new Date(startDate);\r\n  \r\n  // Get the month and year of the start date\r\n  const month = currentDate.getMonth();\r\n  const year = currentDate.getFullYear();\r\n  \r\n  // Get the last day of the month\r\n  const lastDayOfMonth = new Date(year, month + 1, 0).getDate();\r\n  \r\n  switch (frequency) {\r\n    case 'one-time':\r\n      // Return only the start date\r\n      dates.push(new Date(startDate));\r\n      break;\r\n      \r\n    case 'weekly':\r\n      // Find all occurrences of the same day of week in the month\r\n      const dayOfWeek = currentDate.getDay(); // 0 = Sunday, 1 = Monday, etc.\r\n      const startDay = currentDate.getDate();\r\n      \r\n      // Start from the selected date\r\n      let weeklyDate = new Date(year, month, startDay);\r\n      \r\n      // Add all remaining occurrences in the month\r\n      while (weeklyDate.getMonth() === month && weeklyDate.getDate() <= lastDayOfMonth) {\r\n        dates.push(new Date(weeklyDate));\r\n        weeklyDate.setDate(weeklyDate.getDate() + 7); // Add 7 days\r\n      }\r\n      break;\r\n      \r\n    case 'bi-weekly':\r\n      // Find occurrences every 2 weeks in the month\r\n      const biWeeklyStartDay = currentDate.getDate();\r\n      let biWeeklyDate = new Date(year, month, biWeeklyStartDay);\r\n      \r\n      // Add all occurrences in the month (every 2 weeks)\r\n      while (biWeeklyDate.getMonth() === month && biWeeklyDate.getDate() <= lastDayOfMonth) {\r\n        dates.push(new Date(biWeeklyDate));\r\n        biWeeklyDate.setDate(biWeeklyDate.getDate() + 14); // Add 14 days\r\n      }\r\n      break;\r\n      \r\n    case 'monthly':\r\n      // Return only the start date (one booking per month)\r\n      dates.push(new Date(startDate));\r\n      break;\r\n      \r\n    default:\r\n      dates.push(new Date(startDate));\r\n  }\r\n  \r\n  return dates;\r\n}\r\n\r\n/**\r\n * Calculate the next booking date for auto-creation\r\n * @param lastDate - The last booking date in the current series\r\n * @param frequency - 'one-time' | 'weekly' | 'bi-weekly' | 'monthly'\r\n * @returns The next booking date\r\n */\r\nexport function calculateNextBookingDate(\r\n  lastDate: Date,\r\n  frequency: 'one-time' | 'weekly' | 'bi-weekly' | 'monthly'\r\n): Date {\r\n  const nextDate = new Date(lastDate);\r\n  \r\n  switch (frequency) {\r\n    case 'one-time':\r\n      // Should not be called for one-time, but return next month just in case\r\n      nextDate.setMonth(nextDate.getMonth() + 1);\r\n      break;\r\n      \r\n    case 'weekly':\r\n      // Next booking is 1 week from last date, but we want first of next month\r\n      // So calculate first occurrence of next month\r\n      nextDate.setMonth(nextDate.getMonth() + 1);\r\n      // Keep the same day of week - find first occurrence in next month\r\n      const dayOfWeek = lastDate.getDay();\r\n      const dayOfMonth = lastDate.getDate();\r\n      \r\n      // Start from the 1st of next month\r\n      nextDate.setDate(1);\r\n      \r\n      // Find the first occurrence of the same day of week\r\n      while (nextDate.getDay() !== dayOfWeek) {\r\n        nextDate.setDate(nextDate.getDate() + 1);\r\n      }\r\n      break;\r\n      \r\n    case 'bi-weekly':\r\n      // Next booking is 2 weeks from last date, but we want first of next month\r\n      // Calculate first occurrence in next month (same day of week)\r\n      nextDate.setMonth(nextDate.getMonth() + 1);\r\n      const biWeeklyDayOfWeek = lastDate.getDay();\r\n      nextDate.setDate(1);\r\n      \r\n      // Find the first occurrence of the same day of week\r\n      while (nextDate.getDay() !== biWeeklyDayOfWeek) {\r\n        nextDate.setDate(nextDate.getDate() + 1);\r\n      }\r\n      break;\r\n      \r\n    case 'monthly':\r\n      // Next booking is same day next month\r\n      nextDate.setMonth(nextDate.getMonth() + 1);\r\n      // Handle edge case where day doesn't exist in next month (e.g., Jan 31 -> Feb 28/29)\r\n      const originalDay = lastDate.getDate();\r\n      const daysInNextMonth = new Date(nextDate.getFullYear(), nextDate.getMonth() + 1, 0).getDate();\r\n      nextDate.setDate(Math.min(originalDay, daysInNextMonth));\r\n      break;\r\n      \r\n    default:\r\n      nextDate.setMonth(nextDate.getMonth() + 1);\r\n  }\r\n  \r\n  return nextDate;\r\n}\r\n\r\n/**\r\n * Format date to YYYY-MM-DD string for database storage\r\n */\r\nexport function formatDateForDB(date: Date): string {\r\n  const year = date.getFullYear();\r\n  const month = String(date.getMonth() + 1).padStart(2, '0');\r\n  const day = String(date.getDate()).padStart(2, '0');\r\n  return `${year}-${month}-${day}`;\r\n}\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1338, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/27825/shalean-v2/shalean-reimagined/app/booking/book/components/BookingSummary.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { format } from 'date-fns';\r\nimport { Calendar, MapPin, Clock } from 'lucide-react';\r\nimport { BookingFormData, PriceBreakdown, PricingRule } from '@/types/booking';\r\nimport { AdditionalService } from '@/types/quote';\r\nimport { supportsRecurringBookings } from '@/lib/utils/service-validation';\r\nimport { calculateBookingDatesForMonth } from '@/lib/utils/recurring-dates';\r\n\r\ninterface BookingSummaryProps {\r\n  formData: BookingFormData;\r\n  priceBreakdown: PriceBreakdown;\r\n  serviceName?: string;\r\n  additionalServices?: AdditionalService[];\r\n  pricingRules?: PricingRule[];\r\n}\r\n\r\nexport function BookingSummary({ formData, priceBreakdown, serviceName, additionalServices = [], pricingRules = [] }: BookingSummaryProps) {\r\n  // Check if service is carpet cleaning\r\n  const isCarpetCleaning = serviceName?.toLowerCase().includes('carpet') ?? false;\r\n  \r\n  // Check if service supports recurring bookings (for frequency discount display)\r\n  // Only Standard Cleaning and Airbnb Cleaning support recurring bookings\r\n  const supportsRecurring = serviceName ? supportsRecurringBookings(serviceName) : false;\r\n  \r\n  // CRITICAL: Only show frequency discount if:\r\n  // 1. Service name is provided AND supports recurring bookings\r\n  // 2. Discount amount is greater than 0\r\n  // This ensures Deep Cleaning, Move In/Out, and Carpet Cleaning NEVER show discounts\r\n  const shouldShowFrequencyDiscount = Boolean(\r\n    serviceName && \r\n    supportsRecurring && \r\n    priceBreakdown.frequencyDiscountAmount > 0\r\n  );\r\n  \r\n  // Filter additional services to only show those relevant to the selected service type\r\n  const relevantAdditionalServices = formData.additionalServices.filter(serviceId => \r\n    additionalServices.some(s => s.id === serviceId)\r\n  );\r\n  \r\n  // Calculate final subtotal (after all discounts, before service fee)\r\n  const finalSubtotal = priceBreakdown.subtotal - priceBreakdown.frequencyDiscountAmount - priceBreakdown.discountAmount;\r\n\r\n  // Calculate recurring total for the first month\r\n  const isRecurring = formData.cleaningFrequency !== 'one-time';\r\n  const hasServiceDate = Boolean(formData.serviceDate);\r\n  const shouldCalculateRecurringTotal = isRecurring && hasServiceDate && supportsRecurring;\r\n\r\n  // Tip is one-time only (applied to first booking only, not recurring)\r\n  const tipAmount = formData.tipAmount || 0;\r\n\r\n  let numberOfBookingsInMonth = 1;\r\n  let recurringTotal = priceBreakdown.totalAmount + tipAmount; // Single booking: base + tip\r\n\r\n  if (shouldCalculateRecurringTotal) {\r\n    try {\r\n      const startDate = new Date(formData.serviceDate);\r\n      const bookingDates = calculateBookingDatesForMonth(startDate, formData.cleaningFrequency);\r\n      numberOfBookingsInMonth = bookingDates.length;\r\n      // For recurring: multiply base total by number of bookings, then add tip once\r\n      recurringTotal = (priceBreakdown.totalAmount * numberOfBookingsInMonth) + tipAmount;\r\n    } catch (error) {\r\n      // If date parsing fails, fall back to single booking\r\n      console.error('Error calculating recurring total:', error);\r\n      numberOfBookingsInMonth = 1;\r\n      recurringTotal = priceBreakdown.totalAmount + tipAmount;\r\n    }\r\n  }\r\n\r\n  // Get frequency label for display\r\n  const getFrequencyLabel = () => {\r\n    switch (formData.cleaningFrequency) {\r\n      case 'weekly':\r\n        return 'Weekly';\r\n      case 'bi-weekly':\r\n        return 'Bi-Weekly';\r\n      case 'monthly':\r\n        return 'Monthly';\r\n      default:\r\n        return '';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"bg-white rounded-2xl p-6 sticky top-24 space-y-4\">\r\n      <h3 className=\"text-lg font-semibold mb-4\">Booking Summary</h3>\r\n\r\n      {/* Service */}\r\n      <div className=\"flex justify-between text-sm\">\r\n        <span className=\"text-muted-foreground\">Service</span>\r\n        <span className=\"font-medium\">{serviceName || 'Not selected'}</span>\r\n      </div>\r\n\r\n      {/* Price Breakdown */}\r\n      <div className=\"space-y-2 pt-4 border-t border-border\">\r\n        <div className=\"text-sm font-semibold mb-2\">Price Breakdown</div>\r\n        <div className=\"flex justify-between text-sm\">\r\n          <span className=\"text-muted-foreground\">Base Price</span>\r\n          <span>R{priceBreakdown.basePrice.toFixed(2)}</span>\r\n        </div>\r\n        {/* Show bedrooms/bathrooms only for non-carpet services */}\r\n        {!isCarpetCleaning && (priceBreakdown.bedroomsPrice > 0 || priceBreakdown.bathroomsPrice > 0) && (\r\n          <div className=\"flex justify-between text-sm\">\r\n            <span className=\"text-muted-foreground\">Bedrooms & Bathrooms ({formData.bedrooms} bed, {formData.bathrooms} bath)</span>\r\n            <span>R{(priceBreakdown.bedroomsPrice + priceBreakdown.bathroomsPrice).toFixed(2)}</span>\r\n          </div>\r\n        )}\r\n        {/* Show carpet pricing only for carpet cleaning service */}\r\n        {isCarpetCleaning && priceBreakdown.fittedRoomsPrice > 0 && (\r\n          <div className=\"flex justify-between text-sm\">\r\n            <span className=\"text-muted-foreground\">\r\n              Fitted Rooms ({formData.numberOfFittedRooms || 0} room{parseInt(formData.numberOfFittedRooms || '0') !== 1 ? 's' : ''})\r\n            </span>\r\n            <span>R{priceBreakdown.fittedRoomsPrice.toFixed(2)}</span>\r\n          </div>\r\n        )}\r\n        {isCarpetCleaning && priceBreakdown.looseCarpetsPrice > 0 && (\r\n          <div className=\"flex justify-between text-sm\">\r\n            <span className=\"text-muted-foreground\">\r\n              Loose Carpets/Rugs ({formData.numberOfLooseCarpets || 0} carpet{parseInt(formData.numberOfLooseCarpets || '0') !== 1 ? 's' : ''})\r\n            </span>\r\n            <span>R{priceBreakdown.looseCarpetsPrice.toFixed(2)}</span>\r\n          </div>\r\n        )}\r\n        {/* Itemized Additional Services - Only show services relevant to selected service type */}\r\n        {relevantAdditionalServices.length > 0 ? (\r\n          <div className=\"space-y-1\">\r\n            {relevantAdditionalServices.map((serviceId) => {\r\n              const service = additionalServices.find(s => s.id === serviceId);\r\n              const priceRule = pricingRules.find(\r\n                r => r.rule_type === 'additional_service' && r.additional_service_id === serviceId\r\n              );\r\n              const price = priceRule?.price || 0;\r\n              return (\r\n                <div key={serviceId} className=\"flex justify-between text-sm\">\r\n                  <span className=\"text-muted-foreground\">{service?.name || 'Additional Service'}</span>\r\n                  <span>R{price.toFixed(2)}</span>\r\n                </div>\r\n              );\r\n            })}\r\n          </div>\r\n        ) : priceBreakdown.additionalServicesPrice > 0 ? (\r\n          // Fallback: Show total if price > 0 but services not found (shouldn't happen with proper filtering)\r\n          <div className=\"flex justify-between text-sm\">\r\n            <span className=\"text-muted-foreground\">Additional Services</span>\r\n            <span>R{priceBreakdown.additionalServicesPrice.toFixed(2)}</span>\r\n          </div>\r\n        ) : null}\r\n        {/* Equipment Supply Charge - Show when cleaningEquipment is 'yes' */}\r\n        {priceBreakdown.equipmentSupplyPrice > 0 && (\r\n          <div className=\"flex justify-between text-sm\">\r\n            <span className=\"text-muted-foreground\">Equipment & Supplies</span>\r\n            <span>R{priceBreakdown.equipmentSupplyPrice.toFixed(2)}</span>\r\n          </div>\r\n        )}\r\n        {/* Additional Cleaners Charge - Show when more than 1 cleaner is selected */}\r\n        {priceBreakdown.additionalCleanersPrice > 0 && (\r\n          <div className=\"flex justify-between text-sm\">\r\n            <span className=\"text-muted-foreground\">\r\n              Additional Cleaners ({formData.numberOfCleaners - 1} × R250)\r\n            </span>\r\n            <span>R{priceBreakdown.additionalCleanersPrice.toFixed(2)}</span>\r\n          </div>\r\n        )}\r\n        {/* Only show frequency discount for services that support recurring bookings (Standard and Airbnb) */}\r\n        {shouldShowFrequencyDiscount && (\r\n          <div className=\"flex justify-between text-sm text-green-600\">\r\n            <span>Frequency Discount ({priceBreakdown.frequencyDiscountPercent.toFixed(0)}%)</span>\r\n            <span>-R{priceBreakdown.frequencyDiscountAmount.toFixed(2)}</span>\r\n          </div>\r\n        )}\r\n        {priceBreakdown.discountAmount > 0 && (\r\n          <div className=\"flex justify-between text-sm text-green-600\">\r\n            <span>Discount Code{formData.discountCode ? ` (${formData.discountCode})` : ''}</span>\r\n            <span>-R{priceBreakdown.discountAmount.toFixed(2)}</span>\r\n          </div>\r\n        )}\r\n        <div className=\"flex justify-between text-sm font-semibold pt-2 border-t border-border\">\r\n          <span>Subtotal</span>\r\n          <span>R{Math.max(0, finalSubtotal).toFixed(2)}</span>\r\n        </div>\r\n        <div className=\"flex justify-between text-sm\">\r\n          <span className=\"text-muted-foreground\">Service Fee</span>\r\n          <span>R{priceBreakdown.serviceFee.toFixed(2)}</span>\r\n        </div>\r\n        {formData.tipAmount > 0 && (\r\n          <div className=\"flex justify-between text-sm\">\r\n            <span className=\"text-muted-foreground\">\r\n              Tip{isRecurring && shouldCalculateRecurringTotal ? ' (one-time, first booking only)' : ''}\r\n            </span>\r\n            <span>R{formData.tipAmount.toFixed(2)}</span>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Schedule */}\r\n      {formData.serviceDate && (\r\n        <div className=\"pt-4 border-t border-border\">\r\n          <div className=\"flex items-center gap-2 mb-2\">\r\n            <Calendar className=\"w-4 h-4 text-muted-foreground\" />\r\n            <span className=\"text-sm font-semibold\">Schedule</span>\r\n          </div>\r\n          <div className=\"text-sm space-y-1\">\r\n            <div>\r\n              {format(new Date(formData.serviceDate), 'MMMM do, yyyy')} @ {formData.serviceTime}\r\n            </div>\r\n            {formData.serviceDuration && (\r\n              <div className=\"flex items-center gap-1.5 text-muted-foreground\">\r\n                <Clock className=\"w-3.5 h-3.5\" />\r\n                <span>\r\n                  {formData.serviceDuration % 1 === 0 \r\n                    ? `${formData.serviceDuration} hours` \r\n                    : `${formData.serviceDuration.toFixed(1)} hours`}\r\n                </span>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Address */}\r\n      {formData.serviceAddress && (\r\n        <div className=\"pt-4 border-t border-border\">\r\n          <div className=\"flex items-center gap-2 mb-2\">\r\n            <MapPin className=\"w-4 h-4 text-muted-foreground\" />\r\n            <span className=\"text-sm font-semibold\">Address</span>\r\n          </div>\r\n          <div className=\"text-sm\">\r\n            {formData.serviceCity}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Total */}\r\n      <div className=\"pt-4 border-t border-border\">\r\n        <div className=\"flex justify-between items-center\">\r\n          <div>\r\n            <span className=\"text-sm font-semibold block\">\r\n              {shouldCalculateRecurringTotal \r\n                ? `Total (${numberOfBookingsInMonth} ${numberOfBookingsInMonth === 1 ? 'booking' : 'bookings'} this month)`\r\n                : 'Total'}\r\n            </span>\r\n            <span className=\"text-xs text-muted-foreground\">\r\n              {shouldCalculateRecurringTotal \r\n                ? `${getFrequencyLabel()} recurring - All fees included`\r\n                : isRecurring && !hasServiceDate\r\n                ? 'Select a date to see monthly total'\r\n                : 'All fees included'}\r\n            </span>\r\n          </div>\r\n          <div className=\"text-2xl font-bold text-primary\">\r\n            R{shouldCalculateRecurringTotal ? recurringTotal.toFixed(2) : (priceBreakdown.totalAmount + tipAmount).toFixed(2)}\r\n          </div>\r\n        </div>\r\n        {shouldCalculateRecurringTotal && numberOfBookingsInMonth > 1 && (\r\n          <div className=\"mt-2 text-xs text-muted-foreground text-right\">\r\n            (R{priceBreakdown.totalAmount.toFixed(2)} × {numberOfBookingsInMonth}) {tipAmount > 0 ? `+ R${tipAmount.toFixed(2)} tip` : ''} = R{recurringTotal.toFixed(2)}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2054, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/27825/shalean-v2/shalean-reimagined/src/components/Footer.tsx"],"sourcesContent":["import { Phone, Mail, MapPin, Facebook, Twitter, Instagram, Linkedin } from \"lucide-react\";\r\nimport Image from \"next/image\";\r\n\r\nconst Footer = () => {\r\n  return (\r\n    <footer className=\"bg-foreground text-primary-foreground\">\r\n      <div className=\"container mx-auto px-4 md:px-6 py-16\">\r\n        <div className=\"grid md:grid-cols-2 lg:grid-cols-4 gap-12\">\r\n          {/* Company Info */}\r\n          <div>\r\n            <div className=\"flex items-center gap-2 mb-6\">\r\n              <div className=\"w-10 h-10 flex items-center justify-center\">\r\n                <Image\r\n                  src=\"/logo.png\"\r\n                  alt=\"Shalean Logo\"\r\n                  width={40}\r\n                  height={40}\r\n                  className=\"object-contain\"\r\n                />\r\n              </div>\r\n              <span className=\"font-bold text-xl\">Shalean</span>\r\n            </div>\r\n            <p className=\"text-primary-foreground/70 mb-6\">\r\n              Professional cleaning services across South Africa. Your trusted partner for spotless spaces.\r\n            </p>\r\n            <div className=\"flex gap-4\">\r\n              <a href=\"https://www.facebook.com/shaleancleaning\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"w-10 h-10 rounded-full bg-primary-foreground/10 flex items-center justify-center hover:bg-primary transition-colors\">\r\n                <Facebook className=\"w-5 h-5\" />\r\n              </a>\r\n              <a href=\"https://x.com/shaloclean\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"w-10 h-10 rounded-full bg-primary-foreground/10 flex items-center justify-center hover:bg-primary transition-colors\">\r\n                <Twitter className=\"w-5 h-5\" />\r\n              </a>\r\n              <a href=\"https://www.instagram.com/shalean_cleaning_services/\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"w-10 h-10 rounded-full bg-primary-foreground/10 flex items-center justify-center hover:bg-primary transition-colors\">\r\n                <Instagram className=\"w-5 h-5\" />\r\n              </a>\r\n              <a href=\"https://www.linkedin.com/in/shalean-cleaning-services-5599a4256/\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"w-10 h-10 rounded-full bg-primary-foreground/10 flex items-center justify-center hover:bg-primary transition-colors\">\r\n                <Linkedin className=\"w-5 h-5\" />\r\n              </a>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Quick Links */}\r\n          <div>\r\n            <h3 className=\"font-bold text-lg mb-6\">Quick Links</h3>\r\n            <ul className=\"space-y-3\">\r\n              {[\"Home\", \"About Us\", \"Services\", \"Pricing\", \"Blog\", \"Contact\"].map((link) => (\r\n                <li key={link}>\r\n                  <a href=\"#\" className=\"text-primary-foreground/70 hover:text-primary transition-colors\">\r\n                    {link}\r\n                  </a>\r\n                </li>\r\n              ))}\r\n            </ul>\r\n          </div>\r\n\r\n          {/* Services */}\r\n          <div>\r\n            <h3 className=\"font-bold text-lg mb-6\">Services</h3>\r\n            <ul className=\"space-y-3\">\r\n              {[\r\n                \"Residential Cleaning\",\r\n                \"Commercial Cleaning\",\r\n                \"Deep Cleaning\",\r\n                \"Move In/Out Cleaning\",\r\n                \"Industrial Cleaning\",\r\n                \"Office Cleaning\",\r\n              ].map((service) => (\r\n                <li key={service}>\r\n                  <a href=\"#\" className=\"text-primary-foreground/70 hover:text-primary transition-colors\">\r\n                    {service}\r\n                  </a>\r\n                </li>\r\n              ))}\r\n            </ul>\r\n          </div>\r\n\r\n          {/* Contact */}\r\n          <div>\r\n            <h3 className=\"font-bold text-lg mb-6\">Contact</h3>\r\n            <ul className=\"space-y-4\">\r\n              <li className=\"flex items-start gap-3\">\r\n                <MapPin className=\"w-5 h-5 text-primary mt-0.5\" />\r\n                <span className=\"text-primary-foreground/70\">\r\n                  39 Harvey Rd, Claremont, Cape Town, 7780, South Africa\r\n                </span>\r\n              </li>\r\n              <li className=\"flex items-center gap-3\">\r\n                <Phone className=\"w-5 h-5 text-primary\" />\r\n                <a href=\"tel:+27871535250\" className=\"text-primary-foreground/70 hover:text-primary transition-colors\">\r\n                  (+27) 87 153 5250\r\n                </a>\r\n              </li>\r\n              <li className=\"flex items-center gap-3\">\r\n                <Mail className=\"w-5 h-5 text-primary\" />\r\n                <a href=\"mailto:info@shalean.co.za\" className=\"text-primary-foreground/70 hover:text-primary transition-colors\">\r\n                  info@shalean.co.za\r\n                </a>\r\n              </li>\r\n            </ul>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Bottom Bar */}\r\n        <div className=\"border-t border-primary-foreground/10 mt-12 pt-8 flex flex-col md:flex-row justify-between items-center gap-4\">\r\n          <p className=\"text-primary-foreground/50 text-sm\">\r\n            © 2026 Shalean Cleaning Services. All rights reserved.\r\n          </p>\r\n          <div className=\"flex gap-6\">\r\n            <a href=\"#\" className=\"text-primary-foreground/50 hover:text-primary text-sm transition-colors\">\r\n              Privacy Policy\r\n            </a>\r\n            <a href=\"#\" className=\"text-primary-foreground/50 hover:text-primary text-sm transition-colors\">\r\n              Terms of Service\r\n            </a>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </footer>\r\n  );\r\n};\r\n\r\nexport default Footer;\r\n"],"names":[],"mappings":";;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;AAEA,MAAM,SAAS;IACb,qBACE,6LAAC;QAAO,WAAU;kBAChB,cAAA,6LAAC;YAAI,WAAU;;8BACb,6LAAC;oBAAI,WAAU;;sCAEb,6LAAC;;8CACC,6LAAC;oCAAI,WAAU;;sDACb,6LAAC;4CAAI,WAAU;sDACb,cAAA,6LAAC,2IAAK;gDACJ,KAAI;gDACJ,KAAI;gDACJ,OAAO;gDACP,QAAQ;gDACR,WAAU;;;;;;;;;;;sDAGd,6LAAC;4CAAK,WAAU;sDAAoB;;;;;;;;;;;;8CAEtC,6LAAC;oCAAE,WAAU;8CAAkC;;;;;;8CAG/C,6LAAC;oCAAI,WAAU;;sDACb,6LAAC;4CAAE,MAAK;4CAA2C,QAAO;4CAAS,KAAI;4CAAsB,WAAU;sDACrG,cAAA,6LAAC,yNAAQ;gDAAC,WAAU;;;;;;;;;;;sDAEtB,6LAAC;4CAAE,MAAK;4CAA2B,QAAO;4CAAS,KAAI;4CAAsB,WAAU;sDACrF,cAAA,6LAAC,sNAAO;gDAAC,WAAU;;;;;;;;;;;sDAErB,6LAAC;4CAAE,MAAK;4CAAuD,QAAO;4CAAS,KAAI;4CAAsB,WAAU;sDACjH,cAAA,6LAAC,4NAAS;gDAAC,WAAU;;;;;;;;;;;sDAEvB,6LAAC;4CAAE,MAAK;4CAAmE,QAAO;4CAAS,KAAI;4CAAsB,WAAU;sDAC7H,cAAA,6LAAC,yNAAQ;gDAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;;sCAM1B,6LAAC;;8CACC,6LAAC;oCAAG,WAAU;8CAAyB;;;;;;8CACvC,6LAAC;oCAAG,WAAU;8CACX;wCAAC;wCAAQ;wCAAY;wCAAY;wCAAW;wCAAQ;qCAAU,CAAC,GAAG,CAAC,CAAC,qBACnE,6LAAC;sDACC,cAAA,6LAAC;gDAAE,MAAK;gDAAI,WAAU;0DACnB;;;;;;2CAFI;;;;;;;;;;;;;;;;sCAUf,6LAAC;;8CACC,6LAAC;oCAAG,WAAU;8CAAyB;;;;;;8CACvC,6LAAC;oCAAG,WAAU;8CACX;wCACC;wCACA;wCACA;wCACA;wCACA;wCACA;qCACD,CAAC,GAAG,CAAC,CAAC,wBACL,6LAAC;sDACC,cAAA,6LAAC;gDAAE,MAAK;gDAAI,WAAU;0DACnB;;;;;;2CAFI;;;;;;;;;;;;;;;;sCAUf,6LAAC;;8CACC,6LAAC;oCAAG,WAAU;8CAAyB;;;;;;8CACvC,6LAAC;oCAAG,WAAU;;sDACZ,6LAAC;4CAAG,WAAU;;8DACZ,6LAAC,uNAAM;oDAAC,WAAU;;;;;;8DAClB,6LAAC;oDAAK,WAAU;8DAA6B;;;;;;;;;;;;sDAI/C,6LAAC;4CAAG,WAAU;;8DACZ,6LAAC,gNAAK;oDAAC,WAAU;;;;;;8DACjB,6LAAC;oDAAE,MAAK;oDAAmB,WAAU;8DAAkE;;;;;;;;;;;;sDAIzG,6LAAC;4CAAG,WAAU;;8DACZ,6LAAC,6MAAI;oDAAC,WAAU;;;;;;8DAChB,6LAAC;oDAAE,MAAK;oDAA4B,WAAU;8DAAkE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;8BASxH,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BAAE,WAAU;sCAAqC;;;;;;sCAGlD,6LAAC;4BAAI,WAAU;;8CACb,6LAAC;oCAAE,MAAK;oCAAI,WAAU;8CAA0E;;;;;;8CAGhG,6LAAC;oCAAE,MAAK;oCAAI,WAAU;8CAA0E;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQ5G;KApHM;uCAsHS"}},
    {"offset": {"line": 2469, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/27825/shalean-v2/shalean-reimagined/app/booking/layout.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { usePathname, useParams } from 'next/navigation';\r\nimport Image from 'next/image';\r\nimport { ProgressIndicator } from './book/components/ProgressIndicator';\r\nimport { BookingFormProvider, useBookingFormContext } from './book/context/BookingFormContext';\r\nimport { useQuery } from '@tanstack/react-query';\r\nimport { useMemo, useState, useEffect, useRef } from 'react';\r\nimport { getServices, getAdditionalServices } from './quote/actions';\r\nimport { getPricingRulesClient } from './book/actions-client';\r\nimport { calculatePriceBreakdownClient } from '@/lib/pricing/calculator-client';\r\nimport { BookingSummary } from './book/components/BookingSummary';\r\nimport { PriceBreakdown } from '@/types/booking';\r\nimport Footer from '@/components/Footer';\r\nimport { findServiceBySlug } from '@/lib/utils/slug';\r\n\r\n// Get step from pathname (supports both with and without slug)\r\nconst getStepFromPath = (pathname: string): number => {\r\n  if (pathname.startsWith('/booking/details')) return 1;\r\n  if (pathname.startsWith('/booking/worker')) return 2;\r\n  if (pathname.startsWith('/booking/submit')) return 3;\r\n  return 1;\r\n};\r\n\r\nfunction BookingLayoutContent({\r\n  children,\r\n}: {\r\n  children: React.ReactNode;\r\n}) {\r\n  const pathname = usePathname();\r\n  const params = useParams();\r\n  const currentStep = getStepFromPath(pathname);\r\n  const serviceSlug = params.serviceSlug as string | undefined;\r\n  \r\n  const {\r\n    formData,\r\n    updateFormData,\r\n    isStepCompleted,\r\n    getDiscountAmount,\r\n    clearDiscountAmount,\r\n    setServicesForSlug,\r\n  } = useBookingFormContext();\r\n\r\n  // Get discount amount from localStorage (reactive)\r\n  // Initialize to 0 to match server render and prevent hydration mismatch\r\n  const [discountAmount, setDiscountAmount] = useState<number>(0);\r\n  const hasClearedDiscountRef = useRef(false);\r\n  \r\n  // Store functions in refs to ensure stable references\r\n  const updateFormDataRef = useRef(updateFormData);\r\n  const clearDiscountAmountRef = useRef(clearDiscountAmount);\r\n  \r\n  // Always update refs to latest functions (they should be stable due to useCallback)\r\n  updateFormDataRef.current = updateFormData;\r\n  clearDiscountAmountRef.current = clearDiscountAmount;\r\n\r\n  // Clear discount code and amount on page refresh/initial load\r\n  // This only runs once on mount (page refresh), not during client-side navigation\r\n  useEffect(() => {\r\n    if (!hasClearedDiscountRef.current) {\r\n      // Clear discount code from formData\r\n      updateFormDataRef.current({ discountCode: '' });\r\n      // Clear discount amount from localStorage\r\n      clearDiscountAmountRef.current();\r\n      setDiscountAmount(0);\r\n      hasClearedDiscountRef.current = true;\r\n    }\r\n  }, []); // Empty array - refs ensure we always have access to latest functions\r\n\r\n  // Sync discount amount from localStorage after mount to prevent hydration mismatch\r\n  useEffect(() => {\r\n    const updateDiscount = () => {\r\n      setDiscountAmount(getDiscountAmount());\r\n    };\r\n    // Listen for custom event when discount is updated\r\n    window.addEventListener('discountUpdated', updateDiscount);\r\n    // Initial load - read from localStorage after mount\r\n    updateDiscount();\r\n    return () => {\r\n      window.removeEventListener('discountUpdated', updateDiscount);\r\n    };\r\n  }, [getDiscountAmount]);\r\n\r\n  // Track previous serviceId to detect changes\r\n  const previousServiceIdRef = useRef<string | undefined>(formData.serviceId);\r\n\r\n  // Reset service-specific fields when service changes\r\n  useEffect(() => {\r\n    const previousServiceId = previousServiceIdRef.current;\r\n    const currentServiceId = formData.serviceId;\r\n\r\n    // Only reset if service actually changed (not on initial load)\r\n    if (previousServiceId && previousServiceId !== currentServiceId) {\r\n      updateFormData({\r\n        additionalServices: [],\r\n        bedrooms: '0',\r\n        bathrooms: '1',\r\n        carpetTypes: [],\r\n        roomStatus: '',\r\n        numberOfFittedRooms: '',\r\n        numberOfLooseCarpets: '',\r\n        cleaningEquipment: '',\r\n        serviceDate: '',\r\n        serviceTime: '',\r\n        serviceDuration: 3.5,\r\n        discountCode: '',\r\n      });\r\n    }\r\n\r\n    // Update the ref for next comparison\r\n    previousServiceIdRef.current = currentServiceId;\r\n  }, [formData.serviceId, updateFormData]);\r\n\r\n  // Fetch services for service name\r\n  const { data: services = [] } = useQuery({\r\n    queryKey: ['services'],\r\n    queryFn: getServices,\r\n    staleTime: 5 * 60 * 1000,\r\n  });\r\n\r\n  // Set services in hook for slug generation\r\n  useEffect(() => {\r\n    if (services.length > 0) {\r\n      setServicesForSlug(services);\r\n    }\r\n  }, [services, setServicesForSlug]);\r\n\r\n  // Validate and set service from slug if present\r\n  useEffect(() => {\r\n    if (serviceSlug && services.length > 0) {\r\n      const service = findServiceBySlug(services, serviceSlug);\r\n      if (service && (!formData.serviceId || formData.serviceId !== service.id)) {\r\n        updateFormData({ serviceId: service.id });\r\n      }\r\n    }\r\n  }, [serviceSlug, services, formData.serviceId, updateFormData]);\r\n\r\n  // Fetch and cache pricing rules (only fetched once)\r\n  const { data: pricingRules = [] } = useQuery({\r\n    queryKey: ['pricing-rules'],\r\n    queryFn: getPricingRulesClient,\r\n    staleTime: 10 * 60 * 1000, // Cache for 10 minutes\r\n  });\r\n\r\n  // Fetch additional services based on selected service\r\n  const { data: additionalServices = [] } = useQuery({\r\n    queryKey: ['additional-services', formData.serviceId],\r\n    queryFn: () => getAdditionalServices(formData.serviceId || undefined),\r\n    enabled: true,\r\n    staleTime: 5 * 60 * 1000,\r\n  });\r\n\r\n  const selectedService = services.find((s) => s.id === formData.serviceId);\r\n\r\n  // Check if selected service is carpet cleaning\r\n  const isCarpetCleaning = selectedService?.name.toLowerCase().includes('carpet') ?? false;\r\n\r\n  // Calculate price breakdown instantly using cached pricing rules\r\n  // This is memoized and recalculates automatically when dependencies change\r\n  // Updates in real-time when cleaningFrequency changes (weekly, bi-weekly, monthly, one-time)\r\n  // IMPORTANT: All formData properties that affect pricing are in the dependency array below to ensure real-time updates\r\n  const priceBreakdown = useMemo<PriceBreakdown>(() => {\r\n    // For carpet cleaning, we don't need bedrooms/bathrooms\r\n    // For other services, we need bedrooms/bathrooms\r\n    const hasRequiredData = isCarpetCleaning\r\n      ? formData.serviceId && pricingRules.length > 0\r\n      : formData.serviceId && formData.bedrooms && formData.bathrooms && pricingRules.length > 0;\r\n\r\n    if (!hasRequiredData) {\r\n      return {\r\n        basePrice: 0,\r\n        bedroomsPrice: 0,\r\n        bathroomsPrice: 0,\r\n        fittedRoomsPrice: 0,\r\n        looseCarpetsPrice: 0,\r\n        additionalServicesPrice: 0,\r\n        equipmentSupplyPrice: 0,\r\n        additionalCleanersPrice: 0,\r\n        subtotal: 0,\r\n        frequencyDiscountPercent: 0,\r\n        frequencyDiscountAmount: 0,\r\n        discountAmount,\r\n        serviceFee: 0,\r\n        totalAmount: 0,\r\n      };\r\n    }\r\n\r\n    // Filter additional services to only include those relevant to the selected service type\r\n    // This ensures the price calculation matches what's displayed in the summary\r\n    const relevantAdditionalServiceIds = formData.additionalServices.filter(serviceId =>\r\n      additionalServices.some(s => s.id === serviceId)\r\n    );\r\n\r\n    return calculatePriceBreakdownClient(\r\n      pricingRules,\r\n      formData.serviceId,\r\n      formData.bedrooms || '0',\r\n      formData.bathrooms || '1',\r\n      relevantAdditionalServiceIds,\r\n      formData.cleaningFrequency,\r\n      discountAmount,\r\n      formData.numberOfFittedRooms || '',\r\n      formData.numberOfLooseCarpets || '',\r\n      isCarpetCleaning,\r\n      selectedService?.name,\r\n      formData.cleaningEquipment,\r\n      formData.numberOfCleaners || 1\r\n    );\r\n  }, [\r\n    pricingRules,\r\n    formData.serviceId,\r\n    formData.bedrooms,\r\n    formData.bathrooms,\r\n    // Use JSON.stringify for array dependency to ensure proper change detection\r\n    // This ensures real-time updates when additionalServices array contents change\r\n    JSON.stringify(formData.additionalServices),\r\n    formData.cleaningFrequency, // This triggers real-time recalculation when frequency changes\r\n    formData.numberOfFittedRooms,\r\n    formData.numberOfLooseCarpets,\r\n    formData.cleaningEquipment, // Track equipment selection for price updates\r\n    formData.numberOfCleaners, // Track number of cleaners for price updates\r\n    discountAmount,\r\n    isCarpetCleaning,\r\n    // additionalServices from query - React Query manages cache stability\r\n    // We track it to detect when available services change for the selected service\r\n    additionalServices,\r\n    selectedService?.name,\r\n  ]);\r\n\r\n  // Check if we're on the confirmation page\r\n  const isConfirmationPage = pathname.startsWith('/booking/confirmation');\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-muted/30\">\r\n      {/* Header - Hidden on confirmation page */}\r\n      {!isConfirmationPage && (\r\n        <div className=\"sticky top-0 z-50 bg-white border-b border-border mb-8\">\r\n          <div className=\"container mx-auto px-4 md:px-6 py-4 max-w-7xl\">\r\n            <div className=\"relative flex items-center justify-center\">\r\n              <div className=\"flex items-center gap-2 absolute left-0\">\r\n                <div className=\"w-8 h-8 md:w-10 md:h-10 flex items-center justify-center\">\r\n                  <Image\r\n                    src=\"/logo.png\"\r\n                    alt=\"Shalean Logo\"\r\n                    width={40}\r\n                    height={40}\r\n                    className=\"object-contain\"\r\n                    priority\r\n                  />\r\n                </div>\r\n                <span className=\"hidden md:inline font-bold text-xl text-foreground\">Shalean</span>\r\n              </div>\r\n              <ProgressIndicator \r\n                currentStep={currentStep}\r\n                serviceSlug={serviceSlug || null}\r\n                isStepCompleted={isStepCompleted}\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <main className=\"container mx-auto px-4 md:px-6 py-8 max-w-7xl\">\r\n        {isConfirmationPage ? (\r\n          // On confirmation page, render children directly without grid layout\r\n          children\r\n        ) : (\r\n          // On other booking pages, use grid layout with sidebar\r\n          <div className=\"grid lg:grid-cols-3 gap-8\">\r\n            {/* Main Form */}\r\n            <div className=\"lg:col-span-2 space-y-8\">\r\n              {children}\r\n            </div>\r\n\r\n            {/* Sidebar Summary */}\r\n            <div className=\"hidden lg:block lg:col-span-1\">\r\n              <BookingSummary\r\n                formData={formData}\r\n                priceBreakdown={priceBreakdown}\r\n                serviceName={selectedService?.name}\r\n                additionalServices={additionalServices}\r\n                pricingRules={pricingRules}\r\n              />\r\n            </div>\r\n          </div>\r\n        )}\r\n      </main>\r\n\r\n      {/* Footer - Hidden on confirmation page */}\r\n      {!isConfirmationPage && <Footer />}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function BookingLayout({\r\n  children,\r\n}: {\r\n  children: React.ReactNode;\r\n}) {\r\n  return (\r\n    <BookingFormProvider>\r\n      <BookingLayoutContent>{children}</BookingLayoutContent>\r\n    </BookingFormProvider>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":"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"}}]
}