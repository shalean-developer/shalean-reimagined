module.exports = [
"[project]/src/components/ui/card.tsx [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "Card",
    ()=>Card,
    "CardContent",
    ()=>CardContent,
    "CardDescription",
    ()=>CardDescription,
    "CardFooter",
    ()=>CardFooter,
    "CardHeader",
    ()=>CardHeader,
    "CardTitle",
    ()=>CardTitle
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/ssr/react-jsx-dev-runtime.js [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/ssr/react.js [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/utils.ts [app-ssr] (ecmascript)");
;
;
;
const Card = /*#__PURE__*/ __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["forwardRef"](({ className, ...props }, ref)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        ref: ref,
        className: (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["cn"])("rounded-lg border bg-card text-card-foreground shadow-sm", className),
        ...props
    }, void 0, false, {
        fileName: "[project]/src/components/ui/card.tsx",
        lineNumber: 6,
        columnNumber: 3
    }, ("TURBOPACK compile-time value", void 0)));
Card.displayName = "Card";
const CardHeader = /*#__PURE__*/ __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["forwardRef"](({ className, ...props }, ref)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        ref: ref,
        className: (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["cn"])("flex flex-col space-y-1.5 p-6", className),
        ...props
    }, void 0, false, {
        fileName: "[project]/src/components/ui/card.tsx",
        lineNumber: 12,
        columnNumber: 5
    }, ("TURBOPACK compile-time value", void 0)));
CardHeader.displayName = "CardHeader";
const CardTitle = /*#__PURE__*/ __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["forwardRef"](({ className, ...props }, ref)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("h3", {
        ref: ref,
        className: (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["cn"])("text-2xl font-semibold leading-none tracking-tight", className),
        ...props
    }, void 0, false, {
        fileName: "[project]/src/components/ui/card.tsx",
        lineNumber: 19,
        columnNumber: 5
    }, ("TURBOPACK compile-time value", void 0)));
CardTitle.displayName = "CardTitle";
const CardDescription = /*#__PURE__*/ __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["forwardRef"](({ className, ...props }, ref)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
        ref: ref,
        className: (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["cn"])("text-sm text-muted-foreground", className),
        ...props
    }, void 0, false, {
        fileName: "[project]/src/components/ui/card.tsx",
        lineNumber: 26,
        columnNumber: 5
    }, ("TURBOPACK compile-time value", void 0)));
CardDescription.displayName = "CardDescription";
const CardContent = /*#__PURE__*/ __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["forwardRef"](({ className, ...props }, ref)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        ref: ref,
        className: (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["cn"])("p-6 pt-0", className),
        ...props
    }, void 0, false, {
        fileName: "[project]/src/components/ui/card.tsx",
        lineNumber: 32,
        columnNumber: 37
    }, ("TURBOPACK compile-time value", void 0)));
CardContent.displayName = "CardContent";
const CardFooter = /*#__PURE__*/ __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["forwardRef"](({ className, ...props }, ref)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        ref: ref,
        className: (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["cn"])("flex items-center p-6 pt-0", className),
        ...props
    }, void 0, false, {
        fileName: "[project]/src/components/ui/card.tsx",
        lineNumber: 38,
        columnNumber: 5
    }, ("TURBOPACK compile-time value", void 0)));
CardFooter.displayName = "CardFooter";
;
}),
"[project]/src/components/ui/label.tsx [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "Label",
    ()=>Label
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/ssr/react-jsx-dev-runtime.js [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/ssr/react.js [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$radix$2d$ui$2f$react$2d$label$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@radix-ui/react-label/dist/index.mjs [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$class$2d$variance$2d$authority$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/class-variance-authority/dist/index.mjs [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/utils.ts [app-ssr] (ecmascript)");
;
;
;
;
;
const labelVariants = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$class$2d$variance$2d$authority$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["cva"])("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70");
const Label = /*#__PURE__*/ __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["forwardRef"](({ className, ...props }, ref)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$radix$2d$ui$2f$react$2d$label$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Root"], {
        ref: ref,
        className: (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["cn"])(labelVariants(), className),
        ...props
    }, void 0, false, {
        fileName: "[project]/src/components/ui/label.tsx",
        lineNumber: 13,
        columnNumber: 3
    }, ("TURBOPACK compile-time value", void 0)));
Label.displayName = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$radix$2d$ui$2f$react$2d$label$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Root"].displayName;
;
}),
"[project]/app/dashboard/data:079001 [app-ssr] (ecmascript) <text/javascript>", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "getCustomerProfile",
    ()=>$$RSC_SERVER_ACTION_4
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-ssr] (ecmascript)");
/* __next_internal_action_entry_do_not_use__ [{"60d1908fde86ac220eb7a80a2be1b3941c55a8b34b":"getCustomerProfile"},"app/dashboard/actions.ts",""] */ "use turbopack no side effects";
;
const $$RSC_SERVER_ACTION_4 = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["createServerReference"])("60d1908fde86ac220eb7a80a2be1b3941c55a8b34b", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["findSourceMapURL"], "getCustomerProfile");
;
 //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vYWN0aW9ucy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHNlcnZlcic7XHJcblxyXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAL2xpYi9zdXBhYmFzZS9zZXJ2ZXInO1xyXG5pbXBvcnQgeyBjcmVhdGVBZG1pbkNsaWVudCB9IGZyb20gJ0AvbGliL3N1cGFiYXNlL3NlcnZlci1hZG1pbic7XHJcbmltcG9ydCB7IEJvb2tpbmcgfSBmcm9tICdAL3R5cGVzL2Jvb2tpbmcnO1xyXG5pbXBvcnQgeyBQcm9maWxlLCBQcm9maWxlVXBkYXRlSW5wdXQgfSBmcm9tICdAL3R5cGVzL3Byb2ZpbGUnO1xyXG5pbXBvcnQgeyBMb2NhdGlvbiwgTG9jYXRpb25DcmVhdGVJbnB1dCwgTG9jYXRpb25VcGRhdGVJbnB1dCB9IGZyb20gJ0AvdHlwZXMvbG9jYXRpb24nO1xyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEF1dGhlbnRpY2F0ZWRVc2VyKCk6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgZW1haWw/OiBzdHJpbmc7XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuICAgIGNvbnN0IHsgZGF0YTogeyB1c2VyIH0sIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcclxuXHJcbiAgICBpZiAoZXJyb3IgfHwgIXVzZXIpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTm90IGF1dGhlbnRpY2F0ZWQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgZW1haWw6IHVzZXIuZW1haWwgfHwgdW5kZWZpbmVkIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGdldEF1dGhlbnRpY2F0ZWRVc2VyOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGdldCB1c2VyJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q3VzdG9tZXJCb29raW5ncyhcclxuICBlbWFpbDogc3RyaW5nLFxyXG4gIHBob25lPzogc3RyaW5nLFxyXG4gIGZpbHRlcj86ICdhbGwnIHwgJ3VwY29taW5nJyB8ICdjb21wbGV0ZWQnIHwgJ2NhbmNlbGxlZCdcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBib29raW5ncz86IEJvb2tpbmdbXTtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIGxldCBxdWVyeSA9IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdib29raW5ncycpXHJcbiAgICAgIC5zZWxlY3QoJyonKVxyXG4gICAgICAub3JkZXIoJ3NlcnZpY2VfZGF0ZScsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KVxyXG4gICAgICAub3JkZXIoJ2NyZWF0ZWRfYXQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSk7XHJcblxyXG4gICAgLy8gQnVpbGQgcXVlcnkgZm9yIGVtYWlsL3Bob25lIGxvb2t1cFxyXG4gICAgaWYgKGVtYWlsICYmIHBob25lKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkub3IoYGN1c3RvbWVyX2VtYWlsLmVxLiR7ZW1haWx9LGN1c3RvbWVyX3Bob25lLmVxLiR7cGhvbmV9YCk7XHJcbiAgICB9IGVsc2UgaWYgKGVtYWlsKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ2N1c3RvbWVyX2VtYWlsJywgZW1haWwpO1xyXG4gICAgfSBlbHNlIGlmIChwaG9uZSkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdjdXN0b21lcl9waG9uZScsIHBob25lKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0VtYWlsIG9yIHBob25lIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEFwcGx5IHN0YXR1cyBmaWx0ZXJcclxuICAgIGlmIChmaWx0ZXIgJiYgZmlsdGVyICE9PSAnYWxsJykge1xyXG4gICAgICBpZiAoZmlsdGVyID09PSAndXBjb21pbmcnKSB7XHJcbiAgICAgICAgcXVlcnkgPSBxdWVyeS5pbignc3RhdHVzJywgWydwZW5kaW5nJywgJ2NvbmZpcm1lZCddKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdzdGF0dXMnLCBmaWx0ZXIpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgcXVlcnk7XHJcblxyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGJvb2tpbmdzOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYm9va2luZ3M6IGRhdGEgfHwgW10gfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gZ2V0Q3VzdG9tZXJCb29raW5nczonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBmZXRjaCBib29raW5ncycsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEN1c3RvbWVyQm9va2luZ1N0YXRzKFxyXG4gIGVtYWlsOiBzdHJpbmcsXHJcbiAgcGhvbmU/OiBzdHJpbmdcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBzdGF0cz86IHtcclxuICAgIHRvdGFsOiBudW1iZXI7XHJcbiAgICB1cGNvbWluZzogbnVtYmVyO1xyXG4gICAgY29tcGxldGVkOiBudW1iZXI7XHJcbiAgICBjYW5jZWxsZWQ6IG51bWJlcjtcclxuICAgIHRvdGFsU3BlbnQ6IG51bWJlcjtcclxuICB9O1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgbGV0IHF1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2Jvb2tpbmdzJylcclxuICAgICAgLnNlbGVjdCgnc3RhdHVzLCB0b3RhbF9hbW91bnQsIHBheW1lbnRfc3RhdHVzJyk7XHJcblxyXG4gICAgLy8gQnVpbGQgcXVlcnkgZm9yIGVtYWlsL3Bob25lIGxvb2t1cFxyXG4gICAgaWYgKGVtYWlsICYmIHBob25lKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkub3IoYGN1c3RvbWVyX2VtYWlsLmVxLiR7ZW1haWx9LGN1c3RvbWVyX3Bob25lLmVxLiR7cGhvbmV9YCk7XHJcbiAgICB9IGVsc2UgaWYgKGVtYWlsKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ2N1c3RvbWVyX2VtYWlsJywgZW1haWwpO1xyXG4gICAgfSBlbHNlIGlmIChwaG9uZSkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdjdXN0b21lcl9waG9uZScsIHBob25lKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0VtYWlsIG9yIHBob25lIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHF1ZXJ5O1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBzdGF0cyA9IHtcclxuICAgICAgdG90YWw6IGRhdGE/Lmxlbmd0aCB8fCAwLFxyXG4gICAgICB1cGNvbWluZzogZGF0YT8uZmlsdGVyKChiKSA9PiBiLnN0YXR1cyA9PT0gJ3BlbmRpbmcnIHx8IGIuc3RhdHVzID09PSAnY29uZmlybWVkJykubGVuZ3RoIHx8IDAsXHJcbiAgICAgIGNvbXBsZXRlZDogZGF0YT8uZmlsdGVyKChiKSA9PiBiLnN0YXR1cyA9PT0gJ2NvbXBsZXRlZCcpLmxlbmd0aCB8fCAwLFxyXG4gICAgICBjYW5jZWxsZWQ6IGRhdGE/LmZpbHRlcigoYikgPT4gYi5zdGF0dXMgPT09ICdjYW5jZWxsZWQnKS5sZW5ndGggfHwgMCxcclxuICAgICAgdG90YWxTcGVudDogZGF0YVxyXG4gICAgICAgID8uZmlsdGVyKChiKSA9PiBiLnBheW1lbnRfc3RhdHVzID09PSAncGFpZCcpXHJcbiAgICAgICAgLnJlZHVjZSgoc3VtLCBiKSA9PiBzdW0gKyAoYi50b3RhbF9hbW91bnQgfHwgMCksIDApIHx8IDAsXHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHN0YXRzIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGZldGNoIHN0YXRzJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Qm9va2luZ0J5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgYm9va2luZz86IEJvb2tpbmc7XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnYm9va2luZ3MnKVxyXG4gICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgLmVxKCdpZCcsIGlkKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGJvb2tpbmc6JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdCb29raW5nIG5vdCBmb3VuZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBib29raW5nOiBkYXRhIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ1VuZXhwZWN0ZWQgZXJyb3IgZmV0Y2hpbmcgYm9va2luZzonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0FuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDdXN0b21lclByb2ZpbGUoXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBwaG9uZT86IHN0cmluZ1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIHByb2ZpbGU/OiBQcm9maWxlO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgLy8gRmlyc3QsIHRyeSB0byBnZXQgcHJvZmlsZSBmcm9tIHByb2ZpbGVzIHRhYmxlXHJcbiAgICBsZXQgcXVlcnkgPSBzdXBhYmFzZS5mcm9tKCdwcm9maWxlcycpLnNlbGVjdCgnKicpO1xyXG5cclxuICAgIGlmIChlbWFpbCkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdlbWFpbCcsIGVtYWlsKTtcclxuICAgIH0gZWxzZSBpZiAocGhvbmUpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgncGhvbmUnLCBwaG9uZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdFbWFpbCBvciBwaG9uZSBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB7IGRhdGE6IHByb2ZpbGVEYXRhLCBlcnJvcjogcHJvZmlsZUVycm9yIH0gPSBhd2FpdCBxdWVyeS5tYXliZVNpbmdsZSgpO1xyXG5cclxuICAgIC8vIElmIHByb2ZpbGUgZXhpc3RzLCByZXR1cm4gaXRcclxuICAgIGlmIChwcm9maWxlRGF0YSAmJiAhcHJvZmlsZUVycm9yKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHByb2ZpbGU6IHByb2ZpbGVEYXRhIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gSWYgbm8gcHJvZmlsZSBleGlzdHMsIGRlcml2ZSBmcm9tIG1vc3QgcmVjZW50IGJvb2tpbmdcclxuICAgIGxldCBib29raW5nUXVlcnkgPSBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnYm9va2luZ3MnKVxyXG4gICAgICAuc2VsZWN0KCdjdXN0b21lcl9maXJzdF9uYW1lLCBjdXN0b21lcl9sYXN0X25hbWUsIGN1c3RvbWVyX2VtYWlsLCBjdXN0b21lcl9waG9uZScpXHJcbiAgICAgIC5vcmRlcignY3JlYXRlZF9hdCcsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KVxyXG4gICAgICAubGltaXQoMSk7XHJcblxyXG4gICAgaWYgKGVtYWlsICYmIHBob25lKSB7XHJcbiAgICAgIGJvb2tpbmdRdWVyeSA9IGJvb2tpbmdRdWVyeS5vcihgY3VzdG9tZXJfZW1haWwuZXEuJHtlbWFpbH0sY3VzdG9tZXJfcGhvbmUuZXEuJHtwaG9uZX1gKTtcclxuICAgIH0gZWxzZSBpZiAoZW1haWwpIHtcclxuICAgICAgYm9va2luZ1F1ZXJ5ID0gYm9va2luZ1F1ZXJ5LmVxKCdjdXN0b21lcl9lbWFpbCcsIGVtYWlsKTtcclxuICAgIH0gZWxzZSBpZiAocGhvbmUpIHtcclxuICAgICAgYm9va2luZ1F1ZXJ5ID0gYm9va2luZ1F1ZXJ5LmVxKCdjdXN0b21lcl9waG9uZScsIHBob25lKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB7IGRhdGE6IGJvb2tpbmdEYXRhLCBlcnJvcjogYm9va2luZ0Vycm9yIH0gPSBhd2FpdCBib29raW5nUXVlcnkubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoYm9va2luZ0Vycm9yIHx8ICFib29raW5nRGF0YSkge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIGVycm9yOiAnTm8gcHJvZmlsZSBvciBib29raW5nIGZvdW5kLiBQbGVhc2UgY3JlYXRlIGEgYm9va2luZyBmaXJzdC4nLFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENyZWF0ZSBhIHByb2ZpbGUgb2JqZWN0IGZyb20gYm9va2luZyBkYXRhXHJcbiAgICBjb25zdCBkZXJpdmVkUHJvZmlsZTogUHJvZmlsZSA9IHtcclxuICAgICAgaWQ6ICcnLCAvLyBXaWxsIGJlIGdlbmVyYXRlZCB3aGVuIHNhdmVkXHJcbiAgICAgIGVtYWlsOiBib29raW5nRGF0YS5jdXN0b21lcl9lbWFpbCxcclxuICAgICAgcGhvbmU6IGJvb2tpbmdEYXRhLmN1c3RvbWVyX3Bob25lIHx8IG51bGwsXHJcbiAgICAgIGZpcnN0X25hbWU6IGJvb2tpbmdEYXRhLmN1c3RvbWVyX2ZpcnN0X25hbWUsXHJcbiAgICAgIGxhc3RfbmFtZTogYm9va2luZ0RhdGEuY3VzdG9tZXJfbGFzdF9uYW1lLFxyXG4gICAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcHJvZmlsZTogZGVyaXZlZFByb2ZpbGUgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gZ2V0Q3VzdG9tZXJQcm9maWxlOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGZldGNoIHByb2ZpbGUnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGxvYWRQcm9maWxlUGljdHVyZShcclxuICBlbWFpbDogc3RyaW5nLFxyXG4gIGZpbGVEYXRhOiBzdHJpbmcsIC8vIGJhc2U2NCBlbmNvZGVkIHN0cmluZ1xyXG4gIGZpbGVOYW1lOiBzdHJpbmcsXHJcbiAgZmlsZVR5cGU6IHN0cmluZ1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIHVybD86IHN0cmluZztcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICAvLyBVc2UgYWRtaW4gY2xpZW50IGZvciBzdG9yYWdlIHVwbG9hZHMgaWYgc2VydmljZSByb2xlIGtleSBpcyBhdmFpbGFibGVcclxuICAgIC8vIFRoaXMgZW5zdXJlcyBzdG9yYWdlIHBvbGljaWVzIGRvbid0IGJsb2NrIHRoZSB1cGxvYWRcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSBcclxuICAgICAgPyBjcmVhdGVBZG1pbkNsaWVudCgpIFxyXG4gICAgICA6IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIFZhbGlkYXRlIGZpbGUgdHlwZVxyXG4gICAgY29uc3QgdmFsaWRJbWFnZVR5cGVzID0gWydpbWFnZS9qcGVnJywgJ2ltYWdlL2pwZycsICdpbWFnZS9wbmcnLCAnaW1hZ2Uvd2VicCddO1xyXG4gICAgaWYgKCF2YWxpZEltYWdlVHlwZXMuaW5jbHVkZXMoZmlsZVR5cGUpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ludmFsaWQgZmlsZSB0eXBlLiBQbGVhc2UgdXBsb2FkIGEgSlBFRywgUE5HLCBvciBXZWJQIGltYWdlLicgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBEZWNvZGUgYmFzZTY0IGRhdGFcclxuICAgIGNvbnN0IGJhc2U2NERhdGEgPSBmaWxlRGF0YS5yZXBsYWNlKC9eZGF0YTppbWFnZVxcL1xcdys7YmFzZTY0LC8sICcnKTtcclxuICAgIGNvbnN0IGJ1ZmZlciA9IEJ1ZmZlci5mcm9tKGJhc2U2NERhdGEsICdiYXNlNjQnKTtcclxuXHJcbiAgICAvLyBWYWxpZGF0ZSBmaWxlIHNpemUgKG1heCA1TUIpXHJcbiAgICBjb25zdCBtYXhTaXplID0gNSAqIDEwMjQgKiAxMDI0OyAvLyA1TUIgaW4gYnl0ZXNcclxuICAgIGlmIChidWZmZXIubGVuZ3RoID4gbWF4U2l6ZSkge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdGaWxlIHNpemUgdG9vIGxhcmdlLiBQbGVhc2UgdXBsb2FkIGFuIGltYWdlIHNtYWxsZXIgdGhhbiA1TUIuJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEdlbmVyYXRlIHVuaXF1ZSBmaWxlbmFtZSB1c2luZyBlbWFpbCBhbmQgdGltZXN0YW1wXHJcbiAgICBjb25zdCBmaWxlRXh0ID0gZmlsZU5hbWUuc3BsaXQoJy4nKS5wb3AoKSB8fCAnanBnJztcclxuICAgIGNvbnN0IHNhbml0aXplZEVtYWlsID0gZW1haWwucmVwbGFjZSgvW15hLXpBLVowLTldL2csICdfJyk7XHJcbiAgICBjb25zdCB1bmlxdWVGaWxlTmFtZSA9IGAke3Nhbml0aXplZEVtYWlsfV8ke0RhdGUubm93KCl9LiR7ZmlsZUV4dH1gO1xyXG4gICAgY29uc3QgZmlsZVBhdGggPSBgYXZhdGFycy8ke3VuaXF1ZUZpbGVOYW1lfWA7XHJcblxyXG4gICAgLy8gVXBsb2FkIHRvIFN1cGFiYXNlIFN0b3JhZ2VcclxuICAgIGNvbnN0IHsgZGF0YTogdXBsb2FkRGF0YSwgZXJyb3I6IHVwbG9hZEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5zdG9yYWdlXHJcbiAgICAgIC5mcm9tKCdwcm9maWxlLXBpY3R1cmVzJylcclxuICAgICAgLnVwbG9hZChmaWxlUGF0aCwgYnVmZmVyLCB7XHJcbiAgICAgICAgY29udGVudFR5cGU6IGZpbGVUeXBlLFxyXG4gICAgICAgIHVwc2VydDogZmFsc2UsXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgaWYgKHVwbG9hZEVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcign4p2MIFN0b3JhZ2UgdXBsb2FkIGVycm9yOicsIHVwbG9hZEVycm9yKTtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdVcGxvYWQgZXJyb3IgZGV0YWlsczonLCB7XHJcbiAgICAgICAgICBtZXNzYWdlOiB1cGxvYWRFcnJvci5tZXNzYWdlLFxyXG4gICAgICAgICAgc3RhdHVzQ29kZTogdXBsb2FkRXJyb3Iuc3RhdHVzQ29kZSxcclxuICAgICAgICAgIGVycm9yOiB1cGxvYWRFcnJvci5lcnJvcixcclxuICAgICAgICB9KTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBDaGVjayBmb3Igc3RvcmFnZSBSTFMgZXJyb3JzXHJcbiAgICAgICAgaWYgKHVwbG9hZEVycm9yLm1lc3NhZ2U/LmluY2x1ZGVzKCdyb3ctbGV2ZWwgc2VjdXJpdHknKSB8fCBcclxuICAgICAgICAgICAgdXBsb2FkRXJyb3IubWVzc2FnZT8uaW5jbHVkZXMoJ1JMUycpIHx8XHJcbiAgICAgICAgICAgIHVwbG9hZEVycm9yLm1lc3NhZ2U/LmluY2x1ZGVzKCdwb2xpY3knKSkge1xyXG4gICAgICAgICAgcmV0dXJuIHsgXHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLCBcclxuICAgICAgICAgICAgZXJyb3I6ICdTdG9yYWdlIGJ1Y2tldCBSTFMgcG9saWN5IGVycm9yLiBQbGVhc2UgY2hlY2sgeW91ciBcInByb2ZpbGUtcGljdHVyZXNcIiBidWNrZXQgcG9saWNpZXMgaW4gU3VwYWJhc2UgU3RvcmFnZS4gVGhlIGJ1Y2tldCBuZWVkcyBwb2xpY2llcyB0aGF0IGFsbG93IGF1dGhlbnRpY2F0ZWQgdXNlcnMgdG8gdXBsb2FkIGZpbGVzLicsXHJcbiAgICAgICAgICAgIGVycm9yRGV0YWlsczogdXBsb2FkRXJyb3IubWVzc2FnZSxcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIElmIGJ1Y2tldCBkb2Vzbid0IGV4aXN0LCByZXR1cm4gaGVscGZ1bCBlcnJvclxyXG4gICAgICAgIGlmICh1cGxvYWRFcnJvci5tZXNzYWdlLmluY2x1ZGVzKCdub3QgZm91bmQnKSB8fCB1cGxvYWRFcnJvci5tZXNzYWdlLmluY2x1ZGVzKCdCdWNrZXQnKSkge1xyXG4gICAgICAgICAgcmV0dXJuIHsgXHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLCBcclxuICAgICAgICAgICAgZXJyb3I6ICdTdG9yYWdlIGJ1Y2tldCBub3QgY29uZmlndXJlZC4gUGxlYXNlIGNyZWF0ZSBhIFwicHJvZmlsZS1waWN0dXJlc1wiIGJ1Y2tldCBpbiBTdXBhYmFzZSBTdG9yYWdlLicsXHJcbiAgICAgICAgICAgIGVycm9yRGV0YWlsczogdXBsb2FkRXJyb3IubWVzc2FnZSxcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB7IFxyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsIFxyXG4gICAgICAgICAgZXJyb3I6IHVwbG9hZEVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byB1cGxvYWQgZmlsZScsXHJcbiAgICAgICAgICBlcnJvckRldGFpbHM6IHVwbG9hZEVycm9yLmVycm9yIHx8IHVwbG9hZEVycm9yLnN0YXR1c0NvZGU/LnRvU3RyaW5nKCksXHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG5cclxuICAgIC8vIEdldCBwdWJsaWMgVVJMXHJcbiAgICBjb25zdCB7IGRhdGE6IHVybERhdGEgfSA9IHN1cGFiYXNlLnN0b3JhZ2VcclxuICAgICAgLmZyb20oJ3Byb2ZpbGUtcGljdHVyZXMnKVxyXG4gICAgICAuZ2V0UHVibGljVXJsKGZpbGVQYXRoKTtcclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCB1cmw6IHVybERhdGEucHVibGljVXJsIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHVwbG9hZFByb2ZpbGVQaWN0dXJlOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIHVwbG9hZCBwcm9maWxlIHBpY3R1cmUnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBkZWxldGVQcm9maWxlUGljdHVyZShlbWFpbDogc3RyaW5nLCBhdmF0YXJVcmw6IHN0cmluZyk6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICAvLyBFeHRyYWN0IGZpbGUgcGF0aCBmcm9tIFVSTFxyXG4gICAgLy8gVVJMIGZvcm1hdDogaHR0cHM6Ly9bcHJvamVjdF0uc3VwYWJhc2UuY28vc3RvcmFnZS92MS9vYmplY3QvcHVibGljL3Byb2ZpbGUtcGljdHVyZXMvYXZhdGFycy9maWxlbmFtZS5qcGdcclxuICAgIGNvbnN0IHVybFBhdHRlcm4gPSAvXFwvcHJvZmlsZS1waWN0dXJlc1xcLyguKykkLztcclxuICAgIGNvbnN0IG1hdGNoID0gYXZhdGFyVXJsLm1hdGNoKHVybFBhdHRlcm4pO1xyXG4gICAgXHJcbiAgICBpZiAoIW1hdGNoIHx8ICFtYXRjaFsxXSkge1xyXG4gICAgICAvLyBJZiBVUkwgZG9lc24ndCBtYXRjaCBleHBlY3RlZCBwYXR0ZXJuLCB0cnkgYWx0ZXJuYXRpdmUgcGFyc2luZ1xyXG4gICAgICBjb25zdCB1cmxQYXJ0cyA9IGF2YXRhclVybC5zcGxpdCgnL2F2YXRhcnMvJyk7XHJcbiAgICAgIGlmICh1cmxQYXJ0cy5sZW5ndGggPCAyKSB7XHJcbiAgICAgICAgLy8gSWYgd2UgY2FuJ3QgcGFyc2UgdGhlIFVSTCwganVzdCByZXR1cm4gc3VjY2VzcyAodGhlIGZpbGUgbWlnaHQgYWxyZWFkeSBiZSBkZWxldGVkKVxyXG4gICAgICAgIGNvbnNvbGUud2FybignQ291bGQgbm90IHBhcnNlIGF2YXRhciBVUkwgZm9yIGRlbGV0aW9uOicsIGF2YXRhclVybCk7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xyXG4gICAgICB9XHJcbiAgICAgIGNvbnN0IGZpbGVQYXRoID0gYGF2YXRhcnMvJHt1cmxQYXJ0c1sxXS5zcGxpdCgnPycpWzBdfWA7XHJcbiAgICAgIGNvbnN0IHsgZXJyb3I6IGRlbGV0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5zdG9yYWdlXHJcbiAgICAgICAgLmZyb20oJ3Byb2ZpbGUtcGljdHVyZXMnKVxyXG4gICAgICAgIC5yZW1vdmUoW2ZpbGVQYXRoXSk7XHJcblxyXG4gICAgICBpZiAoZGVsZXRlRXJyb3IgJiYgIWRlbGV0ZUVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ25vdCBmb3VuZCcpKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZGVsZXRpbmcgZmlsZTonLCBkZWxldGVFcnJvcik7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBkZWxldGVFcnJvci5tZXNzYWdlIH07XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGZpbGVQYXRoID0gbWF0Y2hbMV0uc3BsaXQoJz8nKVswXTsgLy8gUmVtb3ZlIHF1ZXJ5IHBhcmFtZXRlcnMgaWYgYW55XHJcblxyXG4gICAgLy8gRGVsZXRlIGZyb20gc3RvcmFnZVxyXG4gICAgY29uc3QgeyBlcnJvcjogZGVsZXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLnN0b3JhZ2VcclxuICAgICAgLmZyb20oJ3Byb2ZpbGUtcGljdHVyZXMnKVxyXG4gICAgICAucmVtb3ZlKFtmaWxlUGF0aF0pO1xyXG5cclxuICAgIGlmIChkZWxldGVFcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBkZWxldGluZyBmaWxlOicsIGRlbGV0ZUVycm9yKTtcclxuICAgICAgLy8gRG9uJ3QgZmFpbCBpZiBmaWxlIGRvZXNuJ3QgZXhpc3RcclxuICAgICAgaWYgKGRlbGV0ZUVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ25vdCBmb3VuZCcpIHx8IGRlbGV0ZUVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ05vIHN1Y2ggZmlsZScpKSB7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZGVsZXRlRXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gZGVsZXRlUHJvZmlsZVBpY3R1cmU6JywgZXJyb3IpO1xyXG4gICAgLy8gRG9uJ3QgZmFpbCBjb21wbGV0ZWx5IC0gdGhlIFVSTCBpbiBkYXRhYmFzZSB3aWxsIGJlIHJlbW92ZWQgYW55d2F5XHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQ3VzdG9tZXJQcm9maWxlKFxyXG4gIGVtYWlsOiBzdHJpbmcsXHJcbiAgZGF0YTogUHJvZmlsZVVwZGF0ZUlucHV0XHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgcHJvZmlsZT86IFByb2ZpbGU7XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgLy8gRmlyc3QsIHZlcmlmeSB0aGUgYXV0aGVudGljYXRlZCB1c2VyIG1hdGNoZXMgdGhlIGVtYWlsXHJcbiAgICBjb25zdCBhdXRoU3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuICAgIGNvbnN0IHsgZGF0YTogeyB1c2VyIH0sIGVycm9yOiBhdXRoRXJyb3IgfSA9IGF3YWl0IGF1dGhTdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcclxuICAgIFxyXG4gICAgaWYgKGF1dGhFcnJvciB8fCAhdXNlcikge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdOb3QgYXV0aGVudGljYXRlZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBWZXJpZnkgdGhhdCB0aGUgZW1haWwgcGFyYW1ldGVyIG1hdGNoZXMgdGhlIGF1dGhlbnRpY2F0ZWQgdXNlcidzIGVtYWlsXHJcbiAgICAvLyBUaGlzIGVuc3VyZXMgdXNlcnMgY2FuIG9ubHkgdXBkYXRlIHRoZWlyIG93biBwcm9maWxlXHJcbiAgICBpZiAodXNlci5lbWFpbD8udG9Mb3dlckNhc2UoKSAhPT0gZW1haWwudG9Mb3dlckNhc2UoKSAmJiB1c2VyLmVtYWlsPy50b0xvd2VyQ2FzZSgpICE9PSBkYXRhLmVtYWlsPy50b0xvd2VyQ2FzZSgpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ1VuYXV0aG9yaXplZDogWW91IGNhbiBvbmx5IHVwZGF0ZSB5b3VyIG93biBwcm9maWxlJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEFMV0FZUyB1c2UgYWRtaW4gY2xpZW50IGZvciBwcm9maWxlIG9wZXJhdGlvbnMgLSBpdCBieXBhc3NlcyBSTFMgY29tcGxldGVseVxyXG4gICAgLy8gVGhpcyBpcyBSRVFVSVJFRCAtIHdlIGNhbm5vdCB1c2UgYXV0aGVudGljYXRlZCBjbGllbnQgYXMgaXQgbWF5IHN0aWxsIGNoZWNrIFJMUyBwb2xpY2llc1xyXG4gICAgbGV0IHN1cGFiYXNlO1xyXG4gICAgdHJ5IHtcclxuICAgICAgc3VwYWJhc2UgPSBjcmVhdGVBZG1pbkNsaWVudCgpO1xyXG4gICAgICBjb25zb2xlLmxvZygn4pyFIFVzaW5nIGFkbWluIGNsaWVudCBmb3IgcHJvZmlsZSBvcGVyYXRpb25zJyk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAvLyBEbyBOT1QgZmFsbCBiYWNrIHRvIGF1dGhlbnRpY2F0ZWQgY2xpZW50IC0gaXQgd2lsbCBjYXVzZSBSTFMgZXJyb3JzXHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBGYWlsZWQgdG8gY3JlYXRlIGFkbWluIGNsaWVudDonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6ICdTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIGlzIG5vdCBzZXQuIFRoaXMgaXMgUkVRVUlSRUQgZm9yIHByb2ZpbGUgb3BlcmF0aW9ucy4gUGxlYXNlIGFkZCBpdCB0byB5b3VyIC5lbnYubG9jYWwgZmlsZS4gR2V0IGl0IGZyb206IFN1cGFiYXNlIERhc2hib2FyZCDihpIgU2V0dGluZ3Mg4oaSIEFQSSDihpIgc2VydmljZV9yb2xlIGtleSAoc2VjcmV0KScsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIFZlcmlmeSB3ZSBoYXZlIGEgdmFsaWQgY2xpZW50IChzaG91bGQgbmV2ZXIgaGFwcGVuIGR1ZSB0byBlcnJvciBhYm92ZSwgYnV0IGRvdWJsZS1jaGVjaylcclxuICAgIGlmICghc3VwYWJhc2UpIHtcclxuICAgICAgcmV0dXJuIHsgXHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsIFxyXG4gICAgICAgIGVycm9yOiAnRmFpbGVkIHRvIGluaXRpYWxpemUgZGF0YWJhc2UgY2xpZW50LiBQbGVhc2UgY2hlY2sgeW91ciBTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIGluIC5lbnYubG9jYWwnIFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFZhbGlkYXRlIGlucHV0XHJcbiAgICBpZiAoIWRhdGEuZmlyc3RfbmFtZT8udHJpbSgpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ZpcnN0IG5hbWUgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcbiAgICBpZiAoIWRhdGEubGFzdF9uYW1lPy50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTGFzdCBuYW1lIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG4gICAgaWYgKCFkYXRhLmVtYWlsPy50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRW1haWwgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcbiAgICBpZiAoIS9eW15cXHNAXStAW15cXHNAXStcXC5bXlxcc0BdKyQvLnRlc3QoZGF0YS5lbWFpbCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnSW52YWxpZCBlbWFpbCBmb3JtYXQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVmVyaWZ5IHRoZSBuZXcgZW1haWwgKGlmIGNoYW5nZWQpIHN0aWxsIG1hdGNoZXMgdGhlIGF1dGhlbnRpY2F0ZWQgdXNlclxyXG4gICAgaWYgKGRhdGEuZW1haWwudG9Mb3dlckNhc2UoKSAhPT0gdXNlci5lbWFpbD8udG9Mb3dlckNhc2UoKSkge1xyXG4gICAgICAvLyBBbGxvdyBlbWFpbCBjaGFuZ2Ugb25seSBpZiBpdCdzIHRoZSBzYW1lIHVzZXIgKGNhc2UgaW5zZW5zaXRpdmUgY2hlY2sgYWJvdmUgcGFzc2VkKVxyXG4gICAgICAvLyBCdXQgd2Ugc2hvdWxkIHZlcmlmeSBpdCdzIGEgdmFsaWQgY2hhbmdlICh1c2VyIHVwZGF0aW5nIHRoZWlyIG93biBlbWFpbClcclxuICAgICAgaWYgKGRhdGEuZW1haWwudG9Mb3dlckNhc2UoKSAhPT0gZW1haWwudG9Mb3dlckNhc2UoKSkge1xyXG4gICAgICAgIC8vIEVtYWlsIGlzIGJlaW5nIGNoYW5nZWQgLSB2ZXJpZnkgaXQncyBzdGlsbCB0aGUgc2FtZSB1c2VyXHJcbiAgICAgICAgLy8gRm9yIG5vdywgd2UnbGwgYWxsb3cgaXQgYnV0IGluIHByb2R1Y3Rpb24geW91IG1pZ2h0IHdhbnQgdG8gcmVxdWlyZSBlbWFpbCB2ZXJpZmljYXRpb25cclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIENoZWNrIGlmIHByb2ZpbGUgZXhpc3RzXHJcbiAgICBjb25zb2xlLmxvZygn8J+UjSBDaGVja2luZyBpZiBwcm9maWxlIGV4aXN0cyBmb3IgZW1haWw6JywgZW1haWwpO1xyXG4gICAgY29uc29sZS5sb2coJ/CflI0gVXNpbmcgY2xpZW50IHR5cGU6JywgcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSA/ICdBRE1JTiAoc2VydmljZSByb2xlKScgOiAnQVVUSEVOVElDQVRFRCAoYW5vbiBrZXkpJyk7XHJcbiAgICBcclxuICAgIGNvbnN0IHsgZGF0YTogZXhpc3RpbmdQcm9maWxlLCBlcnJvcjogc2VsZWN0RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgIC5zZWxlY3QoJyonKVxyXG4gICAgICAuZXEoJ2VtYWlsJywgZW1haWwpXHJcbiAgICAgIC5tYXliZVNpbmdsZSgpO1xyXG4gICAgXHJcbiAgICBpZiAoc2VsZWN0RXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIHNlbGVjdGluZyBwcm9maWxlOicsIHNlbGVjdEVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBgRmFpbGVkIHRvIGNoZWNrIHByb2ZpbGU6ICR7c2VsZWN0RXJyb3IubWVzc2FnZX1gIH07XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGNvbnNvbGUubG9nKCfinIUgUHJvZmlsZSBjaGVjayByZXN1bHQ6JywgZXhpc3RpbmdQcm9maWxlID8gJ1Byb2ZpbGUgZXhpc3RzICh3aWxsIFVQREFURSknIDogJ1Byb2ZpbGUgZG9lcyBub3QgZXhpc3QgKHdpbGwgSU5TRVJUKScpO1xyXG5cclxuICAgIC8vIElmIGF2YXRhcl91cmwgaXMgYmVpbmcgcmVtb3ZlZCwgZGVsZXRlIHRoZSBvbGQgZmlsZVxyXG4gICAgaWYgKGV4aXN0aW5nUHJvZmlsZT8uYXZhdGFyX3VybCAmJiBkYXRhLmF2YXRhcl91cmwgPT09IG51bGwpIHtcclxuICAgICAgYXdhaXQgZGVsZXRlUHJvZmlsZVBpY3R1cmUoZW1haWwsIGV4aXN0aW5nUHJvZmlsZS5hdmF0YXJfdXJsKTtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgcmVzdWx0O1xyXG4gICAgaWYgKGV4aXN0aW5nUHJvZmlsZSkge1xyXG4gICAgICAvLyBVcGRhdGUgZXhpc3RpbmcgcHJvZmlsZVxyXG4gICAgICAvLyBJZiBlbWFpbCBjaGFuZ2VkLCB3ZSBuZWVkIHRvIGhhbmRsZSBpdCBjYXJlZnVsbHlcclxuICAgICAgaWYgKGRhdGEuZW1haWwgIT09IGVtYWlsKSB7XHJcbiAgICAgICAgLy8gQ2hlY2sgaWYgbmV3IGVtYWlsIGFscmVhZHkgZXhpc3RzXHJcbiAgICAgICAgY29uc3QgeyBkYXRhOiBlbWFpbENoZWNrIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcclxuICAgICAgICAgIC5zZWxlY3QoJ2lkJylcclxuICAgICAgICAgIC5lcSgnZW1haWwnLCBkYXRhLmVtYWlsKVxyXG4gICAgICAgICAgLm1heWJlU2luZ2xlKCk7XHJcblxyXG4gICAgICAgIGlmIChlbWFpbENoZWNrKSB7XHJcbiAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdFbWFpbCBhbHJlYWR5IGV4aXN0cycgfTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IHVwZGF0ZURhdGE6IGFueSA9IHtcclxuICAgICAgICAgIGZpcnN0X25hbWU6IGRhdGEuZmlyc3RfbmFtZS50cmltKCksXHJcbiAgICAgICAgICBsYXN0X25hbWU6IGRhdGEubGFzdF9uYW1lLnRyaW0oKSxcclxuICAgICAgICAgIGVtYWlsOiBkYXRhLmVtYWlsLnRyaW0oKSxcclxuICAgICAgICAgIHBob25lOiBkYXRhLnBob25lPy50cmltKCkgfHwgbnVsbCxcclxuICAgICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8vIE9ubHkgdXBkYXRlIGF2YXRhcl91cmwgaWYgaXQncyBwcm92aWRlZFxyXG4gICAgICBpZiAoZGF0YS5hdmF0YXJfdXJsICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICB1cGRhdGVEYXRhLmF2YXRhcl91cmwgPSBkYXRhLmF2YXRhcl91cmw7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnNvbGUubG9nKCfwn5OdIEF0dGVtcHRpbmcgdG8gVVBEQVRFIHByb2ZpbGUgd2l0aCBkYXRhOicsIHVwZGF0ZURhdGEpO1xyXG4gICAgICBjb25zb2xlLmxvZygn8J+TnSBVcGRhdGUgV0hFUkUgZW1haWwgPScsIGVtYWlsKTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IHsgZGF0YTogdXBkYXRlZFByb2ZpbGUsIGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgIC51cGRhdGUodXBkYXRlRGF0YSlcclxuICAgICAgICAuZXEoJ2VtYWlsJywgZW1haWwpXHJcbiAgICAgICAgLnNlbGVjdCgpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgaWYgKHVwZGF0ZUVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIHVwZGF0aW5nIHByb2ZpbGU6JywgdXBkYXRlRXJyb3IpO1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBVcGRhdGUgZXJyb3IgZGV0YWlsczonLCB7XHJcbiAgICAgICAgICBjb2RlOiB1cGRhdGVFcnJvci5jb2RlLFxyXG4gICAgICAgICAgbWVzc2FnZTogdXBkYXRlRXJyb3IubWVzc2FnZSxcclxuICAgICAgICAgIGRldGFpbHM6IHVwZGF0ZUVycm9yLmRldGFpbHMsXHJcbiAgICAgICAgICBoaW50OiB1cGRhdGVFcnJvci5oaW50LFxyXG4gICAgICAgICAgc3RhdHVzQ29kZTogKHVwZGF0ZUVycm9yIGFzIGFueSkuc3RhdHVzQ29kZSxcclxuICAgICAgICAgIHN0YXR1czogKHVwZGF0ZUVycm9yIGFzIGFueSkuc3RhdHVzLFxyXG4gICAgICAgICAgc2VydmljZVJvbGVLZXlTZXQ6ICEhcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSxcclxuICAgICAgICB9KTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBDaGVjayBmb3IgUkxTIGVycm9ycyBzcGVjaWZpY2FsbHlcclxuICAgICAgICBpZiAodXBkYXRlRXJyb3IubWVzc2FnZT8uaW5jbHVkZXMoJ3Jvdy1sZXZlbCBzZWN1cml0eScpIHx8IFxyXG4gICAgICAgICAgICB1cGRhdGVFcnJvci5jb2RlID09PSAnNDI1MDEnIHx8XHJcbiAgICAgICAgICAgIHVwZGF0ZUVycm9yLm1lc3NhZ2U/LmluY2x1ZGVzKCdSTFMnKSkge1xyXG4gICAgICAgICAgcmV0dXJuIHsgXHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLCBcclxuICAgICAgICAgICAgZXJyb3I6ICdSb3cgTGV2ZWwgU2VjdXJpdHkgZXJyb3IuIFBsZWFzZSBlbnN1cmU6IDEpIFJMUyBpcyBkaXNhYmxlZCBvbiBwcm9maWxlcyB0YWJsZSwgMikgU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSBpcyBzZXQgaW4gLmVudi5sb2NhbCcsXHJcbiAgICAgICAgICAgIGVycm9yRGV0YWlsczogYEVycm9yIGNvZGU6ICR7dXBkYXRlRXJyb3IuY29kZSB8fCAndW5rbm93bid9LiAke3VwZGF0ZUVycm9yLmhpbnQgfHwgJyd9YCxcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHJldHVybiB7IFxyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsIFxyXG4gICAgICAgICAgZXJyb3I6IHVwZGF0ZUVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byB1cGRhdGUgcHJvZmlsZScsXHJcbiAgICAgICAgICBlcnJvckRldGFpbHM6IHVwZGF0ZUVycm9yLmRldGFpbHMgfHwgdXBkYXRlRXJyb3IuaGludCB8fCB1bmRlZmluZWQsXHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmVzdWx0ID0gdXBkYXRlZFByb2ZpbGU7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyBDcmVhdGUgbmV3IHByb2ZpbGVcclxuICAgICAgY29uc3QgaW5zZXJ0RGF0YTogYW55ID0ge1xyXG4gICAgICAgICAgZW1haWw6IGRhdGEuZW1haWwudHJpbSgpLFxyXG4gICAgICAgICAgcGhvbmU6IGRhdGEucGhvbmU/LnRyaW0oKSB8fCBudWxsLFxyXG4gICAgICAgICAgZmlyc3RfbmFtZTogZGF0YS5maXJzdF9uYW1lLnRyaW0oKSxcclxuICAgICAgICAgIGxhc3RfbmFtZTogZGF0YS5sYXN0X25hbWUudHJpbSgpLFxyXG4gICAgICB9O1xyXG5cclxuICAgICAgLy8gT25seSBzZXQgYXZhdGFyX3VybCBpZiBpdCdzIHByb3ZpZGVkXHJcbiAgICAgIGlmIChkYXRhLmF2YXRhcl91cmwpIHtcclxuICAgICAgICBpbnNlcnREYXRhLmF2YXRhcl91cmwgPSBkYXRhLmF2YXRhcl91cmw7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IHsgZGF0YTogbmV3UHJvZmlsZSwgZXJyb3I6IGluc2VydEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgICAgLmluc2VydChpbnNlcnREYXRhKVxyXG4gICAgICAgIC5zZWxlY3QoKVxyXG4gICAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICAgIGlmIChpbnNlcnRFcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIHByb2ZpbGU6JywgaW5zZXJ0RXJyb3IpO1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBJbnNlcnQgZXJyb3IgZGV0YWlsczonLCB7XHJcbiAgICAgICAgICBjb2RlOiBpbnNlcnRFcnJvci5jb2RlLFxyXG4gICAgICAgICAgbWVzc2FnZTogaW5zZXJ0RXJyb3IubWVzc2FnZSxcclxuICAgICAgICAgIGRldGFpbHM6IGluc2VydEVycm9yLmRldGFpbHMsXHJcbiAgICAgICAgICBoaW50OiBpbnNlcnRFcnJvci5oaW50LFxyXG4gICAgICAgICAgc2VydmljZVJvbGVLZXlTZXQ6ICEhcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSxcclxuICAgICAgICB9KTtcclxuICAgICAgICAvLyBDaGVjayBpZiBpdCdzIGEgdW5pcXVlIGNvbnN0cmFpbnQgdmlvbGF0aW9uXHJcbiAgICAgICAgaWYgKGluc2VydEVycm9yLmNvZGUgPT09ICcyMzUwNScpIHtcclxuICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0VtYWlsIGFscmVhZHkgZXhpc3RzJyB9O1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBDaGVjayBpZiBpdCdzIGFuIFJMUyBlcnJvclxyXG4gICAgICAgIGlmIChpbnNlcnRFcnJvci5tZXNzYWdlPy5pbmNsdWRlcygncm93LWxldmVsIHNlY3VyaXR5JykgfHwgXHJcbiAgICAgICAgICAgIGluc2VydEVycm9yLmNvZGUgPT09ICc0MjUwMScgfHxcclxuICAgICAgICAgICAgaW5zZXJ0RXJyb3IubWVzc2FnZT8uaW5jbHVkZXMoJ1JMUycpKSB7XHJcbiAgICAgICAgICByZXR1cm4geyBcclxuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsIFxyXG4gICAgICAgICAgICBlcnJvcjogJ1JvdyBMZXZlbCBTZWN1cml0eSBlcnJvci4gUGxlYXNlIGVuc3VyZTogMSkgUkxTIGlzIGRpc2FibGVkIG9uIHByb2ZpbGVzIHRhYmxlLCAyKSBTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIGlzIHNldCBpbiAuZW52LmxvY2FsJyxcclxuICAgICAgICAgICAgZXJyb3JEZXRhaWxzOiBgRXJyb3IgY29kZTogJHtpbnNlcnRFcnJvci5jb2RlIHx8ICd1bmtub3duJ30uICR7aW5zZXJ0RXJyb3IuaGludCB8fCAnJ31gLFxyXG4gICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHsgXHJcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSwgXHJcbiAgICAgICAgICBlcnJvcjogaW5zZXJ0RXJyb3IubWVzc2FnZSB8fCAnRmFpbGVkIHRvIGNyZWF0ZSBwcm9maWxlJyxcclxuICAgICAgICAgIGVycm9yRGV0YWlsczogaW5zZXJ0RXJyb3IuZGV0YWlscyB8fCBpbnNlcnRFcnJvci5oaW50IHx8IHVuZGVmaW5lZCxcclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcblxyXG4gICAgICByZXN1bHQgPSBuZXdQcm9maWxlO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHByb2ZpbGU6IHJlc3VsdCB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiB1cGRhdGVDdXN0b21lclByb2ZpbGU6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gdXBkYXRlIHByb2ZpbGUnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDdXN0b21lckxvY2F0aW9ucyhcclxuICBlbWFpbDogc3RyaW5nLFxyXG4gIHBob25lPzogc3RyaW5nXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgbG9jYXRpb25zPzogTG9jYXRpb25bXTtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIGxldCBxdWVyeSA9IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdsb2NhdGlvbnMnKVxyXG4gICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgLm9yZGVyKCdpc19kZWZhdWx0JywgeyBhc2NlbmRpbmc6IGZhbHNlIH0pXHJcbiAgICAgIC5vcmRlcignY3JlYXRlZF9hdCcsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KTtcclxuXHJcbiAgICAvLyBCdWlsZCBxdWVyeSBmb3IgZW1haWwvcGhvbmUgbG9va3VwXHJcbiAgICBpZiAoZW1haWwgJiYgcGhvbmUpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5vcihgY3VzdG9tZXJfZW1haWwuZXEuJHtlbWFpbH0sY3VzdG9tZXJfcGhvbmUuZXEuJHtwaG9uZX1gKTtcclxuICAgIH0gZWxzZSBpZiAoZW1haWwpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnY3VzdG9tZXJfZW1haWwnLCBlbWFpbCk7XHJcbiAgICB9IGVsc2UgaWYgKHBob25lKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ2N1c3RvbWVyX3Bob25lJywgcGhvbmUpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRW1haWwgb3IgcGhvbmUgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgcXVlcnk7XHJcblxyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGxvY2F0aW9uczonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGxvY2F0aW9uczogZGF0YSB8fCBbXSB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBnZXRDdXN0b21lckxvY2F0aW9uczonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBmZXRjaCBsb2NhdGlvbnMnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVMb2NhdGlvbihcclxuICBlbWFpbDogc3RyaW5nLFxyXG4gIHBob25lOiBzdHJpbmcgfCB1bmRlZmluZWQsXHJcbiAgbG9jYXRpb25EYXRhOiBMb2NhdGlvbkNyZWF0ZUlucHV0XHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgbG9jYXRpb24/OiBMb2NhdGlvbjtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIFZhbGlkYXRlIGlucHV0XHJcbiAgICBpZiAoIWxvY2F0aW9uRGF0YS5uaWNrbmFtZT8udHJpbSgpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ05pY2tuYW1lIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG4gICAgaWYgKCFsb2NhdGlvbkRhdGEuYWRkcmVzcz8udHJpbSgpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0FkZHJlc3MgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcbiAgICBpZiAoIWxvY2F0aW9uRGF0YS5zdWJ1cmI/LnRyaW0oKSkge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdTdWJ1cmIgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcbiAgICBpZiAoIWxvY2F0aW9uRGF0YS5jaXR5Py50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnQ2l0eSBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBJZiBzZXR0aW5nIGFzIGRlZmF1bHQsIHVuc2V0IGFsbCBvdGhlciBkZWZhdWx0cyBmb3IgdGhpcyBjdXN0b21lclxyXG4gICAgaWYgKGxvY2F0aW9uRGF0YS5pc19kZWZhdWx0KSB7XHJcbiAgICAgIGxldCB1cGRhdGVRdWVyeSA9IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ2xvY2F0aW9ucycpXHJcbiAgICAgICAgLnVwZGF0ZSh7IGlzX2RlZmF1bHQ6IGZhbHNlIH0pO1xyXG5cclxuICAgICAgaWYgKGVtYWlsICYmIHBob25lKSB7XHJcbiAgICAgICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5vcihgY3VzdG9tZXJfZW1haWwuZXEuJHtlbWFpbH0sY3VzdG9tZXJfcGhvbmUuZXEuJHtwaG9uZX1gKTtcclxuICAgICAgfSBlbHNlIGlmIChlbWFpbCkge1xyXG4gICAgICAgIHVwZGF0ZVF1ZXJ5ID0gdXBkYXRlUXVlcnkuZXEoJ2N1c3RvbWVyX2VtYWlsJywgZW1haWwpO1xyXG4gICAgICB9IGVsc2UgaWYgKHBob25lKSB7XHJcbiAgICAgICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5lcSgnY3VzdG9tZXJfcGhvbmUnLCBwaG9uZSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGF3YWl0IHVwZGF0ZVF1ZXJ5O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgZGF0YTogbmV3TG9jYXRpb24sIGVycm9yOiBpbnNlcnRFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2xvY2F0aW9ucycpXHJcbiAgICAgIC5pbnNlcnQoe1xyXG4gICAgICAgIGN1c3RvbWVyX2VtYWlsOiBlbWFpbCxcclxuICAgICAgICBjdXN0b21lcl9waG9uZTogcGhvbmUgfHwgbnVsbCxcclxuICAgICAgICBuaWNrbmFtZTogbG9jYXRpb25EYXRhLm5pY2tuYW1lLnRyaW0oKSxcclxuICAgICAgICBhZGRyZXNzOiBsb2NhdGlvbkRhdGEuYWRkcmVzcy50cmltKCksXHJcbiAgICAgICAgYXB0X3VuaXQ6IGxvY2F0aW9uRGF0YS5hcHRfdW5pdD8udHJpbSgpIHx8IG51bGwsXHJcbiAgICAgICAgc3VidXJiOiBsb2NhdGlvbkRhdGEuc3VidXJiLnRyaW0oKSxcclxuICAgICAgICBjaXR5OiBsb2NhdGlvbkRhdGEuY2l0eS50cmltKCksXHJcbiAgICAgICAgcG9zdGFsX2NvZGU6IGxvY2F0aW9uRGF0YS5wb3N0YWxfY29kZT8udHJpbSgpIHx8IG51bGwsXHJcbiAgICAgICAgaXNfZGVmYXVsdDogbG9jYXRpb25EYXRhLmlzX2RlZmF1bHQgfHwgZmFsc2UsXHJcbiAgICAgIH0pXHJcbiAgICAgIC5zZWxlY3QoKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKGluc2VydEVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIGxvY2F0aW9uOicsIGluc2VydEVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBpbnNlcnRFcnJvci5tZXNzYWdlIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgbG9jYXRpb246IG5ld0xvY2F0aW9uIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGNyZWF0ZUxvY2F0aW9uOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGNyZWF0ZSBsb2NhdGlvbicsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUxvY2F0aW9uKFxyXG4gIGxvY2F0aW9uSWQ6IHN0cmluZyxcclxuICBsb2NhdGlvbkRhdGE6IExvY2F0aW9uVXBkYXRlSW5wdXRcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBsb2NhdGlvbj86IExvY2F0aW9uO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgLy8gVmFsaWRhdGUgaW5wdXQgaWYgcHJvdmlkZWRcclxuICAgIGlmIChsb2NhdGlvbkRhdGEubmlja25hbWUgIT09IHVuZGVmaW5lZCAmJiAhbG9jYXRpb25EYXRhLm5pY2tuYW1lLnRyaW0oKSkge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdOaWNrbmFtZSBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuYWRkcmVzcyAhPT0gdW5kZWZpbmVkICYmICFsb2NhdGlvbkRhdGEuYWRkcmVzcy50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnQWRkcmVzcyBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuc3VidXJiICE9PSB1bmRlZmluZWQgJiYgIWxvY2F0aW9uRGF0YS5zdWJ1cmIudHJpbSgpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ1N1YnVyYiBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuY2l0eSAhPT0gdW5kZWZpbmVkICYmICFsb2NhdGlvbkRhdGEuY2l0eS50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnQ2l0eSBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBHZXQgY3VycmVudCBsb2NhdGlvbiB0byBjaGVjayBjdXN0b21lciBlbWFpbFxyXG4gICAgY29uc3QgeyBkYXRhOiBjdXJyZW50TG9jYXRpb24sIGVycm9yOiBmZXRjaEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnbG9jYXRpb25zJylcclxuICAgICAgLnNlbGVjdCgnY3VzdG9tZXJfZW1haWwsIGN1c3RvbWVyX3Bob25lJylcclxuICAgICAgLmVxKCdpZCcsIGxvY2F0aW9uSWQpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoZmV0Y2hFcnJvciB8fCAhY3VycmVudExvY2F0aW9uKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0xvY2F0aW9uIG5vdCBmb3VuZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBJZiBzZXR0aW5nIGFzIGRlZmF1bHQsIHVuc2V0IGFsbCBvdGhlciBkZWZhdWx0cyBmb3IgdGhpcyBjdXN0b21lclxyXG4gICAgaWYgKGxvY2F0aW9uRGF0YS5pc19kZWZhdWx0KSB7XHJcbiAgICAgIGxldCB1cGRhdGVRdWVyeSA9IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ2xvY2F0aW9ucycpXHJcbiAgICAgICAgLnVwZGF0ZSh7IGlzX2RlZmF1bHQ6IGZhbHNlIH0pO1xyXG5cclxuICAgICAgaWYgKGN1cnJlbnRMb2NhdGlvbi5jdXN0b21lcl9lbWFpbCAmJiBjdXJyZW50TG9jYXRpb24uY3VzdG9tZXJfcGhvbmUpIHtcclxuICAgICAgICB1cGRhdGVRdWVyeSA9IHVwZGF0ZVF1ZXJ5Lm9yKGBjdXN0b21lcl9lbWFpbC5lcS4ke2N1cnJlbnRMb2NhdGlvbi5jdXN0b21lcl9lbWFpbH0sY3VzdG9tZXJfcGhvbmUuZXEuJHtjdXJyZW50TG9jYXRpb24uY3VzdG9tZXJfcGhvbmV9YCk7XHJcbiAgICAgIH0gZWxzZSBpZiAoY3VycmVudExvY2F0aW9uLmN1c3RvbWVyX2VtYWlsKSB7XHJcbiAgICAgICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5lcSgnY3VzdG9tZXJfZW1haWwnLCBjdXJyZW50TG9jYXRpb24uY3VzdG9tZXJfZW1haWwpO1xyXG4gICAgICB9IGVsc2UgaWYgKGN1cnJlbnRMb2NhdGlvbi5jdXN0b21lcl9waG9uZSkge1xyXG4gICAgICAgIHVwZGF0ZVF1ZXJ5ID0gdXBkYXRlUXVlcnkuZXEoJ2N1c3RvbWVyX3Bob25lJywgY3VycmVudExvY2F0aW9uLmN1c3RvbWVyX3Bob25lKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gRG9uJ3QgdW5zZXQgdGhlIGN1cnJlbnQgbG9jYXRpb25cclxuICAgICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5uZXEoJ2lkJywgbG9jYXRpb25JZCk7XHJcblxyXG4gICAgICBhd2FpdCB1cGRhdGVRdWVyeTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBCdWlsZCB1cGRhdGUgb2JqZWN0IHdpdGggb25seSBwcm92aWRlZCBmaWVsZHNcclxuICAgIGNvbnN0IHVwZGF0ZURhdGE6IGFueSA9IHtcclxuICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgfTtcclxuXHJcbiAgICBpZiAobG9jYXRpb25EYXRhLm5pY2tuYW1lICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgdXBkYXRlRGF0YS5uaWNrbmFtZSA9IGxvY2F0aW9uRGF0YS5uaWNrbmFtZS50cmltKCk7XHJcbiAgICB9XHJcbiAgICBpZiAobG9jYXRpb25EYXRhLmFkZHJlc3MgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB1cGRhdGVEYXRhLmFkZHJlc3MgPSBsb2NhdGlvbkRhdGEuYWRkcmVzcy50cmltKCk7XHJcbiAgICB9XHJcbiAgICBpZiAobG9jYXRpb25EYXRhLmFwdF91bml0ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgdXBkYXRlRGF0YS5hcHRfdW5pdCA9IGxvY2F0aW9uRGF0YS5hcHRfdW5pdD8udHJpbSgpIHx8IG51bGw7XHJcbiAgICB9XHJcbiAgICBpZiAobG9jYXRpb25EYXRhLnN1YnVyYiAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHVwZGF0ZURhdGEuc3VidXJiID0gbG9jYXRpb25EYXRhLnN1YnVyYi50cmltKCk7XHJcbiAgICB9XHJcbiAgICBpZiAobG9jYXRpb25EYXRhLmNpdHkgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB1cGRhdGVEYXRhLmNpdHkgPSBsb2NhdGlvbkRhdGEuY2l0eS50cmltKCk7XHJcbiAgICB9XHJcbiAgICBpZiAobG9jYXRpb25EYXRhLnBvc3RhbF9jb2RlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgdXBkYXRlRGF0YS5wb3N0YWxfY29kZSA9IGxvY2F0aW9uRGF0YS5wb3N0YWxfY29kZT8udHJpbSgpIHx8IG51bGw7XHJcbiAgICB9XHJcbiAgICBpZiAobG9jYXRpb25EYXRhLmlzX2RlZmF1bHQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB1cGRhdGVEYXRhLmlzX2RlZmF1bHQgPSBsb2NhdGlvbkRhdGEuaXNfZGVmYXVsdDtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB7IGRhdGE6IHVwZGF0ZWRMb2NhdGlvbiwgZXJyb3I6IHVwZGF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnbG9jYXRpb25zJylcclxuICAgICAgLnVwZGF0ZSh1cGRhdGVEYXRhKVxyXG4gICAgICAuZXEoJ2lkJywgbG9jYXRpb25JZClcclxuICAgICAgLnNlbGVjdCgpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICBpZiAodXBkYXRlRXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBkYXRpbmcgbG9jYXRpb246JywgdXBkYXRlRXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHVwZGF0ZUVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBsb2NhdGlvbjogdXBkYXRlZExvY2F0aW9uIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHVwZGF0ZUxvY2F0aW9uOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIHVwZGF0ZSBsb2NhdGlvbicsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGRlbGV0ZUxvY2F0aW9uKGxvY2F0aW9uSWQ6IHN0cmluZyk6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnbG9jYXRpb25zJylcclxuICAgICAgLmRlbGV0ZSgpXHJcbiAgICAgIC5lcSgnaWQnLCBsb2NhdGlvbklkKTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZGVsZXRpbmcgbG9jYXRpb246JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGRlbGV0ZUxvY2F0aW9uOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGRlbGV0ZSBsb2NhdGlvbicsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNldERlZmF1bHRMb2NhdGlvbihcclxuICBsb2NhdGlvbklkOiBzdHJpbmcsXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBwaG9uZT86IHN0cmluZ1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGxvY2F0aW9uPzogTG9jYXRpb247XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICAvLyBHZXQgY3VycmVudCBsb2NhdGlvbiB0byB2ZXJpZnkgb3duZXJzaGlwXHJcbiAgICBjb25zdCB7IGRhdGE6IGN1cnJlbnRMb2NhdGlvbiwgZXJyb3I6IGZldGNoRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdsb2NhdGlvbnMnKVxyXG4gICAgICAuc2VsZWN0KCdjdXN0b21lcl9lbWFpbCwgY3VzdG9tZXJfcGhvbmUnKVxyXG4gICAgICAuZXEoJ2lkJywgbG9jYXRpb25JZClcclxuICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgIGlmIChmZXRjaEVycm9yIHx8ICFjdXJyZW50TG9jYXRpb24pIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTG9jYXRpb24gbm90IGZvdW5kJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFZlcmlmeSBvd25lcnNoaXBcclxuICAgIGNvbnN0IGlzT3duZXIgPSBcclxuICAgICAgY3VycmVudExvY2F0aW9uLmN1c3RvbWVyX2VtYWlsID09PSBlbWFpbCB8fFxyXG4gICAgICAocGhvbmUgJiYgY3VycmVudExvY2F0aW9uLmN1c3RvbWVyX3Bob25lID09PSBwaG9uZSk7XHJcblxyXG4gICAgaWYgKCFpc093bmVyKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ1VuYXV0aG9yaXplZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBVbnNldCBhbGwgb3RoZXIgZGVmYXVsdHMgZm9yIHRoaXMgY3VzdG9tZXJcclxuICAgIGxldCB1cGRhdGVRdWVyeSA9IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdsb2NhdGlvbnMnKVxyXG4gICAgICAudXBkYXRlKHsgaXNfZGVmYXVsdDogZmFsc2UgfSk7XHJcblxyXG4gICAgaWYgKGVtYWlsICYmIHBob25lKSB7XHJcbiAgICAgIHVwZGF0ZVF1ZXJ5ID0gdXBkYXRlUXVlcnkub3IoYGN1c3RvbWVyX2VtYWlsLmVxLiR7ZW1haWx9LGN1c3RvbWVyX3Bob25lLmVxLiR7cGhvbmV9YCk7XHJcbiAgICB9IGVsc2UgaWYgKGVtYWlsKSB7XHJcbiAgICAgIHVwZGF0ZVF1ZXJ5ID0gdXBkYXRlUXVlcnkuZXEoJ2N1c3RvbWVyX2VtYWlsJywgZW1haWwpO1xyXG4gICAgfSBlbHNlIGlmIChwaG9uZSkge1xyXG4gICAgICB1cGRhdGVRdWVyeSA9IHVwZGF0ZVF1ZXJ5LmVxKCdjdXN0b21lcl9waG9uZScsIHBob25lKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBEb24ndCB1bnNldCB0aGUgY3VycmVudCBsb2NhdGlvblxyXG4gICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5uZXEoJ2lkJywgbG9jYXRpb25JZCk7XHJcblxyXG4gICAgYXdhaXQgdXBkYXRlUXVlcnk7XHJcblxyXG4gICAgLy8gU2V0IHRoaXMgbG9jYXRpb24gYXMgZGVmYXVsdFxyXG4gICAgY29uc3QgeyBkYXRhOiB1cGRhdGVkTG9jYXRpb24sIGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2xvY2F0aW9ucycpXHJcbiAgICAgIC51cGRhdGUoeyBpc19kZWZhdWx0OiB0cnVlIH0pXHJcbiAgICAgIC5lcSgnaWQnLCBsb2NhdGlvbklkKVxyXG4gICAgICAuc2VsZWN0KClcclxuICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgIGlmICh1cGRhdGVFcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBzZXR0aW5nIGRlZmF1bHQgbG9jYXRpb246JywgdXBkYXRlRXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHVwZGF0ZUVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBsb2NhdGlvbjogdXBkYXRlZExvY2F0aW9uIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHNldERlZmF1bHRMb2NhdGlvbjonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBzZXQgZGVmYXVsdCBsb2NhdGlvbicsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldE9yQ3JlYXRlUmVmZXJyYWxDb2RlKFxyXG4gIGVtYWlsOiBzdHJpbmdcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICByZWZlcnJhbENvZGU/OiBzdHJpbmc7XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICAvLyBDaGVjayBpZiBwcm9maWxlIGV4aXN0cyBhbmQgaGFzIGEgcmVmZXJyYWwgY29kZVxyXG4gICAgY29uc3QgeyBkYXRhOiBwcm9maWxlLCBlcnJvcjogcHJvZmlsZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAuc2VsZWN0KCdyZWZlcnJhbF9jb2RlJylcclxuICAgICAgLmVxKCdlbWFpbCcsIGVtYWlsKVxyXG4gICAgICAubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgICBpZiAocHJvZmlsZUVycm9yICYmIHByb2ZpbGVFcnJvci5jb2RlICE9PSAnUEdSU1QxMTYnKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIHByb2ZpbGU6JywgcHJvZmlsZUVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBwcm9maWxlRXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIElmIHByb2ZpbGUgZXhpc3RzIGFuZCBoYXMgYSByZWZlcnJhbCBjb2RlLCByZXR1cm4gaXRcclxuICAgIGlmIChwcm9maWxlPy5yZWZlcnJhbF9jb2RlKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHJlZmVycmFsQ29kZTogcHJvZmlsZS5yZWZlcnJhbF9jb2RlIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gR2VuZXJhdGUgYSBuZXcgcmVmZXJyYWwgY29kZVxyXG4gICAgLy8gVHJ5IHVzaW5nIHRoZSBkYXRhYmFzZSBmdW5jdGlvbiBmaXJzdCwgYnV0IGZhbGxiYWNrIHRvIGNsaWVudC1zaWRlIGdlbmVyYXRpb25cclxuICAgIGxldCBnZW5lcmF0ZWRDb2RlOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcclxuICAgIFxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgeyBkYXRhOiBkYkNvZGUsIGVycm9yOiBjb2RlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLnJwYygnZ2VuZXJhdGVfcmVmZXJyYWxfY29kZScpO1xyXG4gICAgICBcclxuICAgICAgaWYgKCFjb2RlRXJyb3IgJiYgZGJDb2RlKSB7XHJcbiAgICAgICAgZ2VuZXJhdGVkQ29kZSA9IGRiQ29kZTtcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAocnBjRXJyb3IpIHtcclxuICAgICAgLy8gUlBDIGZ1bmN0aW9uIG1pZ2h0IG5vdCBleGlzdCB5ZXQsIHRoYXQncyBva2F5XHJcbiAgICAgIGNvbnNvbGUubG9nKCdSUEMgZnVuY3Rpb24gbm90IGF2YWlsYWJsZSwgdXNpbmcgZmFsbGJhY2snKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIWdlbmVyYXRlZENvZGUpIHtcclxuICAgICAgLy8gRmFsbGJhY2s6IGdlbmVyYXRlIGNvZGUgY2xpZW50LXNpZGUgc3R5bGVcclxuICAgICAgY29uc3QgZmFsbGJhY2tDb2RlID0gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIsIDgpLnRvVXBwZXJDYXNlKCk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBDaGVjayBpZiBmYWxsYmFjayBjb2RlIGV4aXN0cywgcmV0cnkgaWYgaXQgZG9lc1xyXG4gICAgICBsZXQgZmluYWxDb2RlID0gZmFsbGJhY2tDb2RlO1xyXG4gICAgICBsZXQgYXR0ZW1wdHMgPSAwO1xyXG4gICAgICBjb25zdCBtYXhBdHRlbXB0cyA9IDU7XHJcblxyXG4gICAgICB3aGlsZSAoYXR0ZW1wdHMgPCBtYXhBdHRlbXB0cykge1xyXG4gICAgICAgIGNvbnN0IHsgZGF0YTogZXhpc3RpbmcgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgICAgLnNlbGVjdCgnaWQnKVxyXG4gICAgICAgICAgLmVxKCdyZWZlcnJhbF9jb2RlJywgZmluYWxDb2RlKVxyXG4gICAgICAgICAgLm1heWJlU2luZ2xlKCk7XHJcblxyXG4gICAgICAgIGlmICghZXhpc3RpbmcpIHtcclxuICAgICAgICAgIGJyZWFrOyAvLyBDb2RlIGlzIHVuaXF1ZVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gR2VuZXJhdGUgYSBuZXcgY29kZVxyXG4gICAgICAgIGZpbmFsQ29kZSA9IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cmluZygyLCA4KS50b1VwcGVyQ2FzZSgpO1xyXG4gICAgICAgIGF0dGVtcHRzKys7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIFVwZGF0ZSBvciBpbnNlcnQgcHJvZmlsZSB3aXRoIHJlZmVycmFsIGNvZGVcclxuICAgICAgLy8gRmlyc3QsIHRyeSB0byB1cGRhdGUgZXhpc3RpbmcgcHJvZmlsZVxyXG4gICAgICBjb25zdCB7IGRhdGE6IGV4aXN0aW5nUHJvZmlsZSB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgIC5zZWxlY3QoJ2lkLCBmaXJzdF9uYW1lLCBsYXN0X25hbWUnKVxyXG4gICAgICAgIC5lcSgnZW1haWwnLCBlbWFpbClcclxuICAgICAgICAubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgICAgIGxldCB1cGRhdGVkUHJvZmlsZTtcclxuICAgICAgaWYgKGV4aXN0aW5nUHJvZmlsZSkge1xyXG4gICAgICAgIC8vIFVwZGF0ZSBleGlzdGluZyBwcm9maWxlXHJcbiAgICAgICAgY29uc3QgeyBkYXRhOiB1cGRhdGVkLCBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgICAgLnVwZGF0ZSh7XHJcbiAgICAgICAgICAgIHJlZmVycmFsX2NvZGU6IGZpbmFsQ29kZSxcclxuICAgICAgICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgICAgICAgfSlcclxuICAgICAgICAgIC5lcSgnZW1haWwnLCBlbWFpbClcclxuICAgICAgICAgIC5zZWxlY3QoJ3JlZmVycmFsX2NvZGUnKVxyXG4gICAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgICBpZiAodXBkYXRlRXJyb3IpIHtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHVwZGF0aW5nIHJlZmVycmFsIGNvZGU6JywgdXBkYXRlRXJyb3IpO1xyXG4gICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB1cGRhdGVFcnJvci5tZXNzYWdlIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHVwZGF0ZWRQcm9maWxlID0gdXBkYXRlZDtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBJbnNlcnQgbmV3IHByb2ZpbGUgd2l0aCByZWZlcnJhbCBjb2RlXHJcbiAgICAgICAgY29uc3QgeyBkYXRhOiBpbnNlcnRlZCwgZXJyb3I6IGluc2VydEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcclxuICAgICAgICAgIC5pbnNlcnQoe1xyXG4gICAgICAgICAgICBlbWFpbCxcclxuICAgICAgICAgICAgcmVmZXJyYWxfY29kZTogZmluYWxDb2RlLFxyXG4gICAgICAgICAgICBmaXJzdF9uYW1lOiBlbWFpbC5zcGxpdCgnQCcpWzBdLFxyXG4gICAgICAgICAgICBsYXN0X25hbWU6ICcnLFxyXG4gICAgICAgICAgfSlcclxuICAgICAgICAgIC5zZWxlY3QoJ3JlZmVycmFsX2NvZGUnKVxyXG4gICAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgICBpZiAoaW5zZXJ0RXJyb3IpIHtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIHJlZmVycmFsIGNvZGU6JywgaW5zZXJ0RXJyb3IpO1xyXG4gICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBpbnNlcnRFcnJvci5tZXNzYWdlIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHVwZGF0ZWRQcm9maWxlID0gaW5zZXJ0ZWQ7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHJlZmVycmFsQ29kZTogdXBkYXRlZFByb2ZpbGU/LnJlZmVycmFsX2NvZGUgfHwgZmluYWxDb2RlIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVXNlIHRoZSBnZW5lcmF0ZWQgY29kZSBmcm9tIGRhdGFiYXNlIGZ1bmN0aW9uXHJcbiAgICAvLyBVcGRhdGUgb3IgaW5zZXJ0IHByb2ZpbGUgd2l0aCBnZW5lcmF0ZWQgY29kZVxyXG4gICAgY29uc3QgeyBkYXRhOiBleGlzdGluZ1Byb2ZpbGUgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgIC5zZWxlY3QoJ2lkLCBmaXJzdF9uYW1lLCBsYXN0X25hbWUnKVxyXG4gICAgICAuZXEoJ2VtYWlsJywgZW1haWwpXHJcbiAgICAgIC5tYXliZVNpbmdsZSgpO1xyXG5cclxuICAgIGxldCB1cGRhdGVkUHJvZmlsZTtcclxuICAgIGlmIChleGlzdGluZ1Byb2ZpbGUpIHtcclxuICAgICAgLy8gVXBkYXRlIGV4aXN0aW5nIHByb2ZpbGVcclxuICAgICAgY29uc3QgeyBkYXRhOiB1cGRhdGVkLCBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcclxuICAgICAgICAudXBkYXRlKHtcclxuICAgICAgICAgIHJlZmVycmFsX2NvZGU6IGdlbmVyYXRlZENvZGUsXHJcbiAgICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgfSlcclxuICAgICAgICAuZXEoJ2VtYWlsJywgZW1haWwpXHJcbiAgICAgICAgLnNlbGVjdCgncmVmZXJyYWxfY29kZScpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgaWYgKHVwZGF0ZUVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBkYXRpbmcgcmVmZXJyYWwgY29kZTonLCB1cGRhdGVFcnJvcik7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB1cGRhdGVFcnJvci5tZXNzYWdlIH07XHJcbiAgICAgIH1cclxuICAgICAgdXBkYXRlZFByb2ZpbGUgPSB1cGRhdGVkO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8gSW5zZXJ0IG5ldyBwcm9maWxlIHdpdGggcmVmZXJyYWwgY29kZVxyXG4gICAgICBjb25zdCB7IGRhdGE6IGluc2VydGVkLCBlcnJvcjogaW5zZXJ0RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcclxuICAgICAgICAuaW5zZXJ0KHtcclxuICAgICAgICAgIGVtYWlsLFxyXG4gICAgICAgICAgcmVmZXJyYWxfY29kZTogZ2VuZXJhdGVkQ29kZSxcclxuICAgICAgICAgIGZpcnN0X25hbWU6IGVtYWlsLnNwbGl0KCdAJylbMF0sXHJcbiAgICAgICAgICBsYXN0X25hbWU6ICcnLFxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnNlbGVjdCgncmVmZXJyYWxfY29kZScpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgaWYgKGluc2VydEVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYXRpbmcgcmVmZXJyYWwgY29kZTonLCBpbnNlcnRFcnJvcik7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBpbnNlcnRFcnJvci5tZXNzYWdlIH07XHJcbiAgICAgIH1cclxuICAgICAgdXBkYXRlZFByb2ZpbGUgPSBpbnNlcnRlZDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCByZWZlcnJhbENvZGU6IHVwZGF0ZWRQcm9maWxlPy5yZWZlcnJhbF9jb2RlIHx8IGdlbmVyYXRlZENvZGUgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gZ2V0T3JDcmVhdGVSZWZlcnJhbENvZGU6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gZ2V0IHJlZmVycmFsIGNvZGUnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZW5kUmVmZXJyYWxJbnZpdGVzKFxyXG4gIGVtYWlsOiBzdHJpbmcsXHJcbiAgaW52aXRlRW1haWxzOiBzdHJpbmdbXSxcclxuICByZWZlcnJhbENvZGU6IHN0cmluZ1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIHNlbnQ/OiBudW1iZXI7XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICAvLyBWYWxpZGF0ZSBlbWFpbCBhZGRyZXNzZXNcclxuICAgIGNvbnN0IHZhbGlkRW1haWxzID0gaW52aXRlRW1haWxzXHJcbiAgICAgIC5tYXAoKGUpID0+IGUudHJpbSgpKVxyXG4gICAgICAuZmlsdGVyKChlKSA9PiB7XHJcbiAgICAgICAgaWYgKCFlKSByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgcmV0dXJuIC9eW15cXHNAXStAW15cXHNAXStcXC5bXlxcc0BdKyQvLnRlc3QoZSk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgIGlmICh2YWxpZEVtYWlscy5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTm8gdmFsaWQgZW1haWwgYWRkcmVzc2VzIHByb3ZpZGVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENyZWF0ZSByZWZlcnJhbCByZWNvcmRzIGZvciB0cmFja2luZ1xyXG4gICAgY29uc3QgcmVmZXJyYWxSZWNvcmRzID0gdmFsaWRFbWFpbHMubWFwKChyZWZlcnJlZEVtYWlsKSA9PiAoe1xyXG4gICAgICByZWZlcnJlcl9lbWFpbDogZW1haWwsXHJcbiAgICAgIHJlZmVycmVkX2VtYWlsOiByZWZlcnJlZEVtYWlsLFxyXG4gICAgICByZWZlcnJhbF9jb2RlOiByZWZlcnJhbENvZGUsXHJcbiAgICAgIHN0YXR1czogJ3BlbmRpbmcnLFxyXG4gICAgfSkpO1xyXG5cclxuICAgIGNvbnN0IHsgZXJyb3I6IGluc2VydEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgncmVmZXJyYWxzJylcclxuICAgICAgLmluc2VydChyZWZlcnJhbFJlY29yZHMpO1xyXG5cclxuICAgIGlmIChpbnNlcnRFcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjcmVhdGluZyByZWZlcnJhbCByZWNvcmRzOicsIGluc2VydEVycm9yKTtcclxuICAgICAgLy8gQ29udGludWUgZXZlbiBpZiBpbnNlcnQgZmFpbHMgLSB3ZSBzdGlsbCB3YW50IHRvIHNlbmQgZW1haWxzXHJcbiAgICB9XHJcblxyXG4gICAgLy8gR2VuZXJhdGUgcmVmZXJyYWwgbGlua1xyXG4gICAgY29uc3QgYmFzZVVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NJVEVfVVJMIHx8ICdodHRwczovL3NoYWxlYW4uY28uemEnO1xyXG4gICAgY29uc3QgcmVmZXJyYWxMaW5rID0gYCR7YmFzZVVybH0vYm9va2luZy9kZXRhaWxzP3JlZj0ke3JlZmVycmFsQ29kZX1gO1xyXG5cclxuICAgIC8vIFRPRE86IEltcGxlbWVudCBhY3R1YWwgZW1haWwgc2VuZGluZyB1c2luZyB5b3VyIGVtYWlsIHNlcnZpY2UgKFJlc2VuZCwgU2VuZEdyaWQsIGV0Yy4pXHJcbiAgICAvLyBGb3Igbm93LCB3ZSdsbCBqdXN0IGxvZyB0aGUgZW1haWxzIHRoYXQgd291bGQgYmUgc2VudFxyXG4gICAgY29uc29sZS5sb2coJ1JlZmVycmFsIGludml0ZXMgdG8gc2VuZDonLCB7XHJcbiAgICAgIGZyb206IGVtYWlsLFxyXG4gICAgICB0bzogdmFsaWRFbWFpbHMsXHJcbiAgICAgIHJlZmVycmFsQ29kZSxcclxuICAgICAgcmVmZXJyYWxMaW5rLFxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gSW4gYSByZWFsIGltcGxlbWVudGF0aW9uLCB5b3Ugd291bGQgc2VuZCBlbWFpbHMgaGVyZVxyXG4gICAgLy8gRXhhbXBsZSB3aXRoIFJlc2VuZDpcclxuICAgIC8vIGF3YWl0IHJlc2VuZC5lbWFpbHMuc2VuZCh7XHJcbiAgICAvLyAgIGZyb206ICdTaGFsZWFuIDxub3JlcGx5QHNoYWxlYW4uY28uemE+JyxcclxuICAgIC8vICAgdG86IHZhbGlkRW1haWxzLFxyXG4gICAgLy8gICBzdWJqZWN0OiAnWW91XFwndmUgYmVlbiBpbnZpdGVkIHRvIHRyeSBTaGFsZWFuIENsZWFuaW5nIFNlcnZpY2VzIScsXHJcbiAgICAvLyAgIGh0bWw6IGA8cD5Zb3VyIGZyaWVuZCBoYXMgaW52aXRlZCB5b3UgdG8gdHJ5IFNoYWxlYW4uIFVzZSBjb2RlICR7cmVmZXJyYWxDb2RlfSB0byBnZXQgUjE1MCBvZmYgeW91ciBmaXJzdCBib29raW5nITwvcD48cD48YSBocmVmPVwiJHtyZWZlcnJhbExpbmt9XCI+Qm9vayBOb3c8L2E+PC9wPmAsXHJcbiAgICAvLyB9KTtcclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBzZW50OiB2YWxpZEVtYWlscy5sZW5ndGggfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gc2VuZFJlZmVycmFsSW52aXRlczonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBzZW5kIGludml0ZXMnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRSZWZlcnJhbFN0YXRzKFxyXG4gIGVtYWlsOiBzdHJpbmdcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBzdGF0cz86IHtcclxuICAgIHRvdGFsUmVmZXJyYWxzOiBudW1iZXI7XHJcbiAgICBjb21wbGV0ZWRSZWZlcnJhbHM6IG51bWJlcjtcclxuICAgIHBlbmRpbmdSZXdhcmRzOiBudW1iZXI7XHJcbiAgICB0b3RhbFJld2FyZHM6IG51bWJlcjtcclxuICB9O1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgY29uc3QgeyBkYXRhOiByZWZlcnJhbHMsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgncmVmZXJyYWxzJylcclxuICAgICAgLnNlbGVjdCgnc3RhdHVzLCByZWZlcnJlcl9yZXdhcmRfYW1vdW50LCByZWZlcnJlcl9yZXdhcmRfc3RhdHVzJylcclxuICAgICAgLmVxKCdyZWZlcnJlcl9lbWFpbCcsIGVtYWlsKTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgcmVmZXJyYWwgc3RhdHM6JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBzdGF0cyA9IHtcclxuICAgICAgdG90YWxSZWZlcnJhbHM6IHJlZmVycmFscz8ubGVuZ3RoIHx8IDAsXHJcbiAgICAgIGNvbXBsZXRlZFJlZmVycmFsczpcclxuICAgICAgICByZWZlcnJhbHM/LmZpbHRlcigocikgPT4gci5zdGF0dXMgPT09ICdjb21wbGV0ZWQnKS5sZW5ndGggfHwgMCxcclxuICAgICAgcGVuZGluZ1Jld2FyZHM6XHJcbiAgICAgICAgcmVmZXJyYWxzPy5maWx0ZXIoKHIpID0+IHIucmVmZXJyZXJfcmV3YXJkX3N0YXR1cyA9PT0gJ3BlbmRpbmcnKS5sZW5ndGggfHwgMCxcclxuICAgICAgdG90YWxSZXdhcmRzOlxyXG4gICAgICAgIHJlZmVycmFsc1xyXG4gICAgICAgICAgPy5maWx0ZXIoKHIpID0+IHIucmVmZXJyZXJfcmV3YXJkX3N0YXR1cyA9PT0gJ2NyZWRpdGVkJylcclxuICAgICAgICAgIC5yZWR1Y2UoKHN1bSwgcikgPT4gc3VtICsgKHIucmVmZXJyZXJfcmV3YXJkX2Ftb3VudCB8fCAwKSwgMCkgfHwgMCxcclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgc3RhdHMgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gZ2V0UmVmZXJyYWxTdGF0czonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBmZXRjaCByZWZlcnJhbCBzdGF0cycsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIEluaXRpYWxpemUgYSBjcmVkaXQgcHVyY2hhc2Ugd2l0aCBQYXlzdGFja1xyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGluaXRpYWxpemVDcmVkaXRQdXJjaGFzZShcclxuICBlbWFpbDogc3RyaW5nLFxyXG4gIGFtb3VudDogbnVtYmVyLFxyXG4gIHBheW1lbnRNZXRob2Q6ICdjcmVkaXRfY2FyZCcgfCAnZWZ0J1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGF1dGhvcml6YXRpb25Vcmw/OiBzdHJpbmc7XHJcbiAgcmVmZXJlbmNlPzogc3RyaW5nO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGlmIChhbW91bnQgPCAyMCB8fCBhbW91bnQgPiA1MDAwKSB7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6ICdBbW91bnQgbXVzdCBiZSBiZXR3ZWVuIFIyMCBhbmQgUjUwMDAnLFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEdlbmVyYXRlIGEgdW5pcXVlIHJlZmVyZW5jZSBmb3IgdGhpcyBjcmVkaXQgcHVyY2hhc2VcclxuICAgIGNvbnN0IHJlZmVyZW5jZSA9IGBDUkVESVRfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cmluZygyLCA5KX1gO1xyXG5cclxuICAgIC8vIENyZWF0ZSBhIHBlbmRpbmcgY3JlZGl0IHRyYW5zYWN0aW9uXHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG4gICAgXHJcbiAgICAvLyBHZXQgb3IgY3JlYXRlIHByb2ZpbGVcclxuICAgIGxldCB7IGRhdGE6IHByb2ZpbGUgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgIC5zZWxlY3QoJ2lkLCBjcmVkaXRfYmFsYW5jZScpXHJcbiAgICAgIC5lcSgnZW1haWwnLCBlbWFpbClcclxuICAgICAgLm1heWJlU2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKCFwcm9maWxlKSB7XHJcbiAgICAgIC8vIENyZWF0ZSBhIGJhc2ljIHByb2ZpbGUgaWYgaXQgZG9lc24ndCBleGlzdFxyXG4gICAgICBjb25zdCB7IGRhdGE6IG5ld1Byb2ZpbGUsIGVycm9yOiBjcmVhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgIC5pbnNlcnQoe1xyXG4gICAgICAgICAgZW1haWwsXHJcbiAgICAgICAgICBjcmVkaXRfYmFsYW5jZTogMCxcclxuICAgICAgICAgIGZpcnN0X25hbWU6ICcnLFxyXG4gICAgICAgICAgbGFzdF9uYW1lOiAnJyxcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5zZWxlY3QoJ2lkLCBjcmVkaXRfYmFsYW5jZScpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgaWYgKGNyZWF0ZUVycm9yIHx8ICFuZXdQcm9maWxlKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgZXJyb3I6ICdGYWlsZWQgdG8gY3JlYXRlIHByb2ZpbGUnLFxyXG4gICAgICAgIH07XHJcbiAgICAgIH1cclxuICAgICAgcHJvZmlsZSA9IG5ld1Byb2ZpbGU7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ3JlYXRlIHBlbmRpbmcgY3JlZGl0IHRyYW5zYWN0aW9uXHJcbiAgICBjb25zdCB7IGVycm9yOiB0cmFuc2FjdGlvbkVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnY3JlZGl0X3RyYW5zYWN0aW9ucycpXHJcbiAgICAgIC5pbnNlcnQoe1xyXG4gICAgICAgIHByb2ZpbGVfaWQ6IHByb2ZpbGUuaWQsXHJcbiAgICAgICAgZW1haWwsXHJcbiAgICAgICAgdHJhbnNhY3Rpb25fdHlwZTogJ3B1cmNoYXNlJyxcclxuICAgICAgICBhbW91bnQsXHJcbiAgICAgICAgYmFsYW5jZV9iZWZvcmU6IHByb2ZpbGUuY3JlZGl0X2JhbGFuY2UgfHwgMCxcclxuICAgICAgICBiYWxhbmNlX2FmdGVyOiBwcm9maWxlLmNyZWRpdF9iYWxhbmNlIHx8IDAsIC8vIFdvbid0IHVwZGF0ZSB1bnRpbCBwYXltZW50IHN1Y2NlZWRzXHJcbiAgICAgICAgcGF5bWVudF9tZXRob2Q6IHBheW1lbnRNZXRob2QsXHJcbiAgICAgICAgcGF5c3RhY2tfcmVmZXJlbmNlOiByZWZlcmVuY2UsXHJcbiAgICAgICAgcGF5bWVudF9zdGF0dXM6ICdwZW5kaW5nJyxcclxuICAgICAgICBkZXNjcmlwdGlvbjogYFB1cmNoYXNlIG9mIFIke2Ftb3VudH0gU2hhbGVhbkNyZWRgLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICBpZiAodHJhbnNhY3Rpb25FcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjcmVhdGluZyBjcmVkaXQgdHJhbnNhY3Rpb246JywgdHJhbnNhY3Rpb25FcnJvcik7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6ICdGYWlsZWQgdG8gY3JlYXRlIHRyYW5zYWN0aW9uIHJlY29yZCcsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gSW5pdGlhbGl6ZSBQYXlzdGFjayBwYXltZW50XHJcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKCcvYXBpL3BheXN0YWNrL2luaXRpYWxpemUnLCB7XHJcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgfSxcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIGVtYWlsLFxyXG4gICAgICAgIGFtb3VudCxcclxuICAgICAgICByZWZlcmVuY2UsXHJcbiAgICAgICAgbWV0YWRhdGE6IHtcclxuICAgICAgICAgIHRyYW5zYWN0aW9uX3R5cGU6ICdjcmVkaXRfcHVyY2hhc2UnLFxyXG4gICAgICAgICAgcGF5bWVudF9tZXRob2Q6IHBheW1lbnRNZXRob2QsXHJcbiAgICAgICAgfSxcclxuICAgICAgfSksXHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XHJcbiAgICAgIGNvbnN0IGVycm9yID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIGVycm9yOiBlcnJvci5lcnJvciB8fCAnRmFpbGVkIHRvIGluaXRpYWxpemUgcGF5bWVudCcsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcGF5bWVudERhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XHJcblxyXG4gICAgaWYgKCFwYXltZW50RGF0YS5zdGF0dXMpIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogcGF5bWVudERhdGEubWVzc2FnZSB8fCAnRmFpbGVkIHRvIGluaXRpYWxpemUgcGF5bWVudCcsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgYXV0aG9yaXphdGlvblVybDogcGF5bWVudERhdGEuZGF0YS5hdXRob3JpemF0aW9uX3VybCxcclxuICAgICAgcmVmZXJlbmNlOiBwYXltZW50RGF0YS5kYXRhLnJlZmVyZW5jZSxcclxuICAgIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluaXRpYWxpemluZyBjcmVkaXQgcHVyY2hhc2U6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gaW5pdGlhbGl6ZSBwYXltZW50JyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFZvdWNoZXJSZWRlbXB0aW9uIHtcclxuICBpZDogc3RyaW5nO1xyXG4gIHZvdWNoZXJfY29kZTogc3RyaW5nO1xyXG4gIGFtb3VudDogbnVtYmVyO1xyXG4gIHJlZGVlbWVkX2F0OiBzdHJpbmc7XHJcbiAgYm9va2luZ19pZD86IHN0cmluZztcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJlZGVlbVZvdWNoZXIoXHJcbiAgY29kZTogc3RyaW5nLFxyXG4gIGVtYWlsOiBzdHJpbmcsXHJcbiAgcGhvbmU/OiBzdHJpbmdcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBhbW91bnQ/OiBudW1iZXI7XHJcbiAgbmV3QmFsYW5jZT86IG51bWJlcjtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIENhbGwgdGhlIGRhdGFiYXNlIGZ1bmN0aW9uIHRvIHJlZGVlbSB0aGUgdm91Y2hlclxyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UucnBjKCdyZWRlZW1fdm91Y2hlcicsIHtcclxuICAgICAgcF9jb2RlOiBjb2RlLnRyaW0oKS50b1VwcGVyQ2FzZSgpLFxyXG4gICAgICBwX2VtYWlsOiBlbWFpbC50cmltKCksXHJcbiAgICAgIHBfcGhvbmU6IHBob25lPy50cmltKCkgfHwgbnVsbCxcclxuICAgIH0pO1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciByZWRlZW1pbmcgdm91Y2hlcjonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byByZWRlZW0gdm91Y2hlcicsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gUGFyc2UgdGhlIHJlc3VsdCBmcm9tIHRoZSBmdW5jdGlvbiAoaGFuZGxlIGJvdGggb2JqZWN0IGFuZCBzdHJpbmcgSlNPTkIpXHJcbiAgICBsZXQgcmVzdWx0ID0gZGF0YTtcclxuICAgIGlmICh0eXBlb2YgZGF0YSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICByZXN1bHQgPSBKU09OLnBhcnNlKGRhdGEpO1xyXG4gICAgICB9IGNhdGNoIChwYXJzZUVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgcGFyc2luZyB2b3VjaGVyIHJlZGVtcHRpb24gcmVzdWx0OicsIHBhcnNlRXJyb3IpO1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgIGVycm9yOiAnSW52YWxpZCByZXNwb25zZSBmcm9tIHNlcnZlcicsXHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGlmIChyZXN1bHQgJiYgdHlwZW9mIHJlc3VsdCA9PT0gJ29iamVjdCcgJiYgJ3N1Y2Nlc3MnIGluIHJlc3VsdCkge1xyXG4gICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgZXJyb3I6IHJlc3VsdC5lcnJvciB8fCAnRmFpbGVkIHRvIHJlZGVlbSB2b3VjaGVyJyxcclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcblxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgYW1vdW50OiByZXN1bHQuYW1vdW50LFxyXG4gICAgICAgIG5ld0JhbGFuY2U6IHJlc3VsdC5uZXdfYmFsYW5jZSxcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6ICdVbmV4cGVjdGVkIHJlc3BvbnNlIGZyb20gc2VydmVyJyxcclxuICAgIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHJlZGVlbVZvdWNoZXI6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gcmVkZWVtIHZvdWNoZXInLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRWb3VjaGVyUmVkZW1wdGlvbnMoXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBwaG9uZT86IHN0cmluZ1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIHJlZGVtcHRpb25zPzogVm91Y2hlclJlZGVtcHRpb25bXTtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIGxldCBxdWVyeSA9IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCd2b3VjaGVyX3JlZGVtcHRpb25zJylcclxuICAgICAgLnNlbGVjdCgnaWQsIHZvdWNoZXJfY29kZSwgYW1vdW50LCByZWRlZW1lZF9hdCwgYm9va2luZ19pZCcpXHJcbiAgICAgIC5vcmRlcigncmVkZWVtZWRfYXQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSk7XHJcblxyXG4gICAgLy8gQnVpbGQgcXVlcnkgZm9yIGVtYWlsL3Bob25lIGxvb2t1cFxyXG4gICAgLy8gUHJpb3JpdGl6ZSBlbWFpbCBhcyBpdCdzIHRoZSBwcmltYXJ5IGlkZW50aWZpZXIgdG8gcHJldmVudCBjcm9zcy1hY2NvdW50IHZpc2liaWxpdHlcclxuICAgIGlmIChlbWFpbCkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdlbWFpbCcsIGVtYWlsKTtcclxuICAgICAgLy8gSWYgcGhvbmUgaXMgYWxzbyBwcm92aWRlZCwgd2UgY2FuIG9wdGlvbmFsbHkgZmlsdGVyIGJ5IGJvdGggZm9yIGV4dHJhIHNlY3VyaXR5XHJcbiAgICAgIC8vIGJ1dCBlbWFpbCBhbG9uZSBzaG91bGQgYmUgc3VmZmljaWVudCBzaW5jZSBpdCdzIHVuaXF1ZVxyXG4gICAgfSBlbHNlIGlmIChwaG9uZSkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdwaG9uZScsIHBob25lKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0VtYWlsIG9yIHBob25lIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHF1ZXJ5O1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyB2b3VjaGVyIHJlZGVtcHRpb25zOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVHJhbnNmb3JtIHRoZSBkYXRhIHRvIG1hdGNoIHRoZSBpbnRlcmZhY2VcclxuICAgIGNvbnN0IHJlZGVtcHRpb25zOiBWb3VjaGVyUmVkZW1wdGlvbltdID0gKGRhdGEgfHwgW10pLm1hcCgocmVkZW1wdGlvbikgPT4gKHtcclxuICAgICAgaWQ6IHJlZGVtcHRpb24uaWQsXHJcbiAgICAgIHZvdWNoZXJfY29kZTogcmVkZW1wdGlvbi52b3VjaGVyX2NvZGUsXHJcbiAgICAgIGFtb3VudDogcmVkZW1wdGlvbi5hbW91bnQsXHJcbiAgICAgIHJlZGVlbWVkX2F0OiByZWRlbXB0aW9uLnJlZGVlbWVkX2F0LFxyXG4gICAgICBib29raW5nX2lkOiByZWRlbXB0aW9uLmJvb2tpbmdfaWQgfHwgdW5kZWZpbmVkLFxyXG4gICAgfSkpO1xyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHJlZGVtcHRpb25zIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGdldFZvdWNoZXJSZWRlbXB0aW9uczonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBmZXRjaCB2b3VjaGVyIHJlZGVtcHRpb25zJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG4iXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IitSQTRLc0IsK0xBQUEifQ==
}),
"[project]/app/dashboard/data:9f8a2b [app-ssr] (ecmascript) <text/javascript>", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "updateCustomerProfile",
    ()=>$$RSC_SERVER_ACTION_7
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-ssr] (ecmascript)");
/* __next_internal_action_entry_do_not_use__ [{"601814a93ae97943fba4e2304e5c5cf022cae486fb":"updateCustomerProfile"},"app/dashboard/actions.ts",""] */ "use turbopack no side effects";
;
const $$RSC_SERVER_ACTION_7 = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["createServerReference"])("601814a93ae97943fba4e2304e5c5cf022cae486fb", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["findSourceMapURL"], "updateCustomerProfile");
;
 //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vYWN0aW9ucy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHNlcnZlcic7XHJcblxyXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAL2xpYi9zdXBhYmFzZS9zZXJ2ZXInO1xyXG5pbXBvcnQgeyBjcmVhdGVBZG1pbkNsaWVudCB9IGZyb20gJ0AvbGliL3N1cGFiYXNlL3NlcnZlci1hZG1pbic7XHJcbmltcG9ydCB7IEJvb2tpbmcgfSBmcm9tICdAL3R5cGVzL2Jvb2tpbmcnO1xyXG5pbXBvcnQgeyBQcm9maWxlLCBQcm9maWxlVXBkYXRlSW5wdXQgfSBmcm9tICdAL3R5cGVzL3Byb2ZpbGUnO1xyXG5pbXBvcnQgeyBMb2NhdGlvbiwgTG9jYXRpb25DcmVhdGVJbnB1dCwgTG9jYXRpb25VcGRhdGVJbnB1dCB9IGZyb20gJ0AvdHlwZXMvbG9jYXRpb24nO1xyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEF1dGhlbnRpY2F0ZWRVc2VyKCk6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgZW1haWw/OiBzdHJpbmc7XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuICAgIGNvbnN0IHsgZGF0YTogeyB1c2VyIH0sIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcclxuXHJcbiAgICBpZiAoZXJyb3IgfHwgIXVzZXIpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTm90IGF1dGhlbnRpY2F0ZWQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgZW1haWw6IHVzZXIuZW1haWwgfHwgdW5kZWZpbmVkIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGdldEF1dGhlbnRpY2F0ZWRVc2VyOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGdldCB1c2VyJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q3VzdG9tZXJCb29raW5ncyhcclxuICBlbWFpbDogc3RyaW5nLFxyXG4gIHBob25lPzogc3RyaW5nLFxyXG4gIGZpbHRlcj86ICdhbGwnIHwgJ3VwY29taW5nJyB8ICdjb21wbGV0ZWQnIHwgJ2NhbmNlbGxlZCdcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBib29raW5ncz86IEJvb2tpbmdbXTtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIGxldCBxdWVyeSA9IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdib29raW5ncycpXHJcbiAgICAgIC5zZWxlY3QoJyonKVxyXG4gICAgICAub3JkZXIoJ3NlcnZpY2VfZGF0ZScsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KVxyXG4gICAgICAub3JkZXIoJ2NyZWF0ZWRfYXQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSk7XHJcblxyXG4gICAgLy8gQnVpbGQgcXVlcnkgZm9yIGVtYWlsL3Bob25lIGxvb2t1cFxyXG4gICAgaWYgKGVtYWlsICYmIHBob25lKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkub3IoYGN1c3RvbWVyX2VtYWlsLmVxLiR7ZW1haWx9LGN1c3RvbWVyX3Bob25lLmVxLiR7cGhvbmV9YCk7XHJcbiAgICB9IGVsc2UgaWYgKGVtYWlsKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ2N1c3RvbWVyX2VtYWlsJywgZW1haWwpO1xyXG4gICAgfSBlbHNlIGlmIChwaG9uZSkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdjdXN0b21lcl9waG9uZScsIHBob25lKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0VtYWlsIG9yIHBob25lIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEFwcGx5IHN0YXR1cyBmaWx0ZXJcclxuICAgIGlmIChmaWx0ZXIgJiYgZmlsdGVyICE9PSAnYWxsJykge1xyXG4gICAgICBpZiAoZmlsdGVyID09PSAndXBjb21pbmcnKSB7XHJcbiAgICAgICAgcXVlcnkgPSBxdWVyeS5pbignc3RhdHVzJywgWydwZW5kaW5nJywgJ2NvbmZpcm1lZCddKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdzdGF0dXMnLCBmaWx0ZXIpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgcXVlcnk7XHJcblxyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGJvb2tpbmdzOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYm9va2luZ3M6IGRhdGEgfHwgW10gfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gZ2V0Q3VzdG9tZXJCb29raW5nczonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBmZXRjaCBib29raW5ncycsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEN1c3RvbWVyQm9va2luZ1N0YXRzKFxyXG4gIGVtYWlsOiBzdHJpbmcsXHJcbiAgcGhvbmU/OiBzdHJpbmdcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBzdGF0cz86IHtcclxuICAgIHRvdGFsOiBudW1iZXI7XHJcbiAgICB1cGNvbWluZzogbnVtYmVyO1xyXG4gICAgY29tcGxldGVkOiBudW1iZXI7XHJcbiAgICBjYW5jZWxsZWQ6IG51bWJlcjtcclxuICAgIHRvdGFsU3BlbnQ6IG51bWJlcjtcclxuICB9O1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgbGV0IHF1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2Jvb2tpbmdzJylcclxuICAgICAgLnNlbGVjdCgnc3RhdHVzLCB0b3RhbF9hbW91bnQsIHBheW1lbnRfc3RhdHVzJyk7XHJcblxyXG4gICAgLy8gQnVpbGQgcXVlcnkgZm9yIGVtYWlsL3Bob25lIGxvb2t1cFxyXG4gICAgaWYgKGVtYWlsICYmIHBob25lKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkub3IoYGN1c3RvbWVyX2VtYWlsLmVxLiR7ZW1haWx9LGN1c3RvbWVyX3Bob25lLmVxLiR7cGhvbmV9YCk7XHJcbiAgICB9IGVsc2UgaWYgKGVtYWlsKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ2N1c3RvbWVyX2VtYWlsJywgZW1haWwpO1xyXG4gICAgfSBlbHNlIGlmIChwaG9uZSkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdjdXN0b21lcl9waG9uZScsIHBob25lKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0VtYWlsIG9yIHBob25lIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHF1ZXJ5O1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBzdGF0cyA9IHtcclxuICAgICAgdG90YWw6IGRhdGE/Lmxlbmd0aCB8fCAwLFxyXG4gICAgICB1cGNvbWluZzogZGF0YT8uZmlsdGVyKChiKSA9PiBiLnN0YXR1cyA9PT0gJ3BlbmRpbmcnIHx8IGIuc3RhdHVzID09PSAnY29uZmlybWVkJykubGVuZ3RoIHx8IDAsXHJcbiAgICAgIGNvbXBsZXRlZDogZGF0YT8uZmlsdGVyKChiKSA9PiBiLnN0YXR1cyA9PT0gJ2NvbXBsZXRlZCcpLmxlbmd0aCB8fCAwLFxyXG4gICAgICBjYW5jZWxsZWQ6IGRhdGE/LmZpbHRlcigoYikgPT4gYi5zdGF0dXMgPT09ICdjYW5jZWxsZWQnKS5sZW5ndGggfHwgMCxcclxuICAgICAgdG90YWxTcGVudDogZGF0YVxyXG4gICAgICAgID8uZmlsdGVyKChiKSA9PiBiLnBheW1lbnRfc3RhdHVzID09PSAncGFpZCcpXHJcbiAgICAgICAgLnJlZHVjZSgoc3VtLCBiKSA9PiBzdW0gKyAoYi50b3RhbF9hbW91bnQgfHwgMCksIDApIHx8IDAsXHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHN0YXRzIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGZldGNoIHN0YXRzJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Qm9va2luZ0J5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgYm9va2luZz86IEJvb2tpbmc7XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnYm9va2luZ3MnKVxyXG4gICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgLmVxKCdpZCcsIGlkKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGJvb2tpbmc6JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdCb29raW5nIG5vdCBmb3VuZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBib29raW5nOiBkYXRhIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ1VuZXhwZWN0ZWQgZXJyb3IgZmV0Y2hpbmcgYm9va2luZzonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0FuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDdXN0b21lclByb2ZpbGUoXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBwaG9uZT86IHN0cmluZ1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIHByb2ZpbGU/OiBQcm9maWxlO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgLy8gRmlyc3QsIHRyeSB0byBnZXQgcHJvZmlsZSBmcm9tIHByb2ZpbGVzIHRhYmxlXHJcbiAgICBsZXQgcXVlcnkgPSBzdXBhYmFzZS5mcm9tKCdwcm9maWxlcycpLnNlbGVjdCgnKicpO1xyXG5cclxuICAgIGlmIChlbWFpbCkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdlbWFpbCcsIGVtYWlsKTtcclxuICAgIH0gZWxzZSBpZiAocGhvbmUpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgncGhvbmUnLCBwaG9uZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdFbWFpbCBvciBwaG9uZSBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB7IGRhdGE6IHByb2ZpbGVEYXRhLCBlcnJvcjogcHJvZmlsZUVycm9yIH0gPSBhd2FpdCBxdWVyeS5tYXliZVNpbmdsZSgpO1xyXG5cclxuICAgIC8vIElmIHByb2ZpbGUgZXhpc3RzLCByZXR1cm4gaXRcclxuICAgIGlmIChwcm9maWxlRGF0YSAmJiAhcHJvZmlsZUVycm9yKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHByb2ZpbGU6IHByb2ZpbGVEYXRhIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gSWYgbm8gcHJvZmlsZSBleGlzdHMsIGRlcml2ZSBmcm9tIG1vc3QgcmVjZW50IGJvb2tpbmdcclxuICAgIGxldCBib29raW5nUXVlcnkgPSBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnYm9va2luZ3MnKVxyXG4gICAgICAuc2VsZWN0KCdjdXN0b21lcl9maXJzdF9uYW1lLCBjdXN0b21lcl9sYXN0X25hbWUsIGN1c3RvbWVyX2VtYWlsLCBjdXN0b21lcl9waG9uZScpXHJcbiAgICAgIC5vcmRlcignY3JlYXRlZF9hdCcsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KVxyXG4gICAgICAubGltaXQoMSk7XHJcblxyXG4gICAgaWYgKGVtYWlsICYmIHBob25lKSB7XHJcbiAgICAgIGJvb2tpbmdRdWVyeSA9IGJvb2tpbmdRdWVyeS5vcihgY3VzdG9tZXJfZW1haWwuZXEuJHtlbWFpbH0sY3VzdG9tZXJfcGhvbmUuZXEuJHtwaG9uZX1gKTtcclxuICAgIH0gZWxzZSBpZiAoZW1haWwpIHtcclxuICAgICAgYm9va2luZ1F1ZXJ5ID0gYm9va2luZ1F1ZXJ5LmVxKCdjdXN0b21lcl9lbWFpbCcsIGVtYWlsKTtcclxuICAgIH0gZWxzZSBpZiAocGhvbmUpIHtcclxuICAgICAgYm9va2luZ1F1ZXJ5ID0gYm9va2luZ1F1ZXJ5LmVxKCdjdXN0b21lcl9waG9uZScsIHBob25lKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB7IGRhdGE6IGJvb2tpbmdEYXRhLCBlcnJvcjogYm9va2luZ0Vycm9yIH0gPSBhd2FpdCBib29raW5nUXVlcnkubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoYm9va2luZ0Vycm9yIHx8ICFib29raW5nRGF0YSkge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIGVycm9yOiAnTm8gcHJvZmlsZSBvciBib29raW5nIGZvdW5kLiBQbGVhc2UgY3JlYXRlIGEgYm9va2luZyBmaXJzdC4nLFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENyZWF0ZSBhIHByb2ZpbGUgb2JqZWN0IGZyb20gYm9va2luZyBkYXRhXHJcbiAgICBjb25zdCBkZXJpdmVkUHJvZmlsZTogUHJvZmlsZSA9IHtcclxuICAgICAgaWQ6ICcnLCAvLyBXaWxsIGJlIGdlbmVyYXRlZCB3aGVuIHNhdmVkXHJcbiAgICAgIGVtYWlsOiBib29raW5nRGF0YS5jdXN0b21lcl9lbWFpbCxcclxuICAgICAgcGhvbmU6IGJvb2tpbmdEYXRhLmN1c3RvbWVyX3Bob25lIHx8IG51bGwsXHJcbiAgICAgIGZpcnN0X25hbWU6IGJvb2tpbmdEYXRhLmN1c3RvbWVyX2ZpcnN0X25hbWUsXHJcbiAgICAgIGxhc3RfbmFtZTogYm9va2luZ0RhdGEuY3VzdG9tZXJfbGFzdF9uYW1lLFxyXG4gICAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcHJvZmlsZTogZGVyaXZlZFByb2ZpbGUgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gZ2V0Q3VzdG9tZXJQcm9maWxlOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGZldGNoIHByb2ZpbGUnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGxvYWRQcm9maWxlUGljdHVyZShcclxuICBlbWFpbDogc3RyaW5nLFxyXG4gIGZpbGVEYXRhOiBzdHJpbmcsIC8vIGJhc2U2NCBlbmNvZGVkIHN0cmluZ1xyXG4gIGZpbGVOYW1lOiBzdHJpbmcsXHJcbiAgZmlsZVR5cGU6IHN0cmluZ1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIHVybD86IHN0cmluZztcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICAvLyBVc2UgYWRtaW4gY2xpZW50IGZvciBzdG9yYWdlIHVwbG9hZHMgaWYgc2VydmljZSByb2xlIGtleSBpcyBhdmFpbGFibGVcclxuICAgIC8vIFRoaXMgZW5zdXJlcyBzdG9yYWdlIHBvbGljaWVzIGRvbid0IGJsb2NrIHRoZSB1cGxvYWRcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSBcclxuICAgICAgPyBjcmVhdGVBZG1pbkNsaWVudCgpIFxyXG4gICAgICA6IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIFZhbGlkYXRlIGZpbGUgdHlwZVxyXG4gICAgY29uc3QgdmFsaWRJbWFnZVR5cGVzID0gWydpbWFnZS9qcGVnJywgJ2ltYWdlL2pwZycsICdpbWFnZS9wbmcnLCAnaW1hZ2Uvd2VicCddO1xyXG4gICAgaWYgKCF2YWxpZEltYWdlVHlwZXMuaW5jbHVkZXMoZmlsZVR5cGUpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ludmFsaWQgZmlsZSB0eXBlLiBQbGVhc2UgdXBsb2FkIGEgSlBFRywgUE5HLCBvciBXZWJQIGltYWdlLicgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBEZWNvZGUgYmFzZTY0IGRhdGFcclxuICAgIGNvbnN0IGJhc2U2NERhdGEgPSBmaWxlRGF0YS5yZXBsYWNlKC9eZGF0YTppbWFnZVxcL1xcdys7YmFzZTY0LC8sICcnKTtcclxuICAgIGNvbnN0IGJ1ZmZlciA9IEJ1ZmZlci5mcm9tKGJhc2U2NERhdGEsICdiYXNlNjQnKTtcclxuXHJcbiAgICAvLyBWYWxpZGF0ZSBmaWxlIHNpemUgKG1heCA1TUIpXHJcbiAgICBjb25zdCBtYXhTaXplID0gNSAqIDEwMjQgKiAxMDI0OyAvLyA1TUIgaW4gYnl0ZXNcclxuICAgIGlmIChidWZmZXIubGVuZ3RoID4gbWF4U2l6ZSkge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdGaWxlIHNpemUgdG9vIGxhcmdlLiBQbGVhc2UgdXBsb2FkIGFuIGltYWdlIHNtYWxsZXIgdGhhbiA1TUIuJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEdlbmVyYXRlIHVuaXF1ZSBmaWxlbmFtZSB1c2luZyBlbWFpbCBhbmQgdGltZXN0YW1wXHJcbiAgICBjb25zdCBmaWxlRXh0ID0gZmlsZU5hbWUuc3BsaXQoJy4nKS5wb3AoKSB8fCAnanBnJztcclxuICAgIGNvbnN0IHNhbml0aXplZEVtYWlsID0gZW1haWwucmVwbGFjZSgvW15hLXpBLVowLTldL2csICdfJyk7XHJcbiAgICBjb25zdCB1bmlxdWVGaWxlTmFtZSA9IGAke3Nhbml0aXplZEVtYWlsfV8ke0RhdGUubm93KCl9LiR7ZmlsZUV4dH1gO1xyXG4gICAgY29uc3QgZmlsZVBhdGggPSBgYXZhdGFycy8ke3VuaXF1ZUZpbGVOYW1lfWA7XHJcblxyXG4gICAgLy8gVXBsb2FkIHRvIFN1cGFiYXNlIFN0b3JhZ2VcclxuICAgIGNvbnN0IHsgZGF0YTogdXBsb2FkRGF0YSwgZXJyb3I6IHVwbG9hZEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5zdG9yYWdlXHJcbiAgICAgIC5mcm9tKCdwcm9maWxlLXBpY3R1cmVzJylcclxuICAgICAgLnVwbG9hZChmaWxlUGF0aCwgYnVmZmVyLCB7XHJcbiAgICAgICAgY29udGVudFR5cGU6IGZpbGVUeXBlLFxyXG4gICAgICAgIHVwc2VydDogZmFsc2UsXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgaWYgKHVwbG9hZEVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcign4p2MIFN0b3JhZ2UgdXBsb2FkIGVycm9yOicsIHVwbG9hZEVycm9yKTtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdVcGxvYWQgZXJyb3IgZGV0YWlsczonLCB7XHJcbiAgICAgICAgICBtZXNzYWdlOiB1cGxvYWRFcnJvci5tZXNzYWdlLFxyXG4gICAgICAgICAgc3RhdHVzQ29kZTogdXBsb2FkRXJyb3Iuc3RhdHVzQ29kZSxcclxuICAgICAgICAgIGVycm9yOiB1cGxvYWRFcnJvci5lcnJvcixcclxuICAgICAgICB9KTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBDaGVjayBmb3Igc3RvcmFnZSBSTFMgZXJyb3JzXHJcbiAgICAgICAgaWYgKHVwbG9hZEVycm9yLm1lc3NhZ2U/LmluY2x1ZGVzKCdyb3ctbGV2ZWwgc2VjdXJpdHknKSB8fCBcclxuICAgICAgICAgICAgdXBsb2FkRXJyb3IubWVzc2FnZT8uaW5jbHVkZXMoJ1JMUycpIHx8XHJcbiAgICAgICAgICAgIHVwbG9hZEVycm9yLm1lc3NhZ2U/LmluY2x1ZGVzKCdwb2xpY3knKSkge1xyXG4gICAgICAgICAgcmV0dXJuIHsgXHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLCBcclxuICAgICAgICAgICAgZXJyb3I6ICdTdG9yYWdlIGJ1Y2tldCBSTFMgcG9saWN5IGVycm9yLiBQbGVhc2UgY2hlY2sgeW91ciBcInByb2ZpbGUtcGljdHVyZXNcIiBidWNrZXQgcG9saWNpZXMgaW4gU3VwYWJhc2UgU3RvcmFnZS4gVGhlIGJ1Y2tldCBuZWVkcyBwb2xpY2llcyB0aGF0IGFsbG93IGF1dGhlbnRpY2F0ZWQgdXNlcnMgdG8gdXBsb2FkIGZpbGVzLicsXHJcbiAgICAgICAgICAgIGVycm9yRGV0YWlsczogdXBsb2FkRXJyb3IubWVzc2FnZSxcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIElmIGJ1Y2tldCBkb2Vzbid0IGV4aXN0LCByZXR1cm4gaGVscGZ1bCBlcnJvclxyXG4gICAgICAgIGlmICh1cGxvYWRFcnJvci5tZXNzYWdlLmluY2x1ZGVzKCdub3QgZm91bmQnKSB8fCB1cGxvYWRFcnJvci5tZXNzYWdlLmluY2x1ZGVzKCdCdWNrZXQnKSkge1xyXG4gICAgICAgICAgcmV0dXJuIHsgXHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLCBcclxuICAgICAgICAgICAgZXJyb3I6ICdTdG9yYWdlIGJ1Y2tldCBub3QgY29uZmlndXJlZC4gUGxlYXNlIGNyZWF0ZSBhIFwicHJvZmlsZS1waWN0dXJlc1wiIGJ1Y2tldCBpbiBTdXBhYmFzZSBTdG9yYWdlLicsXHJcbiAgICAgICAgICAgIGVycm9yRGV0YWlsczogdXBsb2FkRXJyb3IubWVzc2FnZSxcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB7IFxyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsIFxyXG4gICAgICAgICAgZXJyb3I6IHVwbG9hZEVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byB1cGxvYWQgZmlsZScsXHJcbiAgICAgICAgICBlcnJvckRldGFpbHM6IHVwbG9hZEVycm9yLmVycm9yIHx8IHVwbG9hZEVycm9yLnN0YXR1c0NvZGU/LnRvU3RyaW5nKCksXHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG5cclxuICAgIC8vIEdldCBwdWJsaWMgVVJMXHJcbiAgICBjb25zdCB7IGRhdGE6IHVybERhdGEgfSA9IHN1cGFiYXNlLnN0b3JhZ2VcclxuICAgICAgLmZyb20oJ3Byb2ZpbGUtcGljdHVyZXMnKVxyXG4gICAgICAuZ2V0UHVibGljVXJsKGZpbGVQYXRoKTtcclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCB1cmw6IHVybERhdGEucHVibGljVXJsIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHVwbG9hZFByb2ZpbGVQaWN0dXJlOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIHVwbG9hZCBwcm9maWxlIHBpY3R1cmUnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBkZWxldGVQcm9maWxlUGljdHVyZShlbWFpbDogc3RyaW5nLCBhdmF0YXJVcmw6IHN0cmluZyk6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICAvLyBFeHRyYWN0IGZpbGUgcGF0aCBmcm9tIFVSTFxyXG4gICAgLy8gVVJMIGZvcm1hdDogaHR0cHM6Ly9bcHJvamVjdF0uc3VwYWJhc2UuY28vc3RvcmFnZS92MS9vYmplY3QvcHVibGljL3Byb2ZpbGUtcGljdHVyZXMvYXZhdGFycy9maWxlbmFtZS5qcGdcclxuICAgIGNvbnN0IHVybFBhdHRlcm4gPSAvXFwvcHJvZmlsZS1waWN0dXJlc1xcLyguKykkLztcclxuICAgIGNvbnN0IG1hdGNoID0gYXZhdGFyVXJsLm1hdGNoKHVybFBhdHRlcm4pO1xyXG4gICAgXHJcbiAgICBpZiAoIW1hdGNoIHx8ICFtYXRjaFsxXSkge1xyXG4gICAgICAvLyBJZiBVUkwgZG9lc24ndCBtYXRjaCBleHBlY3RlZCBwYXR0ZXJuLCB0cnkgYWx0ZXJuYXRpdmUgcGFyc2luZ1xyXG4gICAgICBjb25zdCB1cmxQYXJ0cyA9IGF2YXRhclVybC5zcGxpdCgnL2F2YXRhcnMvJyk7XHJcbiAgICAgIGlmICh1cmxQYXJ0cy5sZW5ndGggPCAyKSB7XHJcbiAgICAgICAgLy8gSWYgd2UgY2FuJ3QgcGFyc2UgdGhlIFVSTCwganVzdCByZXR1cm4gc3VjY2VzcyAodGhlIGZpbGUgbWlnaHQgYWxyZWFkeSBiZSBkZWxldGVkKVxyXG4gICAgICAgIGNvbnNvbGUud2FybignQ291bGQgbm90IHBhcnNlIGF2YXRhciBVUkwgZm9yIGRlbGV0aW9uOicsIGF2YXRhclVybCk7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xyXG4gICAgICB9XHJcbiAgICAgIGNvbnN0IGZpbGVQYXRoID0gYGF2YXRhcnMvJHt1cmxQYXJ0c1sxXS5zcGxpdCgnPycpWzBdfWA7XHJcbiAgICAgIGNvbnN0IHsgZXJyb3I6IGRlbGV0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5zdG9yYWdlXHJcbiAgICAgICAgLmZyb20oJ3Byb2ZpbGUtcGljdHVyZXMnKVxyXG4gICAgICAgIC5yZW1vdmUoW2ZpbGVQYXRoXSk7XHJcblxyXG4gICAgICBpZiAoZGVsZXRlRXJyb3IgJiYgIWRlbGV0ZUVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ25vdCBmb3VuZCcpKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZGVsZXRpbmcgZmlsZTonLCBkZWxldGVFcnJvcik7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBkZWxldGVFcnJvci5tZXNzYWdlIH07XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGZpbGVQYXRoID0gbWF0Y2hbMV0uc3BsaXQoJz8nKVswXTsgLy8gUmVtb3ZlIHF1ZXJ5IHBhcmFtZXRlcnMgaWYgYW55XHJcblxyXG4gICAgLy8gRGVsZXRlIGZyb20gc3RvcmFnZVxyXG4gICAgY29uc3QgeyBlcnJvcjogZGVsZXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLnN0b3JhZ2VcclxuICAgICAgLmZyb20oJ3Byb2ZpbGUtcGljdHVyZXMnKVxyXG4gICAgICAucmVtb3ZlKFtmaWxlUGF0aF0pO1xyXG5cclxuICAgIGlmIChkZWxldGVFcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBkZWxldGluZyBmaWxlOicsIGRlbGV0ZUVycm9yKTtcclxuICAgICAgLy8gRG9uJ3QgZmFpbCBpZiBmaWxlIGRvZXNuJ3QgZXhpc3RcclxuICAgICAgaWYgKGRlbGV0ZUVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ25vdCBmb3VuZCcpIHx8IGRlbGV0ZUVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ05vIHN1Y2ggZmlsZScpKSB7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZGVsZXRlRXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gZGVsZXRlUHJvZmlsZVBpY3R1cmU6JywgZXJyb3IpO1xyXG4gICAgLy8gRG9uJ3QgZmFpbCBjb21wbGV0ZWx5IC0gdGhlIFVSTCBpbiBkYXRhYmFzZSB3aWxsIGJlIHJlbW92ZWQgYW55d2F5XHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQ3VzdG9tZXJQcm9maWxlKFxyXG4gIGVtYWlsOiBzdHJpbmcsXHJcbiAgZGF0YTogUHJvZmlsZVVwZGF0ZUlucHV0XHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgcHJvZmlsZT86IFByb2ZpbGU7XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgLy8gRmlyc3QsIHZlcmlmeSB0aGUgYXV0aGVudGljYXRlZCB1c2VyIG1hdGNoZXMgdGhlIGVtYWlsXHJcbiAgICBjb25zdCBhdXRoU3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuICAgIGNvbnN0IHsgZGF0YTogeyB1c2VyIH0sIGVycm9yOiBhdXRoRXJyb3IgfSA9IGF3YWl0IGF1dGhTdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcclxuICAgIFxyXG4gICAgaWYgKGF1dGhFcnJvciB8fCAhdXNlcikge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdOb3QgYXV0aGVudGljYXRlZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBWZXJpZnkgdGhhdCB0aGUgZW1haWwgcGFyYW1ldGVyIG1hdGNoZXMgdGhlIGF1dGhlbnRpY2F0ZWQgdXNlcidzIGVtYWlsXHJcbiAgICAvLyBUaGlzIGVuc3VyZXMgdXNlcnMgY2FuIG9ubHkgdXBkYXRlIHRoZWlyIG93biBwcm9maWxlXHJcbiAgICBpZiAodXNlci5lbWFpbD8udG9Mb3dlckNhc2UoKSAhPT0gZW1haWwudG9Mb3dlckNhc2UoKSAmJiB1c2VyLmVtYWlsPy50b0xvd2VyQ2FzZSgpICE9PSBkYXRhLmVtYWlsPy50b0xvd2VyQ2FzZSgpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ1VuYXV0aG9yaXplZDogWW91IGNhbiBvbmx5IHVwZGF0ZSB5b3VyIG93biBwcm9maWxlJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEFMV0FZUyB1c2UgYWRtaW4gY2xpZW50IGZvciBwcm9maWxlIG9wZXJhdGlvbnMgLSBpdCBieXBhc3NlcyBSTFMgY29tcGxldGVseVxyXG4gICAgLy8gVGhpcyBpcyBSRVFVSVJFRCAtIHdlIGNhbm5vdCB1c2UgYXV0aGVudGljYXRlZCBjbGllbnQgYXMgaXQgbWF5IHN0aWxsIGNoZWNrIFJMUyBwb2xpY2llc1xyXG4gICAgbGV0IHN1cGFiYXNlO1xyXG4gICAgdHJ5IHtcclxuICAgICAgc3VwYWJhc2UgPSBjcmVhdGVBZG1pbkNsaWVudCgpO1xyXG4gICAgICBjb25zb2xlLmxvZygn4pyFIFVzaW5nIGFkbWluIGNsaWVudCBmb3IgcHJvZmlsZSBvcGVyYXRpb25zJyk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAvLyBEbyBOT1QgZmFsbCBiYWNrIHRvIGF1dGhlbnRpY2F0ZWQgY2xpZW50IC0gaXQgd2lsbCBjYXVzZSBSTFMgZXJyb3JzXHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBGYWlsZWQgdG8gY3JlYXRlIGFkbWluIGNsaWVudDonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6ICdTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIGlzIG5vdCBzZXQuIFRoaXMgaXMgUkVRVUlSRUQgZm9yIHByb2ZpbGUgb3BlcmF0aW9ucy4gUGxlYXNlIGFkZCBpdCB0byB5b3VyIC5lbnYubG9jYWwgZmlsZS4gR2V0IGl0IGZyb206IFN1cGFiYXNlIERhc2hib2FyZCDihpIgU2V0dGluZ3Mg4oaSIEFQSSDihpIgc2VydmljZV9yb2xlIGtleSAoc2VjcmV0KScsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIFZlcmlmeSB3ZSBoYXZlIGEgdmFsaWQgY2xpZW50IChzaG91bGQgbmV2ZXIgaGFwcGVuIGR1ZSB0byBlcnJvciBhYm92ZSwgYnV0IGRvdWJsZS1jaGVjaylcclxuICAgIGlmICghc3VwYWJhc2UpIHtcclxuICAgICAgcmV0dXJuIHsgXHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsIFxyXG4gICAgICAgIGVycm9yOiAnRmFpbGVkIHRvIGluaXRpYWxpemUgZGF0YWJhc2UgY2xpZW50LiBQbGVhc2UgY2hlY2sgeW91ciBTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIGluIC5lbnYubG9jYWwnIFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFZhbGlkYXRlIGlucHV0XHJcbiAgICBpZiAoIWRhdGEuZmlyc3RfbmFtZT8udHJpbSgpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ZpcnN0IG5hbWUgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcbiAgICBpZiAoIWRhdGEubGFzdF9uYW1lPy50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTGFzdCBuYW1lIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG4gICAgaWYgKCFkYXRhLmVtYWlsPy50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRW1haWwgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcbiAgICBpZiAoIS9eW15cXHNAXStAW15cXHNAXStcXC5bXlxcc0BdKyQvLnRlc3QoZGF0YS5lbWFpbCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnSW52YWxpZCBlbWFpbCBmb3JtYXQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVmVyaWZ5IHRoZSBuZXcgZW1haWwgKGlmIGNoYW5nZWQpIHN0aWxsIG1hdGNoZXMgdGhlIGF1dGhlbnRpY2F0ZWQgdXNlclxyXG4gICAgaWYgKGRhdGEuZW1haWwudG9Mb3dlckNhc2UoKSAhPT0gdXNlci5lbWFpbD8udG9Mb3dlckNhc2UoKSkge1xyXG4gICAgICAvLyBBbGxvdyBlbWFpbCBjaGFuZ2Ugb25seSBpZiBpdCdzIHRoZSBzYW1lIHVzZXIgKGNhc2UgaW5zZW5zaXRpdmUgY2hlY2sgYWJvdmUgcGFzc2VkKVxyXG4gICAgICAvLyBCdXQgd2Ugc2hvdWxkIHZlcmlmeSBpdCdzIGEgdmFsaWQgY2hhbmdlICh1c2VyIHVwZGF0aW5nIHRoZWlyIG93biBlbWFpbClcclxuICAgICAgaWYgKGRhdGEuZW1haWwudG9Mb3dlckNhc2UoKSAhPT0gZW1haWwudG9Mb3dlckNhc2UoKSkge1xyXG4gICAgICAgIC8vIEVtYWlsIGlzIGJlaW5nIGNoYW5nZWQgLSB2ZXJpZnkgaXQncyBzdGlsbCB0aGUgc2FtZSB1c2VyXHJcbiAgICAgICAgLy8gRm9yIG5vdywgd2UnbGwgYWxsb3cgaXQgYnV0IGluIHByb2R1Y3Rpb24geW91IG1pZ2h0IHdhbnQgdG8gcmVxdWlyZSBlbWFpbCB2ZXJpZmljYXRpb25cclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIENoZWNrIGlmIHByb2ZpbGUgZXhpc3RzXHJcbiAgICBjb25zb2xlLmxvZygn8J+UjSBDaGVja2luZyBpZiBwcm9maWxlIGV4aXN0cyBmb3IgZW1haWw6JywgZW1haWwpO1xyXG4gICAgY29uc29sZS5sb2coJ/CflI0gVXNpbmcgY2xpZW50IHR5cGU6JywgcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSA/ICdBRE1JTiAoc2VydmljZSByb2xlKScgOiAnQVVUSEVOVElDQVRFRCAoYW5vbiBrZXkpJyk7XHJcbiAgICBcclxuICAgIGNvbnN0IHsgZGF0YTogZXhpc3RpbmdQcm9maWxlLCBlcnJvcjogc2VsZWN0RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgIC5zZWxlY3QoJyonKVxyXG4gICAgICAuZXEoJ2VtYWlsJywgZW1haWwpXHJcbiAgICAgIC5tYXliZVNpbmdsZSgpO1xyXG4gICAgXHJcbiAgICBpZiAoc2VsZWN0RXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIHNlbGVjdGluZyBwcm9maWxlOicsIHNlbGVjdEVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBgRmFpbGVkIHRvIGNoZWNrIHByb2ZpbGU6ICR7c2VsZWN0RXJyb3IubWVzc2FnZX1gIH07XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGNvbnNvbGUubG9nKCfinIUgUHJvZmlsZSBjaGVjayByZXN1bHQ6JywgZXhpc3RpbmdQcm9maWxlID8gJ1Byb2ZpbGUgZXhpc3RzICh3aWxsIFVQREFURSknIDogJ1Byb2ZpbGUgZG9lcyBub3QgZXhpc3QgKHdpbGwgSU5TRVJUKScpO1xyXG5cclxuICAgIC8vIElmIGF2YXRhcl91cmwgaXMgYmVpbmcgcmVtb3ZlZCwgZGVsZXRlIHRoZSBvbGQgZmlsZVxyXG4gICAgaWYgKGV4aXN0aW5nUHJvZmlsZT8uYXZhdGFyX3VybCAmJiBkYXRhLmF2YXRhcl91cmwgPT09IG51bGwpIHtcclxuICAgICAgYXdhaXQgZGVsZXRlUHJvZmlsZVBpY3R1cmUoZW1haWwsIGV4aXN0aW5nUHJvZmlsZS5hdmF0YXJfdXJsKTtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgcmVzdWx0O1xyXG4gICAgaWYgKGV4aXN0aW5nUHJvZmlsZSkge1xyXG4gICAgICAvLyBVcGRhdGUgZXhpc3RpbmcgcHJvZmlsZVxyXG4gICAgICAvLyBJZiBlbWFpbCBjaGFuZ2VkLCB3ZSBuZWVkIHRvIGhhbmRsZSBpdCBjYXJlZnVsbHlcclxuICAgICAgaWYgKGRhdGEuZW1haWwgIT09IGVtYWlsKSB7XHJcbiAgICAgICAgLy8gQ2hlY2sgaWYgbmV3IGVtYWlsIGFscmVhZHkgZXhpc3RzXHJcbiAgICAgICAgY29uc3QgeyBkYXRhOiBlbWFpbENoZWNrIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcclxuICAgICAgICAgIC5zZWxlY3QoJ2lkJylcclxuICAgICAgICAgIC5lcSgnZW1haWwnLCBkYXRhLmVtYWlsKVxyXG4gICAgICAgICAgLm1heWJlU2luZ2xlKCk7XHJcblxyXG4gICAgICAgIGlmIChlbWFpbENoZWNrKSB7XHJcbiAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdFbWFpbCBhbHJlYWR5IGV4aXN0cycgfTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IHVwZGF0ZURhdGE6IGFueSA9IHtcclxuICAgICAgICAgIGZpcnN0X25hbWU6IGRhdGEuZmlyc3RfbmFtZS50cmltKCksXHJcbiAgICAgICAgICBsYXN0X25hbWU6IGRhdGEubGFzdF9uYW1lLnRyaW0oKSxcclxuICAgICAgICAgIGVtYWlsOiBkYXRhLmVtYWlsLnRyaW0oKSxcclxuICAgICAgICAgIHBob25lOiBkYXRhLnBob25lPy50cmltKCkgfHwgbnVsbCxcclxuICAgICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8vIE9ubHkgdXBkYXRlIGF2YXRhcl91cmwgaWYgaXQncyBwcm92aWRlZFxyXG4gICAgICBpZiAoZGF0YS5hdmF0YXJfdXJsICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICB1cGRhdGVEYXRhLmF2YXRhcl91cmwgPSBkYXRhLmF2YXRhcl91cmw7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnNvbGUubG9nKCfwn5OdIEF0dGVtcHRpbmcgdG8gVVBEQVRFIHByb2ZpbGUgd2l0aCBkYXRhOicsIHVwZGF0ZURhdGEpO1xyXG4gICAgICBjb25zb2xlLmxvZygn8J+TnSBVcGRhdGUgV0hFUkUgZW1haWwgPScsIGVtYWlsKTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IHsgZGF0YTogdXBkYXRlZFByb2ZpbGUsIGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgIC51cGRhdGUodXBkYXRlRGF0YSlcclxuICAgICAgICAuZXEoJ2VtYWlsJywgZW1haWwpXHJcbiAgICAgICAgLnNlbGVjdCgpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgaWYgKHVwZGF0ZUVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIHVwZGF0aW5nIHByb2ZpbGU6JywgdXBkYXRlRXJyb3IpO1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBVcGRhdGUgZXJyb3IgZGV0YWlsczonLCB7XHJcbiAgICAgICAgICBjb2RlOiB1cGRhdGVFcnJvci5jb2RlLFxyXG4gICAgICAgICAgbWVzc2FnZTogdXBkYXRlRXJyb3IubWVzc2FnZSxcclxuICAgICAgICAgIGRldGFpbHM6IHVwZGF0ZUVycm9yLmRldGFpbHMsXHJcbiAgICAgICAgICBoaW50OiB1cGRhdGVFcnJvci5oaW50LFxyXG4gICAgICAgICAgc3RhdHVzQ29kZTogKHVwZGF0ZUVycm9yIGFzIGFueSkuc3RhdHVzQ29kZSxcclxuICAgICAgICAgIHN0YXR1czogKHVwZGF0ZUVycm9yIGFzIGFueSkuc3RhdHVzLFxyXG4gICAgICAgICAgc2VydmljZVJvbGVLZXlTZXQ6ICEhcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSxcclxuICAgICAgICB9KTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBDaGVjayBmb3IgUkxTIGVycm9ycyBzcGVjaWZpY2FsbHlcclxuICAgICAgICBpZiAodXBkYXRlRXJyb3IubWVzc2FnZT8uaW5jbHVkZXMoJ3Jvdy1sZXZlbCBzZWN1cml0eScpIHx8IFxyXG4gICAgICAgICAgICB1cGRhdGVFcnJvci5jb2RlID09PSAnNDI1MDEnIHx8XHJcbiAgICAgICAgICAgIHVwZGF0ZUVycm9yLm1lc3NhZ2U/LmluY2x1ZGVzKCdSTFMnKSkge1xyXG4gICAgICAgICAgcmV0dXJuIHsgXHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLCBcclxuICAgICAgICAgICAgZXJyb3I6ICdSb3cgTGV2ZWwgU2VjdXJpdHkgZXJyb3IuIFBsZWFzZSBlbnN1cmU6IDEpIFJMUyBpcyBkaXNhYmxlZCBvbiBwcm9maWxlcyB0YWJsZSwgMikgU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSBpcyBzZXQgaW4gLmVudi5sb2NhbCcsXHJcbiAgICAgICAgICAgIGVycm9yRGV0YWlsczogYEVycm9yIGNvZGU6ICR7dXBkYXRlRXJyb3IuY29kZSB8fCAndW5rbm93bid9LiAke3VwZGF0ZUVycm9yLmhpbnQgfHwgJyd9YCxcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHJldHVybiB7IFxyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsIFxyXG4gICAgICAgICAgZXJyb3I6IHVwZGF0ZUVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byB1cGRhdGUgcHJvZmlsZScsXHJcbiAgICAgICAgICBlcnJvckRldGFpbHM6IHVwZGF0ZUVycm9yLmRldGFpbHMgfHwgdXBkYXRlRXJyb3IuaGludCB8fCB1bmRlZmluZWQsXHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmVzdWx0ID0gdXBkYXRlZFByb2ZpbGU7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyBDcmVhdGUgbmV3IHByb2ZpbGVcclxuICAgICAgY29uc3QgaW5zZXJ0RGF0YTogYW55ID0ge1xyXG4gICAgICAgICAgZW1haWw6IGRhdGEuZW1haWwudHJpbSgpLFxyXG4gICAgICAgICAgcGhvbmU6IGRhdGEucGhvbmU/LnRyaW0oKSB8fCBudWxsLFxyXG4gICAgICAgICAgZmlyc3RfbmFtZTogZGF0YS5maXJzdF9uYW1lLnRyaW0oKSxcclxuICAgICAgICAgIGxhc3RfbmFtZTogZGF0YS5sYXN0X25hbWUudHJpbSgpLFxyXG4gICAgICB9O1xyXG5cclxuICAgICAgLy8gT25seSBzZXQgYXZhdGFyX3VybCBpZiBpdCdzIHByb3ZpZGVkXHJcbiAgICAgIGlmIChkYXRhLmF2YXRhcl91cmwpIHtcclxuICAgICAgICBpbnNlcnREYXRhLmF2YXRhcl91cmwgPSBkYXRhLmF2YXRhcl91cmw7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IHsgZGF0YTogbmV3UHJvZmlsZSwgZXJyb3I6IGluc2VydEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgICAgLmluc2VydChpbnNlcnREYXRhKVxyXG4gICAgICAgIC5zZWxlY3QoKVxyXG4gICAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICAgIGlmIChpbnNlcnRFcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIHByb2ZpbGU6JywgaW5zZXJ0RXJyb3IpO1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBJbnNlcnQgZXJyb3IgZGV0YWlsczonLCB7XHJcbiAgICAgICAgICBjb2RlOiBpbnNlcnRFcnJvci5jb2RlLFxyXG4gICAgICAgICAgbWVzc2FnZTogaW5zZXJ0RXJyb3IubWVzc2FnZSxcclxuICAgICAgICAgIGRldGFpbHM6IGluc2VydEVycm9yLmRldGFpbHMsXHJcbiAgICAgICAgICBoaW50OiBpbnNlcnRFcnJvci5oaW50LFxyXG4gICAgICAgICAgc2VydmljZVJvbGVLZXlTZXQ6ICEhcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSxcclxuICAgICAgICB9KTtcclxuICAgICAgICAvLyBDaGVjayBpZiBpdCdzIGEgdW5pcXVlIGNvbnN0cmFpbnQgdmlvbGF0aW9uXHJcbiAgICAgICAgaWYgKGluc2VydEVycm9yLmNvZGUgPT09ICcyMzUwNScpIHtcclxuICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0VtYWlsIGFscmVhZHkgZXhpc3RzJyB9O1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBDaGVjayBpZiBpdCdzIGFuIFJMUyBlcnJvclxyXG4gICAgICAgIGlmIChpbnNlcnRFcnJvci5tZXNzYWdlPy5pbmNsdWRlcygncm93LWxldmVsIHNlY3VyaXR5JykgfHwgXHJcbiAgICAgICAgICAgIGluc2VydEVycm9yLmNvZGUgPT09ICc0MjUwMScgfHxcclxuICAgICAgICAgICAgaW5zZXJ0RXJyb3IubWVzc2FnZT8uaW5jbHVkZXMoJ1JMUycpKSB7XHJcbiAgICAgICAgICByZXR1cm4geyBcclxuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsIFxyXG4gICAgICAgICAgICBlcnJvcjogJ1JvdyBMZXZlbCBTZWN1cml0eSBlcnJvci4gUGxlYXNlIGVuc3VyZTogMSkgUkxTIGlzIGRpc2FibGVkIG9uIHByb2ZpbGVzIHRhYmxlLCAyKSBTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIGlzIHNldCBpbiAuZW52LmxvY2FsJyxcclxuICAgICAgICAgICAgZXJyb3JEZXRhaWxzOiBgRXJyb3IgY29kZTogJHtpbnNlcnRFcnJvci5jb2RlIHx8ICd1bmtub3duJ30uICR7aW5zZXJ0RXJyb3IuaGludCB8fCAnJ31gLFxyXG4gICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHsgXHJcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSwgXHJcbiAgICAgICAgICBlcnJvcjogaW5zZXJ0RXJyb3IubWVzc2FnZSB8fCAnRmFpbGVkIHRvIGNyZWF0ZSBwcm9maWxlJyxcclxuICAgICAgICAgIGVycm9yRGV0YWlsczogaW5zZXJ0RXJyb3IuZGV0YWlscyB8fCBpbnNlcnRFcnJvci5oaW50IHx8IHVuZGVmaW5lZCxcclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcblxyXG4gICAgICByZXN1bHQgPSBuZXdQcm9maWxlO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHByb2ZpbGU6IHJlc3VsdCB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiB1cGRhdGVDdXN0b21lclByb2ZpbGU6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gdXBkYXRlIHByb2ZpbGUnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDdXN0b21lckxvY2F0aW9ucyhcclxuICBlbWFpbDogc3RyaW5nLFxyXG4gIHBob25lPzogc3RyaW5nXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgbG9jYXRpb25zPzogTG9jYXRpb25bXTtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIGxldCBxdWVyeSA9IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdsb2NhdGlvbnMnKVxyXG4gICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgLm9yZGVyKCdpc19kZWZhdWx0JywgeyBhc2NlbmRpbmc6IGZhbHNlIH0pXHJcbiAgICAgIC5vcmRlcignY3JlYXRlZF9hdCcsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KTtcclxuXHJcbiAgICAvLyBCdWlsZCBxdWVyeSBmb3IgZW1haWwvcGhvbmUgbG9va3VwXHJcbiAgICBpZiAoZW1haWwgJiYgcGhvbmUpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5vcihgY3VzdG9tZXJfZW1haWwuZXEuJHtlbWFpbH0sY3VzdG9tZXJfcGhvbmUuZXEuJHtwaG9uZX1gKTtcclxuICAgIH0gZWxzZSBpZiAoZW1haWwpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnY3VzdG9tZXJfZW1haWwnLCBlbWFpbCk7XHJcbiAgICB9IGVsc2UgaWYgKHBob25lKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ2N1c3RvbWVyX3Bob25lJywgcGhvbmUpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRW1haWwgb3IgcGhvbmUgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgcXVlcnk7XHJcblxyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGxvY2F0aW9uczonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGxvY2F0aW9uczogZGF0YSB8fCBbXSB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBnZXRDdXN0b21lckxvY2F0aW9uczonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBmZXRjaCBsb2NhdGlvbnMnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVMb2NhdGlvbihcclxuICBlbWFpbDogc3RyaW5nLFxyXG4gIHBob25lOiBzdHJpbmcgfCB1bmRlZmluZWQsXHJcbiAgbG9jYXRpb25EYXRhOiBMb2NhdGlvbkNyZWF0ZUlucHV0XHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgbG9jYXRpb24/OiBMb2NhdGlvbjtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIFZhbGlkYXRlIGlucHV0XHJcbiAgICBpZiAoIWxvY2F0aW9uRGF0YS5uaWNrbmFtZT8udHJpbSgpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ05pY2tuYW1lIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG4gICAgaWYgKCFsb2NhdGlvbkRhdGEuYWRkcmVzcz8udHJpbSgpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0FkZHJlc3MgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcbiAgICBpZiAoIWxvY2F0aW9uRGF0YS5zdWJ1cmI/LnRyaW0oKSkge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdTdWJ1cmIgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcbiAgICBpZiAoIWxvY2F0aW9uRGF0YS5jaXR5Py50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnQ2l0eSBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBJZiBzZXR0aW5nIGFzIGRlZmF1bHQsIHVuc2V0IGFsbCBvdGhlciBkZWZhdWx0cyBmb3IgdGhpcyBjdXN0b21lclxyXG4gICAgaWYgKGxvY2F0aW9uRGF0YS5pc19kZWZhdWx0KSB7XHJcbiAgICAgIGxldCB1cGRhdGVRdWVyeSA9IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ2xvY2F0aW9ucycpXHJcbiAgICAgICAgLnVwZGF0ZSh7IGlzX2RlZmF1bHQ6IGZhbHNlIH0pO1xyXG5cclxuICAgICAgaWYgKGVtYWlsICYmIHBob25lKSB7XHJcbiAgICAgICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5vcihgY3VzdG9tZXJfZW1haWwuZXEuJHtlbWFpbH0sY3VzdG9tZXJfcGhvbmUuZXEuJHtwaG9uZX1gKTtcclxuICAgICAgfSBlbHNlIGlmIChlbWFpbCkge1xyXG4gICAgICAgIHVwZGF0ZVF1ZXJ5ID0gdXBkYXRlUXVlcnkuZXEoJ2N1c3RvbWVyX2VtYWlsJywgZW1haWwpO1xyXG4gICAgICB9IGVsc2UgaWYgKHBob25lKSB7XHJcbiAgICAgICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5lcSgnY3VzdG9tZXJfcGhvbmUnLCBwaG9uZSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGF3YWl0IHVwZGF0ZVF1ZXJ5O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgZGF0YTogbmV3TG9jYXRpb24sIGVycm9yOiBpbnNlcnRFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2xvY2F0aW9ucycpXHJcbiAgICAgIC5pbnNlcnQoe1xyXG4gICAgICAgIGN1c3RvbWVyX2VtYWlsOiBlbWFpbCxcclxuICAgICAgICBjdXN0b21lcl9waG9uZTogcGhvbmUgfHwgbnVsbCxcclxuICAgICAgICBuaWNrbmFtZTogbG9jYXRpb25EYXRhLm5pY2tuYW1lLnRyaW0oKSxcclxuICAgICAgICBhZGRyZXNzOiBsb2NhdGlvbkRhdGEuYWRkcmVzcy50cmltKCksXHJcbiAgICAgICAgYXB0X3VuaXQ6IGxvY2F0aW9uRGF0YS5hcHRfdW5pdD8udHJpbSgpIHx8IG51bGwsXHJcbiAgICAgICAgc3VidXJiOiBsb2NhdGlvbkRhdGEuc3VidXJiLnRyaW0oKSxcclxuICAgICAgICBjaXR5OiBsb2NhdGlvbkRhdGEuY2l0eS50cmltKCksXHJcbiAgICAgICAgcG9zdGFsX2NvZGU6IGxvY2F0aW9uRGF0YS5wb3N0YWxfY29kZT8udHJpbSgpIHx8IG51bGwsXHJcbiAgICAgICAgaXNfZGVmYXVsdDogbG9jYXRpb25EYXRhLmlzX2RlZmF1bHQgfHwgZmFsc2UsXHJcbiAgICAgIH0pXHJcbiAgICAgIC5zZWxlY3QoKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKGluc2VydEVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIGxvY2F0aW9uOicsIGluc2VydEVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBpbnNlcnRFcnJvci5tZXNzYWdlIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgbG9jYXRpb246IG5ld0xvY2F0aW9uIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGNyZWF0ZUxvY2F0aW9uOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGNyZWF0ZSBsb2NhdGlvbicsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUxvY2F0aW9uKFxyXG4gIGxvY2F0aW9uSWQ6IHN0cmluZyxcclxuICBsb2NhdGlvbkRhdGE6IExvY2F0aW9uVXBkYXRlSW5wdXRcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBsb2NhdGlvbj86IExvY2F0aW9uO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgLy8gVmFsaWRhdGUgaW5wdXQgaWYgcHJvdmlkZWRcclxuICAgIGlmIChsb2NhdGlvbkRhdGEubmlja25hbWUgIT09IHVuZGVmaW5lZCAmJiAhbG9jYXRpb25EYXRhLm5pY2tuYW1lLnRyaW0oKSkge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdOaWNrbmFtZSBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuYWRkcmVzcyAhPT0gdW5kZWZpbmVkICYmICFsb2NhdGlvbkRhdGEuYWRkcmVzcy50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnQWRkcmVzcyBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuc3VidXJiICE9PSB1bmRlZmluZWQgJiYgIWxvY2F0aW9uRGF0YS5zdWJ1cmIudHJpbSgpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ1N1YnVyYiBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuY2l0eSAhPT0gdW5kZWZpbmVkICYmICFsb2NhdGlvbkRhdGEuY2l0eS50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnQ2l0eSBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBHZXQgY3VycmVudCBsb2NhdGlvbiB0byBjaGVjayBjdXN0b21lciBlbWFpbFxyXG4gICAgY29uc3QgeyBkYXRhOiBjdXJyZW50TG9jYXRpb24sIGVycm9yOiBmZXRjaEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnbG9jYXRpb25zJylcclxuICAgICAgLnNlbGVjdCgnY3VzdG9tZXJfZW1haWwsIGN1c3RvbWVyX3Bob25lJylcclxuICAgICAgLmVxKCdpZCcsIGxvY2F0aW9uSWQpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoZmV0Y2hFcnJvciB8fCAhY3VycmVudExvY2F0aW9uKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0xvY2F0aW9uIG5vdCBmb3VuZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBJZiBzZXR0aW5nIGFzIGRlZmF1bHQsIHVuc2V0IGFsbCBvdGhlciBkZWZhdWx0cyBmb3IgdGhpcyBjdXN0b21lclxyXG4gICAgaWYgKGxvY2F0aW9uRGF0YS5pc19kZWZhdWx0KSB7XHJcbiAgICAgIGxldCB1cGRhdGVRdWVyeSA9IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ2xvY2F0aW9ucycpXHJcbiAgICAgICAgLnVwZGF0ZSh7IGlzX2RlZmF1bHQ6IGZhbHNlIH0pO1xyXG5cclxuICAgICAgaWYgKGN1cnJlbnRMb2NhdGlvbi5jdXN0b21lcl9lbWFpbCAmJiBjdXJyZW50TG9jYXRpb24uY3VzdG9tZXJfcGhvbmUpIHtcclxuICAgICAgICB1cGRhdGVRdWVyeSA9IHVwZGF0ZVF1ZXJ5Lm9yKGBjdXN0b21lcl9lbWFpbC5lcS4ke2N1cnJlbnRMb2NhdGlvbi5jdXN0b21lcl9lbWFpbH0sY3VzdG9tZXJfcGhvbmUuZXEuJHtjdXJyZW50TG9jYXRpb24uY3VzdG9tZXJfcGhvbmV9YCk7XHJcbiAgICAgIH0gZWxzZSBpZiAoY3VycmVudExvY2F0aW9uLmN1c3RvbWVyX2VtYWlsKSB7XHJcbiAgICAgICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5lcSgnY3VzdG9tZXJfZW1haWwnLCBjdXJyZW50TG9jYXRpb24uY3VzdG9tZXJfZW1haWwpO1xyXG4gICAgICB9IGVsc2UgaWYgKGN1cnJlbnRMb2NhdGlvbi5jdXN0b21lcl9waG9uZSkge1xyXG4gICAgICAgIHVwZGF0ZVF1ZXJ5ID0gdXBkYXRlUXVlcnkuZXEoJ2N1c3RvbWVyX3Bob25lJywgY3VycmVudExvY2F0aW9uLmN1c3RvbWVyX3Bob25lKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gRG9uJ3QgdW5zZXQgdGhlIGN1cnJlbnQgbG9jYXRpb25cclxuICAgICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5uZXEoJ2lkJywgbG9jYXRpb25JZCk7XHJcblxyXG4gICAgICBhd2FpdCB1cGRhdGVRdWVyeTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBCdWlsZCB1cGRhdGUgb2JqZWN0IHdpdGggb25seSBwcm92aWRlZCBmaWVsZHNcclxuICAgIGNvbnN0IHVwZGF0ZURhdGE6IGFueSA9IHtcclxuICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgfTtcclxuXHJcbiAgICBpZiAobG9jYXRpb25EYXRhLm5pY2tuYW1lICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgdXBkYXRlRGF0YS5uaWNrbmFtZSA9IGxvY2F0aW9uRGF0YS5uaWNrbmFtZS50cmltKCk7XHJcbiAgICB9XHJcbiAgICBpZiAobG9jYXRpb25EYXRhLmFkZHJlc3MgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB1cGRhdGVEYXRhLmFkZHJlc3MgPSBsb2NhdGlvbkRhdGEuYWRkcmVzcy50cmltKCk7XHJcbiAgICB9XHJcbiAgICBpZiAobG9jYXRpb25EYXRhLmFwdF91bml0ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgdXBkYXRlRGF0YS5hcHRfdW5pdCA9IGxvY2F0aW9uRGF0YS5hcHRfdW5pdD8udHJpbSgpIHx8IG51bGw7XHJcbiAgICB9XHJcbiAgICBpZiAobG9jYXRpb25EYXRhLnN1YnVyYiAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHVwZGF0ZURhdGEuc3VidXJiID0gbG9jYXRpb25EYXRhLnN1YnVyYi50cmltKCk7XHJcbiAgICB9XHJcbiAgICBpZiAobG9jYXRpb25EYXRhLmNpdHkgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB1cGRhdGVEYXRhLmNpdHkgPSBsb2NhdGlvbkRhdGEuY2l0eS50cmltKCk7XHJcbiAgICB9XHJcbiAgICBpZiAobG9jYXRpb25EYXRhLnBvc3RhbF9jb2RlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgdXBkYXRlRGF0YS5wb3N0YWxfY29kZSA9IGxvY2F0aW9uRGF0YS5wb3N0YWxfY29kZT8udHJpbSgpIHx8IG51bGw7XHJcbiAgICB9XHJcbiAgICBpZiAobG9jYXRpb25EYXRhLmlzX2RlZmF1bHQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB1cGRhdGVEYXRhLmlzX2RlZmF1bHQgPSBsb2NhdGlvbkRhdGEuaXNfZGVmYXVsdDtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB7IGRhdGE6IHVwZGF0ZWRMb2NhdGlvbiwgZXJyb3I6IHVwZGF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnbG9jYXRpb25zJylcclxuICAgICAgLnVwZGF0ZSh1cGRhdGVEYXRhKVxyXG4gICAgICAuZXEoJ2lkJywgbG9jYXRpb25JZClcclxuICAgICAgLnNlbGVjdCgpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICBpZiAodXBkYXRlRXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBkYXRpbmcgbG9jYXRpb246JywgdXBkYXRlRXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHVwZGF0ZUVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBsb2NhdGlvbjogdXBkYXRlZExvY2F0aW9uIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHVwZGF0ZUxvY2F0aW9uOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIHVwZGF0ZSBsb2NhdGlvbicsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGRlbGV0ZUxvY2F0aW9uKGxvY2F0aW9uSWQ6IHN0cmluZyk6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnbG9jYXRpb25zJylcclxuICAgICAgLmRlbGV0ZSgpXHJcbiAgICAgIC5lcSgnaWQnLCBsb2NhdGlvbklkKTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZGVsZXRpbmcgbG9jYXRpb246JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGRlbGV0ZUxvY2F0aW9uOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGRlbGV0ZSBsb2NhdGlvbicsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNldERlZmF1bHRMb2NhdGlvbihcclxuICBsb2NhdGlvbklkOiBzdHJpbmcsXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBwaG9uZT86IHN0cmluZ1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGxvY2F0aW9uPzogTG9jYXRpb247XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICAvLyBHZXQgY3VycmVudCBsb2NhdGlvbiB0byB2ZXJpZnkgb3duZXJzaGlwXHJcbiAgICBjb25zdCB7IGRhdGE6IGN1cnJlbnRMb2NhdGlvbiwgZXJyb3I6IGZldGNoRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdsb2NhdGlvbnMnKVxyXG4gICAgICAuc2VsZWN0KCdjdXN0b21lcl9lbWFpbCwgY3VzdG9tZXJfcGhvbmUnKVxyXG4gICAgICAuZXEoJ2lkJywgbG9jYXRpb25JZClcclxuICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgIGlmIChmZXRjaEVycm9yIHx8ICFjdXJyZW50TG9jYXRpb24pIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTG9jYXRpb24gbm90IGZvdW5kJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFZlcmlmeSBvd25lcnNoaXBcclxuICAgIGNvbnN0IGlzT3duZXIgPSBcclxuICAgICAgY3VycmVudExvY2F0aW9uLmN1c3RvbWVyX2VtYWlsID09PSBlbWFpbCB8fFxyXG4gICAgICAocGhvbmUgJiYgY3VycmVudExvY2F0aW9uLmN1c3RvbWVyX3Bob25lID09PSBwaG9uZSk7XHJcblxyXG4gICAgaWYgKCFpc093bmVyKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ1VuYXV0aG9yaXplZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBVbnNldCBhbGwgb3RoZXIgZGVmYXVsdHMgZm9yIHRoaXMgY3VzdG9tZXJcclxuICAgIGxldCB1cGRhdGVRdWVyeSA9IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdsb2NhdGlvbnMnKVxyXG4gICAgICAudXBkYXRlKHsgaXNfZGVmYXVsdDogZmFsc2UgfSk7XHJcblxyXG4gICAgaWYgKGVtYWlsICYmIHBob25lKSB7XHJcbiAgICAgIHVwZGF0ZVF1ZXJ5ID0gdXBkYXRlUXVlcnkub3IoYGN1c3RvbWVyX2VtYWlsLmVxLiR7ZW1haWx9LGN1c3RvbWVyX3Bob25lLmVxLiR7cGhvbmV9YCk7XHJcbiAgICB9IGVsc2UgaWYgKGVtYWlsKSB7XHJcbiAgICAgIHVwZGF0ZVF1ZXJ5ID0gdXBkYXRlUXVlcnkuZXEoJ2N1c3RvbWVyX2VtYWlsJywgZW1haWwpO1xyXG4gICAgfSBlbHNlIGlmIChwaG9uZSkge1xyXG4gICAgICB1cGRhdGVRdWVyeSA9IHVwZGF0ZVF1ZXJ5LmVxKCdjdXN0b21lcl9waG9uZScsIHBob25lKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBEb24ndCB1bnNldCB0aGUgY3VycmVudCBsb2NhdGlvblxyXG4gICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5uZXEoJ2lkJywgbG9jYXRpb25JZCk7XHJcblxyXG4gICAgYXdhaXQgdXBkYXRlUXVlcnk7XHJcblxyXG4gICAgLy8gU2V0IHRoaXMgbG9jYXRpb24gYXMgZGVmYXVsdFxyXG4gICAgY29uc3QgeyBkYXRhOiB1cGRhdGVkTG9jYXRpb24sIGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2xvY2F0aW9ucycpXHJcbiAgICAgIC51cGRhdGUoeyBpc19kZWZhdWx0OiB0cnVlIH0pXHJcbiAgICAgIC5lcSgnaWQnLCBsb2NhdGlvbklkKVxyXG4gICAgICAuc2VsZWN0KClcclxuICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgIGlmICh1cGRhdGVFcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBzZXR0aW5nIGRlZmF1bHQgbG9jYXRpb246JywgdXBkYXRlRXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHVwZGF0ZUVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBsb2NhdGlvbjogdXBkYXRlZExvY2F0aW9uIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHNldERlZmF1bHRMb2NhdGlvbjonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBzZXQgZGVmYXVsdCBsb2NhdGlvbicsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldE9yQ3JlYXRlUmVmZXJyYWxDb2RlKFxyXG4gIGVtYWlsOiBzdHJpbmdcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICByZWZlcnJhbENvZGU/OiBzdHJpbmc7XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICAvLyBDaGVjayBpZiBwcm9maWxlIGV4aXN0cyBhbmQgaGFzIGEgcmVmZXJyYWwgY29kZVxyXG4gICAgY29uc3QgeyBkYXRhOiBwcm9maWxlLCBlcnJvcjogcHJvZmlsZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAuc2VsZWN0KCdyZWZlcnJhbF9jb2RlJylcclxuICAgICAgLmVxKCdlbWFpbCcsIGVtYWlsKVxyXG4gICAgICAubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgICBpZiAocHJvZmlsZUVycm9yICYmIHByb2ZpbGVFcnJvci5jb2RlICE9PSAnUEdSU1QxMTYnKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIHByb2ZpbGU6JywgcHJvZmlsZUVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBwcm9maWxlRXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIElmIHByb2ZpbGUgZXhpc3RzIGFuZCBoYXMgYSByZWZlcnJhbCBjb2RlLCByZXR1cm4gaXRcclxuICAgIGlmIChwcm9maWxlPy5yZWZlcnJhbF9jb2RlKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHJlZmVycmFsQ29kZTogcHJvZmlsZS5yZWZlcnJhbF9jb2RlIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gR2VuZXJhdGUgYSBuZXcgcmVmZXJyYWwgY29kZVxyXG4gICAgLy8gVHJ5IHVzaW5nIHRoZSBkYXRhYmFzZSBmdW5jdGlvbiBmaXJzdCwgYnV0IGZhbGxiYWNrIHRvIGNsaWVudC1zaWRlIGdlbmVyYXRpb25cclxuICAgIGxldCBnZW5lcmF0ZWRDb2RlOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcclxuICAgIFxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgeyBkYXRhOiBkYkNvZGUsIGVycm9yOiBjb2RlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLnJwYygnZ2VuZXJhdGVfcmVmZXJyYWxfY29kZScpO1xyXG4gICAgICBcclxuICAgICAgaWYgKCFjb2RlRXJyb3IgJiYgZGJDb2RlKSB7XHJcbiAgICAgICAgZ2VuZXJhdGVkQ29kZSA9IGRiQ29kZTtcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAocnBjRXJyb3IpIHtcclxuICAgICAgLy8gUlBDIGZ1bmN0aW9uIG1pZ2h0IG5vdCBleGlzdCB5ZXQsIHRoYXQncyBva2F5XHJcbiAgICAgIGNvbnNvbGUubG9nKCdSUEMgZnVuY3Rpb24gbm90IGF2YWlsYWJsZSwgdXNpbmcgZmFsbGJhY2snKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIWdlbmVyYXRlZENvZGUpIHtcclxuICAgICAgLy8gRmFsbGJhY2s6IGdlbmVyYXRlIGNvZGUgY2xpZW50LXNpZGUgc3R5bGVcclxuICAgICAgY29uc3QgZmFsbGJhY2tDb2RlID0gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIsIDgpLnRvVXBwZXJDYXNlKCk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBDaGVjayBpZiBmYWxsYmFjayBjb2RlIGV4aXN0cywgcmV0cnkgaWYgaXQgZG9lc1xyXG4gICAgICBsZXQgZmluYWxDb2RlID0gZmFsbGJhY2tDb2RlO1xyXG4gICAgICBsZXQgYXR0ZW1wdHMgPSAwO1xyXG4gICAgICBjb25zdCBtYXhBdHRlbXB0cyA9IDU7XHJcblxyXG4gICAgICB3aGlsZSAoYXR0ZW1wdHMgPCBtYXhBdHRlbXB0cykge1xyXG4gICAgICAgIGNvbnN0IHsgZGF0YTogZXhpc3RpbmcgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgICAgLnNlbGVjdCgnaWQnKVxyXG4gICAgICAgICAgLmVxKCdyZWZlcnJhbF9jb2RlJywgZmluYWxDb2RlKVxyXG4gICAgICAgICAgLm1heWJlU2luZ2xlKCk7XHJcblxyXG4gICAgICAgIGlmICghZXhpc3RpbmcpIHtcclxuICAgICAgICAgIGJyZWFrOyAvLyBDb2RlIGlzIHVuaXF1ZVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gR2VuZXJhdGUgYSBuZXcgY29kZVxyXG4gICAgICAgIGZpbmFsQ29kZSA9IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cmluZygyLCA4KS50b1VwcGVyQ2FzZSgpO1xyXG4gICAgICAgIGF0dGVtcHRzKys7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIFVwZGF0ZSBvciBpbnNlcnQgcHJvZmlsZSB3aXRoIHJlZmVycmFsIGNvZGVcclxuICAgICAgLy8gRmlyc3QsIHRyeSB0byB1cGRhdGUgZXhpc3RpbmcgcHJvZmlsZVxyXG4gICAgICBjb25zdCB7IGRhdGE6IGV4aXN0aW5nUHJvZmlsZSB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgIC5zZWxlY3QoJ2lkLCBmaXJzdF9uYW1lLCBsYXN0X25hbWUnKVxyXG4gICAgICAgIC5lcSgnZW1haWwnLCBlbWFpbClcclxuICAgICAgICAubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgICAgIGxldCB1cGRhdGVkUHJvZmlsZTtcclxuICAgICAgaWYgKGV4aXN0aW5nUHJvZmlsZSkge1xyXG4gICAgICAgIC8vIFVwZGF0ZSBleGlzdGluZyBwcm9maWxlXHJcbiAgICAgICAgY29uc3QgeyBkYXRhOiB1cGRhdGVkLCBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgICAgLnVwZGF0ZSh7XHJcbiAgICAgICAgICAgIHJlZmVycmFsX2NvZGU6IGZpbmFsQ29kZSxcclxuICAgICAgICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgICAgICAgfSlcclxuICAgICAgICAgIC5lcSgnZW1haWwnLCBlbWFpbClcclxuICAgICAgICAgIC5zZWxlY3QoJ3JlZmVycmFsX2NvZGUnKVxyXG4gICAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgICBpZiAodXBkYXRlRXJyb3IpIHtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHVwZGF0aW5nIHJlZmVycmFsIGNvZGU6JywgdXBkYXRlRXJyb3IpO1xyXG4gICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB1cGRhdGVFcnJvci5tZXNzYWdlIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHVwZGF0ZWRQcm9maWxlID0gdXBkYXRlZDtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBJbnNlcnQgbmV3IHByb2ZpbGUgd2l0aCByZWZlcnJhbCBjb2RlXHJcbiAgICAgICAgY29uc3QgeyBkYXRhOiBpbnNlcnRlZCwgZXJyb3I6IGluc2VydEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcclxuICAgICAgICAgIC5pbnNlcnQoe1xyXG4gICAgICAgICAgICBlbWFpbCxcclxuICAgICAgICAgICAgcmVmZXJyYWxfY29kZTogZmluYWxDb2RlLFxyXG4gICAgICAgICAgICBmaXJzdF9uYW1lOiBlbWFpbC5zcGxpdCgnQCcpWzBdLFxyXG4gICAgICAgICAgICBsYXN0X25hbWU6ICcnLFxyXG4gICAgICAgICAgfSlcclxuICAgICAgICAgIC5zZWxlY3QoJ3JlZmVycmFsX2NvZGUnKVxyXG4gICAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgICBpZiAoaW5zZXJ0RXJyb3IpIHtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIHJlZmVycmFsIGNvZGU6JywgaW5zZXJ0RXJyb3IpO1xyXG4gICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBpbnNlcnRFcnJvci5tZXNzYWdlIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHVwZGF0ZWRQcm9maWxlID0gaW5zZXJ0ZWQ7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHJlZmVycmFsQ29kZTogdXBkYXRlZFByb2ZpbGU/LnJlZmVycmFsX2NvZGUgfHwgZmluYWxDb2RlIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVXNlIHRoZSBnZW5lcmF0ZWQgY29kZSBmcm9tIGRhdGFiYXNlIGZ1bmN0aW9uXHJcbiAgICAvLyBVcGRhdGUgb3IgaW5zZXJ0IHByb2ZpbGUgd2l0aCBnZW5lcmF0ZWQgY29kZVxyXG4gICAgY29uc3QgeyBkYXRhOiBleGlzdGluZ1Byb2ZpbGUgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgIC5zZWxlY3QoJ2lkLCBmaXJzdF9uYW1lLCBsYXN0X25hbWUnKVxyXG4gICAgICAuZXEoJ2VtYWlsJywgZW1haWwpXHJcbiAgICAgIC5tYXliZVNpbmdsZSgpO1xyXG5cclxuICAgIGxldCB1cGRhdGVkUHJvZmlsZTtcclxuICAgIGlmIChleGlzdGluZ1Byb2ZpbGUpIHtcclxuICAgICAgLy8gVXBkYXRlIGV4aXN0aW5nIHByb2ZpbGVcclxuICAgICAgY29uc3QgeyBkYXRhOiB1cGRhdGVkLCBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcclxuICAgICAgICAudXBkYXRlKHtcclxuICAgICAgICAgIHJlZmVycmFsX2NvZGU6IGdlbmVyYXRlZENvZGUsXHJcbiAgICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgfSlcclxuICAgICAgICAuZXEoJ2VtYWlsJywgZW1haWwpXHJcbiAgICAgICAgLnNlbGVjdCgncmVmZXJyYWxfY29kZScpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgaWYgKHVwZGF0ZUVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBkYXRpbmcgcmVmZXJyYWwgY29kZTonLCB1cGRhdGVFcnJvcik7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB1cGRhdGVFcnJvci5tZXNzYWdlIH07XHJcbiAgICAgIH1cclxuICAgICAgdXBkYXRlZFByb2ZpbGUgPSB1cGRhdGVkO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8gSW5zZXJ0IG5ldyBwcm9maWxlIHdpdGggcmVmZXJyYWwgY29kZVxyXG4gICAgICBjb25zdCB7IGRhdGE6IGluc2VydGVkLCBlcnJvcjogaW5zZXJ0RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcclxuICAgICAgICAuaW5zZXJ0KHtcclxuICAgICAgICAgIGVtYWlsLFxyXG4gICAgICAgICAgcmVmZXJyYWxfY29kZTogZ2VuZXJhdGVkQ29kZSxcclxuICAgICAgICAgIGZpcnN0X25hbWU6IGVtYWlsLnNwbGl0KCdAJylbMF0sXHJcbiAgICAgICAgICBsYXN0X25hbWU6ICcnLFxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnNlbGVjdCgncmVmZXJyYWxfY29kZScpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgaWYgKGluc2VydEVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYXRpbmcgcmVmZXJyYWwgY29kZTonLCBpbnNlcnRFcnJvcik7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBpbnNlcnRFcnJvci5tZXNzYWdlIH07XHJcbiAgICAgIH1cclxuICAgICAgdXBkYXRlZFByb2ZpbGUgPSBpbnNlcnRlZDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCByZWZlcnJhbENvZGU6IHVwZGF0ZWRQcm9maWxlPy5yZWZlcnJhbF9jb2RlIHx8IGdlbmVyYXRlZENvZGUgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gZ2V0T3JDcmVhdGVSZWZlcnJhbENvZGU6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gZ2V0IHJlZmVycmFsIGNvZGUnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZW5kUmVmZXJyYWxJbnZpdGVzKFxyXG4gIGVtYWlsOiBzdHJpbmcsXHJcbiAgaW52aXRlRW1haWxzOiBzdHJpbmdbXSxcclxuICByZWZlcnJhbENvZGU6IHN0cmluZ1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIHNlbnQ/OiBudW1iZXI7XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICAvLyBWYWxpZGF0ZSBlbWFpbCBhZGRyZXNzZXNcclxuICAgIGNvbnN0IHZhbGlkRW1haWxzID0gaW52aXRlRW1haWxzXHJcbiAgICAgIC5tYXAoKGUpID0+IGUudHJpbSgpKVxyXG4gICAgICAuZmlsdGVyKChlKSA9PiB7XHJcbiAgICAgICAgaWYgKCFlKSByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgcmV0dXJuIC9eW15cXHNAXStAW15cXHNAXStcXC5bXlxcc0BdKyQvLnRlc3QoZSk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgIGlmICh2YWxpZEVtYWlscy5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTm8gdmFsaWQgZW1haWwgYWRkcmVzc2VzIHByb3ZpZGVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENyZWF0ZSByZWZlcnJhbCByZWNvcmRzIGZvciB0cmFja2luZ1xyXG4gICAgY29uc3QgcmVmZXJyYWxSZWNvcmRzID0gdmFsaWRFbWFpbHMubWFwKChyZWZlcnJlZEVtYWlsKSA9PiAoe1xyXG4gICAgICByZWZlcnJlcl9lbWFpbDogZW1haWwsXHJcbiAgICAgIHJlZmVycmVkX2VtYWlsOiByZWZlcnJlZEVtYWlsLFxyXG4gICAgICByZWZlcnJhbF9jb2RlOiByZWZlcnJhbENvZGUsXHJcbiAgICAgIHN0YXR1czogJ3BlbmRpbmcnLFxyXG4gICAgfSkpO1xyXG5cclxuICAgIGNvbnN0IHsgZXJyb3I6IGluc2VydEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgncmVmZXJyYWxzJylcclxuICAgICAgLmluc2VydChyZWZlcnJhbFJlY29yZHMpO1xyXG5cclxuICAgIGlmIChpbnNlcnRFcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjcmVhdGluZyByZWZlcnJhbCByZWNvcmRzOicsIGluc2VydEVycm9yKTtcclxuICAgICAgLy8gQ29udGludWUgZXZlbiBpZiBpbnNlcnQgZmFpbHMgLSB3ZSBzdGlsbCB3YW50IHRvIHNlbmQgZW1haWxzXHJcbiAgICB9XHJcblxyXG4gICAgLy8gR2VuZXJhdGUgcmVmZXJyYWwgbGlua1xyXG4gICAgY29uc3QgYmFzZVVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NJVEVfVVJMIHx8ICdodHRwczovL3NoYWxlYW4uY28uemEnO1xyXG4gICAgY29uc3QgcmVmZXJyYWxMaW5rID0gYCR7YmFzZVVybH0vYm9va2luZy9kZXRhaWxzP3JlZj0ke3JlZmVycmFsQ29kZX1gO1xyXG5cclxuICAgIC8vIFRPRE86IEltcGxlbWVudCBhY3R1YWwgZW1haWwgc2VuZGluZyB1c2luZyB5b3VyIGVtYWlsIHNlcnZpY2UgKFJlc2VuZCwgU2VuZEdyaWQsIGV0Yy4pXHJcbiAgICAvLyBGb3Igbm93LCB3ZSdsbCBqdXN0IGxvZyB0aGUgZW1haWxzIHRoYXQgd291bGQgYmUgc2VudFxyXG4gICAgY29uc29sZS5sb2coJ1JlZmVycmFsIGludml0ZXMgdG8gc2VuZDonLCB7XHJcbiAgICAgIGZyb206IGVtYWlsLFxyXG4gICAgICB0bzogdmFsaWRFbWFpbHMsXHJcbiAgICAgIHJlZmVycmFsQ29kZSxcclxuICAgICAgcmVmZXJyYWxMaW5rLFxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gSW4gYSByZWFsIGltcGxlbWVudGF0aW9uLCB5b3Ugd291bGQgc2VuZCBlbWFpbHMgaGVyZVxyXG4gICAgLy8gRXhhbXBsZSB3aXRoIFJlc2VuZDpcclxuICAgIC8vIGF3YWl0IHJlc2VuZC5lbWFpbHMuc2VuZCh7XHJcbiAgICAvLyAgIGZyb206ICdTaGFsZWFuIDxub3JlcGx5QHNoYWxlYW4uY28uemE+JyxcclxuICAgIC8vICAgdG86IHZhbGlkRW1haWxzLFxyXG4gICAgLy8gICBzdWJqZWN0OiAnWW91XFwndmUgYmVlbiBpbnZpdGVkIHRvIHRyeSBTaGFsZWFuIENsZWFuaW5nIFNlcnZpY2VzIScsXHJcbiAgICAvLyAgIGh0bWw6IGA8cD5Zb3VyIGZyaWVuZCBoYXMgaW52aXRlZCB5b3UgdG8gdHJ5IFNoYWxlYW4uIFVzZSBjb2RlICR7cmVmZXJyYWxDb2RlfSB0byBnZXQgUjE1MCBvZmYgeW91ciBmaXJzdCBib29raW5nITwvcD48cD48YSBocmVmPVwiJHtyZWZlcnJhbExpbmt9XCI+Qm9vayBOb3c8L2E+PC9wPmAsXHJcbiAgICAvLyB9KTtcclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBzZW50OiB2YWxpZEVtYWlscy5sZW5ndGggfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gc2VuZFJlZmVycmFsSW52aXRlczonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBzZW5kIGludml0ZXMnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRSZWZlcnJhbFN0YXRzKFxyXG4gIGVtYWlsOiBzdHJpbmdcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBzdGF0cz86IHtcclxuICAgIHRvdGFsUmVmZXJyYWxzOiBudW1iZXI7XHJcbiAgICBjb21wbGV0ZWRSZWZlcnJhbHM6IG51bWJlcjtcclxuICAgIHBlbmRpbmdSZXdhcmRzOiBudW1iZXI7XHJcbiAgICB0b3RhbFJld2FyZHM6IG51bWJlcjtcclxuICB9O1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgY29uc3QgeyBkYXRhOiByZWZlcnJhbHMsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgncmVmZXJyYWxzJylcclxuICAgICAgLnNlbGVjdCgnc3RhdHVzLCByZWZlcnJlcl9yZXdhcmRfYW1vdW50LCByZWZlcnJlcl9yZXdhcmRfc3RhdHVzJylcclxuICAgICAgLmVxKCdyZWZlcnJlcl9lbWFpbCcsIGVtYWlsKTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgcmVmZXJyYWwgc3RhdHM6JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBzdGF0cyA9IHtcclxuICAgICAgdG90YWxSZWZlcnJhbHM6IHJlZmVycmFscz8ubGVuZ3RoIHx8IDAsXHJcbiAgICAgIGNvbXBsZXRlZFJlZmVycmFsczpcclxuICAgICAgICByZWZlcnJhbHM/LmZpbHRlcigocikgPT4gci5zdGF0dXMgPT09ICdjb21wbGV0ZWQnKS5sZW5ndGggfHwgMCxcclxuICAgICAgcGVuZGluZ1Jld2FyZHM6XHJcbiAgICAgICAgcmVmZXJyYWxzPy5maWx0ZXIoKHIpID0+IHIucmVmZXJyZXJfcmV3YXJkX3N0YXR1cyA9PT0gJ3BlbmRpbmcnKS5sZW5ndGggfHwgMCxcclxuICAgICAgdG90YWxSZXdhcmRzOlxyXG4gICAgICAgIHJlZmVycmFsc1xyXG4gICAgICAgICAgPy5maWx0ZXIoKHIpID0+IHIucmVmZXJyZXJfcmV3YXJkX3N0YXR1cyA9PT0gJ2NyZWRpdGVkJylcclxuICAgICAgICAgIC5yZWR1Y2UoKHN1bSwgcikgPT4gc3VtICsgKHIucmVmZXJyZXJfcmV3YXJkX2Ftb3VudCB8fCAwKSwgMCkgfHwgMCxcclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgc3RhdHMgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gZ2V0UmVmZXJyYWxTdGF0czonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBmZXRjaCByZWZlcnJhbCBzdGF0cycsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIEluaXRpYWxpemUgYSBjcmVkaXQgcHVyY2hhc2Ugd2l0aCBQYXlzdGFja1xyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGluaXRpYWxpemVDcmVkaXRQdXJjaGFzZShcclxuICBlbWFpbDogc3RyaW5nLFxyXG4gIGFtb3VudDogbnVtYmVyLFxyXG4gIHBheW1lbnRNZXRob2Q6ICdjcmVkaXRfY2FyZCcgfCAnZWZ0J1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGF1dGhvcml6YXRpb25Vcmw/OiBzdHJpbmc7XHJcbiAgcmVmZXJlbmNlPzogc3RyaW5nO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGlmIChhbW91bnQgPCAyMCB8fCBhbW91bnQgPiA1MDAwKSB7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6ICdBbW91bnQgbXVzdCBiZSBiZXR3ZWVuIFIyMCBhbmQgUjUwMDAnLFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEdlbmVyYXRlIGEgdW5pcXVlIHJlZmVyZW5jZSBmb3IgdGhpcyBjcmVkaXQgcHVyY2hhc2VcclxuICAgIGNvbnN0IHJlZmVyZW5jZSA9IGBDUkVESVRfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cmluZygyLCA5KX1gO1xyXG5cclxuICAgIC8vIENyZWF0ZSBhIHBlbmRpbmcgY3JlZGl0IHRyYW5zYWN0aW9uXHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG4gICAgXHJcbiAgICAvLyBHZXQgb3IgY3JlYXRlIHByb2ZpbGVcclxuICAgIGxldCB7IGRhdGE6IHByb2ZpbGUgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgIC5zZWxlY3QoJ2lkLCBjcmVkaXRfYmFsYW5jZScpXHJcbiAgICAgIC5lcSgnZW1haWwnLCBlbWFpbClcclxuICAgICAgLm1heWJlU2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKCFwcm9maWxlKSB7XHJcbiAgICAgIC8vIENyZWF0ZSBhIGJhc2ljIHByb2ZpbGUgaWYgaXQgZG9lc24ndCBleGlzdFxyXG4gICAgICBjb25zdCB7IGRhdGE6IG5ld1Byb2ZpbGUsIGVycm9yOiBjcmVhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgIC5pbnNlcnQoe1xyXG4gICAgICAgICAgZW1haWwsXHJcbiAgICAgICAgICBjcmVkaXRfYmFsYW5jZTogMCxcclxuICAgICAgICAgIGZpcnN0X25hbWU6ICcnLFxyXG4gICAgICAgICAgbGFzdF9uYW1lOiAnJyxcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5zZWxlY3QoJ2lkLCBjcmVkaXRfYmFsYW5jZScpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgaWYgKGNyZWF0ZUVycm9yIHx8ICFuZXdQcm9maWxlKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgZXJyb3I6ICdGYWlsZWQgdG8gY3JlYXRlIHByb2ZpbGUnLFxyXG4gICAgICAgIH07XHJcbiAgICAgIH1cclxuICAgICAgcHJvZmlsZSA9IG5ld1Byb2ZpbGU7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ3JlYXRlIHBlbmRpbmcgY3JlZGl0IHRyYW5zYWN0aW9uXHJcbiAgICBjb25zdCB7IGVycm9yOiB0cmFuc2FjdGlvbkVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnY3JlZGl0X3RyYW5zYWN0aW9ucycpXHJcbiAgICAgIC5pbnNlcnQoe1xyXG4gICAgICAgIHByb2ZpbGVfaWQ6IHByb2ZpbGUuaWQsXHJcbiAgICAgICAgZW1haWwsXHJcbiAgICAgICAgdHJhbnNhY3Rpb25fdHlwZTogJ3B1cmNoYXNlJyxcclxuICAgICAgICBhbW91bnQsXHJcbiAgICAgICAgYmFsYW5jZV9iZWZvcmU6IHByb2ZpbGUuY3JlZGl0X2JhbGFuY2UgfHwgMCxcclxuICAgICAgICBiYWxhbmNlX2FmdGVyOiBwcm9maWxlLmNyZWRpdF9iYWxhbmNlIHx8IDAsIC8vIFdvbid0IHVwZGF0ZSB1bnRpbCBwYXltZW50IHN1Y2NlZWRzXHJcbiAgICAgICAgcGF5bWVudF9tZXRob2Q6IHBheW1lbnRNZXRob2QsXHJcbiAgICAgICAgcGF5c3RhY2tfcmVmZXJlbmNlOiByZWZlcmVuY2UsXHJcbiAgICAgICAgcGF5bWVudF9zdGF0dXM6ICdwZW5kaW5nJyxcclxuICAgICAgICBkZXNjcmlwdGlvbjogYFB1cmNoYXNlIG9mIFIke2Ftb3VudH0gU2hhbGVhbkNyZWRgLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICBpZiAodHJhbnNhY3Rpb25FcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjcmVhdGluZyBjcmVkaXQgdHJhbnNhY3Rpb246JywgdHJhbnNhY3Rpb25FcnJvcik7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6ICdGYWlsZWQgdG8gY3JlYXRlIHRyYW5zYWN0aW9uIHJlY29yZCcsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gSW5pdGlhbGl6ZSBQYXlzdGFjayBwYXltZW50XHJcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKCcvYXBpL3BheXN0YWNrL2luaXRpYWxpemUnLCB7XHJcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgfSxcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIGVtYWlsLFxyXG4gICAgICAgIGFtb3VudCxcclxuICAgICAgICByZWZlcmVuY2UsXHJcbiAgICAgICAgbWV0YWRhdGE6IHtcclxuICAgICAgICAgIHRyYW5zYWN0aW9uX3R5cGU6ICdjcmVkaXRfcHVyY2hhc2UnLFxyXG4gICAgICAgICAgcGF5bWVudF9tZXRob2Q6IHBheW1lbnRNZXRob2QsXHJcbiAgICAgICAgfSxcclxuICAgICAgfSksXHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XHJcbiAgICAgIGNvbnN0IGVycm9yID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIGVycm9yOiBlcnJvci5lcnJvciB8fCAnRmFpbGVkIHRvIGluaXRpYWxpemUgcGF5bWVudCcsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcGF5bWVudERhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XHJcblxyXG4gICAgaWYgKCFwYXltZW50RGF0YS5zdGF0dXMpIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogcGF5bWVudERhdGEubWVzc2FnZSB8fCAnRmFpbGVkIHRvIGluaXRpYWxpemUgcGF5bWVudCcsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgYXV0aG9yaXphdGlvblVybDogcGF5bWVudERhdGEuZGF0YS5hdXRob3JpemF0aW9uX3VybCxcclxuICAgICAgcmVmZXJlbmNlOiBwYXltZW50RGF0YS5kYXRhLnJlZmVyZW5jZSxcclxuICAgIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluaXRpYWxpemluZyBjcmVkaXQgcHVyY2hhc2U6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gaW5pdGlhbGl6ZSBwYXltZW50JyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFZvdWNoZXJSZWRlbXB0aW9uIHtcclxuICBpZDogc3RyaW5nO1xyXG4gIHZvdWNoZXJfY29kZTogc3RyaW5nO1xyXG4gIGFtb3VudDogbnVtYmVyO1xyXG4gIHJlZGVlbWVkX2F0OiBzdHJpbmc7XHJcbiAgYm9va2luZ19pZD86IHN0cmluZztcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJlZGVlbVZvdWNoZXIoXHJcbiAgY29kZTogc3RyaW5nLFxyXG4gIGVtYWlsOiBzdHJpbmcsXHJcbiAgcGhvbmU/OiBzdHJpbmdcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBhbW91bnQ/OiBudW1iZXI7XHJcbiAgbmV3QmFsYW5jZT86IG51bWJlcjtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIENhbGwgdGhlIGRhdGFiYXNlIGZ1bmN0aW9uIHRvIHJlZGVlbSB0aGUgdm91Y2hlclxyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UucnBjKCdyZWRlZW1fdm91Y2hlcicsIHtcclxuICAgICAgcF9jb2RlOiBjb2RlLnRyaW0oKS50b1VwcGVyQ2FzZSgpLFxyXG4gICAgICBwX2VtYWlsOiBlbWFpbC50cmltKCksXHJcbiAgICAgIHBfcGhvbmU6IHBob25lPy50cmltKCkgfHwgbnVsbCxcclxuICAgIH0pO1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciByZWRlZW1pbmcgdm91Y2hlcjonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byByZWRlZW0gdm91Y2hlcicsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gUGFyc2UgdGhlIHJlc3VsdCBmcm9tIHRoZSBmdW5jdGlvbiAoaGFuZGxlIGJvdGggb2JqZWN0IGFuZCBzdHJpbmcgSlNPTkIpXHJcbiAgICBsZXQgcmVzdWx0ID0gZGF0YTtcclxuICAgIGlmICh0eXBlb2YgZGF0YSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICByZXN1bHQgPSBKU09OLnBhcnNlKGRhdGEpO1xyXG4gICAgICB9IGNhdGNoIChwYXJzZUVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgcGFyc2luZyB2b3VjaGVyIHJlZGVtcHRpb24gcmVzdWx0OicsIHBhcnNlRXJyb3IpO1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgIGVycm9yOiAnSW52YWxpZCByZXNwb25zZSBmcm9tIHNlcnZlcicsXHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGlmIChyZXN1bHQgJiYgdHlwZW9mIHJlc3VsdCA9PT0gJ29iamVjdCcgJiYgJ3N1Y2Nlc3MnIGluIHJlc3VsdCkge1xyXG4gICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgZXJyb3I6IHJlc3VsdC5lcnJvciB8fCAnRmFpbGVkIHRvIHJlZGVlbSB2b3VjaGVyJyxcclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcblxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgYW1vdW50OiByZXN1bHQuYW1vdW50LFxyXG4gICAgICAgIG5ld0JhbGFuY2U6IHJlc3VsdC5uZXdfYmFsYW5jZSxcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6ICdVbmV4cGVjdGVkIHJlc3BvbnNlIGZyb20gc2VydmVyJyxcclxuICAgIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHJlZGVlbVZvdWNoZXI6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gcmVkZWVtIHZvdWNoZXInLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRWb3VjaGVyUmVkZW1wdGlvbnMoXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBwaG9uZT86IHN0cmluZ1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIHJlZGVtcHRpb25zPzogVm91Y2hlclJlZGVtcHRpb25bXTtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIGxldCBxdWVyeSA9IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCd2b3VjaGVyX3JlZGVtcHRpb25zJylcclxuICAgICAgLnNlbGVjdCgnaWQsIHZvdWNoZXJfY29kZSwgYW1vdW50LCByZWRlZW1lZF9hdCwgYm9va2luZ19pZCcpXHJcbiAgICAgIC5vcmRlcigncmVkZWVtZWRfYXQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSk7XHJcblxyXG4gICAgLy8gQnVpbGQgcXVlcnkgZm9yIGVtYWlsL3Bob25lIGxvb2t1cFxyXG4gICAgLy8gUHJpb3JpdGl6ZSBlbWFpbCBhcyBpdCdzIHRoZSBwcmltYXJ5IGlkZW50aWZpZXIgdG8gcHJldmVudCBjcm9zcy1hY2NvdW50IHZpc2liaWxpdHlcclxuICAgIGlmIChlbWFpbCkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdlbWFpbCcsIGVtYWlsKTtcclxuICAgICAgLy8gSWYgcGhvbmUgaXMgYWxzbyBwcm92aWRlZCwgd2UgY2FuIG9wdGlvbmFsbHkgZmlsdGVyIGJ5IGJvdGggZm9yIGV4dHJhIHNlY3VyaXR5XHJcbiAgICAgIC8vIGJ1dCBlbWFpbCBhbG9uZSBzaG91bGQgYmUgc3VmZmljaWVudCBzaW5jZSBpdCdzIHVuaXF1ZVxyXG4gICAgfSBlbHNlIGlmIChwaG9uZSkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdwaG9uZScsIHBob25lKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0VtYWlsIG9yIHBob25lIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHF1ZXJ5O1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyB2b3VjaGVyIHJlZGVtcHRpb25zOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVHJhbnNmb3JtIHRoZSBkYXRhIHRvIG1hdGNoIHRoZSBpbnRlcmZhY2VcclxuICAgIGNvbnN0IHJlZGVtcHRpb25zOiBWb3VjaGVyUmVkZW1wdGlvbltdID0gKGRhdGEgfHwgW10pLm1hcCgocmVkZW1wdGlvbikgPT4gKHtcclxuICAgICAgaWQ6IHJlZGVtcHRpb24uaWQsXHJcbiAgICAgIHZvdWNoZXJfY29kZTogcmVkZW1wdGlvbi52b3VjaGVyX2NvZGUsXHJcbiAgICAgIGFtb3VudDogcmVkZW1wdGlvbi5hbW91bnQsXHJcbiAgICAgIHJlZGVlbWVkX2F0OiByZWRlbXB0aW9uLnJlZGVlbWVkX2F0LFxyXG4gICAgICBib29raW5nX2lkOiByZWRlbXB0aW9uLmJvb2tpbmdfaWQgfHwgdW5kZWZpbmVkLFxyXG4gICAgfSkpO1xyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHJlZGVtcHRpb25zIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGdldFZvdWNoZXJSZWRlbXB0aW9uczonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBmZXRjaCB2b3VjaGVyIHJlZGVtcHRpb25zJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG4iXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6ImtTQThZc0Isa01BQUEifQ==
}),
"[project]/app/dashboard/data:8e0d87 [app-ssr] (ecmascript) <text/javascript>", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "getAuthenticatedUser",
    ()=>$$RSC_SERVER_ACTION_0
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-ssr] (ecmascript)");
/* __next_internal_action_entry_do_not_use__ [{"00d62cc413d9b16ce2ea0ff37e9486d3704f49d049":"getAuthenticatedUser"},"app/dashboard/actions.ts",""] */ "use turbopack no side effects";
;
const $$RSC_SERVER_ACTION_0 = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["createServerReference"])("00d62cc413d9b16ce2ea0ff37e9486d3704f49d049", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["findSourceMapURL"], "getAuthenticatedUser");
;
 //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vYWN0aW9ucy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHNlcnZlcic7XHJcblxyXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAL2xpYi9zdXBhYmFzZS9zZXJ2ZXInO1xyXG5pbXBvcnQgeyBjcmVhdGVBZG1pbkNsaWVudCB9IGZyb20gJ0AvbGliL3N1cGFiYXNlL3NlcnZlci1hZG1pbic7XHJcbmltcG9ydCB7IEJvb2tpbmcgfSBmcm9tICdAL3R5cGVzL2Jvb2tpbmcnO1xyXG5pbXBvcnQgeyBQcm9maWxlLCBQcm9maWxlVXBkYXRlSW5wdXQgfSBmcm9tICdAL3R5cGVzL3Byb2ZpbGUnO1xyXG5pbXBvcnQgeyBMb2NhdGlvbiwgTG9jYXRpb25DcmVhdGVJbnB1dCwgTG9jYXRpb25VcGRhdGVJbnB1dCB9IGZyb20gJ0AvdHlwZXMvbG9jYXRpb24nO1xyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEF1dGhlbnRpY2F0ZWRVc2VyKCk6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgZW1haWw/OiBzdHJpbmc7XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuICAgIGNvbnN0IHsgZGF0YTogeyB1c2VyIH0sIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcclxuXHJcbiAgICBpZiAoZXJyb3IgfHwgIXVzZXIpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTm90IGF1dGhlbnRpY2F0ZWQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgZW1haWw6IHVzZXIuZW1haWwgfHwgdW5kZWZpbmVkIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGdldEF1dGhlbnRpY2F0ZWRVc2VyOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGdldCB1c2VyJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q3VzdG9tZXJCb29raW5ncyhcclxuICBlbWFpbDogc3RyaW5nLFxyXG4gIHBob25lPzogc3RyaW5nLFxyXG4gIGZpbHRlcj86ICdhbGwnIHwgJ3VwY29taW5nJyB8ICdjb21wbGV0ZWQnIHwgJ2NhbmNlbGxlZCdcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBib29raW5ncz86IEJvb2tpbmdbXTtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIGxldCBxdWVyeSA9IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdib29raW5ncycpXHJcbiAgICAgIC5zZWxlY3QoJyonKVxyXG4gICAgICAub3JkZXIoJ3NlcnZpY2VfZGF0ZScsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KVxyXG4gICAgICAub3JkZXIoJ2NyZWF0ZWRfYXQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSk7XHJcblxyXG4gICAgLy8gQnVpbGQgcXVlcnkgZm9yIGVtYWlsL3Bob25lIGxvb2t1cFxyXG4gICAgaWYgKGVtYWlsICYmIHBob25lKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkub3IoYGN1c3RvbWVyX2VtYWlsLmVxLiR7ZW1haWx9LGN1c3RvbWVyX3Bob25lLmVxLiR7cGhvbmV9YCk7XHJcbiAgICB9IGVsc2UgaWYgKGVtYWlsKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ2N1c3RvbWVyX2VtYWlsJywgZW1haWwpO1xyXG4gICAgfSBlbHNlIGlmIChwaG9uZSkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdjdXN0b21lcl9waG9uZScsIHBob25lKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0VtYWlsIG9yIHBob25lIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEFwcGx5IHN0YXR1cyBmaWx0ZXJcclxuICAgIGlmIChmaWx0ZXIgJiYgZmlsdGVyICE9PSAnYWxsJykge1xyXG4gICAgICBpZiAoZmlsdGVyID09PSAndXBjb21pbmcnKSB7XHJcbiAgICAgICAgcXVlcnkgPSBxdWVyeS5pbignc3RhdHVzJywgWydwZW5kaW5nJywgJ2NvbmZpcm1lZCddKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdzdGF0dXMnLCBmaWx0ZXIpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgcXVlcnk7XHJcblxyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGJvb2tpbmdzOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYm9va2luZ3M6IGRhdGEgfHwgW10gfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gZ2V0Q3VzdG9tZXJCb29raW5nczonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBmZXRjaCBib29raW5ncycsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEN1c3RvbWVyQm9va2luZ1N0YXRzKFxyXG4gIGVtYWlsOiBzdHJpbmcsXHJcbiAgcGhvbmU/OiBzdHJpbmdcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBzdGF0cz86IHtcclxuICAgIHRvdGFsOiBudW1iZXI7XHJcbiAgICB1cGNvbWluZzogbnVtYmVyO1xyXG4gICAgY29tcGxldGVkOiBudW1iZXI7XHJcbiAgICBjYW5jZWxsZWQ6IG51bWJlcjtcclxuICAgIHRvdGFsU3BlbnQ6IG51bWJlcjtcclxuICB9O1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgbGV0IHF1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2Jvb2tpbmdzJylcclxuICAgICAgLnNlbGVjdCgnc3RhdHVzLCB0b3RhbF9hbW91bnQsIHBheW1lbnRfc3RhdHVzJyk7XHJcblxyXG4gICAgLy8gQnVpbGQgcXVlcnkgZm9yIGVtYWlsL3Bob25lIGxvb2t1cFxyXG4gICAgaWYgKGVtYWlsICYmIHBob25lKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkub3IoYGN1c3RvbWVyX2VtYWlsLmVxLiR7ZW1haWx9LGN1c3RvbWVyX3Bob25lLmVxLiR7cGhvbmV9YCk7XHJcbiAgICB9IGVsc2UgaWYgKGVtYWlsKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ2N1c3RvbWVyX2VtYWlsJywgZW1haWwpO1xyXG4gICAgfSBlbHNlIGlmIChwaG9uZSkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdjdXN0b21lcl9waG9uZScsIHBob25lKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0VtYWlsIG9yIHBob25lIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHF1ZXJ5O1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBzdGF0cyA9IHtcclxuICAgICAgdG90YWw6IGRhdGE/Lmxlbmd0aCB8fCAwLFxyXG4gICAgICB1cGNvbWluZzogZGF0YT8uZmlsdGVyKChiKSA9PiBiLnN0YXR1cyA9PT0gJ3BlbmRpbmcnIHx8IGIuc3RhdHVzID09PSAnY29uZmlybWVkJykubGVuZ3RoIHx8IDAsXHJcbiAgICAgIGNvbXBsZXRlZDogZGF0YT8uZmlsdGVyKChiKSA9PiBiLnN0YXR1cyA9PT0gJ2NvbXBsZXRlZCcpLmxlbmd0aCB8fCAwLFxyXG4gICAgICBjYW5jZWxsZWQ6IGRhdGE/LmZpbHRlcigoYikgPT4gYi5zdGF0dXMgPT09ICdjYW5jZWxsZWQnKS5sZW5ndGggfHwgMCxcclxuICAgICAgdG90YWxTcGVudDogZGF0YVxyXG4gICAgICAgID8uZmlsdGVyKChiKSA9PiBiLnBheW1lbnRfc3RhdHVzID09PSAncGFpZCcpXHJcbiAgICAgICAgLnJlZHVjZSgoc3VtLCBiKSA9PiBzdW0gKyAoYi50b3RhbF9hbW91bnQgfHwgMCksIDApIHx8IDAsXHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHN0YXRzIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGZldGNoIHN0YXRzJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Qm9va2luZ0J5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgYm9va2luZz86IEJvb2tpbmc7XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnYm9va2luZ3MnKVxyXG4gICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgLmVxKCdpZCcsIGlkKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGJvb2tpbmc6JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdCb29raW5nIG5vdCBmb3VuZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBib29raW5nOiBkYXRhIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ1VuZXhwZWN0ZWQgZXJyb3IgZmV0Y2hpbmcgYm9va2luZzonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0FuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDdXN0b21lclByb2ZpbGUoXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBwaG9uZT86IHN0cmluZ1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIHByb2ZpbGU/OiBQcm9maWxlO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgLy8gRmlyc3QsIHRyeSB0byBnZXQgcHJvZmlsZSBmcm9tIHByb2ZpbGVzIHRhYmxlXHJcbiAgICBsZXQgcXVlcnkgPSBzdXBhYmFzZS5mcm9tKCdwcm9maWxlcycpLnNlbGVjdCgnKicpO1xyXG5cclxuICAgIGlmIChlbWFpbCkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdlbWFpbCcsIGVtYWlsKTtcclxuICAgIH0gZWxzZSBpZiAocGhvbmUpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgncGhvbmUnLCBwaG9uZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdFbWFpbCBvciBwaG9uZSBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB7IGRhdGE6IHByb2ZpbGVEYXRhLCBlcnJvcjogcHJvZmlsZUVycm9yIH0gPSBhd2FpdCBxdWVyeS5tYXliZVNpbmdsZSgpO1xyXG5cclxuICAgIC8vIElmIHByb2ZpbGUgZXhpc3RzLCByZXR1cm4gaXRcclxuICAgIGlmIChwcm9maWxlRGF0YSAmJiAhcHJvZmlsZUVycm9yKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHByb2ZpbGU6IHByb2ZpbGVEYXRhIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gSWYgbm8gcHJvZmlsZSBleGlzdHMsIGRlcml2ZSBmcm9tIG1vc3QgcmVjZW50IGJvb2tpbmdcclxuICAgIGxldCBib29raW5nUXVlcnkgPSBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnYm9va2luZ3MnKVxyXG4gICAgICAuc2VsZWN0KCdjdXN0b21lcl9maXJzdF9uYW1lLCBjdXN0b21lcl9sYXN0X25hbWUsIGN1c3RvbWVyX2VtYWlsLCBjdXN0b21lcl9waG9uZScpXHJcbiAgICAgIC5vcmRlcignY3JlYXRlZF9hdCcsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KVxyXG4gICAgICAubGltaXQoMSk7XHJcblxyXG4gICAgaWYgKGVtYWlsICYmIHBob25lKSB7XHJcbiAgICAgIGJvb2tpbmdRdWVyeSA9IGJvb2tpbmdRdWVyeS5vcihgY3VzdG9tZXJfZW1haWwuZXEuJHtlbWFpbH0sY3VzdG9tZXJfcGhvbmUuZXEuJHtwaG9uZX1gKTtcclxuICAgIH0gZWxzZSBpZiAoZW1haWwpIHtcclxuICAgICAgYm9va2luZ1F1ZXJ5ID0gYm9va2luZ1F1ZXJ5LmVxKCdjdXN0b21lcl9lbWFpbCcsIGVtYWlsKTtcclxuICAgIH0gZWxzZSBpZiAocGhvbmUpIHtcclxuICAgICAgYm9va2luZ1F1ZXJ5ID0gYm9va2luZ1F1ZXJ5LmVxKCdjdXN0b21lcl9waG9uZScsIHBob25lKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB7IGRhdGE6IGJvb2tpbmdEYXRhLCBlcnJvcjogYm9va2luZ0Vycm9yIH0gPSBhd2FpdCBib29raW5nUXVlcnkubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoYm9va2luZ0Vycm9yIHx8ICFib29raW5nRGF0YSkge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIGVycm9yOiAnTm8gcHJvZmlsZSBvciBib29raW5nIGZvdW5kLiBQbGVhc2UgY3JlYXRlIGEgYm9va2luZyBmaXJzdC4nLFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENyZWF0ZSBhIHByb2ZpbGUgb2JqZWN0IGZyb20gYm9va2luZyBkYXRhXHJcbiAgICBjb25zdCBkZXJpdmVkUHJvZmlsZTogUHJvZmlsZSA9IHtcclxuICAgICAgaWQ6ICcnLCAvLyBXaWxsIGJlIGdlbmVyYXRlZCB3aGVuIHNhdmVkXHJcbiAgICAgIGVtYWlsOiBib29raW5nRGF0YS5jdXN0b21lcl9lbWFpbCxcclxuICAgICAgcGhvbmU6IGJvb2tpbmdEYXRhLmN1c3RvbWVyX3Bob25lIHx8IG51bGwsXHJcbiAgICAgIGZpcnN0X25hbWU6IGJvb2tpbmdEYXRhLmN1c3RvbWVyX2ZpcnN0X25hbWUsXHJcbiAgICAgIGxhc3RfbmFtZTogYm9va2luZ0RhdGEuY3VzdG9tZXJfbGFzdF9uYW1lLFxyXG4gICAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcHJvZmlsZTogZGVyaXZlZFByb2ZpbGUgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gZ2V0Q3VzdG9tZXJQcm9maWxlOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGZldGNoIHByb2ZpbGUnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGxvYWRQcm9maWxlUGljdHVyZShcclxuICBlbWFpbDogc3RyaW5nLFxyXG4gIGZpbGVEYXRhOiBzdHJpbmcsIC8vIGJhc2U2NCBlbmNvZGVkIHN0cmluZ1xyXG4gIGZpbGVOYW1lOiBzdHJpbmcsXHJcbiAgZmlsZVR5cGU6IHN0cmluZ1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIHVybD86IHN0cmluZztcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICAvLyBVc2UgYWRtaW4gY2xpZW50IGZvciBzdG9yYWdlIHVwbG9hZHMgaWYgc2VydmljZSByb2xlIGtleSBpcyBhdmFpbGFibGVcclxuICAgIC8vIFRoaXMgZW5zdXJlcyBzdG9yYWdlIHBvbGljaWVzIGRvbid0IGJsb2NrIHRoZSB1cGxvYWRcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSBcclxuICAgICAgPyBjcmVhdGVBZG1pbkNsaWVudCgpIFxyXG4gICAgICA6IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIFZhbGlkYXRlIGZpbGUgdHlwZVxyXG4gICAgY29uc3QgdmFsaWRJbWFnZVR5cGVzID0gWydpbWFnZS9qcGVnJywgJ2ltYWdlL2pwZycsICdpbWFnZS9wbmcnLCAnaW1hZ2Uvd2VicCddO1xyXG4gICAgaWYgKCF2YWxpZEltYWdlVHlwZXMuaW5jbHVkZXMoZmlsZVR5cGUpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ludmFsaWQgZmlsZSB0eXBlLiBQbGVhc2UgdXBsb2FkIGEgSlBFRywgUE5HLCBvciBXZWJQIGltYWdlLicgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBEZWNvZGUgYmFzZTY0IGRhdGFcclxuICAgIGNvbnN0IGJhc2U2NERhdGEgPSBmaWxlRGF0YS5yZXBsYWNlKC9eZGF0YTppbWFnZVxcL1xcdys7YmFzZTY0LC8sICcnKTtcclxuICAgIGNvbnN0IGJ1ZmZlciA9IEJ1ZmZlci5mcm9tKGJhc2U2NERhdGEsICdiYXNlNjQnKTtcclxuXHJcbiAgICAvLyBWYWxpZGF0ZSBmaWxlIHNpemUgKG1heCA1TUIpXHJcbiAgICBjb25zdCBtYXhTaXplID0gNSAqIDEwMjQgKiAxMDI0OyAvLyA1TUIgaW4gYnl0ZXNcclxuICAgIGlmIChidWZmZXIubGVuZ3RoID4gbWF4U2l6ZSkge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdGaWxlIHNpemUgdG9vIGxhcmdlLiBQbGVhc2UgdXBsb2FkIGFuIGltYWdlIHNtYWxsZXIgdGhhbiA1TUIuJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEdlbmVyYXRlIHVuaXF1ZSBmaWxlbmFtZSB1c2luZyBlbWFpbCBhbmQgdGltZXN0YW1wXHJcbiAgICBjb25zdCBmaWxlRXh0ID0gZmlsZU5hbWUuc3BsaXQoJy4nKS5wb3AoKSB8fCAnanBnJztcclxuICAgIGNvbnN0IHNhbml0aXplZEVtYWlsID0gZW1haWwucmVwbGFjZSgvW15hLXpBLVowLTldL2csICdfJyk7XHJcbiAgICBjb25zdCB1bmlxdWVGaWxlTmFtZSA9IGAke3Nhbml0aXplZEVtYWlsfV8ke0RhdGUubm93KCl9LiR7ZmlsZUV4dH1gO1xyXG4gICAgY29uc3QgZmlsZVBhdGggPSBgYXZhdGFycy8ke3VuaXF1ZUZpbGVOYW1lfWA7XHJcblxyXG4gICAgLy8gVXBsb2FkIHRvIFN1cGFiYXNlIFN0b3JhZ2VcclxuICAgIGNvbnN0IHsgZGF0YTogdXBsb2FkRGF0YSwgZXJyb3I6IHVwbG9hZEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5zdG9yYWdlXHJcbiAgICAgIC5mcm9tKCdwcm9maWxlLXBpY3R1cmVzJylcclxuICAgICAgLnVwbG9hZChmaWxlUGF0aCwgYnVmZmVyLCB7XHJcbiAgICAgICAgY29udGVudFR5cGU6IGZpbGVUeXBlLFxyXG4gICAgICAgIHVwc2VydDogZmFsc2UsXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgaWYgKHVwbG9hZEVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcign4p2MIFN0b3JhZ2UgdXBsb2FkIGVycm9yOicsIHVwbG9hZEVycm9yKTtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdVcGxvYWQgZXJyb3IgZGV0YWlsczonLCB7XHJcbiAgICAgICAgICBtZXNzYWdlOiB1cGxvYWRFcnJvci5tZXNzYWdlLFxyXG4gICAgICAgICAgc3RhdHVzQ29kZTogdXBsb2FkRXJyb3Iuc3RhdHVzQ29kZSxcclxuICAgICAgICAgIGVycm9yOiB1cGxvYWRFcnJvci5lcnJvcixcclxuICAgICAgICB9KTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBDaGVjayBmb3Igc3RvcmFnZSBSTFMgZXJyb3JzXHJcbiAgICAgICAgaWYgKHVwbG9hZEVycm9yLm1lc3NhZ2U/LmluY2x1ZGVzKCdyb3ctbGV2ZWwgc2VjdXJpdHknKSB8fCBcclxuICAgICAgICAgICAgdXBsb2FkRXJyb3IubWVzc2FnZT8uaW5jbHVkZXMoJ1JMUycpIHx8XHJcbiAgICAgICAgICAgIHVwbG9hZEVycm9yLm1lc3NhZ2U/LmluY2x1ZGVzKCdwb2xpY3knKSkge1xyXG4gICAgICAgICAgcmV0dXJuIHsgXHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLCBcclxuICAgICAgICAgICAgZXJyb3I6ICdTdG9yYWdlIGJ1Y2tldCBSTFMgcG9saWN5IGVycm9yLiBQbGVhc2UgY2hlY2sgeW91ciBcInByb2ZpbGUtcGljdHVyZXNcIiBidWNrZXQgcG9saWNpZXMgaW4gU3VwYWJhc2UgU3RvcmFnZS4gVGhlIGJ1Y2tldCBuZWVkcyBwb2xpY2llcyB0aGF0IGFsbG93IGF1dGhlbnRpY2F0ZWQgdXNlcnMgdG8gdXBsb2FkIGZpbGVzLicsXHJcbiAgICAgICAgICAgIGVycm9yRGV0YWlsczogdXBsb2FkRXJyb3IubWVzc2FnZSxcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIElmIGJ1Y2tldCBkb2Vzbid0IGV4aXN0LCByZXR1cm4gaGVscGZ1bCBlcnJvclxyXG4gICAgICAgIGlmICh1cGxvYWRFcnJvci5tZXNzYWdlLmluY2x1ZGVzKCdub3QgZm91bmQnKSB8fCB1cGxvYWRFcnJvci5tZXNzYWdlLmluY2x1ZGVzKCdCdWNrZXQnKSkge1xyXG4gICAgICAgICAgcmV0dXJuIHsgXHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLCBcclxuICAgICAgICAgICAgZXJyb3I6ICdTdG9yYWdlIGJ1Y2tldCBub3QgY29uZmlndXJlZC4gUGxlYXNlIGNyZWF0ZSBhIFwicHJvZmlsZS1waWN0dXJlc1wiIGJ1Y2tldCBpbiBTdXBhYmFzZSBTdG9yYWdlLicsXHJcbiAgICAgICAgICAgIGVycm9yRGV0YWlsczogdXBsb2FkRXJyb3IubWVzc2FnZSxcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB7IFxyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsIFxyXG4gICAgICAgICAgZXJyb3I6IHVwbG9hZEVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byB1cGxvYWQgZmlsZScsXHJcbiAgICAgICAgICBlcnJvckRldGFpbHM6IHVwbG9hZEVycm9yLmVycm9yIHx8IHVwbG9hZEVycm9yLnN0YXR1c0NvZGU/LnRvU3RyaW5nKCksXHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG5cclxuICAgIC8vIEdldCBwdWJsaWMgVVJMXHJcbiAgICBjb25zdCB7IGRhdGE6IHVybERhdGEgfSA9IHN1cGFiYXNlLnN0b3JhZ2VcclxuICAgICAgLmZyb20oJ3Byb2ZpbGUtcGljdHVyZXMnKVxyXG4gICAgICAuZ2V0UHVibGljVXJsKGZpbGVQYXRoKTtcclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCB1cmw6IHVybERhdGEucHVibGljVXJsIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHVwbG9hZFByb2ZpbGVQaWN0dXJlOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIHVwbG9hZCBwcm9maWxlIHBpY3R1cmUnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBkZWxldGVQcm9maWxlUGljdHVyZShlbWFpbDogc3RyaW5nLCBhdmF0YXJVcmw6IHN0cmluZyk6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICAvLyBFeHRyYWN0IGZpbGUgcGF0aCBmcm9tIFVSTFxyXG4gICAgLy8gVVJMIGZvcm1hdDogaHR0cHM6Ly9bcHJvamVjdF0uc3VwYWJhc2UuY28vc3RvcmFnZS92MS9vYmplY3QvcHVibGljL3Byb2ZpbGUtcGljdHVyZXMvYXZhdGFycy9maWxlbmFtZS5qcGdcclxuICAgIGNvbnN0IHVybFBhdHRlcm4gPSAvXFwvcHJvZmlsZS1waWN0dXJlc1xcLyguKykkLztcclxuICAgIGNvbnN0IG1hdGNoID0gYXZhdGFyVXJsLm1hdGNoKHVybFBhdHRlcm4pO1xyXG4gICAgXHJcbiAgICBpZiAoIW1hdGNoIHx8ICFtYXRjaFsxXSkge1xyXG4gICAgICAvLyBJZiBVUkwgZG9lc24ndCBtYXRjaCBleHBlY3RlZCBwYXR0ZXJuLCB0cnkgYWx0ZXJuYXRpdmUgcGFyc2luZ1xyXG4gICAgICBjb25zdCB1cmxQYXJ0cyA9IGF2YXRhclVybC5zcGxpdCgnL2F2YXRhcnMvJyk7XHJcbiAgICAgIGlmICh1cmxQYXJ0cy5sZW5ndGggPCAyKSB7XHJcbiAgICAgICAgLy8gSWYgd2UgY2FuJ3QgcGFyc2UgdGhlIFVSTCwganVzdCByZXR1cm4gc3VjY2VzcyAodGhlIGZpbGUgbWlnaHQgYWxyZWFkeSBiZSBkZWxldGVkKVxyXG4gICAgICAgIGNvbnNvbGUud2FybignQ291bGQgbm90IHBhcnNlIGF2YXRhciBVUkwgZm9yIGRlbGV0aW9uOicsIGF2YXRhclVybCk7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xyXG4gICAgICB9XHJcbiAgICAgIGNvbnN0IGZpbGVQYXRoID0gYGF2YXRhcnMvJHt1cmxQYXJ0c1sxXS5zcGxpdCgnPycpWzBdfWA7XHJcbiAgICAgIGNvbnN0IHsgZXJyb3I6IGRlbGV0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5zdG9yYWdlXHJcbiAgICAgICAgLmZyb20oJ3Byb2ZpbGUtcGljdHVyZXMnKVxyXG4gICAgICAgIC5yZW1vdmUoW2ZpbGVQYXRoXSk7XHJcblxyXG4gICAgICBpZiAoZGVsZXRlRXJyb3IgJiYgIWRlbGV0ZUVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ25vdCBmb3VuZCcpKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZGVsZXRpbmcgZmlsZTonLCBkZWxldGVFcnJvcik7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBkZWxldGVFcnJvci5tZXNzYWdlIH07XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGZpbGVQYXRoID0gbWF0Y2hbMV0uc3BsaXQoJz8nKVswXTsgLy8gUmVtb3ZlIHF1ZXJ5IHBhcmFtZXRlcnMgaWYgYW55XHJcblxyXG4gICAgLy8gRGVsZXRlIGZyb20gc3RvcmFnZVxyXG4gICAgY29uc3QgeyBlcnJvcjogZGVsZXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLnN0b3JhZ2VcclxuICAgICAgLmZyb20oJ3Byb2ZpbGUtcGljdHVyZXMnKVxyXG4gICAgICAucmVtb3ZlKFtmaWxlUGF0aF0pO1xyXG5cclxuICAgIGlmIChkZWxldGVFcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBkZWxldGluZyBmaWxlOicsIGRlbGV0ZUVycm9yKTtcclxuICAgICAgLy8gRG9uJ3QgZmFpbCBpZiBmaWxlIGRvZXNuJ3QgZXhpc3RcclxuICAgICAgaWYgKGRlbGV0ZUVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ25vdCBmb3VuZCcpIHx8IGRlbGV0ZUVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ05vIHN1Y2ggZmlsZScpKSB7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZGVsZXRlRXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gZGVsZXRlUHJvZmlsZVBpY3R1cmU6JywgZXJyb3IpO1xyXG4gICAgLy8gRG9uJ3QgZmFpbCBjb21wbGV0ZWx5IC0gdGhlIFVSTCBpbiBkYXRhYmFzZSB3aWxsIGJlIHJlbW92ZWQgYW55d2F5XHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQ3VzdG9tZXJQcm9maWxlKFxyXG4gIGVtYWlsOiBzdHJpbmcsXHJcbiAgZGF0YTogUHJvZmlsZVVwZGF0ZUlucHV0XHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgcHJvZmlsZT86IFByb2ZpbGU7XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgLy8gRmlyc3QsIHZlcmlmeSB0aGUgYXV0aGVudGljYXRlZCB1c2VyIG1hdGNoZXMgdGhlIGVtYWlsXHJcbiAgICBjb25zdCBhdXRoU3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuICAgIGNvbnN0IHsgZGF0YTogeyB1c2VyIH0sIGVycm9yOiBhdXRoRXJyb3IgfSA9IGF3YWl0IGF1dGhTdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcclxuICAgIFxyXG4gICAgaWYgKGF1dGhFcnJvciB8fCAhdXNlcikge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdOb3QgYXV0aGVudGljYXRlZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBWZXJpZnkgdGhhdCB0aGUgZW1haWwgcGFyYW1ldGVyIG1hdGNoZXMgdGhlIGF1dGhlbnRpY2F0ZWQgdXNlcidzIGVtYWlsXHJcbiAgICAvLyBUaGlzIGVuc3VyZXMgdXNlcnMgY2FuIG9ubHkgdXBkYXRlIHRoZWlyIG93biBwcm9maWxlXHJcbiAgICBpZiAodXNlci5lbWFpbD8udG9Mb3dlckNhc2UoKSAhPT0gZW1haWwudG9Mb3dlckNhc2UoKSAmJiB1c2VyLmVtYWlsPy50b0xvd2VyQ2FzZSgpICE9PSBkYXRhLmVtYWlsPy50b0xvd2VyQ2FzZSgpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ1VuYXV0aG9yaXplZDogWW91IGNhbiBvbmx5IHVwZGF0ZSB5b3VyIG93biBwcm9maWxlJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEFMV0FZUyB1c2UgYWRtaW4gY2xpZW50IGZvciBwcm9maWxlIG9wZXJhdGlvbnMgLSBpdCBieXBhc3NlcyBSTFMgY29tcGxldGVseVxyXG4gICAgLy8gVGhpcyBpcyBSRVFVSVJFRCAtIHdlIGNhbm5vdCB1c2UgYXV0aGVudGljYXRlZCBjbGllbnQgYXMgaXQgbWF5IHN0aWxsIGNoZWNrIFJMUyBwb2xpY2llc1xyXG4gICAgbGV0IHN1cGFiYXNlO1xyXG4gICAgdHJ5IHtcclxuICAgICAgc3VwYWJhc2UgPSBjcmVhdGVBZG1pbkNsaWVudCgpO1xyXG4gICAgICBjb25zb2xlLmxvZygn4pyFIFVzaW5nIGFkbWluIGNsaWVudCBmb3IgcHJvZmlsZSBvcGVyYXRpb25zJyk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAvLyBEbyBOT1QgZmFsbCBiYWNrIHRvIGF1dGhlbnRpY2F0ZWQgY2xpZW50IC0gaXQgd2lsbCBjYXVzZSBSTFMgZXJyb3JzXHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBGYWlsZWQgdG8gY3JlYXRlIGFkbWluIGNsaWVudDonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6ICdTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIGlzIG5vdCBzZXQuIFRoaXMgaXMgUkVRVUlSRUQgZm9yIHByb2ZpbGUgb3BlcmF0aW9ucy4gUGxlYXNlIGFkZCBpdCB0byB5b3VyIC5lbnYubG9jYWwgZmlsZS4gR2V0IGl0IGZyb206IFN1cGFiYXNlIERhc2hib2FyZCDihpIgU2V0dGluZ3Mg4oaSIEFQSSDihpIgc2VydmljZV9yb2xlIGtleSAoc2VjcmV0KScsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIFZlcmlmeSB3ZSBoYXZlIGEgdmFsaWQgY2xpZW50IChzaG91bGQgbmV2ZXIgaGFwcGVuIGR1ZSB0byBlcnJvciBhYm92ZSwgYnV0IGRvdWJsZS1jaGVjaylcclxuICAgIGlmICghc3VwYWJhc2UpIHtcclxuICAgICAgcmV0dXJuIHsgXHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsIFxyXG4gICAgICAgIGVycm9yOiAnRmFpbGVkIHRvIGluaXRpYWxpemUgZGF0YWJhc2UgY2xpZW50LiBQbGVhc2UgY2hlY2sgeW91ciBTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIGluIC5lbnYubG9jYWwnIFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFZhbGlkYXRlIGlucHV0XHJcbiAgICBpZiAoIWRhdGEuZmlyc3RfbmFtZT8udHJpbSgpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ZpcnN0IG5hbWUgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcbiAgICBpZiAoIWRhdGEubGFzdF9uYW1lPy50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTGFzdCBuYW1lIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG4gICAgaWYgKCFkYXRhLmVtYWlsPy50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRW1haWwgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcbiAgICBpZiAoIS9eW15cXHNAXStAW15cXHNAXStcXC5bXlxcc0BdKyQvLnRlc3QoZGF0YS5lbWFpbCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnSW52YWxpZCBlbWFpbCBmb3JtYXQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVmVyaWZ5IHRoZSBuZXcgZW1haWwgKGlmIGNoYW5nZWQpIHN0aWxsIG1hdGNoZXMgdGhlIGF1dGhlbnRpY2F0ZWQgdXNlclxyXG4gICAgaWYgKGRhdGEuZW1haWwudG9Mb3dlckNhc2UoKSAhPT0gdXNlci5lbWFpbD8udG9Mb3dlckNhc2UoKSkge1xyXG4gICAgICAvLyBBbGxvdyBlbWFpbCBjaGFuZ2Ugb25seSBpZiBpdCdzIHRoZSBzYW1lIHVzZXIgKGNhc2UgaW5zZW5zaXRpdmUgY2hlY2sgYWJvdmUgcGFzc2VkKVxyXG4gICAgICAvLyBCdXQgd2Ugc2hvdWxkIHZlcmlmeSBpdCdzIGEgdmFsaWQgY2hhbmdlICh1c2VyIHVwZGF0aW5nIHRoZWlyIG93biBlbWFpbClcclxuICAgICAgaWYgKGRhdGEuZW1haWwudG9Mb3dlckNhc2UoKSAhPT0gZW1haWwudG9Mb3dlckNhc2UoKSkge1xyXG4gICAgICAgIC8vIEVtYWlsIGlzIGJlaW5nIGNoYW5nZWQgLSB2ZXJpZnkgaXQncyBzdGlsbCB0aGUgc2FtZSB1c2VyXHJcbiAgICAgICAgLy8gRm9yIG5vdywgd2UnbGwgYWxsb3cgaXQgYnV0IGluIHByb2R1Y3Rpb24geW91IG1pZ2h0IHdhbnQgdG8gcmVxdWlyZSBlbWFpbCB2ZXJpZmljYXRpb25cclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIENoZWNrIGlmIHByb2ZpbGUgZXhpc3RzXHJcbiAgICBjb25zb2xlLmxvZygn8J+UjSBDaGVja2luZyBpZiBwcm9maWxlIGV4aXN0cyBmb3IgZW1haWw6JywgZW1haWwpO1xyXG4gICAgY29uc29sZS5sb2coJ/CflI0gVXNpbmcgY2xpZW50IHR5cGU6JywgcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSA/ICdBRE1JTiAoc2VydmljZSByb2xlKScgOiAnQVVUSEVOVElDQVRFRCAoYW5vbiBrZXkpJyk7XHJcbiAgICBcclxuICAgIGNvbnN0IHsgZGF0YTogZXhpc3RpbmdQcm9maWxlLCBlcnJvcjogc2VsZWN0RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgIC5zZWxlY3QoJyonKVxyXG4gICAgICAuZXEoJ2VtYWlsJywgZW1haWwpXHJcbiAgICAgIC5tYXliZVNpbmdsZSgpO1xyXG4gICAgXHJcbiAgICBpZiAoc2VsZWN0RXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIHNlbGVjdGluZyBwcm9maWxlOicsIHNlbGVjdEVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBgRmFpbGVkIHRvIGNoZWNrIHByb2ZpbGU6ICR7c2VsZWN0RXJyb3IubWVzc2FnZX1gIH07XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGNvbnNvbGUubG9nKCfinIUgUHJvZmlsZSBjaGVjayByZXN1bHQ6JywgZXhpc3RpbmdQcm9maWxlID8gJ1Byb2ZpbGUgZXhpc3RzICh3aWxsIFVQREFURSknIDogJ1Byb2ZpbGUgZG9lcyBub3QgZXhpc3QgKHdpbGwgSU5TRVJUKScpO1xyXG5cclxuICAgIC8vIElmIGF2YXRhcl91cmwgaXMgYmVpbmcgcmVtb3ZlZCwgZGVsZXRlIHRoZSBvbGQgZmlsZVxyXG4gICAgaWYgKGV4aXN0aW5nUHJvZmlsZT8uYXZhdGFyX3VybCAmJiBkYXRhLmF2YXRhcl91cmwgPT09IG51bGwpIHtcclxuICAgICAgYXdhaXQgZGVsZXRlUHJvZmlsZVBpY3R1cmUoZW1haWwsIGV4aXN0aW5nUHJvZmlsZS5hdmF0YXJfdXJsKTtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgcmVzdWx0O1xyXG4gICAgaWYgKGV4aXN0aW5nUHJvZmlsZSkge1xyXG4gICAgICAvLyBVcGRhdGUgZXhpc3RpbmcgcHJvZmlsZVxyXG4gICAgICAvLyBJZiBlbWFpbCBjaGFuZ2VkLCB3ZSBuZWVkIHRvIGhhbmRsZSBpdCBjYXJlZnVsbHlcclxuICAgICAgaWYgKGRhdGEuZW1haWwgIT09IGVtYWlsKSB7XHJcbiAgICAgICAgLy8gQ2hlY2sgaWYgbmV3IGVtYWlsIGFscmVhZHkgZXhpc3RzXHJcbiAgICAgICAgY29uc3QgeyBkYXRhOiBlbWFpbENoZWNrIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcclxuICAgICAgICAgIC5zZWxlY3QoJ2lkJylcclxuICAgICAgICAgIC5lcSgnZW1haWwnLCBkYXRhLmVtYWlsKVxyXG4gICAgICAgICAgLm1heWJlU2luZ2xlKCk7XHJcblxyXG4gICAgICAgIGlmIChlbWFpbENoZWNrKSB7XHJcbiAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdFbWFpbCBhbHJlYWR5IGV4aXN0cycgfTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IHVwZGF0ZURhdGE6IGFueSA9IHtcclxuICAgICAgICAgIGZpcnN0X25hbWU6IGRhdGEuZmlyc3RfbmFtZS50cmltKCksXHJcbiAgICAgICAgICBsYXN0X25hbWU6IGRhdGEubGFzdF9uYW1lLnRyaW0oKSxcclxuICAgICAgICAgIGVtYWlsOiBkYXRhLmVtYWlsLnRyaW0oKSxcclxuICAgICAgICAgIHBob25lOiBkYXRhLnBob25lPy50cmltKCkgfHwgbnVsbCxcclxuICAgICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8vIE9ubHkgdXBkYXRlIGF2YXRhcl91cmwgaWYgaXQncyBwcm92aWRlZFxyXG4gICAgICBpZiAoZGF0YS5hdmF0YXJfdXJsICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICB1cGRhdGVEYXRhLmF2YXRhcl91cmwgPSBkYXRhLmF2YXRhcl91cmw7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnNvbGUubG9nKCfwn5OdIEF0dGVtcHRpbmcgdG8gVVBEQVRFIHByb2ZpbGUgd2l0aCBkYXRhOicsIHVwZGF0ZURhdGEpO1xyXG4gICAgICBjb25zb2xlLmxvZygn8J+TnSBVcGRhdGUgV0hFUkUgZW1haWwgPScsIGVtYWlsKTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IHsgZGF0YTogdXBkYXRlZFByb2ZpbGUsIGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgIC51cGRhdGUodXBkYXRlRGF0YSlcclxuICAgICAgICAuZXEoJ2VtYWlsJywgZW1haWwpXHJcbiAgICAgICAgLnNlbGVjdCgpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgaWYgKHVwZGF0ZUVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIHVwZGF0aW5nIHByb2ZpbGU6JywgdXBkYXRlRXJyb3IpO1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBVcGRhdGUgZXJyb3IgZGV0YWlsczonLCB7XHJcbiAgICAgICAgICBjb2RlOiB1cGRhdGVFcnJvci5jb2RlLFxyXG4gICAgICAgICAgbWVzc2FnZTogdXBkYXRlRXJyb3IubWVzc2FnZSxcclxuICAgICAgICAgIGRldGFpbHM6IHVwZGF0ZUVycm9yLmRldGFpbHMsXHJcbiAgICAgICAgICBoaW50OiB1cGRhdGVFcnJvci5oaW50LFxyXG4gICAgICAgICAgc3RhdHVzQ29kZTogKHVwZGF0ZUVycm9yIGFzIGFueSkuc3RhdHVzQ29kZSxcclxuICAgICAgICAgIHN0YXR1czogKHVwZGF0ZUVycm9yIGFzIGFueSkuc3RhdHVzLFxyXG4gICAgICAgICAgc2VydmljZVJvbGVLZXlTZXQ6ICEhcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSxcclxuICAgICAgICB9KTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBDaGVjayBmb3IgUkxTIGVycm9ycyBzcGVjaWZpY2FsbHlcclxuICAgICAgICBpZiAodXBkYXRlRXJyb3IubWVzc2FnZT8uaW5jbHVkZXMoJ3Jvdy1sZXZlbCBzZWN1cml0eScpIHx8IFxyXG4gICAgICAgICAgICB1cGRhdGVFcnJvci5jb2RlID09PSAnNDI1MDEnIHx8XHJcbiAgICAgICAgICAgIHVwZGF0ZUVycm9yLm1lc3NhZ2U/LmluY2x1ZGVzKCdSTFMnKSkge1xyXG4gICAgICAgICAgcmV0dXJuIHsgXHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLCBcclxuICAgICAgICAgICAgZXJyb3I6ICdSb3cgTGV2ZWwgU2VjdXJpdHkgZXJyb3IuIFBsZWFzZSBlbnN1cmU6IDEpIFJMUyBpcyBkaXNhYmxlZCBvbiBwcm9maWxlcyB0YWJsZSwgMikgU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSBpcyBzZXQgaW4gLmVudi5sb2NhbCcsXHJcbiAgICAgICAgICAgIGVycm9yRGV0YWlsczogYEVycm9yIGNvZGU6ICR7dXBkYXRlRXJyb3IuY29kZSB8fCAndW5rbm93bid9LiAke3VwZGF0ZUVycm9yLmhpbnQgfHwgJyd9YCxcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHJldHVybiB7IFxyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsIFxyXG4gICAgICAgICAgZXJyb3I6IHVwZGF0ZUVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byB1cGRhdGUgcHJvZmlsZScsXHJcbiAgICAgICAgICBlcnJvckRldGFpbHM6IHVwZGF0ZUVycm9yLmRldGFpbHMgfHwgdXBkYXRlRXJyb3IuaGludCB8fCB1bmRlZmluZWQsXHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmVzdWx0ID0gdXBkYXRlZFByb2ZpbGU7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyBDcmVhdGUgbmV3IHByb2ZpbGVcclxuICAgICAgY29uc3QgaW5zZXJ0RGF0YTogYW55ID0ge1xyXG4gICAgICAgICAgZW1haWw6IGRhdGEuZW1haWwudHJpbSgpLFxyXG4gICAgICAgICAgcGhvbmU6IGRhdGEucGhvbmU/LnRyaW0oKSB8fCBudWxsLFxyXG4gICAgICAgICAgZmlyc3RfbmFtZTogZGF0YS5maXJzdF9uYW1lLnRyaW0oKSxcclxuICAgICAgICAgIGxhc3RfbmFtZTogZGF0YS5sYXN0X25hbWUudHJpbSgpLFxyXG4gICAgICB9O1xyXG5cclxuICAgICAgLy8gT25seSBzZXQgYXZhdGFyX3VybCBpZiBpdCdzIHByb3ZpZGVkXHJcbiAgICAgIGlmIChkYXRhLmF2YXRhcl91cmwpIHtcclxuICAgICAgICBpbnNlcnREYXRhLmF2YXRhcl91cmwgPSBkYXRhLmF2YXRhcl91cmw7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IHsgZGF0YTogbmV3UHJvZmlsZSwgZXJyb3I6IGluc2VydEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgICAgLmluc2VydChpbnNlcnREYXRhKVxyXG4gICAgICAgIC5zZWxlY3QoKVxyXG4gICAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICAgIGlmIChpbnNlcnRFcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIHByb2ZpbGU6JywgaW5zZXJ0RXJyb3IpO1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBJbnNlcnQgZXJyb3IgZGV0YWlsczonLCB7XHJcbiAgICAgICAgICBjb2RlOiBpbnNlcnRFcnJvci5jb2RlLFxyXG4gICAgICAgICAgbWVzc2FnZTogaW5zZXJ0RXJyb3IubWVzc2FnZSxcclxuICAgICAgICAgIGRldGFpbHM6IGluc2VydEVycm9yLmRldGFpbHMsXHJcbiAgICAgICAgICBoaW50OiBpbnNlcnRFcnJvci5oaW50LFxyXG4gICAgICAgICAgc2VydmljZVJvbGVLZXlTZXQ6ICEhcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSxcclxuICAgICAgICB9KTtcclxuICAgICAgICAvLyBDaGVjayBpZiBpdCdzIGEgdW5pcXVlIGNvbnN0cmFpbnQgdmlvbGF0aW9uXHJcbiAgICAgICAgaWYgKGluc2VydEVycm9yLmNvZGUgPT09ICcyMzUwNScpIHtcclxuICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0VtYWlsIGFscmVhZHkgZXhpc3RzJyB9O1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBDaGVjayBpZiBpdCdzIGFuIFJMUyBlcnJvclxyXG4gICAgICAgIGlmIChpbnNlcnRFcnJvci5tZXNzYWdlPy5pbmNsdWRlcygncm93LWxldmVsIHNlY3VyaXR5JykgfHwgXHJcbiAgICAgICAgICAgIGluc2VydEVycm9yLmNvZGUgPT09ICc0MjUwMScgfHxcclxuICAgICAgICAgICAgaW5zZXJ0RXJyb3IubWVzc2FnZT8uaW5jbHVkZXMoJ1JMUycpKSB7XHJcbiAgICAgICAgICByZXR1cm4geyBcclxuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsIFxyXG4gICAgICAgICAgICBlcnJvcjogJ1JvdyBMZXZlbCBTZWN1cml0eSBlcnJvci4gUGxlYXNlIGVuc3VyZTogMSkgUkxTIGlzIGRpc2FibGVkIG9uIHByb2ZpbGVzIHRhYmxlLCAyKSBTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIGlzIHNldCBpbiAuZW52LmxvY2FsJyxcclxuICAgICAgICAgICAgZXJyb3JEZXRhaWxzOiBgRXJyb3IgY29kZTogJHtpbnNlcnRFcnJvci5jb2RlIHx8ICd1bmtub3duJ30uICR7aW5zZXJ0RXJyb3IuaGludCB8fCAnJ31gLFxyXG4gICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHsgXHJcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSwgXHJcbiAgICAgICAgICBlcnJvcjogaW5zZXJ0RXJyb3IubWVzc2FnZSB8fCAnRmFpbGVkIHRvIGNyZWF0ZSBwcm9maWxlJyxcclxuICAgICAgICAgIGVycm9yRGV0YWlsczogaW5zZXJ0RXJyb3IuZGV0YWlscyB8fCBpbnNlcnRFcnJvci5oaW50IHx8IHVuZGVmaW5lZCxcclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcblxyXG4gICAgICByZXN1bHQgPSBuZXdQcm9maWxlO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHByb2ZpbGU6IHJlc3VsdCB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiB1cGRhdGVDdXN0b21lclByb2ZpbGU6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gdXBkYXRlIHByb2ZpbGUnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDdXN0b21lckxvY2F0aW9ucyhcclxuICBlbWFpbDogc3RyaW5nLFxyXG4gIHBob25lPzogc3RyaW5nXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgbG9jYXRpb25zPzogTG9jYXRpb25bXTtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIGxldCBxdWVyeSA9IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdsb2NhdGlvbnMnKVxyXG4gICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgLm9yZGVyKCdpc19kZWZhdWx0JywgeyBhc2NlbmRpbmc6IGZhbHNlIH0pXHJcbiAgICAgIC5vcmRlcignY3JlYXRlZF9hdCcsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KTtcclxuXHJcbiAgICAvLyBCdWlsZCBxdWVyeSBmb3IgZW1haWwvcGhvbmUgbG9va3VwXHJcbiAgICBpZiAoZW1haWwgJiYgcGhvbmUpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5vcihgY3VzdG9tZXJfZW1haWwuZXEuJHtlbWFpbH0sY3VzdG9tZXJfcGhvbmUuZXEuJHtwaG9uZX1gKTtcclxuICAgIH0gZWxzZSBpZiAoZW1haWwpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnY3VzdG9tZXJfZW1haWwnLCBlbWFpbCk7XHJcbiAgICB9IGVsc2UgaWYgKHBob25lKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ2N1c3RvbWVyX3Bob25lJywgcGhvbmUpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRW1haWwgb3IgcGhvbmUgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgcXVlcnk7XHJcblxyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGxvY2F0aW9uczonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGxvY2F0aW9uczogZGF0YSB8fCBbXSB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBnZXRDdXN0b21lckxvY2F0aW9uczonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBmZXRjaCBsb2NhdGlvbnMnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVMb2NhdGlvbihcclxuICBlbWFpbDogc3RyaW5nLFxyXG4gIHBob25lOiBzdHJpbmcgfCB1bmRlZmluZWQsXHJcbiAgbG9jYXRpb25EYXRhOiBMb2NhdGlvbkNyZWF0ZUlucHV0XHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgbG9jYXRpb24/OiBMb2NhdGlvbjtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIFZhbGlkYXRlIGlucHV0XHJcbiAgICBpZiAoIWxvY2F0aW9uRGF0YS5uaWNrbmFtZT8udHJpbSgpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ05pY2tuYW1lIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG4gICAgaWYgKCFsb2NhdGlvbkRhdGEuYWRkcmVzcz8udHJpbSgpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0FkZHJlc3MgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcbiAgICBpZiAoIWxvY2F0aW9uRGF0YS5zdWJ1cmI/LnRyaW0oKSkge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdTdWJ1cmIgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcbiAgICBpZiAoIWxvY2F0aW9uRGF0YS5jaXR5Py50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnQ2l0eSBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBJZiBzZXR0aW5nIGFzIGRlZmF1bHQsIHVuc2V0IGFsbCBvdGhlciBkZWZhdWx0cyBmb3IgdGhpcyBjdXN0b21lclxyXG4gICAgaWYgKGxvY2F0aW9uRGF0YS5pc19kZWZhdWx0KSB7XHJcbiAgICAgIGxldCB1cGRhdGVRdWVyeSA9IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ2xvY2F0aW9ucycpXHJcbiAgICAgICAgLnVwZGF0ZSh7IGlzX2RlZmF1bHQ6IGZhbHNlIH0pO1xyXG5cclxuICAgICAgaWYgKGVtYWlsICYmIHBob25lKSB7XHJcbiAgICAgICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5vcihgY3VzdG9tZXJfZW1haWwuZXEuJHtlbWFpbH0sY3VzdG9tZXJfcGhvbmUuZXEuJHtwaG9uZX1gKTtcclxuICAgICAgfSBlbHNlIGlmIChlbWFpbCkge1xyXG4gICAgICAgIHVwZGF0ZVF1ZXJ5ID0gdXBkYXRlUXVlcnkuZXEoJ2N1c3RvbWVyX2VtYWlsJywgZW1haWwpO1xyXG4gICAgICB9IGVsc2UgaWYgKHBob25lKSB7XHJcbiAgICAgICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5lcSgnY3VzdG9tZXJfcGhvbmUnLCBwaG9uZSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGF3YWl0IHVwZGF0ZVF1ZXJ5O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgZGF0YTogbmV3TG9jYXRpb24sIGVycm9yOiBpbnNlcnRFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2xvY2F0aW9ucycpXHJcbiAgICAgIC5pbnNlcnQoe1xyXG4gICAgICAgIGN1c3RvbWVyX2VtYWlsOiBlbWFpbCxcclxuICAgICAgICBjdXN0b21lcl9waG9uZTogcGhvbmUgfHwgbnVsbCxcclxuICAgICAgICBuaWNrbmFtZTogbG9jYXRpb25EYXRhLm5pY2tuYW1lLnRyaW0oKSxcclxuICAgICAgICBhZGRyZXNzOiBsb2NhdGlvbkRhdGEuYWRkcmVzcy50cmltKCksXHJcbiAgICAgICAgYXB0X3VuaXQ6IGxvY2F0aW9uRGF0YS5hcHRfdW5pdD8udHJpbSgpIHx8IG51bGwsXHJcbiAgICAgICAgc3VidXJiOiBsb2NhdGlvbkRhdGEuc3VidXJiLnRyaW0oKSxcclxuICAgICAgICBjaXR5OiBsb2NhdGlvbkRhdGEuY2l0eS50cmltKCksXHJcbiAgICAgICAgcG9zdGFsX2NvZGU6IGxvY2F0aW9uRGF0YS5wb3N0YWxfY29kZT8udHJpbSgpIHx8IG51bGwsXHJcbiAgICAgICAgaXNfZGVmYXVsdDogbG9jYXRpb25EYXRhLmlzX2RlZmF1bHQgfHwgZmFsc2UsXHJcbiAgICAgIH0pXHJcbiAgICAgIC5zZWxlY3QoKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKGluc2VydEVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIGxvY2F0aW9uOicsIGluc2VydEVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBpbnNlcnRFcnJvci5tZXNzYWdlIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgbG9jYXRpb246IG5ld0xvY2F0aW9uIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGNyZWF0ZUxvY2F0aW9uOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGNyZWF0ZSBsb2NhdGlvbicsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUxvY2F0aW9uKFxyXG4gIGxvY2F0aW9uSWQ6IHN0cmluZyxcclxuICBsb2NhdGlvbkRhdGE6IExvY2F0aW9uVXBkYXRlSW5wdXRcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBsb2NhdGlvbj86IExvY2F0aW9uO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgLy8gVmFsaWRhdGUgaW5wdXQgaWYgcHJvdmlkZWRcclxuICAgIGlmIChsb2NhdGlvbkRhdGEubmlja25hbWUgIT09IHVuZGVmaW5lZCAmJiAhbG9jYXRpb25EYXRhLm5pY2tuYW1lLnRyaW0oKSkge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdOaWNrbmFtZSBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuYWRkcmVzcyAhPT0gdW5kZWZpbmVkICYmICFsb2NhdGlvbkRhdGEuYWRkcmVzcy50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnQWRkcmVzcyBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuc3VidXJiICE9PSB1bmRlZmluZWQgJiYgIWxvY2F0aW9uRGF0YS5zdWJ1cmIudHJpbSgpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ1N1YnVyYiBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuY2l0eSAhPT0gdW5kZWZpbmVkICYmICFsb2NhdGlvbkRhdGEuY2l0eS50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnQ2l0eSBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBHZXQgY3VycmVudCBsb2NhdGlvbiB0byBjaGVjayBjdXN0b21lciBlbWFpbFxyXG4gICAgY29uc3QgeyBkYXRhOiBjdXJyZW50TG9jYXRpb24sIGVycm9yOiBmZXRjaEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnbG9jYXRpb25zJylcclxuICAgICAgLnNlbGVjdCgnY3VzdG9tZXJfZW1haWwsIGN1c3RvbWVyX3Bob25lJylcclxuICAgICAgLmVxKCdpZCcsIGxvY2F0aW9uSWQpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoZmV0Y2hFcnJvciB8fCAhY3VycmVudExvY2F0aW9uKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0xvY2F0aW9uIG5vdCBmb3VuZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBJZiBzZXR0aW5nIGFzIGRlZmF1bHQsIHVuc2V0IGFsbCBvdGhlciBkZWZhdWx0cyBmb3IgdGhpcyBjdXN0b21lclxyXG4gICAgaWYgKGxvY2F0aW9uRGF0YS5pc19kZWZhdWx0KSB7XHJcbiAgICAgIGxldCB1cGRhdGVRdWVyeSA9IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ2xvY2F0aW9ucycpXHJcbiAgICAgICAgLnVwZGF0ZSh7IGlzX2RlZmF1bHQ6IGZhbHNlIH0pO1xyXG5cclxuICAgICAgaWYgKGN1cnJlbnRMb2NhdGlvbi5jdXN0b21lcl9lbWFpbCAmJiBjdXJyZW50TG9jYXRpb24uY3VzdG9tZXJfcGhvbmUpIHtcclxuICAgICAgICB1cGRhdGVRdWVyeSA9IHVwZGF0ZVF1ZXJ5Lm9yKGBjdXN0b21lcl9lbWFpbC5lcS4ke2N1cnJlbnRMb2NhdGlvbi5jdXN0b21lcl9lbWFpbH0sY3VzdG9tZXJfcGhvbmUuZXEuJHtjdXJyZW50TG9jYXRpb24uY3VzdG9tZXJfcGhvbmV9YCk7XHJcbiAgICAgIH0gZWxzZSBpZiAoY3VycmVudExvY2F0aW9uLmN1c3RvbWVyX2VtYWlsKSB7XHJcbiAgICAgICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5lcSgnY3VzdG9tZXJfZW1haWwnLCBjdXJyZW50TG9jYXRpb24uY3VzdG9tZXJfZW1haWwpO1xyXG4gICAgICB9IGVsc2UgaWYgKGN1cnJlbnRMb2NhdGlvbi5jdXN0b21lcl9waG9uZSkge1xyXG4gICAgICAgIHVwZGF0ZVF1ZXJ5ID0gdXBkYXRlUXVlcnkuZXEoJ2N1c3RvbWVyX3Bob25lJywgY3VycmVudExvY2F0aW9uLmN1c3RvbWVyX3Bob25lKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gRG9uJ3QgdW5zZXQgdGhlIGN1cnJlbnQgbG9jYXRpb25cclxuICAgICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5uZXEoJ2lkJywgbG9jYXRpb25JZCk7XHJcblxyXG4gICAgICBhd2FpdCB1cGRhdGVRdWVyeTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBCdWlsZCB1cGRhdGUgb2JqZWN0IHdpdGggb25seSBwcm92aWRlZCBmaWVsZHNcclxuICAgIGNvbnN0IHVwZGF0ZURhdGE6IGFueSA9IHtcclxuICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgfTtcclxuXHJcbiAgICBpZiAobG9jYXRpb25EYXRhLm5pY2tuYW1lICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgdXBkYXRlRGF0YS5uaWNrbmFtZSA9IGxvY2F0aW9uRGF0YS5uaWNrbmFtZS50cmltKCk7XHJcbiAgICB9XHJcbiAgICBpZiAobG9jYXRpb25EYXRhLmFkZHJlc3MgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB1cGRhdGVEYXRhLmFkZHJlc3MgPSBsb2NhdGlvbkRhdGEuYWRkcmVzcy50cmltKCk7XHJcbiAgICB9XHJcbiAgICBpZiAobG9jYXRpb25EYXRhLmFwdF91bml0ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgdXBkYXRlRGF0YS5hcHRfdW5pdCA9IGxvY2F0aW9uRGF0YS5hcHRfdW5pdD8udHJpbSgpIHx8IG51bGw7XHJcbiAgICB9XHJcbiAgICBpZiAobG9jYXRpb25EYXRhLnN1YnVyYiAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHVwZGF0ZURhdGEuc3VidXJiID0gbG9jYXRpb25EYXRhLnN1YnVyYi50cmltKCk7XHJcbiAgICB9XHJcbiAgICBpZiAobG9jYXRpb25EYXRhLmNpdHkgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB1cGRhdGVEYXRhLmNpdHkgPSBsb2NhdGlvbkRhdGEuY2l0eS50cmltKCk7XHJcbiAgICB9XHJcbiAgICBpZiAobG9jYXRpb25EYXRhLnBvc3RhbF9jb2RlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgdXBkYXRlRGF0YS5wb3N0YWxfY29kZSA9IGxvY2F0aW9uRGF0YS5wb3N0YWxfY29kZT8udHJpbSgpIHx8IG51bGw7XHJcbiAgICB9XHJcbiAgICBpZiAobG9jYXRpb25EYXRhLmlzX2RlZmF1bHQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB1cGRhdGVEYXRhLmlzX2RlZmF1bHQgPSBsb2NhdGlvbkRhdGEuaXNfZGVmYXVsdDtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB7IGRhdGE6IHVwZGF0ZWRMb2NhdGlvbiwgZXJyb3I6IHVwZGF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnbG9jYXRpb25zJylcclxuICAgICAgLnVwZGF0ZSh1cGRhdGVEYXRhKVxyXG4gICAgICAuZXEoJ2lkJywgbG9jYXRpb25JZClcclxuICAgICAgLnNlbGVjdCgpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICBpZiAodXBkYXRlRXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBkYXRpbmcgbG9jYXRpb246JywgdXBkYXRlRXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHVwZGF0ZUVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBsb2NhdGlvbjogdXBkYXRlZExvY2F0aW9uIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHVwZGF0ZUxvY2F0aW9uOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIHVwZGF0ZSBsb2NhdGlvbicsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGRlbGV0ZUxvY2F0aW9uKGxvY2F0aW9uSWQ6IHN0cmluZyk6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnbG9jYXRpb25zJylcclxuICAgICAgLmRlbGV0ZSgpXHJcbiAgICAgIC5lcSgnaWQnLCBsb2NhdGlvbklkKTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZGVsZXRpbmcgbG9jYXRpb246JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGRlbGV0ZUxvY2F0aW9uOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGRlbGV0ZSBsb2NhdGlvbicsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNldERlZmF1bHRMb2NhdGlvbihcclxuICBsb2NhdGlvbklkOiBzdHJpbmcsXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBwaG9uZT86IHN0cmluZ1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGxvY2F0aW9uPzogTG9jYXRpb247XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICAvLyBHZXQgY3VycmVudCBsb2NhdGlvbiB0byB2ZXJpZnkgb3duZXJzaGlwXHJcbiAgICBjb25zdCB7IGRhdGE6IGN1cnJlbnRMb2NhdGlvbiwgZXJyb3I6IGZldGNoRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdsb2NhdGlvbnMnKVxyXG4gICAgICAuc2VsZWN0KCdjdXN0b21lcl9lbWFpbCwgY3VzdG9tZXJfcGhvbmUnKVxyXG4gICAgICAuZXEoJ2lkJywgbG9jYXRpb25JZClcclxuICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgIGlmIChmZXRjaEVycm9yIHx8ICFjdXJyZW50TG9jYXRpb24pIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTG9jYXRpb24gbm90IGZvdW5kJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFZlcmlmeSBvd25lcnNoaXBcclxuICAgIGNvbnN0IGlzT3duZXIgPSBcclxuICAgICAgY3VycmVudExvY2F0aW9uLmN1c3RvbWVyX2VtYWlsID09PSBlbWFpbCB8fFxyXG4gICAgICAocGhvbmUgJiYgY3VycmVudExvY2F0aW9uLmN1c3RvbWVyX3Bob25lID09PSBwaG9uZSk7XHJcblxyXG4gICAgaWYgKCFpc093bmVyKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ1VuYXV0aG9yaXplZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBVbnNldCBhbGwgb3RoZXIgZGVmYXVsdHMgZm9yIHRoaXMgY3VzdG9tZXJcclxuICAgIGxldCB1cGRhdGVRdWVyeSA9IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdsb2NhdGlvbnMnKVxyXG4gICAgICAudXBkYXRlKHsgaXNfZGVmYXVsdDogZmFsc2UgfSk7XHJcblxyXG4gICAgaWYgKGVtYWlsICYmIHBob25lKSB7XHJcbiAgICAgIHVwZGF0ZVF1ZXJ5ID0gdXBkYXRlUXVlcnkub3IoYGN1c3RvbWVyX2VtYWlsLmVxLiR7ZW1haWx9LGN1c3RvbWVyX3Bob25lLmVxLiR7cGhvbmV9YCk7XHJcbiAgICB9IGVsc2UgaWYgKGVtYWlsKSB7XHJcbiAgICAgIHVwZGF0ZVF1ZXJ5ID0gdXBkYXRlUXVlcnkuZXEoJ2N1c3RvbWVyX2VtYWlsJywgZW1haWwpO1xyXG4gICAgfSBlbHNlIGlmIChwaG9uZSkge1xyXG4gICAgICB1cGRhdGVRdWVyeSA9IHVwZGF0ZVF1ZXJ5LmVxKCdjdXN0b21lcl9waG9uZScsIHBob25lKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBEb24ndCB1bnNldCB0aGUgY3VycmVudCBsb2NhdGlvblxyXG4gICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5uZXEoJ2lkJywgbG9jYXRpb25JZCk7XHJcblxyXG4gICAgYXdhaXQgdXBkYXRlUXVlcnk7XHJcblxyXG4gICAgLy8gU2V0IHRoaXMgbG9jYXRpb24gYXMgZGVmYXVsdFxyXG4gICAgY29uc3QgeyBkYXRhOiB1cGRhdGVkTG9jYXRpb24sIGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2xvY2F0aW9ucycpXHJcbiAgICAgIC51cGRhdGUoeyBpc19kZWZhdWx0OiB0cnVlIH0pXHJcbiAgICAgIC5lcSgnaWQnLCBsb2NhdGlvbklkKVxyXG4gICAgICAuc2VsZWN0KClcclxuICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgIGlmICh1cGRhdGVFcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBzZXR0aW5nIGRlZmF1bHQgbG9jYXRpb246JywgdXBkYXRlRXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHVwZGF0ZUVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBsb2NhdGlvbjogdXBkYXRlZExvY2F0aW9uIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHNldERlZmF1bHRMb2NhdGlvbjonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBzZXQgZGVmYXVsdCBsb2NhdGlvbicsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldE9yQ3JlYXRlUmVmZXJyYWxDb2RlKFxyXG4gIGVtYWlsOiBzdHJpbmdcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICByZWZlcnJhbENvZGU/OiBzdHJpbmc7XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICAvLyBDaGVjayBpZiBwcm9maWxlIGV4aXN0cyBhbmQgaGFzIGEgcmVmZXJyYWwgY29kZVxyXG4gICAgY29uc3QgeyBkYXRhOiBwcm9maWxlLCBlcnJvcjogcHJvZmlsZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAuc2VsZWN0KCdyZWZlcnJhbF9jb2RlJylcclxuICAgICAgLmVxKCdlbWFpbCcsIGVtYWlsKVxyXG4gICAgICAubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgICBpZiAocHJvZmlsZUVycm9yICYmIHByb2ZpbGVFcnJvci5jb2RlICE9PSAnUEdSU1QxMTYnKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIHByb2ZpbGU6JywgcHJvZmlsZUVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBwcm9maWxlRXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIElmIHByb2ZpbGUgZXhpc3RzIGFuZCBoYXMgYSByZWZlcnJhbCBjb2RlLCByZXR1cm4gaXRcclxuICAgIGlmIChwcm9maWxlPy5yZWZlcnJhbF9jb2RlKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHJlZmVycmFsQ29kZTogcHJvZmlsZS5yZWZlcnJhbF9jb2RlIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gR2VuZXJhdGUgYSBuZXcgcmVmZXJyYWwgY29kZVxyXG4gICAgLy8gVHJ5IHVzaW5nIHRoZSBkYXRhYmFzZSBmdW5jdGlvbiBmaXJzdCwgYnV0IGZhbGxiYWNrIHRvIGNsaWVudC1zaWRlIGdlbmVyYXRpb25cclxuICAgIGxldCBnZW5lcmF0ZWRDb2RlOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcclxuICAgIFxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgeyBkYXRhOiBkYkNvZGUsIGVycm9yOiBjb2RlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLnJwYygnZ2VuZXJhdGVfcmVmZXJyYWxfY29kZScpO1xyXG4gICAgICBcclxuICAgICAgaWYgKCFjb2RlRXJyb3IgJiYgZGJDb2RlKSB7XHJcbiAgICAgICAgZ2VuZXJhdGVkQ29kZSA9IGRiQ29kZTtcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAocnBjRXJyb3IpIHtcclxuICAgICAgLy8gUlBDIGZ1bmN0aW9uIG1pZ2h0IG5vdCBleGlzdCB5ZXQsIHRoYXQncyBva2F5XHJcbiAgICAgIGNvbnNvbGUubG9nKCdSUEMgZnVuY3Rpb24gbm90IGF2YWlsYWJsZSwgdXNpbmcgZmFsbGJhY2snKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIWdlbmVyYXRlZENvZGUpIHtcclxuICAgICAgLy8gRmFsbGJhY2s6IGdlbmVyYXRlIGNvZGUgY2xpZW50LXNpZGUgc3R5bGVcclxuICAgICAgY29uc3QgZmFsbGJhY2tDb2RlID0gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIsIDgpLnRvVXBwZXJDYXNlKCk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBDaGVjayBpZiBmYWxsYmFjayBjb2RlIGV4aXN0cywgcmV0cnkgaWYgaXQgZG9lc1xyXG4gICAgICBsZXQgZmluYWxDb2RlID0gZmFsbGJhY2tDb2RlO1xyXG4gICAgICBsZXQgYXR0ZW1wdHMgPSAwO1xyXG4gICAgICBjb25zdCBtYXhBdHRlbXB0cyA9IDU7XHJcblxyXG4gICAgICB3aGlsZSAoYXR0ZW1wdHMgPCBtYXhBdHRlbXB0cykge1xyXG4gICAgICAgIGNvbnN0IHsgZGF0YTogZXhpc3RpbmcgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgICAgLnNlbGVjdCgnaWQnKVxyXG4gICAgICAgICAgLmVxKCdyZWZlcnJhbF9jb2RlJywgZmluYWxDb2RlKVxyXG4gICAgICAgICAgLm1heWJlU2luZ2xlKCk7XHJcblxyXG4gICAgICAgIGlmICghZXhpc3RpbmcpIHtcclxuICAgICAgICAgIGJyZWFrOyAvLyBDb2RlIGlzIHVuaXF1ZVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gR2VuZXJhdGUgYSBuZXcgY29kZVxyXG4gICAgICAgIGZpbmFsQ29kZSA9IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cmluZygyLCA4KS50b1VwcGVyQ2FzZSgpO1xyXG4gICAgICAgIGF0dGVtcHRzKys7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIFVwZGF0ZSBvciBpbnNlcnQgcHJvZmlsZSB3aXRoIHJlZmVycmFsIGNvZGVcclxuICAgICAgLy8gRmlyc3QsIHRyeSB0byB1cGRhdGUgZXhpc3RpbmcgcHJvZmlsZVxyXG4gICAgICBjb25zdCB7IGRhdGE6IGV4aXN0aW5nUHJvZmlsZSB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgIC5zZWxlY3QoJ2lkLCBmaXJzdF9uYW1lLCBsYXN0X25hbWUnKVxyXG4gICAgICAgIC5lcSgnZW1haWwnLCBlbWFpbClcclxuICAgICAgICAubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgICAgIGxldCB1cGRhdGVkUHJvZmlsZTtcclxuICAgICAgaWYgKGV4aXN0aW5nUHJvZmlsZSkge1xyXG4gICAgICAgIC8vIFVwZGF0ZSBleGlzdGluZyBwcm9maWxlXHJcbiAgICAgICAgY29uc3QgeyBkYXRhOiB1cGRhdGVkLCBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgICAgLnVwZGF0ZSh7XHJcbiAgICAgICAgICAgIHJlZmVycmFsX2NvZGU6IGZpbmFsQ29kZSxcclxuICAgICAgICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgICAgICAgfSlcclxuICAgICAgICAgIC5lcSgnZW1haWwnLCBlbWFpbClcclxuICAgICAgICAgIC5zZWxlY3QoJ3JlZmVycmFsX2NvZGUnKVxyXG4gICAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgICBpZiAodXBkYXRlRXJyb3IpIHtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHVwZGF0aW5nIHJlZmVycmFsIGNvZGU6JywgdXBkYXRlRXJyb3IpO1xyXG4gICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB1cGRhdGVFcnJvci5tZXNzYWdlIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHVwZGF0ZWRQcm9maWxlID0gdXBkYXRlZDtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBJbnNlcnQgbmV3IHByb2ZpbGUgd2l0aCByZWZlcnJhbCBjb2RlXHJcbiAgICAgICAgY29uc3QgeyBkYXRhOiBpbnNlcnRlZCwgZXJyb3I6IGluc2VydEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcclxuICAgICAgICAgIC5pbnNlcnQoe1xyXG4gICAgICAgICAgICBlbWFpbCxcclxuICAgICAgICAgICAgcmVmZXJyYWxfY29kZTogZmluYWxDb2RlLFxyXG4gICAgICAgICAgICBmaXJzdF9uYW1lOiBlbWFpbC5zcGxpdCgnQCcpWzBdLFxyXG4gICAgICAgICAgICBsYXN0X25hbWU6ICcnLFxyXG4gICAgICAgICAgfSlcclxuICAgICAgICAgIC5zZWxlY3QoJ3JlZmVycmFsX2NvZGUnKVxyXG4gICAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgICBpZiAoaW5zZXJ0RXJyb3IpIHtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIHJlZmVycmFsIGNvZGU6JywgaW5zZXJ0RXJyb3IpO1xyXG4gICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBpbnNlcnRFcnJvci5tZXNzYWdlIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHVwZGF0ZWRQcm9maWxlID0gaW5zZXJ0ZWQ7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHJlZmVycmFsQ29kZTogdXBkYXRlZFByb2ZpbGU/LnJlZmVycmFsX2NvZGUgfHwgZmluYWxDb2RlIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVXNlIHRoZSBnZW5lcmF0ZWQgY29kZSBmcm9tIGRhdGFiYXNlIGZ1bmN0aW9uXHJcbiAgICAvLyBVcGRhdGUgb3IgaW5zZXJ0IHByb2ZpbGUgd2l0aCBnZW5lcmF0ZWQgY29kZVxyXG4gICAgY29uc3QgeyBkYXRhOiBleGlzdGluZ1Byb2ZpbGUgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgIC5zZWxlY3QoJ2lkLCBmaXJzdF9uYW1lLCBsYXN0X25hbWUnKVxyXG4gICAgICAuZXEoJ2VtYWlsJywgZW1haWwpXHJcbiAgICAgIC5tYXliZVNpbmdsZSgpO1xyXG5cclxuICAgIGxldCB1cGRhdGVkUHJvZmlsZTtcclxuICAgIGlmIChleGlzdGluZ1Byb2ZpbGUpIHtcclxuICAgICAgLy8gVXBkYXRlIGV4aXN0aW5nIHByb2ZpbGVcclxuICAgICAgY29uc3QgeyBkYXRhOiB1cGRhdGVkLCBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcclxuICAgICAgICAudXBkYXRlKHtcclxuICAgICAgICAgIHJlZmVycmFsX2NvZGU6IGdlbmVyYXRlZENvZGUsXHJcbiAgICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgfSlcclxuICAgICAgICAuZXEoJ2VtYWlsJywgZW1haWwpXHJcbiAgICAgICAgLnNlbGVjdCgncmVmZXJyYWxfY29kZScpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgaWYgKHVwZGF0ZUVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBkYXRpbmcgcmVmZXJyYWwgY29kZTonLCB1cGRhdGVFcnJvcik7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB1cGRhdGVFcnJvci5tZXNzYWdlIH07XHJcbiAgICAgIH1cclxuICAgICAgdXBkYXRlZFByb2ZpbGUgPSB1cGRhdGVkO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8gSW5zZXJ0IG5ldyBwcm9maWxlIHdpdGggcmVmZXJyYWwgY29kZVxyXG4gICAgICBjb25zdCB7IGRhdGE6IGluc2VydGVkLCBlcnJvcjogaW5zZXJ0RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcclxuICAgICAgICAuaW5zZXJ0KHtcclxuICAgICAgICAgIGVtYWlsLFxyXG4gICAgICAgICAgcmVmZXJyYWxfY29kZTogZ2VuZXJhdGVkQ29kZSxcclxuICAgICAgICAgIGZpcnN0X25hbWU6IGVtYWlsLnNwbGl0KCdAJylbMF0sXHJcbiAgICAgICAgICBsYXN0X25hbWU6ICcnLFxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnNlbGVjdCgncmVmZXJyYWxfY29kZScpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgaWYgKGluc2VydEVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYXRpbmcgcmVmZXJyYWwgY29kZTonLCBpbnNlcnRFcnJvcik7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBpbnNlcnRFcnJvci5tZXNzYWdlIH07XHJcbiAgICAgIH1cclxuICAgICAgdXBkYXRlZFByb2ZpbGUgPSBpbnNlcnRlZDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCByZWZlcnJhbENvZGU6IHVwZGF0ZWRQcm9maWxlPy5yZWZlcnJhbF9jb2RlIHx8IGdlbmVyYXRlZENvZGUgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gZ2V0T3JDcmVhdGVSZWZlcnJhbENvZGU6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gZ2V0IHJlZmVycmFsIGNvZGUnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZW5kUmVmZXJyYWxJbnZpdGVzKFxyXG4gIGVtYWlsOiBzdHJpbmcsXHJcbiAgaW52aXRlRW1haWxzOiBzdHJpbmdbXSxcclxuICByZWZlcnJhbENvZGU6IHN0cmluZ1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIHNlbnQ/OiBudW1iZXI7XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICAvLyBWYWxpZGF0ZSBlbWFpbCBhZGRyZXNzZXNcclxuICAgIGNvbnN0IHZhbGlkRW1haWxzID0gaW52aXRlRW1haWxzXHJcbiAgICAgIC5tYXAoKGUpID0+IGUudHJpbSgpKVxyXG4gICAgICAuZmlsdGVyKChlKSA9PiB7XHJcbiAgICAgICAgaWYgKCFlKSByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgcmV0dXJuIC9eW15cXHNAXStAW15cXHNAXStcXC5bXlxcc0BdKyQvLnRlc3QoZSk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgIGlmICh2YWxpZEVtYWlscy5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTm8gdmFsaWQgZW1haWwgYWRkcmVzc2VzIHByb3ZpZGVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENyZWF0ZSByZWZlcnJhbCByZWNvcmRzIGZvciB0cmFja2luZ1xyXG4gICAgY29uc3QgcmVmZXJyYWxSZWNvcmRzID0gdmFsaWRFbWFpbHMubWFwKChyZWZlcnJlZEVtYWlsKSA9PiAoe1xyXG4gICAgICByZWZlcnJlcl9lbWFpbDogZW1haWwsXHJcbiAgICAgIHJlZmVycmVkX2VtYWlsOiByZWZlcnJlZEVtYWlsLFxyXG4gICAgICByZWZlcnJhbF9jb2RlOiByZWZlcnJhbENvZGUsXHJcbiAgICAgIHN0YXR1czogJ3BlbmRpbmcnLFxyXG4gICAgfSkpO1xyXG5cclxuICAgIGNvbnN0IHsgZXJyb3I6IGluc2VydEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgncmVmZXJyYWxzJylcclxuICAgICAgLmluc2VydChyZWZlcnJhbFJlY29yZHMpO1xyXG5cclxuICAgIGlmIChpbnNlcnRFcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjcmVhdGluZyByZWZlcnJhbCByZWNvcmRzOicsIGluc2VydEVycm9yKTtcclxuICAgICAgLy8gQ29udGludWUgZXZlbiBpZiBpbnNlcnQgZmFpbHMgLSB3ZSBzdGlsbCB3YW50IHRvIHNlbmQgZW1haWxzXHJcbiAgICB9XHJcblxyXG4gICAgLy8gR2VuZXJhdGUgcmVmZXJyYWwgbGlua1xyXG4gICAgY29uc3QgYmFzZVVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NJVEVfVVJMIHx8ICdodHRwczovL3NoYWxlYW4uY28uemEnO1xyXG4gICAgY29uc3QgcmVmZXJyYWxMaW5rID0gYCR7YmFzZVVybH0vYm9va2luZy9kZXRhaWxzP3JlZj0ke3JlZmVycmFsQ29kZX1gO1xyXG5cclxuICAgIC8vIFRPRE86IEltcGxlbWVudCBhY3R1YWwgZW1haWwgc2VuZGluZyB1c2luZyB5b3VyIGVtYWlsIHNlcnZpY2UgKFJlc2VuZCwgU2VuZEdyaWQsIGV0Yy4pXHJcbiAgICAvLyBGb3Igbm93LCB3ZSdsbCBqdXN0IGxvZyB0aGUgZW1haWxzIHRoYXQgd291bGQgYmUgc2VudFxyXG4gICAgY29uc29sZS5sb2coJ1JlZmVycmFsIGludml0ZXMgdG8gc2VuZDonLCB7XHJcbiAgICAgIGZyb206IGVtYWlsLFxyXG4gICAgICB0bzogdmFsaWRFbWFpbHMsXHJcbiAgICAgIHJlZmVycmFsQ29kZSxcclxuICAgICAgcmVmZXJyYWxMaW5rLFxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gSW4gYSByZWFsIGltcGxlbWVudGF0aW9uLCB5b3Ugd291bGQgc2VuZCBlbWFpbHMgaGVyZVxyXG4gICAgLy8gRXhhbXBsZSB3aXRoIFJlc2VuZDpcclxuICAgIC8vIGF3YWl0IHJlc2VuZC5lbWFpbHMuc2VuZCh7XHJcbiAgICAvLyAgIGZyb206ICdTaGFsZWFuIDxub3JlcGx5QHNoYWxlYW4uY28uemE+JyxcclxuICAgIC8vICAgdG86IHZhbGlkRW1haWxzLFxyXG4gICAgLy8gICBzdWJqZWN0OiAnWW91XFwndmUgYmVlbiBpbnZpdGVkIHRvIHRyeSBTaGFsZWFuIENsZWFuaW5nIFNlcnZpY2VzIScsXHJcbiAgICAvLyAgIGh0bWw6IGA8cD5Zb3VyIGZyaWVuZCBoYXMgaW52aXRlZCB5b3UgdG8gdHJ5IFNoYWxlYW4uIFVzZSBjb2RlICR7cmVmZXJyYWxDb2RlfSB0byBnZXQgUjE1MCBvZmYgeW91ciBmaXJzdCBib29raW5nITwvcD48cD48YSBocmVmPVwiJHtyZWZlcnJhbExpbmt9XCI+Qm9vayBOb3c8L2E+PC9wPmAsXHJcbiAgICAvLyB9KTtcclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBzZW50OiB2YWxpZEVtYWlscy5sZW5ndGggfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gc2VuZFJlZmVycmFsSW52aXRlczonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBzZW5kIGludml0ZXMnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRSZWZlcnJhbFN0YXRzKFxyXG4gIGVtYWlsOiBzdHJpbmdcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBzdGF0cz86IHtcclxuICAgIHRvdGFsUmVmZXJyYWxzOiBudW1iZXI7XHJcbiAgICBjb21wbGV0ZWRSZWZlcnJhbHM6IG51bWJlcjtcclxuICAgIHBlbmRpbmdSZXdhcmRzOiBudW1iZXI7XHJcbiAgICB0b3RhbFJld2FyZHM6IG51bWJlcjtcclxuICB9O1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgY29uc3QgeyBkYXRhOiByZWZlcnJhbHMsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgncmVmZXJyYWxzJylcclxuICAgICAgLnNlbGVjdCgnc3RhdHVzLCByZWZlcnJlcl9yZXdhcmRfYW1vdW50LCByZWZlcnJlcl9yZXdhcmRfc3RhdHVzJylcclxuICAgICAgLmVxKCdyZWZlcnJlcl9lbWFpbCcsIGVtYWlsKTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgcmVmZXJyYWwgc3RhdHM6JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBzdGF0cyA9IHtcclxuICAgICAgdG90YWxSZWZlcnJhbHM6IHJlZmVycmFscz8ubGVuZ3RoIHx8IDAsXHJcbiAgICAgIGNvbXBsZXRlZFJlZmVycmFsczpcclxuICAgICAgICByZWZlcnJhbHM/LmZpbHRlcigocikgPT4gci5zdGF0dXMgPT09ICdjb21wbGV0ZWQnKS5sZW5ndGggfHwgMCxcclxuICAgICAgcGVuZGluZ1Jld2FyZHM6XHJcbiAgICAgICAgcmVmZXJyYWxzPy5maWx0ZXIoKHIpID0+IHIucmVmZXJyZXJfcmV3YXJkX3N0YXR1cyA9PT0gJ3BlbmRpbmcnKS5sZW5ndGggfHwgMCxcclxuICAgICAgdG90YWxSZXdhcmRzOlxyXG4gICAgICAgIHJlZmVycmFsc1xyXG4gICAgICAgICAgPy5maWx0ZXIoKHIpID0+IHIucmVmZXJyZXJfcmV3YXJkX3N0YXR1cyA9PT0gJ2NyZWRpdGVkJylcclxuICAgICAgICAgIC5yZWR1Y2UoKHN1bSwgcikgPT4gc3VtICsgKHIucmVmZXJyZXJfcmV3YXJkX2Ftb3VudCB8fCAwKSwgMCkgfHwgMCxcclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgc3RhdHMgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gZ2V0UmVmZXJyYWxTdGF0czonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBmZXRjaCByZWZlcnJhbCBzdGF0cycsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIEluaXRpYWxpemUgYSBjcmVkaXQgcHVyY2hhc2Ugd2l0aCBQYXlzdGFja1xyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGluaXRpYWxpemVDcmVkaXRQdXJjaGFzZShcclxuICBlbWFpbDogc3RyaW5nLFxyXG4gIGFtb3VudDogbnVtYmVyLFxyXG4gIHBheW1lbnRNZXRob2Q6ICdjcmVkaXRfY2FyZCcgfCAnZWZ0J1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGF1dGhvcml6YXRpb25Vcmw/OiBzdHJpbmc7XHJcbiAgcmVmZXJlbmNlPzogc3RyaW5nO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGlmIChhbW91bnQgPCAyMCB8fCBhbW91bnQgPiA1MDAwKSB7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6ICdBbW91bnQgbXVzdCBiZSBiZXR3ZWVuIFIyMCBhbmQgUjUwMDAnLFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEdlbmVyYXRlIGEgdW5pcXVlIHJlZmVyZW5jZSBmb3IgdGhpcyBjcmVkaXQgcHVyY2hhc2VcclxuICAgIGNvbnN0IHJlZmVyZW5jZSA9IGBDUkVESVRfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cmluZygyLCA5KX1gO1xyXG5cclxuICAgIC8vIENyZWF0ZSBhIHBlbmRpbmcgY3JlZGl0IHRyYW5zYWN0aW9uXHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG4gICAgXHJcbiAgICAvLyBHZXQgb3IgY3JlYXRlIHByb2ZpbGVcclxuICAgIGxldCB7IGRhdGE6IHByb2ZpbGUgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgIC5zZWxlY3QoJ2lkLCBjcmVkaXRfYmFsYW5jZScpXHJcbiAgICAgIC5lcSgnZW1haWwnLCBlbWFpbClcclxuICAgICAgLm1heWJlU2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKCFwcm9maWxlKSB7XHJcbiAgICAgIC8vIENyZWF0ZSBhIGJhc2ljIHByb2ZpbGUgaWYgaXQgZG9lc24ndCBleGlzdFxyXG4gICAgICBjb25zdCB7IGRhdGE6IG5ld1Byb2ZpbGUsIGVycm9yOiBjcmVhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgIC5pbnNlcnQoe1xyXG4gICAgICAgICAgZW1haWwsXHJcbiAgICAgICAgICBjcmVkaXRfYmFsYW5jZTogMCxcclxuICAgICAgICAgIGZpcnN0X25hbWU6ICcnLFxyXG4gICAgICAgICAgbGFzdF9uYW1lOiAnJyxcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5zZWxlY3QoJ2lkLCBjcmVkaXRfYmFsYW5jZScpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgaWYgKGNyZWF0ZUVycm9yIHx8ICFuZXdQcm9maWxlKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgZXJyb3I6ICdGYWlsZWQgdG8gY3JlYXRlIHByb2ZpbGUnLFxyXG4gICAgICAgIH07XHJcbiAgICAgIH1cclxuICAgICAgcHJvZmlsZSA9IG5ld1Byb2ZpbGU7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ3JlYXRlIHBlbmRpbmcgY3JlZGl0IHRyYW5zYWN0aW9uXHJcbiAgICBjb25zdCB7IGVycm9yOiB0cmFuc2FjdGlvbkVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnY3JlZGl0X3RyYW5zYWN0aW9ucycpXHJcbiAgICAgIC5pbnNlcnQoe1xyXG4gICAgICAgIHByb2ZpbGVfaWQ6IHByb2ZpbGUuaWQsXHJcbiAgICAgICAgZW1haWwsXHJcbiAgICAgICAgdHJhbnNhY3Rpb25fdHlwZTogJ3B1cmNoYXNlJyxcclxuICAgICAgICBhbW91bnQsXHJcbiAgICAgICAgYmFsYW5jZV9iZWZvcmU6IHByb2ZpbGUuY3JlZGl0X2JhbGFuY2UgfHwgMCxcclxuICAgICAgICBiYWxhbmNlX2FmdGVyOiBwcm9maWxlLmNyZWRpdF9iYWxhbmNlIHx8IDAsIC8vIFdvbid0IHVwZGF0ZSB1bnRpbCBwYXltZW50IHN1Y2NlZWRzXHJcbiAgICAgICAgcGF5bWVudF9tZXRob2Q6IHBheW1lbnRNZXRob2QsXHJcbiAgICAgICAgcGF5c3RhY2tfcmVmZXJlbmNlOiByZWZlcmVuY2UsXHJcbiAgICAgICAgcGF5bWVudF9zdGF0dXM6ICdwZW5kaW5nJyxcclxuICAgICAgICBkZXNjcmlwdGlvbjogYFB1cmNoYXNlIG9mIFIke2Ftb3VudH0gU2hhbGVhbkNyZWRgLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICBpZiAodHJhbnNhY3Rpb25FcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjcmVhdGluZyBjcmVkaXQgdHJhbnNhY3Rpb246JywgdHJhbnNhY3Rpb25FcnJvcik7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6ICdGYWlsZWQgdG8gY3JlYXRlIHRyYW5zYWN0aW9uIHJlY29yZCcsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gSW5pdGlhbGl6ZSBQYXlzdGFjayBwYXltZW50XHJcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKCcvYXBpL3BheXN0YWNrL2luaXRpYWxpemUnLCB7XHJcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgfSxcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIGVtYWlsLFxyXG4gICAgICAgIGFtb3VudCxcclxuICAgICAgICByZWZlcmVuY2UsXHJcbiAgICAgICAgbWV0YWRhdGE6IHtcclxuICAgICAgICAgIHRyYW5zYWN0aW9uX3R5cGU6ICdjcmVkaXRfcHVyY2hhc2UnLFxyXG4gICAgICAgICAgcGF5bWVudF9tZXRob2Q6IHBheW1lbnRNZXRob2QsXHJcbiAgICAgICAgfSxcclxuICAgICAgfSksXHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XHJcbiAgICAgIGNvbnN0IGVycm9yID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIGVycm9yOiBlcnJvci5lcnJvciB8fCAnRmFpbGVkIHRvIGluaXRpYWxpemUgcGF5bWVudCcsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcGF5bWVudERhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XHJcblxyXG4gICAgaWYgKCFwYXltZW50RGF0YS5zdGF0dXMpIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogcGF5bWVudERhdGEubWVzc2FnZSB8fCAnRmFpbGVkIHRvIGluaXRpYWxpemUgcGF5bWVudCcsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgYXV0aG9yaXphdGlvblVybDogcGF5bWVudERhdGEuZGF0YS5hdXRob3JpemF0aW9uX3VybCxcclxuICAgICAgcmVmZXJlbmNlOiBwYXltZW50RGF0YS5kYXRhLnJlZmVyZW5jZSxcclxuICAgIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluaXRpYWxpemluZyBjcmVkaXQgcHVyY2hhc2U6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gaW5pdGlhbGl6ZSBwYXltZW50JyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFZvdWNoZXJSZWRlbXB0aW9uIHtcclxuICBpZDogc3RyaW5nO1xyXG4gIHZvdWNoZXJfY29kZTogc3RyaW5nO1xyXG4gIGFtb3VudDogbnVtYmVyO1xyXG4gIHJlZGVlbWVkX2F0OiBzdHJpbmc7XHJcbiAgYm9va2luZ19pZD86IHN0cmluZztcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJlZGVlbVZvdWNoZXIoXHJcbiAgY29kZTogc3RyaW5nLFxyXG4gIGVtYWlsOiBzdHJpbmcsXHJcbiAgcGhvbmU/OiBzdHJpbmdcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBhbW91bnQ/OiBudW1iZXI7XHJcbiAgbmV3QmFsYW5jZT86IG51bWJlcjtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIENhbGwgdGhlIGRhdGFiYXNlIGZ1bmN0aW9uIHRvIHJlZGVlbSB0aGUgdm91Y2hlclxyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UucnBjKCdyZWRlZW1fdm91Y2hlcicsIHtcclxuICAgICAgcF9jb2RlOiBjb2RlLnRyaW0oKS50b1VwcGVyQ2FzZSgpLFxyXG4gICAgICBwX2VtYWlsOiBlbWFpbC50cmltKCksXHJcbiAgICAgIHBfcGhvbmU6IHBob25lPy50cmltKCkgfHwgbnVsbCxcclxuICAgIH0pO1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciByZWRlZW1pbmcgdm91Y2hlcjonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byByZWRlZW0gdm91Y2hlcicsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gUGFyc2UgdGhlIHJlc3VsdCBmcm9tIHRoZSBmdW5jdGlvbiAoaGFuZGxlIGJvdGggb2JqZWN0IGFuZCBzdHJpbmcgSlNPTkIpXHJcbiAgICBsZXQgcmVzdWx0ID0gZGF0YTtcclxuICAgIGlmICh0eXBlb2YgZGF0YSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICByZXN1bHQgPSBKU09OLnBhcnNlKGRhdGEpO1xyXG4gICAgICB9IGNhdGNoIChwYXJzZUVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgcGFyc2luZyB2b3VjaGVyIHJlZGVtcHRpb24gcmVzdWx0OicsIHBhcnNlRXJyb3IpO1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgIGVycm9yOiAnSW52YWxpZCByZXNwb25zZSBmcm9tIHNlcnZlcicsXHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGlmIChyZXN1bHQgJiYgdHlwZW9mIHJlc3VsdCA9PT0gJ29iamVjdCcgJiYgJ3N1Y2Nlc3MnIGluIHJlc3VsdCkge1xyXG4gICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgZXJyb3I6IHJlc3VsdC5lcnJvciB8fCAnRmFpbGVkIHRvIHJlZGVlbSB2b3VjaGVyJyxcclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcblxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgYW1vdW50OiByZXN1bHQuYW1vdW50LFxyXG4gICAgICAgIG5ld0JhbGFuY2U6IHJlc3VsdC5uZXdfYmFsYW5jZSxcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6ICdVbmV4cGVjdGVkIHJlc3BvbnNlIGZyb20gc2VydmVyJyxcclxuICAgIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHJlZGVlbVZvdWNoZXI6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gcmVkZWVtIHZvdWNoZXInLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRWb3VjaGVyUmVkZW1wdGlvbnMoXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBwaG9uZT86IHN0cmluZ1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIHJlZGVtcHRpb25zPzogVm91Y2hlclJlZGVtcHRpb25bXTtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIGxldCBxdWVyeSA9IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCd2b3VjaGVyX3JlZGVtcHRpb25zJylcclxuICAgICAgLnNlbGVjdCgnaWQsIHZvdWNoZXJfY29kZSwgYW1vdW50LCByZWRlZW1lZF9hdCwgYm9va2luZ19pZCcpXHJcbiAgICAgIC5vcmRlcigncmVkZWVtZWRfYXQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSk7XHJcblxyXG4gICAgLy8gQnVpbGQgcXVlcnkgZm9yIGVtYWlsL3Bob25lIGxvb2t1cFxyXG4gICAgLy8gUHJpb3JpdGl6ZSBlbWFpbCBhcyBpdCdzIHRoZSBwcmltYXJ5IGlkZW50aWZpZXIgdG8gcHJldmVudCBjcm9zcy1hY2NvdW50IHZpc2liaWxpdHlcclxuICAgIGlmIChlbWFpbCkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdlbWFpbCcsIGVtYWlsKTtcclxuICAgICAgLy8gSWYgcGhvbmUgaXMgYWxzbyBwcm92aWRlZCwgd2UgY2FuIG9wdGlvbmFsbHkgZmlsdGVyIGJ5IGJvdGggZm9yIGV4dHJhIHNlY3VyaXR5XHJcbiAgICAgIC8vIGJ1dCBlbWFpbCBhbG9uZSBzaG91bGQgYmUgc3VmZmljaWVudCBzaW5jZSBpdCdzIHVuaXF1ZVxyXG4gICAgfSBlbHNlIGlmIChwaG9uZSkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdwaG9uZScsIHBob25lKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0VtYWlsIG9yIHBob25lIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHF1ZXJ5O1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyB2b3VjaGVyIHJlZGVtcHRpb25zOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVHJhbnNmb3JtIHRoZSBkYXRhIHRvIG1hdGNoIHRoZSBpbnRlcmZhY2VcclxuICAgIGNvbnN0IHJlZGVtcHRpb25zOiBWb3VjaGVyUmVkZW1wdGlvbltdID0gKGRhdGEgfHwgW10pLm1hcCgocmVkZW1wdGlvbikgPT4gKHtcclxuICAgICAgaWQ6IHJlZGVtcHRpb24uaWQsXHJcbiAgICAgIHZvdWNoZXJfY29kZTogcmVkZW1wdGlvbi52b3VjaGVyX2NvZGUsXHJcbiAgICAgIGFtb3VudDogcmVkZW1wdGlvbi5hbW91bnQsXHJcbiAgICAgIHJlZGVlbWVkX2F0OiByZWRlbXB0aW9uLnJlZGVlbWVkX2F0LFxyXG4gICAgICBib29raW5nX2lkOiByZWRlbXB0aW9uLmJvb2tpbmdfaWQgfHwgdW5kZWZpbmVkLFxyXG4gICAgfSkpO1xyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHJlZGVtcHRpb25zIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGdldFZvdWNoZXJSZWRlbXB0aW9uczonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBmZXRjaCB2b3VjaGVyIHJlZGVtcHRpb25zJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG4iXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6ImlTQVFzQixpTUFBQSJ9
}),
"[project]/app/dashboard/data:b087db [app-ssr] (ecmascript) <text/javascript>", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "uploadProfilePicture",
    ()=>$$RSC_SERVER_ACTION_5
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-ssr] (ecmascript)");
/* __next_internal_action_entry_do_not_use__ [{"784946da6b0a1d1f58381171ad97126653d91253c5":"uploadProfilePicture"},"app/dashboard/actions.ts",""] */ "use turbopack no side effects";
;
const $$RSC_SERVER_ACTION_5 = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["createServerReference"])("784946da6b0a1d1f58381171ad97126653d91253c5", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["findSourceMapURL"], "uploadProfilePicture");
;
 //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vYWN0aW9ucy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHNlcnZlcic7XHJcblxyXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAL2xpYi9zdXBhYmFzZS9zZXJ2ZXInO1xyXG5pbXBvcnQgeyBjcmVhdGVBZG1pbkNsaWVudCB9IGZyb20gJ0AvbGliL3N1cGFiYXNlL3NlcnZlci1hZG1pbic7XHJcbmltcG9ydCB7IEJvb2tpbmcgfSBmcm9tICdAL3R5cGVzL2Jvb2tpbmcnO1xyXG5pbXBvcnQgeyBQcm9maWxlLCBQcm9maWxlVXBkYXRlSW5wdXQgfSBmcm9tICdAL3R5cGVzL3Byb2ZpbGUnO1xyXG5pbXBvcnQgeyBMb2NhdGlvbiwgTG9jYXRpb25DcmVhdGVJbnB1dCwgTG9jYXRpb25VcGRhdGVJbnB1dCB9IGZyb20gJ0AvdHlwZXMvbG9jYXRpb24nO1xyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEF1dGhlbnRpY2F0ZWRVc2VyKCk6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgZW1haWw/OiBzdHJpbmc7XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuICAgIGNvbnN0IHsgZGF0YTogeyB1c2VyIH0sIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcclxuXHJcbiAgICBpZiAoZXJyb3IgfHwgIXVzZXIpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTm90IGF1dGhlbnRpY2F0ZWQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgZW1haWw6IHVzZXIuZW1haWwgfHwgdW5kZWZpbmVkIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGdldEF1dGhlbnRpY2F0ZWRVc2VyOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGdldCB1c2VyJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q3VzdG9tZXJCb29raW5ncyhcclxuICBlbWFpbDogc3RyaW5nLFxyXG4gIHBob25lPzogc3RyaW5nLFxyXG4gIGZpbHRlcj86ICdhbGwnIHwgJ3VwY29taW5nJyB8ICdjb21wbGV0ZWQnIHwgJ2NhbmNlbGxlZCdcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBib29raW5ncz86IEJvb2tpbmdbXTtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIGxldCBxdWVyeSA9IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdib29raW5ncycpXHJcbiAgICAgIC5zZWxlY3QoJyonKVxyXG4gICAgICAub3JkZXIoJ3NlcnZpY2VfZGF0ZScsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KVxyXG4gICAgICAub3JkZXIoJ2NyZWF0ZWRfYXQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSk7XHJcblxyXG4gICAgLy8gQnVpbGQgcXVlcnkgZm9yIGVtYWlsL3Bob25lIGxvb2t1cFxyXG4gICAgaWYgKGVtYWlsICYmIHBob25lKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkub3IoYGN1c3RvbWVyX2VtYWlsLmVxLiR7ZW1haWx9LGN1c3RvbWVyX3Bob25lLmVxLiR7cGhvbmV9YCk7XHJcbiAgICB9IGVsc2UgaWYgKGVtYWlsKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ2N1c3RvbWVyX2VtYWlsJywgZW1haWwpO1xyXG4gICAgfSBlbHNlIGlmIChwaG9uZSkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdjdXN0b21lcl9waG9uZScsIHBob25lKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0VtYWlsIG9yIHBob25lIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEFwcGx5IHN0YXR1cyBmaWx0ZXJcclxuICAgIGlmIChmaWx0ZXIgJiYgZmlsdGVyICE9PSAnYWxsJykge1xyXG4gICAgICBpZiAoZmlsdGVyID09PSAndXBjb21pbmcnKSB7XHJcbiAgICAgICAgcXVlcnkgPSBxdWVyeS5pbignc3RhdHVzJywgWydwZW5kaW5nJywgJ2NvbmZpcm1lZCddKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdzdGF0dXMnLCBmaWx0ZXIpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgcXVlcnk7XHJcblxyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGJvb2tpbmdzOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYm9va2luZ3M6IGRhdGEgfHwgW10gfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gZ2V0Q3VzdG9tZXJCb29raW5nczonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBmZXRjaCBib29raW5ncycsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEN1c3RvbWVyQm9va2luZ1N0YXRzKFxyXG4gIGVtYWlsOiBzdHJpbmcsXHJcbiAgcGhvbmU/OiBzdHJpbmdcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBzdGF0cz86IHtcclxuICAgIHRvdGFsOiBudW1iZXI7XHJcbiAgICB1cGNvbWluZzogbnVtYmVyO1xyXG4gICAgY29tcGxldGVkOiBudW1iZXI7XHJcbiAgICBjYW5jZWxsZWQ6IG51bWJlcjtcclxuICAgIHRvdGFsU3BlbnQ6IG51bWJlcjtcclxuICB9O1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgbGV0IHF1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2Jvb2tpbmdzJylcclxuICAgICAgLnNlbGVjdCgnc3RhdHVzLCB0b3RhbF9hbW91bnQsIHBheW1lbnRfc3RhdHVzJyk7XHJcblxyXG4gICAgLy8gQnVpbGQgcXVlcnkgZm9yIGVtYWlsL3Bob25lIGxvb2t1cFxyXG4gICAgaWYgKGVtYWlsICYmIHBob25lKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkub3IoYGN1c3RvbWVyX2VtYWlsLmVxLiR7ZW1haWx9LGN1c3RvbWVyX3Bob25lLmVxLiR7cGhvbmV9YCk7XHJcbiAgICB9IGVsc2UgaWYgKGVtYWlsKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ2N1c3RvbWVyX2VtYWlsJywgZW1haWwpO1xyXG4gICAgfSBlbHNlIGlmIChwaG9uZSkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdjdXN0b21lcl9waG9uZScsIHBob25lKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0VtYWlsIG9yIHBob25lIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHF1ZXJ5O1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBzdGF0cyA9IHtcclxuICAgICAgdG90YWw6IGRhdGE/Lmxlbmd0aCB8fCAwLFxyXG4gICAgICB1cGNvbWluZzogZGF0YT8uZmlsdGVyKChiKSA9PiBiLnN0YXR1cyA9PT0gJ3BlbmRpbmcnIHx8IGIuc3RhdHVzID09PSAnY29uZmlybWVkJykubGVuZ3RoIHx8IDAsXHJcbiAgICAgIGNvbXBsZXRlZDogZGF0YT8uZmlsdGVyKChiKSA9PiBiLnN0YXR1cyA9PT0gJ2NvbXBsZXRlZCcpLmxlbmd0aCB8fCAwLFxyXG4gICAgICBjYW5jZWxsZWQ6IGRhdGE/LmZpbHRlcigoYikgPT4gYi5zdGF0dXMgPT09ICdjYW5jZWxsZWQnKS5sZW5ndGggfHwgMCxcclxuICAgICAgdG90YWxTcGVudDogZGF0YVxyXG4gICAgICAgID8uZmlsdGVyKChiKSA9PiBiLnBheW1lbnRfc3RhdHVzID09PSAncGFpZCcpXHJcbiAgICAgICAgLnJlZHVjZSgoc3VtLCBiKSA9PiBzdW0gKyAoYi50b3RhbF9hbW91bnQgfHwgMCksIDApIHx8IDAsXHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHN0YXRzIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGZldGNoIHN0YXRzJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Qm9va2luZ0J5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgYm9va2luZz86IEJvb2tpbmc7XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnYm9va2luZ3MnKVxyXG4gICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgLmVxKCdpZCcsIGlkKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGJvb2tpbmc6JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdCb29raW5nIG5vdCBmb3VuZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBib29raW5nOiBkYXRhIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ1VuZXhwZWN0ZWQgZXJyb3IgZmV0Y2hpbmcgYm9va2luZzonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0FuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDdXN0b21lclByb2ZpbGUoXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBwaG9uZT86IHN0cmluZ1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIHByb2ZpbGU/OiBQcm9maWxlO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgLy8gRmlyc3QsIHRyeSB0byBnZXQgcHJvZmlsZSBmcm9tIHByb2ZpbGVzIHRhYmxlXHJcbiAgICBsZXQgcXVlcnkgPSBzdXBhYmFzZS5mcm9tKCdwcm9maWxlcycpLnNlbGVjdCgnKicpO1xyXG5cclxuICAgIGlmIChlbWFpbCkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdlbWFpbCcsIGVtYWlsKTtcclxuICAgIH0gZWxzZSBpZiAocGhvbmUpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgncGhvbmUnLCBwaG9uZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdFbWFpbCBvciBwaG9uZSBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB7IGRhdGE6IHByb2ZpbGVEYXRhLCBlcnJvcjogcHJvZmlsZUVycm9yIH0gPSBhd2FpdCBxdWVyeS5tYXliZVNpbmdsZSgpO1xyXG5cclxuICAgIC8vIElmIHByb2ZpbGUgZXhpc3RzLCByZXR1cm4gaXRcclxuICAgIGlmIChwcm9maWxlRGF0YSAmJiAhcHJvZmlsZUVycm9yKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHByb2ZpbGU6IHByb2ZpbGVEYXRhIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gSWYgbm8gcHJvZmlsZSBleGlzdHMsIGRlcml2ZSBmcm9tIG1vc3QgcmVjZW50IGJvb2tpbmdcclxuICAgIGxldCBib29raW5nUXVlcnkgPSBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnYm9va2luZ3MnKVxyXG4gICAgICAuc2VsZWN0KCdjdXN0b21lcl9maXJzdF9uYW1lLCBjdXN0b21lcl9sYXN0X25hbWUsIGN1c3RvbWVyX2VtYWlsLCBjdXN0b21lcl9waG9uZScpXHJcbiAgICAgIC5vcmRlcignY3JlYXRlZF9hdCcsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KVxyXG4gICAgICAubGltaXQoMSk7XHJcblxyXG4gICAgaWYgKGVtYWlsICYmIHBob25lKSB7XHJcbiAgICAgIGJvb2tpbmdRdWVyeSA9IGJvb2tpbmdRdWVyeS5vcihgY3VzdG9tZXJfZW1haWwuZXEuJHtlbWFpbH0sY3VzdG9tZXJfcGhvbmUuZXEuJHtwaG9uZX1gKTtcclxuICAgIH0gZWxzZSBpZiAoZW1haWwpIHtcclxuICAgICAgYm9va2luZ1F1ZXJ5ID0gYm9va2luZ1F1ZXJ5LmVxKCdjdXN0b21lcl9lbWFpbCcsIGVtYWlsKTtcclxuICAgIH0gZWxzZSBpZiAocGhvbmUpIHtcclxuICAgICAgYm9va2luZ1F1ZXJ5ID0gYm9va2luZ1F1ZXJ5LmVxKCdjdXN0b21lcl9waG9uZScsIHBob25lKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB7IGRhdGE6IGJvb2tpbmdEYXRhLCBlcnJvcjogYm9va2luZ0Vycm9yIH0gPSBhd2FpdCBib29raW5nUXVlcnkubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoYm9va2luZ0Vycm9yIHx8ICFib29raW5nRGF0YSkge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIGVycm9yOiAnTm8gcHJvZmlsZSBvciBib29raW5nIGZvdW5kLiBQbGVhc2UgY3JlYXRlIGEgYm9va2luZyBmaXJzdC4nLFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENyZWF0ZSBhIHByb2ZpbGUgb2JqZWN0IGZyb20gYm9va2luZyBkYXRhXHJcbiAgICBjb25zdCBkZXJpdmVkUHJvZmlsZTogUHJvZmlsZSA9IHtcclxuICAgICAgaWQ6ICcnLCAvLyBXaWxsIGJlIGdlbmVyYXRlZCB3aGVuIHNhdmVkXHJcbiAgICAgIGVtYWlsOiBib29raW5nRGF0YS5jdXN0b21lcl9lbWFpbCxcclxuICAgICAgcGhvbmU6IGJvb2tpbmdEYXRhLmN1c3RvbWVyX3Bob25lIHx8IG51bGwsXHJcbiAgICAgIGZpcnN0X25hbWU6IGJvb2tpbmdEYXRhLmN1c3RvbWVyX2ZpcnN0X25hbWUsXHJcbiAgICAgIGxhc3RfbmFtZTogYm9va2luZ0RhdGEuY3VzdG9tZXJfbGFzdF9uYW1lLFxyXG4gICAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcHJvZmlsZTogZGVyaXZlZFByb2ZpbGUgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gZ2V0Q3VzdG9tZXJQcm9maWxlOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGZldGNoIHByb2ZpbGUnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGxvYWRQcm9maWxlUGljdHVyZShcclxuICBlbWFpbDogc3RyaW5nLFxyXG4gIGZpbGVEYXRhOiBzdHJpbmcsIC8vIGJhc2U2NCBlbmNvZGVkIHN0cmluZ1xyXG4gIGZpbGVOYW1lOiBzdHJpbmcsXHJcbiAgZmlsZVR5cGU6IHN0cmluZ1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIHVybD86IHN0cmluZztcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICAvLyBVc2UgYWRtaW4gY2xpZW50IGZvciBzdG9yYWdlIHVwbG9hZHMgaWYgc2VydmljZSByb2xlIGtleSBpcyBhdmFpbGFibGVcclxuICAgIC8vIFRoaXMgZW5zdXJlcyBzdG9yYWdlIHBvbGljaWVzIGRvbid0IGJsb2NrIHRoZSB1cGxvYWRcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSBcclxuICAgICAgPyBjcmVhdGVBZG1pbkNsaWVudCgpIFxyXG4gICAgICA6IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIFZhbGlkYXRlIGZpbGUgdHlwZVxyXG4gICAgY29uc3QgdmFsaWRJbWFnZVR5cGVzID0gWydpbWFnZS9qcGVnJywgJ2ltYWdlL2pwZycsICdpbWFnZS9wbmcnLCAnaW1hZ2Uvd2VicCddO1xyXG4gICAgaWYgKCF2YWxpZEltYWdlVHlwZXMuaW5jbHVkZXMoZmlsZVR5cGUpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ludmFsaWQgZmlsZSB0eXBlLiBQbGVhc2UgdXBsb2FkIGEgSlBFRywgUE5HLCBvciBXZWJQIGltYWdlLicgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBEZWNvZGUgYmFzZTY0IGRhdGFcclxuICAgIGNvbnN0IGJhc2U2NERhdGEgPSBmaWxlRGF0YS5yZXBsYWNlKC9eZGF0YTppbWFnZVxcL1xcdys7YmFzZTY0LC8sICcnKTtcclxuICAgIGNvbnN0IGJ1ZmZlciA9IEJ1ZmZlci5mcm9tKGJhc2U2NERhdGEsICdiYXNlNjQnKTtcclxuXHJcbiAgICAvLyBWYWxpZGF0ZSBmaWxlIHNpemUgKG1heCA1TUIpXHJcbiAgICBjb25zdCBtYXhTaXplID0gNSAqIDEwMjQgKiAxMDI0OyAvLyA1TUIgaW4gYnl0ZXNcclxuICAgIGlmIChidWZmZXIubGVuZ3RoID4gbWF4U2l6ZSkge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdGaWxlIHNpemUgdG9vIGxhcmdlLiBQbGVhc2UgdXBsb2FkIGFuIGltYWdlIHNtYWxsZXIgdGhhbiA1TUIuJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEdlbmVyYXRlIHVuaXF1ZSBmaWxlbmFtZSB1c2luZyBlbWFpbCBhbmQgdGltZXN0YW1wXHJcbiAgICBjb25zdCBmaWxlRXh0ID0gZmlsZU5hbWUuc3BsaXQoJy4nKS5wb3AoKSB8fCAnanBnJztcclxuICAgIGNvbnN0IHNhbml0aXplZEVtYWlsID0gZW1haWwucmVwbGFjZSgvW15hLXpBLVowLTldL2csICdfJyk7XHJcbiAgICBjb25zdCB1bmlxdWVGaWxlTmFtZSA9IGAke3Nhbml0aXplZEVtYWlsfV8ke0RhdGUubm93KCl9LiR7ZmlsZUV4dH1gO1xyXG4gICAgY29uc3QgZmlsZVBhdGggPSBgYXZhdGFycy8ke3VuaXF1ZUZpbGVOYW1lfWA7XHJcblxyXG4gICAgLy8gVXBsb2FkIHRvIFN1cGFiYXNlIFN0b3JhZ2VcclxuICAgIGNvbnN0IHsgZGF0YTogdXBsb2FkRGF0YSwgZXJyb3I6IHVwbG9hZEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5zdG9yYWdlXHJcbiAgICAgIC5mcm9tKCdwcm9maWxlLXBpY3R1cmVzJylcclxuICAgICAgLnVwbG9hZChmaWxlUGF0aCwgYnVmZmVyLCB7XHJcbiAgICAgICAgY29udGVudFR5cGU6IGZpbGVUeXBlLFxyXG4gICAgICAgIHVwc2VydDogZmFsc2UsXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgaWYgKHVwbG9hZEVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcign4p2MIFN0b3JhZ2UgdXBsb2FkIGVycm9yOicsIHVwbG9hZEVycm9yKTtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdVcGxvYWQgZXJyb3IgZGV0YWlsczonLCB7XHJcbiAgICAgICAgICBtZXNzYWdlOiB1cGxvYWRFcnJvci5tZXNzYWdlLFxyXG4gICAgICAgICAgc3RhdHVzQ29kZTogdXBsb2FkRXJyb3Iuc3RhdHVzQ29kZSxcclxuICAgICAgICAgIGVycm9yOiB1cGxvYWRFcnJvci5lcnJvcixcclxuICAgICAgICB9KTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBDaGVjayBmb3Igc3RvcmFnZSBSTFMgZXJyb3JzXHJcbiAgICAgICAgaWYgKHVwbG9hZEVycm9yLm1lc3NhZ2U/LmluY2x1ZGVzKCdyb3ctbGV2ZWwgc2VjdXJpdHknKSB8fCBcclxuICAgICAgICAgICAgdXBsb2FkRXJyb3IubWVzc2FnZT8uaW5jbHVkZXMoJ1JMUycpIHx8XHJcbiAgICAgICAgICAgIHVwbG9hZEVycm9yLm1lc3NhZ2U/LmluY2x1ZGVzKCdwb2xpY3knKSkge1xyXG4gICAgICAgICAgcmV0dXJuIHsgXHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLCBcclxuICAgICAgICAgICAgZXJyb3I6ICdTdG9yYWdlIGJ1Y2tldCBSTFMgcG9saWN5IGVycm9yLiBQbGVhc2UgY2hlY2sgeW91ciBcInByb2ZpbGUtcGljdHVyZXNcIiBidWNrZXQgcG9saWNpZXMgaW4gU3VwYWJhc2UgU3RvcmFnZS4gVGhlIGJ1Y2tldCBuZWVkcyBwb2xpY2llcyB0aGF0IGFsbG93IGF1dGhlbnRpY2F0ZWQgdXNlcnMgdG8gdXBsb2FkIGZpbGVzLicsXHJcbiAgICAgICAgICAgIGVycm9yRGV0YWlsczogdXBsb2FkRXJyb3IubWVzc2FnZSxcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIElmIGJ1Y2tldCBkb2Vzbid0IGV4aXN0LCByZXR1cm4gaGVscGZ1bCBlcnJvclxyXG4gICAgICAgIGlmICh1cGxvYWRFcnJvci5tZXNzYWdlLmluY2x1ZGVzKCdub3QgZm91bmQnKSB8fCB1cGxvYWRFcnJvci5tZXNzYWdlLmluY2x1ZGVzKCdCdWNrZXQnKSkge1xyXG4gICAgICAgICAgcmV0dXJuIHsgXHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLCBcclxuICAgICAgICAgICAgZXJyb3I6ICdTdG9yYWdlIGJ1Y2tldCBub3QgY29uZmlndXJlZC4gUGxlYXNlIGNyZWF0ZSBhIFwicHJvZmlsZS1waWN0dXJlc1wiIGJ1Y2tldCBpbiBTdXBhYmFzZSBTdG9yYWdlLicsXHJcbiAgICAgICAgICAgIGVycm9yRGV0YWlsczogdXBsb2FkRXJyb3IubWVzc2FnZSxcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB7IFxyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsIFxyXG4gICAgICAgICAgZXJyb3I6IHVwbG9hZEVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byB1cGxvYWQgZmlsZScsXHJcbiAgICAgICAgICBlcnJvckRldGFpbHM6IHVwbG9hZEVycm9yLmVycm9yIHx8IHVwbG9hZEVycm9yLnN0YXR1c0NvZGU/LnRvU3RyaW5nKCksXHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG5cclxuICAgIC8vIEdldCBwdWJsaWMgVVJMXHJcbiAgICBjb25zdCB7IGRhdGE6IHVybERhdGEgfSA9IHN1cGFiYXNlLnN0b3JhZ2VcclxuICAgICAgLmZyb20oJ3Byb2ZpbGUtcGljdHVyZXMnKVxyXG4gICAgICAuZ2V0UHVibGljVXJsKGZpbGVQYXRoKTtcclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCB1cmw6IHVybERhdGEucHVibGljVXJsIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHVwbG9hZFByb2ZpbGVQaWN0dXJlOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIHVwbG9hZCBwcm9maWxlIHBpY3R1cmUnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBkZWxldGVQcm9maWxlUGljdHVyZShlbWFpbDogc3RyaW5nLCBhdmF0YXJVcmw6IHN0cmluZyk6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICAvLyBFeHRyYWN0IGZpbGUgcGF0aCBmcm9tIFVSTFxyXG4gICAgLy8gVVJMIGZvcm1hdDogaHR0cHM6Ly9bcHJvamVjdF0uc3VwYWJhc2UuY28vc3RvcmFnZS92MS9vYmplY3QvcHVibGljL3Byb2ZpbGUtcGljdHVyZXMvYXZhdGFycy9maWxlbmFtZS5qcGdcclxuICAgIGNvbnN0IHVybFBhdHRlcm4gPSAvXFwvcHJvZmlsZS1waWN0dXJlc1xcLyguKykkLztcclxuICAgIGNvbnN0IG1hdGNoID0gYXZhdGFyVXJsLm1hdGNoKHVybFBhdHRlcm4pO1xyXG4gICAgXHJcbiAgICBpZiAoIW1hdGNoIHx8ICFtYXRjaFsxXSkge1xyXG4gICAgICAvLyBJZiBVUkwgZG9lc24ndCBtYXRjaCBleHBlY3RlZCBwYXR0ZXJuLCB0cnkgYWx0ZXJuYXRpdmUgcGFyc2luZ1xyXG4gICAgICBjb25zdCB1cmxQYXJ0cyA9IGF2YXRhclVybC5zcGxpdCgnL2F2YXRhcnMvJyk7XHJcbiAgICAgIGlmICh1cmxQYXJ0cy5sZW5ndGggPCAyKSB7XHJcbiAgICAgICAgLy8gSWYgd2UgY2FuJ3QgcGFyc2UgdGhlIFVSTCwganVzdCByZXR1cm4gc3VjY2VzcyAodGhlIGZpbGUgbWlnaHQgYWxyZWFkeSBiZSBkZWxldGVkKVxyXG4gICAgICAgIGNvbnNvbGUud2FybignQ291bGQgbm90IHBhcnNlIGF2YXRhciBVUkwgZm9yIGRlbGV0aW9uOicsIGF2YXRhclVybCk7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xyXG4gICAgICB9XHJcbiAgICAgIGNvbnN0IGZpbGVQYXRoID0gYGF2YXRhcnMvJHt1cmxQYXJ0c1sxXS5zcGxpdCgnPycpWzBdfWA7XHJcbiAgICAgIGNvbnN0IHsgZXJyb3I6IGRlbGV0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5zdG9yYWdlXHJcbiAgICAgICAgLmZyb20oJ3Byb2ZpbGUtcGljdHVyZXMnKVxyXG4gICAgICAgIC5yZW1vdmUoW2ZpbGVQYXRoXSk7XHJcblxyXG4gICAgICBpZiAoZGVsZXRlRXJyb3IgJiYgIWRlbGV0ZUVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ25vdCBmb3VuZCcpKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZGVsZXRpbmcgZmlsZTonLCBkZWxldGVFcnJvcik7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBkZWxldGVFcnJvci5tZXNzYWdlIH07XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGZpbGVQYXRoID0gbWF0Y2hbMV0uc3BsaXQoJz8nKVswXTsgLy8gUmVtb3ZlIHF1ZXJ5IHBhcmFtZXRlcnMgaWYgYW55XHJcblxyXG4gICAgLy8gRGVsZXRlIGZyb20gc3RvcmFnZVxyXG4gICAgY29uc3QgeyBlcnJvcjogZGVsZXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLnN0b3JhZ2VcclxuICAgICAgLmZyb20oJ3Byb2ZpbGUtcGljdHVyZXMnKVxyXG4gICAgICAucmVtb3ZlKFtmaWxlUGF0aF0pO1xyXG5cclxuICAgIGlmIChkZWxldGVFcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBkZWxldGluZyBmaWxlOicsIGRlbGV0ZUVycm9yKTtcclxuICAgICAgLy8gRG9uJ3QgZmFpbCBpZiBmaWxlIGRvZXNuJ3QgZXhpc3RcclxuICAgICAgaWYgKGRlbGV0ZUVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ25vdCBmb3VuZCcpIHx8IGRlbGV0ZUVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ05vIHN1Y2ggZmlsZScpKSB7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZGVsZXRlRXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gZGVsZXRlUHJvZmlsZVBpY3R1cmU6JywgZXJyb3IpO1xyXG4gICAgLy8gRG9uJ3QgZmFpbCBjb21wbGV0ZWx5IC0gdGhlIFVSTCBpbiBkYXRhYmFzZSB3aWxsIGJlIHJlbW92ZWQgYW55d2F5XHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQ3VzdG9tZXJQcm9maWxlKFxyXG4gIGVtYWlsOiBzdHJpbmcsXHJcbiAgZGF0YTogUHJvZmlsZVVwZGF0ZUlucHV0XHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgcHJvZmlsZT86IFByb2ZpbGU7XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgLy8gRmlyc3QsIHZlcmlmeSB0aGUgYXV0aGVudGljYXRlZCB1c2VyIG1hdGNoZXMgdGhlIGVtYWlsXHJcbiAgICBjb25zdCBhdXRoU3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuICAgIGNvbnN0IHsgZGF0YTogeyB1c2VyIH0sIGVycm9yOiBhdXRoRXJyb3IgfSA9IGF3YWl0IGF1dGhTdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcclxuICAgIFxyXG4gICAgaWYgKGF1dGhFcnJvciB8fCAhdXNlcikge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdOb3QgYXV0aGVudGljYXRlZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBWZXJpZnkgdGhhdCB0aGUgZW1haWwgcGFyYW1ldGVyIG1hdGNoZXMgdGhlIGF1dGhlbnRpY2F0ZWQgdXNlcidzIGVtYWlsXHJcbiAgICAvLyBUaGlzIGVuc3VyZXMgdXNlcnMgY2FuIG9ubHkgdXBkYXRlIHRoZWlyIG93biBwcm9maWxlXHJcbiAgICBpZiAodXNlci5lbWFpbD8udG9Mb3dlckNhc2UoKSAhPT0gZW1haWwudG9Mb3dlckNhc2UoKSAmJiB1c2VyLmVtYWlsPy50b0xvd2VyQ2FzZSgpICE9PSBkYXRhLmVtYWlsPy50b0xvd2VyQ2FzZSgpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ1VuYXV0aG9yaXplZDogWW91IGNhbiBvbmx5IHVwZGF0ZSB5b3VyIG93biBwcm9maWxlJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEFMV0FZUyB1c2UgYWRtaW4gY2xpZW50IGZvciBwcm9maWxlIG9wZXJhdGlvbnMgLSBpdCBieXBhc3NlcyBSTFMgY29tcGxldGVseVxyXG4gICAgLy8gVGhpcyBpcyBSRVFVSVJFRCAtIHdlIGNhbm5vdCB1c2UgYXV0aGVudGljYXRlZCBjbGllbnQgYXMgaXQgbWF5IHN0aWxsIGNoZWNrIFJMUyBwb2xpY2llc1xyXG4gICAgbGV0IHN1cGFiYXNlO1xyXG4gICAgdHJ5IHtcclxuICAgICAgc3VwYWJhc2UgPSBjcmVhdGVBZG1pbkNsaWVudCgpO1xyXG4gICAgICBjb25zb2xlLmxvZygn4pyFIFVzaW5nIGFkbWluIGNsaWVudCBmb3IgcHJvZmlsZSBvcGVyYXRpb25zJyk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAvLyBEbyBOT1QgZmFsbCBiYWNrIHRvIGF1dGhlbnRpY2F0ZWQgY2xpZW50IC0gaXQgd2lsbCBjYXVzZSBSTFMgZXJyb3JzXHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBGYWlsZWQgdG8gY3JlYXRlIGFkbWluIGNsaWVudDonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6ICdTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIGlzIG5vdCBzZXQuIFRoaXMgaXMgUkVRVUlSRUQgZm9yIHByb2ZpbGUgb3BlcmF0aW9ucy4gUGxlYXNlIGFkZCBpdCB0byB5b3VyIC5lbnYubG9jYWwgZmlsZS4gR2V0IGl0IGZyb206IFN1cGFiYXNlIERhc2hib2FyZCDihpIgU2V0dGluZ3Mg4oaSIEFQSSDihpIgc2VydmljZV9yb2xlIGtleSAoc2VjcmV0KScsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIFZlcmlmeSB3ZSBoYXZlIGEgdmFsaWQgY2xpZW50IChzaG91bGQgbmV2ZXIgaGFwcGVuIGR1ZSB0byBlcnJvciBhYm92ZSwgYnV0IGRvdWJsZS1jaGVjaylcclxuICAgIGlmICghc3VwYWJhc2UpIHtcclxuICAgICAgcmV0dXJuIHsgXHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsIFxyXG4gICAgICAgIGVycm9yOiAnRmFpbGVkIHRvIGluaXRpYWxpemUgZGF0YWJhc2UgY2xpZW50LiBQbGVhc2UgY2hlY2sgeW91ciBTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIGluIC5lbnYubG9jYWwnIFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFZhbGlkYXRlIGlucHV0XHJcbiAgICBpZiAoIWRhdGEuZmlyc3RfbmFtZT8udHJpbSgpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ZpcnN0IG5hbWUgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcbiAgICBpZiAoIWRhdGEubGFzdF9uYW1lPy50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTGFzdCBuYW1lIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG4gICAgaWYgKCFkYXRhLmVtYWlsPy50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRW1haWwgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcbiAgICBpZiAoIS9eW15cXHNAXStAW15cXHNAXStcXC5bXlxcc0BdKyQvLnRlc3QoZGF0YS5lbWFpbCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnSW52YWxpZCBlbWFpbCBmb3JtYXQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVmVyaWZ5IHRoZSBuZXcgZW1haWwgKGlmIGNoYW5nZWQpIHN0aWxsIG1hdGNoZXMgdGhlIGF1dGhlbnRpY2F0ZWQgdXNlclxyXG4gICAgaWYgKGRhdGEuZW1haWwudG9Mb3dlckNhc2UoKSAhPT0gdXNlci5lbWFpbD8udG9Mb3dlckNhc2UoKSkge1xyXG4gICAgICAvLyBBbGxvdyBlbWFpbCBjaGFuZ2Ugb25seSBpZiBpdCdzIHRoZSBzYW1lIHVzZXIgKGNhc2UgaW5zZW5zaXRpdmUgY2hlY2sgYWJvdmUgcGFzc2VkKVxyXG4gICAgICAvLyBCdXQgd2Ugc2hvdWxkIHZlcmlmeSBpdCdzIGEgdmFsaWQgY2hhbmdlICh1c2VyIHVwZGF0aW5nIHRoZWlyIG93biBlbWFpbClcclxuICAgICAgaWYgKGRhdGEuZW1haWwudG9Mb3dlckNhc2UoKSAhPT0gZW1haWwudG9Mb3dlckNhc2UoKSkge1xyXG4gICAgICAgIC8vIEVtYWlsIGlzIGJlaW5nIGNoYW5nZWQgLSB2ZXJpZnkgaXQncyBzdGlsbCB0aGUgc2FtZSB1c2VyXHJcbiAgICAgICAgLy8gRm9yIG5vdywgd2UnbGwgYWxsb3cgaXQgYnV0IGluIHByb2R1Y3Rpb24geW91IG1pZ2h0IHdhbnQgdG8gcmVxdWlyZSBlbWFpbCB2ZXJpZmljYXRpb25cclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIENoZWNrIGlmIHByb2ZpbGUgZXhpc3RzXHJcbiAgICBjb25zb2xlLmxvZygn8J+UjSBDaGVja2luZyBpZiBwcm9maWxlIGV4aXN0cyBmb3IgZW1haWw6JywgZW1haWwpO1xyXG4gICAgY29uc29sZS5sb2coJ/CflI0gVXNpbmcgY2xpZW50IHR5cGU6JywgcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSA/ICdBRE1JTiAoc2VydmljZSByb2xlKScgOiAnQVVUSEVOVElDQVRFRCAoYW5vbiBrZXkpJyk7XHJcbiAgICBcclxuICAgIGNvbnN0IHsgZGF0YTogZXhpc3RpbmdQcm9maWxlLCBlcnJvcjogc2VsZWN0RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgIC5zZWxlY3QoJyonKVxyXG4gICAgICAuZXEoJ2VtYWlsJywgZW1haWwpXHJcbiAgICAgIC5tYXliZVNpbmdsZSgpO1xyXG4gICAgXHJcbiAgICBpZiAoc2VsZWN0RXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIHNlbGVjdGluZyBwcm9maWxlOicsIHNlbGVjdEVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBgRmFpbGVkIHRvIGNoZWNrIHByb2ZpbGU6ICR7c2VsZWN0RXJyb3IubWVzc2FnZX1gIH07XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGNvbnNvbGUubG9nKCfinIUgUHJvZmlsZSBjaGVjayByZXN1bHQ6JywgZXhpc3RpbmdQcm9maWxlID8gJ1Byb2ZpbGUgZXhpc3RzICh3aWxsIFVQREFURSknIDogJ1Byb2ZpbGUgZG9lcyBub3QgZXhpc3QgKHdpbGwgSU5TRVJUKScpO1xyXG5cclxuICAgIC8vIElmIGF2YXRhcl91cmwgaXMgYmVpbmcgcmVtb3ZlZCwgZGVsZXRlIHRoZSBvbGQgZmlsZVxyXG4gICAgaWYgKGV4aXN0aW5nUHJvZmlsZT8uYXZhdGFyX3VybCAmJiBkYXRhLmF2YXRhcl91cmwgPT09IG51bGwpIHtcclxuICAgICAgYXdhaXQgZGVsZXRlUHJvZmlsZVBpY3R1cmUoZW1haWwsIGV4aXN0aW5nUHJvZmlsZS5hdmF0YXJfdXJsKTtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgcmVzdWx0O1xyXG4gICAgaWYgKGV4aXN0aW5nUHJvZmlsZSkge1xyXG4gICAgICAvLyBVcGRhdGUgZXhpc3RpbmcgcHJvZmlsZVxyXG4gICAgICAvLyBJZiBlbWFpbCBjaGFuZ2VkLCB3ZSBuZWVkIHRvIGhhbmRsZSBpdCBjYXJlZnVsbHlcclxuICAgICAgaWYgKGRhdGEuZW1haWwgIT09IGVtYWlsKSB7XHJcbiAgICAgICAgLy8gQ2hlY2sgaWYgbmV3IGVtYWlsIGFscmVhZHkgZXhpc3RzXHJcbiAgICAgICAgY29uc3QgeyBkYXRhOiBlbWFpbENoZWNrIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcclxuICAgICAgICAgIC5zZWxlY3QoJ2lkJylcclxuICAgICAgICAgIC5lcSgnZW1haWwnLCBkYXRhLmVtYWlsKVxyXG4gICAgICAgICAgLm1heWJlU2luZ2xlKCk7XHJcblxyXG4gICAgICAgIGlmIChlbWFpbENoZWNrKSB7XHJcbiAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdFbWFpbCBhbHJlYWR5IGV4aXN0cycgfTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IHVwZGF0ZURhdGE6IGFueSA9IHtcclxuICAgICAgICAgIGZpcnN0X25hbWU6IGRhdGEuZmlyc3RfbmFtZS50cmltKCksXHJcbiAgICAgICAgICBsYXN0X25hbWU6IGRhdGEubGFzdF9uYW1lLnRyaW0oKSxcclxuICAgICAgICAgIGVtYWlsOiBkYXRhLmVtYWlsLnRyaW0oKSxcclxuICAgICAgICAgIHBob25lOiBkYXRhLnBob25lPy50cmltKCkgfHwgbnVsbCxcclxuICAgICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8vIE9ubHkgdXBkYXRlIGF2YXRhcl91cmwgaWYgaXQncyBwcm92aWRlZFxyXG4gICAgICBpZiAoZGF0YS5hdmF0YXJfdXJsICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICB1cGRhdGVEYXRhLmF2YXRhcl91cmwgPSBkYXRhLmF2YXRhcl91cmw7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnNvbGUubG9nKCfwn5OdIEF0dGVtcHRpbmcgdG8gVVBEQVRFIHByb2ZpbGUgd2l0aCBkYXRhOicsIHVwZGF0ZURhdGEpO1xyXG4gICAgICBjb25zb2xlLmxvZygn8J+TnSBVcGRhdGUgV0hFUkUgZW1haWwgPScsIGVtYWlsKTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IHsgZGF0YTogdXBkYXRlZFByb2ZpbGUsIGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgIC51cGRhdGUodXBkYXRlRGF0YSlcclxuICAgICAgICAuZXEoJ2VtYWlsJywgZW1haWwpXHJcbiAgICAgICAgLnNlbGVjdCgpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgaWYgKHVwZGF0ZUVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIHVwZGF0aW5nIHByb2ZpbGU6JywgdXBkYXRlRXJyb3IpO1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBVcGRhdGUgZXJyb3IgZGV0YWlsczonLCB7XHJcbiAgICAgICAgICBjb2RlOiB1cGRhdGVFcnJvci5jb2RlLFxyXG4gICAgICAgICAgbWVzc2FnZTogdXBkYXRlRXJyb3IubWVzc2FnZSxcclxuICAgICAgICAgIGRldGFpbHM6IHVwZGF0ZUVycm9yLmRldGFpbHMsXHJcbiAgICAgICAgICBoaW50OiB1cGRhdGVFcnJvci5oaW50LFxyXG4gICAgICAgICAgc3RhdHVzQ29kZTogKHVwZGF0ZUVycm9yIGFzIGFueSkuc3RhdHVzQ29kZSxcclxuICAgICAgICAgIHN0YXR1czogKHVwZGF0ZUVycm9yIGFzIGFueSkuc3RhdHVzLFxyXG4gICAgICAgICAgc2VydmljZVJvbGVLZXlTZXQ6ICEhcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSxcclxuICAgICAgICB9KTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBDaGVjayBmb3IgUkxTIGVycm9ycyBzcGVjaWZpY2FsbHlcclxuICAgICAgICBpZiAodXBkYXRlRXJyb3IubWVzc2FnZT8uaW5jbHVkZXMoJ3Jvdy1sZXZlbCBzZWN1cml0eScpIHx8IFxyXG4gICAgICAgICAgICB1cGRhdGVFcnJvci5jb2RlID09PSAnNDI1MDEnIHx8XHJcbiAgICAgICAgICAgIHVwZGF0ZUVycm9yLm1lc3NhZ2U/LmluY2x1ZGVzKCdSTFMnKSkge1xyXG4gICAgICAgICAgcmV0dXJuIHsgXHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLCBcclxuICAgICAgICAgICAgZXJyb3I6ICdSb3cgTGV2ZWwgU2VjdXJpdHkgZXJyb3IuIFBsZWFzZSBlbnN1cmU6IDEpIFJMUyBpcyBkaXNhYmxlZCBvbiBwcm9maWxlcyB0YWJsZSwgMikgU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSBpcyBzZXQgaW4gLmVudi5sb2NhbCcsXHJcbiAgICAgICAgICAgIGVycm9yRGV0YWlsczogYEVycm9yIGNvZGU6ICR7dXBkYXRlRXJyb3IuY29kZSB8fCAndW5rbm93bid9LiAke3VwZGF0ZUVycm9yLmhpbnQgfHwgJyd9YCxcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHJldHVybiB7IFxyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsIFxyXG4gICAgICAgICAgZXJyb3I6IHVwZGF0ZUVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byB1cGRhdGUgcHJvZmlsZScsXHJcbiAgICAgICAgICBlcnJvckRldGFpbHM6IHVwZGF0ZUVycm9yLmRldGFpbHMgfHwgdXBkYXRlRXJyb3IuaGludCB8fCB1bmRlZmluZWQsXHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmVzdWx0ID0gdXBkYXRlZFByb2ZpbGU7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyBDcmVhdGUgbmV3IHByb2ZpbGVcclxuICAgICAgY29uc3QgaW5zZXJ0RGF0YTogYW55ID0ge1xyXG4gICAgICAgICAgZW1haWw6IGRhdGEuZW1haWwudHJpbSgpLFxyXG4gICAgICAgICAgcGhvbmU6IGRhdGEucGhvbmU/LnRyaW0oKSB8fCBudWxsLFxyXG4gICAgICAgICAgZmlyc3RfbmFtZTogZGF0YS5maXJzdF9uYW1lLnRyaW0oKSxcclxuICAgICAgICAgIGxhc3RfbmFtZTogZGF0YS5sYXN0X25hbWUudHJpbSgpLFxyXG4gICAgICB9O1xyXG5cclxuICAgICAgLy8gT25seSBzZXQgYXZhdGFyX3VybCBpZiBpdCdzIHByb3ZpZGVkXHJcbiAgICAgIGlmIChkYXRhLmF2YXRhcl91cmwpIHtcclxuICAgICAgICBpbnNlcnREYXRhLmF2YXRhcl91cmwgPSBkYXRhLmF2YXRhcl91cmw7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IHsgZGF0YTogbmV3UHJvZmlsZSwgZXJyb3I6IGluc2VydEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgICAgLmluc2VydChpbnNlcnREYXRhKVxyXG4gICAgICAgIC5zZWxlY3QoKVxyXG4gICAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICAgIGlmIChpbnNlcnRFcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIHByb2ZpbGU6JywgaW5zZXJ0RXJyb3IpO1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBJbnNlcnQgZXJyb3IgZGV0YWlsczonLCB7XHJcbiAgICAgICAgICBjb2RlOiBpbnNlcnRFcnJvci5jb2RlLFxyXG4gICAgICAgICAgbWVzc2FnZTogaW5zZXJ0RXJyb3IubWVzc2FnZSxcclxuICAgICAgICAgIGRldGFpbHM6IGluc2VydEVycm9yLmRldGFpbHMsXHJcbiAgICAgICAgICBoaW50OiBpbnNlcnRFcnJvci5oaW50LFxyXG4gICAgICAgICAgc2VydmljZVJvbGVLZXlTZXQ6ICEhcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSxcclxuICAgICAgICB9KTtcclxuICAgICAgICAvLyBDaGVjayBpZiBpdCdzIGEgdW5pcXVlIGNvbnN0cmFpbnQgdmlvbGF0aW9uXHJcbiAgICAgICAgaWYgKGluc2VydEVycm9yLmNvZGUgPT09ICcyMzUwNScpIHtcclxuICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0VtYWlsIGFscmVhZHkgZXhpc3RzJyB9O1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBDaGVjayBpZiBpdCdzIGFuIFJMUyBlcnJvclxyXG4gICAgICAgIGlmIChpbnNlcnRFcnJvci5tZXNzYWdlPy5pbmNsdWRlcygncm93LWxldmVsIHNlY3VyaXR5JykgfHwgXHJcbiAgICAgICAgICAgIGluc2VydEVycm9yLmNvZGUgPT09ICc0MjUwMScgfHxcclxuICAgICAgICAgICAgaW5zZXJ0RXJyb3IubWVzc2FnZT8uaW5jbHVkZXMoJ1JMUycpKSB7XHJcbiAgICAgICAgICByZXR1cm4geyBcclxuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsIFxyXG4gICAgICAgICAgICBlcnJvcjogJ1JvdyBMZXZlbCBTZWN1cml0eSBlcnJvci4gUGxlYXNlIGVuc3VyZTogMSkgUkxTIGlzIGRpc2FibGVkIG9uIHByb2ZpbGVzIHRhYmxlLCAyKSBTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIGlzIHNldCBpbiAuZW52LmxvY2FsJyxcclxuICAgICAgICAgICAgZXJyb3JEZXRhaWxzOiBgRXJyb3IgY29kZTogJHtpbnNlcnRFcnJvci5jb2RlIHx8ICd1bmtub3duJ30uICR7aW5zZXJ0RXJyb3IuaGludCB8fCAnJ31gLFxyXG4gICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHsgXHJcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSwgXHJcbiAgICAgICAgICBlcnJvcjogaW5zZXJ0RXJyb3IubWVzc2FnZSB8fCAnRmFpbGVkIHRvIGNyZWF0ZSBwcm9maWxlJyxcclxuICAgICAgICAgIGVycm9yRGV0YWlsczogaW5zZXJ0RXJyb3IuZGV0YWlscyB8fCBpbnNlcnRFcnJvci5oaW50IHx8IHVuZGVmaW5lZCxcclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcblxyXG4gICAgICByZXN1bHQgPSBuZXdQcm9maWxlO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHByb2ZpbGU6IHJlc3VsdCB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiB1cGRhdGVDdXN0b21lclByb2ZpbGU6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gdXBkYXRlIHByb2ZpbGUnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDdXN0b21lckxvY2F0aW9ucyhcclxuICBlbWFpbDogc3RyaW5nLFxyXG4gIHBob25lPzogc3RyaW5nXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgbG9jYXRpb25zPzogTG9jYXRpb25bXTtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIGxldCBxdWVyeSA9IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdsb2NhdGlvbnMnKVxyXG4gICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgLm9yZGVyKCdpc19kZWZhdWx0JywgeyBhc2NlbmRpbmc6IGZhbHNlIH0pXHJcbiAgICAgIC5vcmRlcignY3JlYXRlZF9hdCcsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KTtcclxuXHJcbiAgICAvLyBCdWlsZCBxdWVyeSBmb3IgZW1haWwvcGhvbmUgbG9va3VwXHJcbiAgICBpZiAoZW1haWwgJiYgcGhvbmUpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5vcihgY3VzdG9tZXJfZW1haWwuZXEuJHtlbWFpbH0sY3VzdG9tZXJfcGhvbmUuZXEuJHtwaG9uZX1gKTtcclxuICAgIH0gZWxzZSBpZiAoZW1haWwpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnY3VzdG9tZXJfZW1haWwnLCBlbWFpbCk7XHJcbiAgICB9IGVsc2UgaWYgKHBob25lKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ2N1c3RvbWVyX3Bob25lJywgcGhvbmUpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRW1haWwgb3IgcGhvbmUgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgcXVlcnk7XHJcblxyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGxvY2F0aW9uczonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGxvY2F0aW9uczogZGF0YSB8fCBbXSB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBnZXRDdXN0b21lckxvY2F0aW9uczonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBmZXRjaCBsb2NhdGlvbnMnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVMb2NhdGlvbihcclxuICBlbWFpbDogc3RyaW5nLFxyXG4gIHBob25lOiBzdHJpbmcgfCB1bmRlZmluZWQsXHJcbiAgbG9jYXRpb25EYXRhOiBMb2NhdGlvbkNyZWF0ZUlucHV0XHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgbG9jYXRpb24/OiBMb2NhdGlvbjtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIFZhbGlkYXRlIGlucHV0XHJcbiAgICBpZiAoIWxvY2F0aW9uRGF0YS5uaWNrbmFtZT8udHJpbSgpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ05pY2tuYW1lIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG4gICAgaWYgKCFsb2NhdGlvbkRhdGEuYWRkcmVzcz8udHJpbSgpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0FkZHJlc3MgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcbiAgICBpZiAoIWxvY2F0aW9uRGF0YS5zdWJ1cmI/LnRyaW0oKSkge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdTdWJ1cmIgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcbiAgICBpZiAoIWxvY2F0aW9uRGF0YS5jaXR5Py50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnQ2l0eSBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBJZiBzZXR0aW5nIGFzIGRlZmF1bHQsIHVuc2V0IGFsbCBvdGhlciBkZWZhdWx0cyBmb3IgdGhpcyBjdXN0b21lclxyXG4gICAgaWYgKGxvY2F0aW9uRGF0YS5pc19kZWZhdWx0KSB7XHJcbiAgICAgIGxldCB1cGRhdGVRdWVyeSA9IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ2xvY2F0aW9ucycpXHJcbiAgICAgICAgLnVwZGF0ZSh7IGlzX2RlZmF1bHQ6IGZhbHNlIH0pO1xyXG5cclxuICAgICAgaWYgKGVtYWlsICYmIHBob25lKSB7XHJcbiAgICAgICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5vcihgY3VzdG9tZXJfZW1haWwuZXEuJHtlbWFpbH0sY3VzdG9tZXJfcGhvbmUuZXEuJHtwaG9uZX1gKTtcclxuICAgICAgfSBlbHNlIGlmIChlbWFpbCkge1xyXG4gICAgICAgIHVwZGF0ZVF1ZXJ5ID0gdXBkYXRlUXVlcnkuZXEoJ2N1c3RvbWVyX2VtYWlsJywgZW1haWwpO1xyXG4gICAgICB9IGVsc2UgaWYgKHBob25lKSB7XHJcbiAgICAgICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5lcSgnY3VzdG9tZXJfcGhvbmUnLCBwaG9uZSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGF3YWl0IHVwZGF0ZVF1ZXJ5O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgZGF0YTogbmV3TG9jYXRpb24sIGVycm9yOiBpbnNlcnRFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2xvY2F0aW9ucycpXHJcbiAgICAgIC5pbnNlcnQoe1xyXG4gICAgICAgIGN1c3RvbWVyX2VtYWlsOiBlbWFpbCxcclxuICAgICAgICBjdXN0b21lcl9waG9uZTogcGhvbmUgfHwgbnVsbCxcclxuICAgICAgICBuaWNrbmFtZTogbG9jYXRpb25EYXRhLm5pY2tuYW1lLnRyaW0oKSxcclxuICAgICAgICBhZGRyZXNzOiBsb2NhdGlvbkRhdGEuYWRkcmVzcy50cmltKCksXHJcbiAgICAgICAgYXB0X3VuaXQ6IGxvY2F0aW9uRGF0YS5hcHRfdW5pdD8udHJpbSgpIHx8IG51bGwsXHJcbiAgICAgICAgc3VidXJiOiBsb2NhdGlvbkRhdGEuc3VidXJiLnRyaW0oKSxcclxuICAgICAgICBjaXR5OiBsb2NhdGlvbkRhdGEuY2l0eS50cmltKCksXHJcbiAgICAgICAgcG9zdGFsX2NvZGU6IGxvY2F0aW9uRGF0YS5wb3N0YWxfY29kZT8udHJpbSgpIHx8IG51bGwsXHJcbiAgICAgICAgaXNfZGVmYXVsdDogbG9jYXRpb25EYXRhLmlzX2RlZmF1bHQgfHwgZmFsc2UsXHJcbiAgICAgIH0pXHJcbiAgICAgIC5zZWxlY3QoKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKGluc2VydEVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIGxvY2F0aW9uOicsIGluc2VydEVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBpbnNlcnRFcnJvci5tZXNzYWdlIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgbG9jYXRpb246IG5ld0xvY2F0aW9uIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGNyZWF0ZUxvY2F0aW9uOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGNyZWF0ZSBsb2NhdGlvbicsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUxvY2F0aW9uKFxyXG4gIGxvY2F0aW9uSWQ6IHN0cmluZyxcclxuICBsb2NhdGlvbkRhdGE6IExvY2F0aW9uVXBkYXRlSW5wdXRcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBsb2NhdGlvbj86IExvY2F0aW9uO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgLy8gVmFsaWRhdGUgaW5wdXQgaWYgcHJvdmlkZWRcclxuICAgIGlmIChsb2NhdGlvbkRhdGEubmlja25hbWUgIT09IHVuZGVmaW5lZCAmJiAhbG9jYXRpb25EYXRhLm5pY2tuYW1lLnRyaW0oKSkge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdOaWNrbmFtZSBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuYWRkcmVzcyAhPT0gdW5kZWZpbmVkICYmICFsb2NhdGlvbkRhdGEuYWRkcmVzcy50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnQWRkcmVzcyBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuc3VidXJiICE9PSB1bmRlZmluZWQgJiYgIWxvY2F0aW9uRGF0YS5zdWJ1cmIudHJpbSgpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ1N1YnVyYiBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuY2l0eSAhPT0gdW5kZWZpbmVkICYmICFsb2NhdGlvbkRhdGEuY2l0eS50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnQ2l0eSBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBHZXQgY3VycmVudCBsb2NhdGlvbiB0byBjaGVjayBjdXN0b21lciBlbWFpbFxyXG4gICAgY29uc3QgeyBkYXRhOiBjdXJyZW50TG9jYXRpb24sIGVycm9yOiBmZXRjaEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnbG9jYXRpb25zJylcclxuICAgICAgLnNlbGVjdCgnY3VzdG9tZXJfZW1haWwsIGN1c3RvbWVyX3Bob25lJylcclxuICAgICAgLmVxKCdpZCcsIGxvY2F0aW9uSWQpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoZmV0Y2hFcnJvciB8fCAhY3VycmVudExvY2F0aW9uKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0xvY2F0aW9uIG5vdCBmb3VuZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBJZiBzZXR0aW5nIGFzIGRlZmF1bHQsIHVuc2V0IGFsbCBvdGhlciBkZWZhdWx0cyBmb3IgdGhpcyBjdXN0b21lclxyXG4gICAgaWYgKGxvY2F0aW9uRGF0YS5pc19kZWZhdWx0KSB7XHJcbiAgICAgIGxldCB1cGRhdGVRdWVyeSA9IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ2xvY2F0aW9ucycpXHJcbiAgICAgICAgLnVwZGF0ZSh7IGlzX2RlZmF1bHQ6IGZhbHNlIH0pO1xyXG5cclxuICAgICAgaWYgKGN1cnJlbnRMb2NhdGlvbi5jdXN0b21lcl9lbWFpbCAmJiBjdXJyZW50TG9jYXRpb24uY3VzdG9tZXJfcGhvbmUpIHtcclxuICAgICAgICB1cGRhdGVRdWVyeSA9IHVwZGF0ZVF1ZXJ5Lm9yKGBjdXN0b21lcl9lbWFpbC5lcS4ke2N1cnJlbnRMb2NhdGlvbi5jdXN0b21lcl9lbWFpbH0sY3VzdG9tZXJfcGhvbmUuZXEuJHtjdXJyZW50TG9jYXRpb24uY3VzdG9tZXJfcGhvbmV9YCk7XHJcbiAgICAgIH0gZWxzZSBpZiAoY3VycmVudExvY2F0aW9uLmN1c3RvbWVyX2VtYWlsKSB7XHJcbiAgICAgICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5lcSgnY3VzdG9tZXJfZW1haWwnLCBjdXJyZW50TG9jYXRpb24uY3VzdG9tZXJfZW1haWwpO1xyXG4gICAgICB9IGVsc2UgaWYgKGN1cnJlbnRMb2NhdGlvbi5jdXN0b21lcl9waG9uZSkge1xyXG4gICAgICAgIHVwZGF0ZVF1ZXJ5ID0gdXBkYXRlUXVlcnkuZXEoJ2N1c3RvbWVyX3Bob25lJywgY3VycmVudExvY2F0aW9uLmN1c3RvbWVyX3Bob25lKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gRG9uJ3QgdW5zZXQgdGhlIGN1cnJlbnQgbG9jYXRpb25cclxuICAgICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5uZXEoJ2lkJywgbG9jYXRpb25JZCk7XHJcblxyXG4gICAgICBhd2FpdCB1cGRhdGVRdWVyeTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBCdWlsZCB1cGRhdGUgb2JqZWN0IHdpdGggb25seSBwcm92aWRlZCBmaWVsZHNcclxuICAgIGNvbnN0IHVwZGF0ZURhdGE6IGFueSA9IHtcclxuICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgfTtcclxuXHJcbiAgICBpZiAobG9jYXRpb25EYXRhLm5pY2tuYW1lICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgdXBkYXRlRGF0YS5uaWNrbmFtZSA9IGxvY2F0aW9uRGF0YS5uaWNrbmFtZS50cmltKCk7XHJcbiAgICB9XHJcbiAgICBpZiAobG9jYXRpb25EYXRhLmFkZHJlc3MgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB1cGRhdGVEYXRhLmFkZHJlc3MgPSBsb2NhdGlvbkRhdGEuYWRkcmVzcy50cmltKCk7XHJcbiAgICB9XHJcbiAgICBpZiAobG9jYXRpb25EYXRhLmFwdF91bml0ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgdXBkYXRlRGF0YS5hcHRfdW5pdCA9IGxvY2F0aW9uRGF0YS5hcHRfdW5pdD8udHJpbSgpIHx8IG51bGw7XHJcbiAgICB9XHJcbiAgICBpZiAobG9jYXRpb25EYXRhLnN1YnVyYiAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHVwZGF0ZURhdGEuc3VidXJiID0gbG9jYXRpb25EYXRhLnN1YnVyYi50cmltKCk7XHJcbiAgICB9XHJcbiAgICBpZiAobG9jYXRpb25EYXRhLmNpdHkgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB1cGRhdGVEYXRhLmNpdHkgPSBsb2NhdGlvbkRhdGEuY2l0eS50cmltKCk7XHJcbiAgICB9XHJcbiAgICBpZiAobG9jYXRpb25EYXRhLnBvc3RhbF9jb2RlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgdXBkYXRlRGF0YS5wb3N0YWxfY29kZSA9IGxvY2F0aW9uRGF0YS5wb3N0YWxfY29kZT8udHJpbSgpIHx8IG51bGw7XHJcbiAgICB9XHJcbiAgICBpZiAobG9jYXRpb25EYXRhLmlzX2RlZmF1bHQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB1cGRhdGVEYXRhLmlzX2RlZmF1bHQgPSBsb2NhdGlvbkRhdGEuaXNfZGVmYXVsdDtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB7IGRhdGE6IHVwZGF0ZWRMb2NhdGlvbiwgZXJyb3I6IHVwZGF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnbG9jYXRpb25zJylcclxuICAgICAgLnVwZGF0ZSh1cGRhdGVEYXRhKVxyXG4gICAgICAuZXEoJ2lkJywgbG9jYXRpb25JZClcclxuICAgICAgLnNlbGVjdCgpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICBpZiAodXBkYXRlRXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBkYXRpbmcgbG9jYXRpb246JywgdXBkYXRlRXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHVwZGF0ZUVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBsb2NhdGlvbjogdXBkYXRlZExvY2F0aW9uIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHVwZGF0ZUxvY2F0aW9uOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIHVwZGF0ZSBsb2NhdGlvbicsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGRlbGV0ZUxvY2F0aW9uKGxvY2F0aW9uSWQ6IHN0cmluZyk6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnbG9jYXRpb25zJylcclxuICAgICAgLmRlbGV0ZSgpXHJcbiAgICAgIC5lcSgnaWQnLCBsb2NhdGlvbklkKTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZGVsZXRpbmcgbG9jYXRpb246JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGRlbGV0ZUxvY2F0aW9uOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGRlbGV0ZSBsb2NhdGlvbicsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNldERlZmF1bHRMb2NhdGlvbihcclxuICBsb2NhdGlvbklkOiBzdHJpbmcsXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBwaG9uZT86IHN0cmluZ1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGxvY2F0aW9uPzogTG9jYXRpb247XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICAvLyBHZXQgY3VycmVudCBsb2NhdGlvbiB0byB2ZXJpZnkgb3duZXJzaGlwXHJcbiAgICBjb25zdCB7IGRhdGE6IGN1cnJlbnRMb2NhdGlvbiwgZXJyb3I6IGZldGNoRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdsb2NhdGlvbnMnKVxyXG4gICAgICAuc2VsZWN0KCdjdXN0b21lcl9lbWFpbCwgY3VzdG9tZXJfcGhvbmUnKVxyXG4gICAgICAuZXEoJ2lkJywgbG9jYXRpb25JZClcclxuICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgIGlmIChmZXRjaEVycm9yIHx8ICFjdXJyZW50TG9jYXRpb24pIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTG9jYXRpb24gbm90IGZvdW5kJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFZlcmlmeSBvd25lcnNoaXBcclxuICAgIGNvbnN0IGlzT3duZXIgPSBcclxuICAgICAgY3VycmVudExvY2F0aW9uLmN1c3RvbWVyX2VtYWlsID09PSBlbWFpbCB8fFxyXG4gICAgICAocGhvbmUgJiYgY3VycmVudExvY2F0aW9uLmN1c3RvbWVyX3Bob25lID09PSBwaG9uZSk7XHJcblxyXG4gICAgaWYgKCFpc093bmVyKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ1VuYXV0aG9yaXplZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBVbnNldCBhbGwgb3RoZXIgZGVmYXVsdHMgZm9yIHRoaXMgY3VzdG9tZXJcclxuICAgIGxldCB1cGRhdGVRdWVyeSA9IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdsb2NhdGlvbnMnKVxyXG4gICAgICAudXBkYXRlKHsgaXNfZGVmYXVsdDogZmFsc2UgfSk7XHJcblxyXG4gICAgaWYgKGVtYWlsICYmIHBob25lKSB7XHJcbiAgICAgIHVwZGF0ZVF1ZXJ5ID0gdXBkYXRlUXVlcnkub3IoYGN1c3RvbWVyX2VtYWlsLmVxLiR7ZW1haWx9LGN1c3RvbWVyX3Bob25lLmVxLiR7cGhvbmV9YCk7XHJcbiAgICB9IGVsc2UgaWYgKGVtYWlsKSB7XHJcbiAgICAgIHVwZGF0ZVF1ZXJ5ID0gdXBkYXRlUXVlcnkuZXEoJ2N1c3RvbWVyX2VtYWlsJywgZW1haWwpO1xyXG4gICAgfSBlbHNlIGlmIChwaG9uZSkge1xyXG4gICAgICB1cGRhdGVRdWVyeSA9IHVwZGF0ZVF1ZXJ5LmVxKCdjdXN0b21lcl9waG9uZScsIHBob25lKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBEb24ndCB1bnNldCB0aGUgY3VycmVudCBsb2NhdGlvblxyXG4gICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5uZXEoJ2lkJywgbG9jYXRpb25JZCk7XHJcblxyXG4gICAgYXdhaXQgdXBkYXRlUXVlcnk7XHJcblxyXG4gICAgLy8gU2V0IHRoaXMgbG9jYXRpb24gYXMgZGVmYXVsdFxyXG4gICAgY29uc3QgeyBkYXRhOiB1cGRhdGVkTG9jYXRpb24sIGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2xvY2F0aW9ucycpXHJcbiAgICAgIC51cGRhdGUoeyBpc19kZWZhdWx0OiB0cnVlIH0pXHJcbiAgICAgIC5lcSgnaWQnLCBsb2NhdGlvbklkKVxyXG4gICAgICAuc2VsZWN0KClcclxuICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgIGlmICh1cGRhdGVFcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBzZXR0aW5nIGRlZmF1bHQgbG9jYXRpb246JywgdXBkYXRlRXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHVwZGF0ZUVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBsb2NhdGlvbjogdXBkYXRlZExvY2F0aW9uIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHNldERlZmF1bHRMb2NhdGlvbjonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBzZXQgZGVmYXVsdCBsb2NhdGlvbicsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldE9yQ3JlYXRlUmVmZXJyYWxDb2RlKFxyXG4gIGVtYWlsOiBzdHJpbmdcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICByZWZlcnJhbENvZGU/OiBzdHJpbmc7XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICAvLyBDaGVjayBpZiBwcm9maWxlIGV4aXN0cyBhbmQgaGFzIGEgcmVmZXJyYWwgY29kZVxyXG4gICAgY29uc3QgeyBkYXRhOiBwcm9maWxlLCBlcnJvcjogcHJvZmlsZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAuc2VsZWN0KCdyZWZlcnJhbF9jb2RlJylcclxuICAgICAgLmVxKCdlbWFpbCcsIGVtYWlsKVxyXG4gICAgICAubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgICBpZiAocHJvZmlsZUVycm9yICYmIHByb2ZpbGVFcnJvci5jb2RlICE9PSAnUEdSU1QxMTYnKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIHByb2ZpbGU6JywgcHJvZmlsZUVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBwcm9maWxlRXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIElmIHByb2ZpbGUgZXhpc3RzIGFuZCBoYXMgYSByZWZlcnJhbCBjb2RlLCByZXR1cm4gaXRcclxuICAgIGlmIChwcm9maWxlPy5yZWZlcnJhbF9jb2RlKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHJlZmVycmFsQ29kZTogcHJvZmlsZS5yZWZlcnJhbF9jb2RlIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gR2VuZXJhdGUgYSBuZXcgcmVmZXJyYWwgY29kZVxyXG4gICAgLy8gVHJ5IHVzaW5nIHRoZSBkYXRhYmFzZSBmdW5jdGlvbiBmaXJzdCwgYnV0IGZhbGxiYWNrIHRvIGNsaWVudC1zaWRlIGdlbmVyYXRpb25cclxuICAgIGxldCBnZW5lcmF0ZWRDb2RlOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcclxuICAgIFxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgeyBkYXRhOiBkYkNvZGUsIGVycm9yOiBjb2RlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLnJwYygnZ2VuZXJhdGVfcmVmZXJyYWxfY29kZScpO1xyXG4gICAgICBcclxuICAgICAgaWYgKCFjb2RlRXJyb3IgJiYgZGJDb2RlKSB7XHJcbiAgICAgICAgZ2VuZXJhdGVkQ29kZSA9IGRiQ29kZTtcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAocnBjRXJyb3IpIHtcclxuICAgICAgLy8gUlBDIGZ1bmN0aW9uIG1pZ2h0IG5vdCBleGlzdCB5ZXQsIHRoYXQncyBva2F5XHJcbiAgICAgIGNvbnNvbGUubG9nKCdSUEMgZnVuY3Rpb24gbm90IGF2YWlsYWJsZSwgdXNpbmcgZmFsbGJhY2snKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIWdlbmVyYXRlZENvZGUpIHtcclxuICAgICAgLy8gRmFsbGJhY2s6IGdlbmVyYXRlIGNvZGUgY2xpZW50LXNpZGUgc3R5bGVcclxuICAgICAgY29uc3QgZmFsbGJhY2tDb2RlID0gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIsIDgpLnRvVXBwZXJDYXNlKCk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBDaGVjayBpZiBmYWxsYmFjayBjb2RlIGV4aXN0cywgcmV0cnkgaWYgaXQgZG9lc1xyXG4gICAgICBsZXQgZmluYWxDb2RlID0gZmFsbGJhY2tDb2RlO1xyXG4gICAgICBsZXQgYXR0ZW1wdHMgPSAwO1xyXG4gICAgICBjb25zdCBtYXhBdHRlbXB0cyA9IDU7XHJcblxyXG4gICAgICB3aGlsZSAoYXR0ZW1wdHMgPCBtYXhBdHRlbXB0cykge1xyXG4gICAgICAgIGNvbnN0IHsgZGF0YTogZXhpc3RpbmcgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgICAgLnNlbGVjdCgnaWQnKVxyXG4gICAgICAgICAgLmVxKCdyZWZlcnJhbF9jb2RlJywgZmluYWxDb2RlKVxyXG4gICAgICAgICAgLm1heWJlU2luZ2xlKCk7XHJcblxyXG4gICAgICAgIGlmICghZXhpc3RpbmcpIHtcclxuICAgICAgICAgIGJyZWFrOyAvLyBDb2RlIGlzIHVuaXF1ZVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gR2VuZXJhdGUgYSBuZXcgY29kZVxyXG4gICAgICAgIGZpbmFsQ29kZSA9IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cmluZygyLCA4KS50b1VwcGVyQ2FzZSgpO1xyXG4gICAgICAgIGF0dGVtcHRzKys7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIFVwZGF0ZSBvciBpbnNlcnQgcHJvZmlsZSB3aXRoIHJlZmVycmFsIGNvZGVcclxuICAgICAgLy8gRmlyc3QsIHRyeSB0byB1cGRhdGUgZXhpc3RpbmcgcHJvZmlsZVxyXG4gICAgICBjb25zdCB7IGRhdGE6IGV4aXN0aW5nUHJvZmlsZSB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgIC5zZWxlY3QoJ2lkLCBmaXJzdF9uYW1lLCBsYXN0X25hbWUnKVxyXG4gICAgICAgIC5lcSgnZW1haWwnLCBlbWFpbClcclxuICAgICAgICAubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgICAgIGxldCB1cGRhdGVkUHJvZmlsZTtcclxuICAgICAgaWYgKGV4aXN0aW5nUHJvZmlsZSkge1xyXG4gICAgICAgIC8vIFVwZGF0ZSBleGlzdGluZyBwcm9maWxlXHJcbiAgICAgICAgY29uc3QgeyBkYXRhOiB1cGRhdGVkLCBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgICAgLnVwZGF0ZSh7XHJcbiAgICAgICAgICAgIHJlZmVycmFsX2NvZGU6IGZpbmFsQ29kZSxcclxuICAgICAgICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgICAgICAgfSlcclxuICAgICAgICAgIC5lcSgnZW1haWwnLCBlbWFpbClcclxuICAgICAgICAgIC5zZWxlY3QoJ3JlZmVycmFsX2NvZGUnKVxyXG4gICAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgICBpZiAodXBkYXRlRXJyb3IpIHtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHVwZGF0aW5nIHJlZmVycmFsIGNvZGU6JywgdXBkYXRlRXJyb3IpO1xyXG4gICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB1cGRhdGVFcnJvci5tZXNzYWdlIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHVwZGF0ZWRQcm9maWxlID0gdXBkYXRlZDtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBJbnNlcnQgbmV3IHByb2ZpbGUgd2l0aCByZWZlcnJhbCBjb2RlXHJcbiAgICAgICAgY29uc3QgeyBkYXRhOiBpbnNlcnRlZCwgZXJyb3I6IGluc2VydEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcclxuICAgICAgICAgIC5pbnNlcnQoe1xyXG4gICAgICAgICAgICBlbWFpbCxcclxuICAgICAgICAgICAgcmVmZXJyYWxfY29kZTogZmluYWxDb2RlLFxyXG4gICAgICAgICAgICBmaXJzdF9uYW1lOiBlbWFpbC5zcGxpdCgnQCcpWzBdLFxyXG4gICAgICAgICAgICBsYXN0X25hbWU6ICcnLFxyXG4gICAgICAgICAgfSlcclxuICAgICAgICAgIC5zZWxlY3QoJ3JlZmVycmFsX2NvZGUnKVxyXG4gICAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgICBpZiAoaW5zZXJ0RXJyb3IpIHtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIHJlZmVycmFsIGNvZGU6JywgaW5zZXJ0RXJyb3IpO1xyXG4gICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBpbnNlcnRFcnJvci5tZXNzYWdlIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHVwZGF0ZWRQcm9maWxlID0gaW5zZXJ0ZWQ7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHJlZmVycmFsQ29kZTogdXBkYXRlZFByb2ZpbGU/LnJlZmVycmFsX2NvZGUgfHwgZmluYWxDb2RlIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVXNlIHRoZSBnZW5lcmF0ZWQgY29kZSBmcm9tIGRhdGFiYXNlIGZ1bmN0aW9uXHJcbiAgICAvLyBVcGRhdGUgb3IgaW5zZXJ0IHByb2ZpbGUgd2l0aCBnZW5lcmF0ZWQgY29kZVxyXG4gICAgY29uc3QgeyBkYXRhOiBleGlzdGluZ1Byb2ZpbGUgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgIC5zZWxlY3QoJ2lkLCBmaXJzdF9uYW1lLCBsYXN0X25hbWUnKVxyXG4gICAgICAuZXEoJ2VtYWlsJywgZW1haWwpXHJcbiAgICAgIC5tYXliZVNpbmdsZSgpO1xyXG5cclxuICAgIGxldCB1cGRhdGVkUHJvZmlsZTtcclxuICAgIGlmIChleGlzdGluZ1Byb2ZpbGUpIHtcclxuICAgICAgLy8gVXBkYXRlIGV4aXN0aW5nIHByb2ZpbGVcclxuICAgICAgY29uc3QgeyBkYXRhOiB1cGRhdGVkLCBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcclxuICAgICAgICAudXBkYXRlKHtcclxuICAgICAgICAgIHJlZmVycmFsX2NvZGU6IGdlbmVyYXRlZENvZGUsXHJcbiAgICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgfSlcclxuICAgICAgICAuZXEoJ2VtYWlsJywgZW1haWwpXHJcbiAgICAgICAgLnNlbGVjdCgncmVmZXJyYWxfY29kZScpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgaWYgKHVwZGF0ZUVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBkYXRpbmcgcmVmZXJyYWwgY29kZTonLCB1cGRhdGVFcnJvcik7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB1cGRhdGVFcnJvci5tZXNzYWdlIH07XHJcbiAgICAgIH1cclxuICAgICAgdXBkYXRlZFByb2ZpbGUgPSB1cGRhdGVkO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8gSW5zZXJ0IG5ldyBwcm9maWxlIHdpdGggcmVmZXJyYWwgY29kZVxyXG4gICAgICBjb25zdCB7IGRhdGE6IGluc2VydGVkLCBlcnJvcjogaW5zZXJ0RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcclxuICAgICAgICAuaW5zZXJ0KHtcclxuICAgICAgICAgIGVtYWlsLFxyXG4gICAgICAgICAgcmVmZXJyYWxfY29kZTogZ2VuZXJhdGVkQ29kZSxcclxuICAgICAgICAgIGZpcnN0X25hbWU6IGVtYWlsLnNwbGl0KCdAJylbMF0sXHJcbiAgICAgICAgICBsYXN0X25hbWU6ICcnLFxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnNlbGVjdCgncmVmZXJyYWxfY29kZScpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgaWYgKGluc2VydEVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYXRpbmcgcmVmZXJyYWwgY29kZTonLCBpbnNlcnRFcnJvcik7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBpbnNlcnRFcnJvci5tZXNzYWdlIH07XHJcbiAgICAgIH1cclxuICAgICAgdXBkYXRlZFByb2ZpbGUgPSBpbnNlcnRlZDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCByZWZlcnJhbENvZGU6IHVwZGF0ZWRQcm9maWxlPy5yZWZlcnJhbF9jb2RlIHx8IGdlbmVyYXRlZENvZGUgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gZ2V0T3JDcmVhdGVSZWZlcnJhbENvZGU6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gZ2V0IHJlZmVycmFsIGNvZGUnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZW5kUmVmZXJyYWxJbnZpdGVzKFxyXG4gIGVtYWlsOiBzdHJpbmcsXHJcbiAgaW52aXRlRW1haWxzOiBzdHJpbmdbXSxcclxuICByZWZlcnJhbENvZGU6IHN0cmluZ1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIHNlbnQ/OiBudW1iZXI7XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICAvLyBWYWxpZGF0ZSBlbWFpbCBhZGRyZXNzZXNcclxuICAgIGNvbnN0IHZhbGlkRW1haWxzID0gaW52aXRlRW1haWxzXHJcbiAgICAgIC5tYXAoKGUpID0+IGUudHJpbSgpKVxyXG4gICAgICAuZmlsdGVyKChlKSA9PiB7XHJcbiAgICAgICAgaWYgKCFlKSByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgcmV0dXJuIC9eW15cXHNAXStAW15cXHNAXStcXC5bXlxcc0BdKyQvLnRlc3QoZSk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgIGlmICh2YWxpZEVtYWlscy5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTm8gdmFsaWQgZW1haWwgYWRkcmVzc2VzIHByb3ZpZGVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENyZWF0ZSByZWZlcnJhbCByZWNvcmRzIGZvciB0cmFja2luZ1xyXG4gICAgY29uc3QgcmVmZXJyYWxSZWNvcmRzID0gdmFsaWRFbWFpbHMubWFwKChyZWZlcnJlZEVtYWlsKSA9PiAoe1xyXG4gICAgICByZWZlcnJlcl9lbWFpbDogZW1haWwsXHJcbiAgICAgIHJlZmVycmVkX2VtYWlsOiByZWZlcnJlZEVtYWlsLFxyXG4gICAgICByZWZlcnJhbF9jb2RlOiByZWZlcnJhbENvZGUsXHJcbiAgICAgIHN0YXR1czogJ3BlbmRpbmcnLFxyXG4gICAgfSkpO1xyXG5cclxuICAgIGNvbnN0IHsgZXJyb3I6IGluc2VydEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgncmVmZXJyYWxzJylcclxuICAgICAgLmluc2VydChyZWZlcnJhbFJlY29yZHMpO1xyXG5cclxuICAgIGlmIChpbnNlcnRFcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjcmVhdGluZyByZWZlcnJhbCByZWNvcmRzOicsIGluc2VydEVycm9yKTtcclxuICAgICAgLy8gQ29udGludWUgZXZlbiBpZiBpbnNlcnQgZmFpbHMgLSB3ZSBzdGlsbCB3YW50IHRvIHNlbmQgZW1haWxzXHJcbiAgICB9XHJcblxyXG4gICAgLy8gR2VuZXJhdGUgcmVmZXJyYWwgbGlua1xyXG4gICAgY29uc3QgYmFzZVVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NJVEVfVVJMIHx8ICdodHRwczovL3NoYWxlYW4uY28uemEnO1xyXG4gICAgY29uc3QgcmVmZXJyYWxMaW5rID0gYCR7YmFzZVVybH0vYm9va2luZy9kZXRhaWxzP3JlZj0ke3JlZmVycmFsQ29kZX1gO1xyXG5cclxuICAgIC8vIFRPRE86IEltcGxlbWVudCBhY3R1YWwgZW1haWwgc2VuZGluZyB1c2luZyB5b3VyIGVtYWlsIHNlcnZpY2UgKFJlc2VuZCwgU2VuZEdyaWQsIGV0Yy4pXHJcbiAgICAvLyBGb3Igbm93LCB3ZSdsbCBqdXN0IGxvZyB0aGUgZW1haWxzIHRoYXQgd291bGQgYmUgc2VudFxyXG4gICAgY29uc29sZS5sb2coJ1JlZmVycmFsIGludml0ZXMgdG8gc2VuZDonLCB7XHJcbiAgICAgIGZyb206IGVtYWlsLFxyXG4gICAgICB0bzogdmFsaWRFbWFpbHMsXHJcbiAgICAgIHJlZmVycmFsQ29kZSxcclxuICAgICAgcmVmZXJyYWxMaW5rLFxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gSW4gYSByZWFsIGltcGxlbWVudGF0aW9uLCB5b3Ugd291bGQgc2VuZCBlbWFpbHMgaGVyZVxyXG4gICAgLy8gRXhhbXBsZSB3aXRoIFJlc2VuZDpcclxuICAgIC8vIGF3YWl0IHJlc2VuZC5lbWFpbHMuc2VuZCh7XHJcbiAgICAvLyAgIGZyb206ICdTaGFsZWFuIDxub3JlcGx5QHNoYWxlYW4uY28uemE+JyxcclxuICAgIC8vICAgdG86IHZhbGlkRW1haWxzLFxyXG4gICAgLy8gICBzdWJqZWN0OiAnWW91XFwndmUgYmVlbiBpbnZpdGVkIHRvIHRyeSBTaGFsZWFuIENsZWFuaW5nIFNlcnZpY2VzIScsXHJcbiAgICAvLyAgIGh0bWw6IGA8cD5Zb3VyIGZyaWVuZCBoYXMgaW52aXRlZCB5b3UgdG8gdHJ5IFNoYWxlYW4uIFVzZSBjb2RlICR7cmVmZXJyYWxDb2RlfSB0byBnZXQgUjE1MCBvZmYgeW91ciBmaXJzdCBib29raW5nITwvcD48cD48YSBocmVmPVwiJHtyZWZlcnJhbExpbmt9XCI+Qm9vayBOb3c8L2E+PC9wPmAsXHJcbiAgICAvLyB9KTtcclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBzZW50OiB2YWxpZEVtYWlscy5sZW5ndGggfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gc2VuZFJlZmVycmFsSW52aXRlczonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBzZW5kIGludml0ZXMnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRSZWZlcnJhbFN0YXRzKFxyXG4gIGVtYWlsOiBzdHJpbmdcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBzdGF0cz86IHtcclxuICAgIHRvdGFsUmVmZXJyYWxzOiBudW1iZXI7XHJcbiAgICBjb21wbGV0ZWRSZWZlcnJhbHM6IG51bWJlcjtcclxuICAgIHBlbmRpbmdSZXdhcmRzOiBudW1iZXI7XHJcbiAgICB0b3RhbFJld2FyZHM6IG51bWJlcjtcclxuICB9O1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgY29uc3QgeyBkYXRhOiByZWZlcnJhbHMsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgncmVmZXJyYWxzJylcclxuICAgICAgLnNlbGVjdCgnc3RhdHVzLCByZWZlcnJlcl9yZXdhcmRfYW1vdW50LCByZWZlcnJlcl9yZXdhcmRfc3RhdHVzJylcclxuICAgICAgLmVxKCdyZWZlcnJlcl9lbWFpbCcsIGVtYWlsKTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgcmVmZXJyYWwgc3RhdHM6JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBzdGF0cyA9IHtcclxuICAgICAgdG90YWxSZWZlcnJhbHM6IHJlZmVycmFscz8ubGVuZ3RoIHx8IDAsXHJcbiAgICAgIGNvbXBsZXRlZFJlZmVycmFsczpcclxuICAgICAgICByZWZlcnJhbHM/LmZpbHRlcigocikgPT4gci5zdGF0dXMgPT09ICdjb21wbGV0ZWQnKS5sZW5ndGggfHwgMCxcclxuICAgICAgcGVuZGluZ1Jld2FyZHM6XHJcbiAgICAgICAgcmVmZXJyYWxzPy5maWx0ZXIoKHIpID0+IHIucmVmZXJyZXJfcmV3YXJkX3N0YXR1cyA9PT0gJ3BlbmRpbmcnKS5sZW5ndGggfHwgMCxcclxuICAgICAgdG90YWxSZXdhcmRzOlxyXG4gICAgICAgIHJlZmVycmFsc1xyXG4gICAgICAgICAgPy5maWx0ZXIoKHIpID0+IHIucmVmZXJyZXJfcmV3YXJkX3N0YXR1cyA9PT0gJ2NyZWRpdGVkJylcclxuICAgICAgICAgIC5yZWR1Y2UoKHN1bSwgcikgPT4gc3VtICsgKHIucmVmZXJyZXJfcmV3YXJkX2Ftb3VudCB8fCAwKSwgMCkgfHwgMCxcclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgc3RhdHMgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gZ2V0UmVmZXJyYWxTdGF0czonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBmZXRjaCByZWZlcnJhbCBzdGF0cycsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIEluaXRpYWxpemUgYSBjcmVkaXQgcHVyY2hhc2Ugd2l0aCBQYXlzdGFja1xyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGluaXRpYWxpemVDcmVkaXRQdXJjaGFzZShcclxuICBlbWFpbDogc3RyaW5nLFxyXG4gIGFtb3VudDogbnVtYmVyLFxyXG4gIHBheW1lbnRNZXRob2Q6ICdjcmVkaXRfY2FyZCcgfCAnZWZ0J1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGF1dGhvcml6YXRpb25Vcmw/OiBzdHJpbmc7XHJcbiAgcmVmZXJlbmNlPzogc3RyaW5nO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGlmIChhbW91bnQgPCAyMCB8fCBhbW91bnQgPiA1MDAwKSB7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6ICdBbW91bnQgbXVzdCBiZSBiZXR3ZWVuIFIyMCBhbmQgUjUwMDAnLFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEdlbmVyYXRlIGEgdW5pcXVlIHJlZmVyZW5jZSBmb3IgdGhpcyBjcmVkaXQgcHVyY2hhc2VcclxuICAgIGNvbnN0IHJlZmVyZW5jZSA9IGBDUkVESVRfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cmluZygyLCA5KX1gO1xyXG5cclxuICAgIC8vIENyZWF0ZSBhIHBlbmRpbmcgY3JlZGl0IHRyYW5zYWN0aW9uXHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG4gICAgXHJcbiAgICAvLyBHZXQgb3IgY3JlYXRlIHByb2ZpbGVcclxuICAgIGxldCB7IGRhdGE6IHByb2ZpbGUgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgIC5zZWxlY3QoJ2lkLCBjcmVkaXRfYmFsYW5jZScpXHJcbiAgICAgIC5lcSgnZW1haWwnLCBlbWFpbClcclxuICAgICAgLm1heWJlU2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKCFwcm9maWxlKSB7XHJcbiAgICAgIC8vIENyZWF0ZSBhIGJhc2ljIHByb2ZpbGUgaWYgaXQgZG9lc24ndCBleGlzdFxyXG4gICAgICBjb25zdCB7IGRhdGE6IG5ld1Byb2ZpbGUsIGVycm9yOiBjcmVhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgIC5pbnNlcnQoe1xyXG4gICAgICAgICAgZW1haWwsXHJcbiAgICAgICAgICBjcmVkaXRfYmFsYW5jZTogMCxcclxuICAgICAgICAgIGZpcnN0X25hbWU6ICcnLFxyXG4gICAgICAgICAgbGFzdF9uYW1lOiAnJyxcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5zZWxlY3QoJ2lkLCBjcmVkaXRfYmFsYW5jZScpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgaWYgKGNyZWF0ZUVycm9yIHx8ICFuZXdQcm9maWxlKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgZXJyb3I6ICdGYWlsZWQgdG8gY3JlYXRlIHByb2ZpbGUnLFxyXG4gICAgICAgIH07XHJcbiAgICAgIH1cclxuICAgICAgcHJvZmlsZSA9IG5ld1Byb2ZpbGU7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ3JlYXRlIHBlbmRpbmcgY3JlZGl0IHRyYW5zYWN0aW9uXHJcbiAgICBjb25zdCB7IGVycm9yOiB0cmFuc2FjdGlvbkVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnY3JlZGl0X3RyYW5zYWN0aW9ucycpXHJcbiAgICAgIC5pbnNlcnQoe1xyXG4gICAgICAgIHByb2ZpbGVfaWQ6IHByb2ZpbGUuaWQsXHJcbiAgICAgICAgZW1haWwsXHJcbiAgICAgICAgdHJhbnNhY3Rpb25fdHlwZTogJ3B1cmNoYXNlJyxcclxuICAgICAgICBhbW91bnQsXHJcbiAgICAgICAgYmFsYW5jZV9iZWZvcmU6IHByb2ZpbGUuY3JlZGl0X2JhbGFuY2UgfHwgMCxcclxuICAgICAgICBiYWxhbmNlX2FmdGVyOiBwcm9maWxlLmNyZWRpdF9iYWxhbmNlIHx8IDAsIC8vIFdvbid0IHVwZGF0ZSB1bnRpbCBwYXltZW50IHN1Y2NlZWRzXHJcbiAgICAgICAgcGF5bWVudF9tZXRob2Q6IHBheW1lbnRNZXRob2QsXHJcbiAgICAgICAgcGF5c3RhY2tfcmVmZXJlbmNlOiByZWZlcmVuY2UsXHJcbiAgICAgICAgcGF5bWVudF9zdGF0dXM6ICdwZW5kaW5nJyxcclxuICAgICAgICBkZXNjcmlwdGlvbjogYFB1cmNoYXNlIG9mIFIke2Ftb3VudH0gU2hhbGVhbkNyZWRgLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICBpZiAodHJhbnNhY3Rpb25FcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjcmVhdGluZyBjcmVkaXQgdHJhbnNhY3Rpb246JywgdHJhbnNhY3Rpb25FcnJvcik7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6ICdGYWlsZWQgdG8gY3JlYXRlIHRyYW5zYWN0aW9uIHJlY29yZCcsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gSW5pdGlhbGl6ZSBQYXlzdGFjayBwYXltZW50XHJcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKCcvYXBpL3BheXN0YWNrL2luaXRpYWxpemUnLCB7XHJcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgfSxcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIGVtYWlsLFxyXG4gICAgICAgIGFtb3VudCxcclxuICAgICAgICByZWZlcmVuY2UsXHJcbiAgICAgICAgbWV0YWRhdGE6IHtcclxuICAgICAgICAgIHRyYW5zYWN0aW9uX3R5cGU6ICdjcmVkaXRfcHVyY2hhc2UnLFxyXG4gICAgICAgICAgcGF5bWVudF9tZXRob2Q6IHBheW1lbnRNZXRob2QsXHJcbiAgICAgICAgfSxcclxuICAgICAgfSksXHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XHJcbiAgICAgIGNvbnN0IGVycm9yID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIGVycm9yOiBlcnJvci5lcnJvciB8fCAnRmFpbGVkIHRvIGluaXRpYWxpemUgcGF5bWVudCcsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcGF5bWVudERhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XHJcblxyXG4gICAgaWYgKCFwYXltZW50RGF0YS5zdGF0dXMpIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogcGF5bWVudERhdGEubWVzc2FnZSB8fCAnRmFpbGVkIHRvIGluaXRpYWxpemUgcGF5bWVudCcsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgYXV0aG9yaXphdGlvblVybDogcGF5bWVudERhdGEuZGF0YS5hdXRob3JpemF0aW9uX3VybCxcclxuICAgICAgcmVmZXJlbmNlOiBwYXltZW50RGF0YS5kYXRhLnJlZmVyZW5jZSxcclxuICAgIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluaXRpYWxpemluZyBjcmVkaXQgcHVyY2hhc2U6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gaW5pdGlhbGl6ZSBwYXltZW50JyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFZvdWNoZXJSZWRlbXB0aW9uIHtcclxuICBpZDogc3RyaW5nO1xyXG4gIHZvdWNoZXJfY29kZTogc3RyaW5nO1xyXG4gIGFtb3VudDogbnVtYmVyO1xyXG4gIHJlZGVlbWVkX2F0OiBzdHJpbmc7XHJcbiAgYm9va2luZ19pZD86IHN0cmluZztcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJlZGVlbVZvdWNoZXIoXHJcbiAgY29kZTogc3RyaW5nLFxyXG4gIGVtYWlsOiBzdHJpbmcsXHJcbiAgcGhvbmU/OiBzdHJpbmdcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBhbW91bnQ/OiBudW1iZXI7XHJcbiAgbmV3QmFsYW5jZT86IG51bWJlcjtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIENhbGwgdGhlIGRhdGFiYXNlIGZ1bmN0aW9uIHRvIHJlZGVlbSB0aGUgdm91Y2hlclxyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UucnBjKCdyZWRlZW1fdm91Y2hlcicsIHtcclxuICAgICAgcF9jb2RlOiBjb2RlLnRyaW0oKS50b1VwcGVyQ2FzZSgpLFxyXG4gICAgICBwX2VtYWlsOiBlbWFpbC50cmltKCksXHJcbiAgICAgIHBfcGhvbmU6IHBob25lPy50cmltKCkgfHwgbnVsbCxcclxuICAgIH0pO1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciByZWRlZW1pbmcgdm91Y2hlcjonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byByZWRlZW0gdm91Y2hlcicsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gUGFyc2UgdGhlIHJlc3VsdCBmcm9tIHRoZSBmdW5jdGlvbiAoaGFuZGxlIGJvdGggb2JqZWN0IGFuZCBzdHJpbmcgSlNPTkIpXHJcbiAgICBsZXQgcmVzdWx0ID0gZGF0YTtcclxuICAgIGlmICh0eXBlb2YgZGF0YSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICByZXN1bHQgPSBKU09OLnBhcnNlKGRhdGEpO1xyXG4gICAgICB9IGNhdGNoIChwYXJzZUVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgcGFyc2luZyB2b3VjaGVyIHJlZGVtcHRpb24gcmVzdWx0OicsIHBhcnNlRXJyb3IpO1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgIGVycm9yOiAnSW52YWxpZCByZXNwb25zZSBmcm9tIHNlcnZlcicsXHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGlmIChyZXN1bHQgJiYgdHlwZW9mIHJlc3VsdCA9PT0gJ29iamVjdCcgJiYgJ3N1Y2Nlc3MnIGluIHJlc3VsdCkge1xyXG4gICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgZXJyb3I6IHJlc3VsdC5lcnJvciB8fCAnRmFpbGVkIHRvIHJlZGVlbSB2b3VjaGVyJyxcclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcblxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgYW1vdW50OiByZXN1bHQuYW1vdW50LFxyXG4gICAgICAgIG5ld0JhbGFuY2U6IHJlc3VsdC5uZXdfYmFsYW5jZSxcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6ICdVbmV4cGVjdGVkIHJlc3BvbnNlIGZyb20gc2VydmVyJyxcclxuICAgIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHJlZGVlbVZvdWNoZXI6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gcmVkZWVtIHZvdWNoZXInLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRWb3VjaGVyUmVkZW1wdGlvbnMoXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBwaG9uZT86IHN0cmluZ1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIHJlZGVtcHRpb25zPzogVm91Y2hlclJlZGVtcHRpb25bXTtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIGxldCBxdWVyeSA9IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCd2b3VjaGVyX3JlZGVtcHRpb25zJylcclxuICAgICAgLnNlbGVjdCgnaWQsIHZvdWNoZXJfY29kZSwgYW1vdW50LCByZWRlZW1lZF9hdCwgYm9va2luZ19pZCcpXHJcbiAgICAgIC5vcmRlcigncmVkZWVtZWRfYXQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSk7XHJcblxyXG4gICAgLy8gQnVpbGQgcXVlcnkgZm9yIGVtYWlsL3Bob25lIGxvb2t1cFxyXG4gICAgLy8gUHJpb3JpdGl6ZSBlbWFpbCBhcyBpdCdzIHRoZSBwcmltYXJ5IGlkZW50aWZpZXIgdG8gcHJldmVudCBjcm9zcy1hY2NvdW50IHZpc2liaWxpdHlcclxuICAgIGlmIChlbWFpbCkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdlbWFpbCcsIGVtYWlsKTtcclxuICAgICAgLy8gSWYgcGhvbmUgaXMgYWxzbyBwcm92aWRlZCwgd2UgY2FuIG9wdGlvbmFsbHkgZmlsdGVyIGJ5IGJvdGggZm9yIGV4dHJhIHNlY3VyaXR5XHJcbiAgICAgIC8vIGJ1dCBlbWFpbCBhbG9uZSBzaG91bGQgYmUgc3VmZmljaWVudCBzaW5jZSBpdCdzIHVuaXF1ZVxyXG4gICAgfSBlbHNlIGlmIChwaG9uZSkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdwaG9uZScsIHBob25lKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0VtYWlsIG9yIHBob25lIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHF1ZXJ5O1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyB2b3VjaGVyIHJlZGVtcHRpb25zOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVHJhbnNmb3JtIHRoZSBkYXRhIHRvIG1hdGNoIHRoZSBpbnRlcmZhY2VcclxuICAgIGNvbnN0IHJlZGVtcHRpb25zOiBWb3VjaGVyUmVkZW1wdGlvbltdID0gKGRhdGEgfHwgW10pLm1hcCgocmVkZW1wdGlvbikgPT4gKHtcclxuICAgICAgaWQ6IHJlZGVtcHRpb24uaWQsXHJcbiAgICAgIHZvdWNoZXJfY29kZTogcmVkZW1wdGlvbi52b3VjaGVyX2NvZGUsXHJcbiAgICAgIGFtb3VudDogcmVkZW1wdGlvbi5hbW91bnQsXHJcbiAgICAgIHJlZGVlbWVkX2F0OiByZWRlbXB0aW9uLnJlZGVlbWVkX2F0LFxyXG4gICAgICBib29raW5nX2lkOiByZWRlbXB0aW9uLmJvb2tpbmdfaWQgfHwgdW5kZWZpbmVkLFxyXG4gICAgfSkpO1xyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHJlZGVtcHRpb25zIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGdldFZvdWNoZXJSZWRlbXB0aW9uczonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBmZXRjaCB2b3VjaGVyIHJlZGVtcHRpb25zJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG4iXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6ImlTQXNQc0IsaU1BQUEifQ==
}),
"[project]/app/dashboard/profile/page.tsx [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "default",
    ()=>ProfilePage
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/ssr/react-jsx-dev-runtime.js [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/ssr/react.js [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/navigation.js [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$card$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/ui/card.tsx [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$input$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/ui/input.tsx [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$label$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/ui/label.tsx [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$button$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/ui/button.tsx [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$avatar$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/ui/avatar.tsx [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$user$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__default__as__User$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/user.js [app-ssr] (ecmascript) <export default as User>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$mail$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__default__as__Mail$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/mail.js [app-ssr] (ecmascript) <export default as Mail>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$phone$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__default__as__Phone$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/phone.js [app-ssr] (ecmascript) <export default as Phone>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$loader$2d$circle$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__default__as__Loader2$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/loader-circle.js [app-ssr] (ecmascript) <export default as Loader2>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$x$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__default__as__X$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/x.js [app-ssr] (ecmascript) <export default as X>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$camera$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__default__as__Camera$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/camera.js [app-ssr] (ecmascript) <export default as Camera>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/sonner/dist/index.mjs [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$dashboard$2f$data$3a$079001__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__ = __turbopack_context__.i("[project]/app/dashboard/data:079001 [app-ssr] (ecmascript) <text/javascript>");
var __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$dashboard$2f$data$3a$9f8a2b__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__ = __turbopack_context__.i("[project]/app/dashboard/data:9f8a2b [app-ssr] (ecmascript) <text/javascript>");
var __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$dashboard$2f$data$3a$8e0d87__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__ = __turbopack_context__.i("[project]/app/dashboard/data:8e0d87 [app-ssr] (ecmascript) <text/javascript>");
var __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$dashboard$2f$data$3a$b087db__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__ = __turbopack_context__.i("[project]/app/dashboard/data:b087db [app-ssr] (ecmascript) <text/javascript>");
'use client';
;
;
;
;
;
;
;
;
;
;
;
function ProfilePage() {
    const searchParams = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useSearchParams"])();
    const fileInputRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useRef"])(null);
    const [loading, setLoading] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(true);
    const [saving, setSaving] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(false);
    const [uploadingImage, setUploadingImage] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(false);
    const [profile, setProfile] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(null);
    const [formData, setFormData] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])({
        first_name: '',
        last_name: '',
        email: '',
        phone: ''
    });
    const [previewImage, setPreviewImage] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(null);
    const [hasSearched, setHasSearched] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(false);
    // Load profile data
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useEffect"])(()=>{
        const loadProfile = async ()=>{
            try {
                setLoading(true);
                // First, try to get authenticated user's email
                const authResult = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$dashboard$2f$data$3a$8e0d87__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["getAuthenticatedUser"])();
                let email = '';
                let phone = '';
                if (authResult.success && authResult.email) {
                    // Use authenticated user's email
                    email = authResult.email;
                } else {
                    // Fall back to URL params or localStorage (for non-authenticated access)
                    const urlEmail = searchParams.get('email');
                    const urlPhone = searchParams.get('phone');
                    const storedEmail = localStorage.getItem('dashboard_email');
                    const storedPhone = localStorage.getItem('dashboard_phone');
                    email = urlEmail || storedEmail || '';
                    phone = urlPhone || storedPhone || '';
                }
                if (!email && !phone) {
                    setHasSearched(false);
                    setLoading(false);
                    return;
                }
                setHasSearched(true);
                const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$dashboard$2f$data$3a$079001__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["getCustomerProfile"])(email, phone);
                if (result.success && result.profile) {
                    setProfile(result.profile);
                    setFormData({
                        first_name: result.profile.first_name,
                        last_name: result.profile.last_name,
                        email: result.profile.email,
                        phone: result.profile.phone || '',
                        avatar_url: result.profile.avatar_url || null
                    });
                    setPreviewImage(null); // Clear preview when loading profile
                } else {
                    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["toast"].error(result.error || 'Failed to load profile');
                }
            } catch (error) {
                console.error('Error loading profile:', error);
                __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["toast"].error('An unexpected error occurred');
            } finally{
                setLoading(false);
            }
        };
        loadProfile();
    // eslint-disable-next-line react-hooks/exhaustive-deps
    }, [
        searchParams
    ]);
    const handleSubmit = async (e)=>{
        e.preventDefault();
        // Validation
        if (!formData.first_name.trim()) {
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["toast"].error('Please enter your first name');
            return;
        }
        if (!formData.last_name.trim()) {
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["toast"].error('Please enter your last name');
            return;
        }
        if (!formData.email.trim()) {
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["toast"].error('Please enter your email address');
            return;
        }
        if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(formData.email)) {
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["toast"].error('Please enter a valid email address');
            return;
        }
        try {
            setSaving(true);
            // Get current email - prioritize authenticated user's email
            const authResult = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$dashboard$2f$data$3a$8e0d87__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["getAuthenticatedUser"])();
            const currentEmail = authResult.success && authResult.email ? authResult.email : profile?.email || localStorage.getItem('dashboard_email') || formData.email;
            const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$dashboard$2f$data$3a$9f8a2b__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["updateCustomerProfile"])(currentEmail, formData);
            if (result.success && result.profile) {
                setProfile(result.profile);
                // Update localStorage if email changed
                if (result.profile.email !== currentEmail) {
                    localStorage.setItem('dashboard_email', result.profile.email);
                }
                if (result.profile.phone) {
                    localStorage.setItem('dashboard_phone', result.profile.phone);
                }
                __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["toast"].success('Profile updated successfully!');
            } else {
                __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["toast"].error(result.error || 'Failed to update profile');
            }
        } catch (error) {
            console.error('Error updating profile:', error);
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["toast"].error('An unexpected error occurred');
        } finally{
            setSaving(false);
        }
    };
    const handleInputChange = (field, value)=>{
        setFormData((prev)=>({
                ...prev,
                [field]: value
            }));
    };
    const handleImageSelect = async (e)=>{
        const file = e.target.files?.[0];
        if (!file) return;
        // Validate file type
        const validImageTypes = [
            'image/jpeg',
            'image/jpg',
            'image/png',
            'image/webp'
        ];
        if (!validImageTypes.includes(file.type)) {
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["toast"].error('Invalid file type. Please upload a JPEG, PNG, or WebP image.');
            return;
        }
        // Validate file size (max 5MB)
        const maxSize = 5 * 1024 * 1024; // 5MB
        if (file.size > maxSize) {
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["toast"].error('File size too large. Please upload an image smaller than 5MB.');
            return;
        }
        // Create preview
        const reader = new FileReader();
        reader.onloadend = ()=>{
            setPreviewImage(reader.result);
        };
        reader.readAsDataURL(file);
        // Upload image
        try {
            setUploadingImage(true);
            // Get authenticated user's email
            const authResult = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$dashboard$2f$data$3a$8e0d87__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["getAuthenticatedUser"])();
            const email = authResult.success && authResult.email ? authResult.email : profile?.email || localStorage.getItem('dashboard_email') || formData.email;
            if (!email) {
                __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["toast"].error('Please wait for authentication');
                setUploadingImage(false);
                return;
            }
            // Convert file to base64
            const base64Data = await new Promise((resolve, reject)=>{
                const reader = new FileReader();
                reader.onloadend = ()=>resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
            const uploadResult = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$dashboard$2f$data$3a$b087db__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["uploadProfilePicture"])(email, base64Data, file.name, file.type);
            if (uploadResult.success && uploadResult.url) {
                console.log(' Image uploaded successfully, URL:', uploadResult.url);
                console.log(' Now updating profile with avatar_url...');
                // Update profile with new avatar URL
                const updateResult = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$dashboard$2f$data$3a$9f8a2b__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["updateCustomerProfile"])(email, {
                    ...formData,
                    avatar_url: uploadResult.url
                });
                console.log(' Profile update result:', {
                    success: updateResult.success,
                    error: updateResult.error,
                    errorDetails: updateResult.errorDetails
                });
                if (updateResult.success && updateResult.profile) {
                    setProfile(updateResult.profile);
                    setFormData((prev)=>({
                            ...prev,
                            avatar_url: uploadResult.url || null
                        }));
                    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["toast"].success('Profile picture uploaded successfully!');
                } else {
                    const errorMsg = updateResult.error || 'Failed to save profile picture';
                    const detailsMsg = updateResult.errorDetails ? ` Details: ${updateResult.errorDetails}` : '';
                    console.error(' Profile update failed:', errorMsg, detailsMsg);
                    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["toast"].error(errorMsg + detailsMsg);
                    setPreviewImage(null);
                }
            } else {
                console.error(' Image upload failed:', uploadResult.error);
                __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["toast"].error(uploadResult.error || 'Failed to upload profile picture');
                setPreviewImage(null);
            }
        } catch (error) {
            console.error('Error uploading image:', error);
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["toast"].error('Failed to upload profile picture');
            setPreviewImage(null);
        } finally{
            setUploadingImage(false);
            // Reset file input
            if (fileInputRef.current) {
                fileInputRef.current.value = '';
            }
        }
    };
    const handleRemoveImage = async ()=>{
        try {
            setSaving(true);
            // Get authenticated user's email
            const authResult = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$dashboard$2f$data$3a$8e0d87__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["getAuthenticatedUser"])();
            const currentEmail = authResult.success && authResult.email ? authResult.email : profile?.email || localStorage.getItem('dashboard_email') || formData.email;
            const updatedFormData = {
                ...formData,
                avatar_url: null
            };
            const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$dashboard$2f$data$3a$9f8a2b__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["updateCustomerProfile"])(currentEmail, updatedFormData);
            if (result.success && result.profile) {
                setProfile(result.profile);
                setFormData(updatedFormData);
                setPreviewImage(null);
                __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["toast"].success('Profile picture removed successfully!');
            } else {
                __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["toast"].error(result.error || 'Failed to remove profile picture');
            }
        } catch (error) {
            console.error('Error removing image:', error);
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["toast"].error('Failed to remove profile picture');
        } finally{
            setSaving(false);
        }
    };
    const getInitials = (firstName, lastName)=>{
        return `${firstName?.[0] || ''}${lastName?.[0] || ''}`.toUpperCase() || 'U';
    };
    if (loading) {
        return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
            className: "space-y-6",
            children: [
                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("h1", {
                            className: "text-3xl font-bold",
                            children: "Profile"
                        }, void 0, false, {
                            fileName: "[project]/app/dashboard/profile/page.tsx",
                            lineNumber: 285,
                            columnNumber: 11
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                            className: "text-muted-foreground",
                            children: "Manage your profile information"
                        }, void 0, false, {
                            fileName: "[project]/app/dashboard/profile/page.tsx",
                            lineNumber: 286,
                            columnNumber: 11
                        }, this)
                    ]
                }, void 0, true, {
                    fileName: "[project]/app/dashboard/profile/page.tsx",
                    lineNumber: 284,
                    columnNumber: 9
                }, this),
                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$card$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Card"], {
                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$card$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["CardContent"], {
                        className: "flex items-center justify-center py-12",
                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$loader$2d$circle$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__default__as__Loader2$3e$__["Loader2"], {
                            className: "w-8 h-8 animate-spin text-muted-foreground"
                        }, void 0, false, {
                            fileName: "[project]/app/dashboard/profile/page.tsx",
                            lineNumber: 290,
                            columnNumber: 13
                        }, this)
                    }, void 0, false, {
                        fileName: "[project]/app/dashboard/profile/page.tsx",
                        lineNumber: 289,
                        columnNumber: 11
                    }, this)
                }, void 0, false, {
                    fileName: "[project]/app/dashboard/profile/page.tsx",
                    lineNumber: 288,
                    columnNumber: 9
                }, this)
            ]
        }, void 0, true, {
            fileName: "[project]/app/dashboard/profile/page.tsx",
            lineNumber: 283,
            columnNumber: 7
        }, this);
    }
    if (!hasSearched) {
        return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
            className: "space-y-6",
            children: [
                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("h1", {
                            className: "text-3xl font-bold",
                            children: "Profile"
                        }, void 0, false, {
                            fileName: "[project]/app/dashboard/profile/page.tsx",
                            lineNumber: 301,
                            columnNumber: 11
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                            className: "text-muted-foreground",
                            children: "Manage your profile information"
                        }, void 0, false, {
                            fileName: "[project]/app/dashboard/profile/page.tsx",
                            lineNumber: 302,
                            columnNumber: 11
                        }, this)
                    ]
                }, void 0, true, {
                    fileName: "[project]/app/dashboard/profile/page.tsx",
                    lineNumber: 300,
                    columnNumber: 9
                }, this),
                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$card$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Card"], {
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$card$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["CardHeader"], {
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$card$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["CardTitle"], {
                                    children: "Access Your Profile"
                                }, void 0, false, {
                                    fileName: "[project]/app/dashboard/profile/page.tsx",
                                    lineNumber: 306,
                                    columnNumber: 13
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$card$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["CardDescription"], {
                                    children: "Please access the dashboard first by searching for your bookings using your email or phone number."
                                }, void 0, false, {
                                    fileName: "[project]/app/dashboard/profile/page.tsx",
                                    lineNumber: 307,
                                    columnNumber: 13
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/app/dashboard/profile/page.tsx",
                            lineNumber: 305,
                            columnNumber: 11
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$card$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["CardContent"], {
                            children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                className: "text-muted-foreground",
                                children: "Go to the dashboard home page and search for your bookings to access your profile."
                            }, void 0, false, {
                                fileName: "[project]/app/dashboard/profile/page.tsx",
                                lineNumber: 312,
                                columnNumber: 13
                            }, this)
                        }, void 0, false, {
                            fileName: "[project]/app/dashboard/profile/page.tsx",
                            lineNumber: 311,
                            columnNumber: 11
                        }, this)
                    ]
                }, void 0, true, {
                    fileName: "[project]/app/dashboard/profile/page.tsx",
                    lineNumber: 304,
                    columnNumber: 9
                }, this)
            ]
        }, void 0, true, {
            fileName: "[project]/app/dashboard/profile/page.tsx",
            lineNumber: 299,
            columnNumber: 7
        }, this);
    }
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        className: "space-y-6",
        children: [
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("h1", {
                        className: "text-3xl font-bold",
                        children: "Profile"
                    }, void 0, false, {
                        fileName: "[project]/app/dashboard/profile/page.tsx",
                        lineNumber: 324,
                        columnNumber: 9
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                        className: "text-muted-foreground",
                        children: "Manage your profile information"
                    }, void 0, false, {
                        fileName: "[project]/app/dashboard/profile/page.tsx",
                        lineNumber: 325,
                        columnNumber: 9
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/app/dashboard/profile/page.tsx",
                lineNumber: 323,
                columnNumber: 7
            }, this),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$card$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Card"], {
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$card$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["CardHeader"], {
                        children: [
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$card$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["CardTitle"], {
                                children: "Profile Information"
                            }, void 0, false, {
                                fileName: "[project]/app/dashboard/profile/page.tsx",
                                lineNumber: 330,
                                columnNumber: 11
                            }, this),
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$card$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["CardDescription"], {
                                children: "Update your personal information. Changes will be saved to your profile."
                            }, void 0, false, {
                                fileName: "[project]/app/dashboard/profile/page.tsx",
                                lineNumber: 331,
                                columnNumber: 11
                            }, this)
                        ]
                    }, void 0, true, {
                        fileName: "[project]/app/dashboard/profile/page.tsx",
                        lineNumber: 329,
                        columnNumber: 9
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$card$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["CardContent"], {
                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("form", {
                            onSubmit: handleSubmit,
                            className: "space-y-6",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "flex flex-col items-center gap-4 pb-6 border-b",
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "relative",
                                            children: [
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$avatar$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Avatar"], {
                                                    className: "w-24 h-24",
                                                    children: [
                                                        previewImage || profile?.avatar_url ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$avatar$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["AvatarImage"], {
                                                            src: previewImage || profile?.avatar_url || '',
                                                            alt: `${profile?.first_name} ${profile?.last_name}`,
                                                            className: "object-cover"
                                                        }, void 0, false, {
                                                            fileName: "[project]/app/dashboard/profile/page.tsx",
                                                            lineNumber: 342,
                                                            columnNumber: 21
                                                        }, this) : null,
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$avatar$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["AvatarFallback"], {
                                                            className: "text-2xl bg-primary/10 text-primary",
                                                            children: profile ? getInitials(profile.first_name, profile.last_name) : 'U'
                                                        }, void 0, false, {
                                                            fileName: "[project]/app/dashboard/profile/page.tsx",
                                                            lineNumber: 348,
                                                            columnNumber: 19
                                                        }, this)
                                                    ]
                                                }, void 0, true, {
                                                    fileName: "[project]/app/dashboard/profile/page.tsx",
                                                    lineNumber: 340,
                                                    columnNumber: 17
                                                }, this),
                                                uploadingImage && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                    className: "absolute inset-0 flex items-center justify-center bg-background/80 rounded-full",
                                                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$loader$2d$circle$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__default__as__Loader2$3e$__["Loader2"], {
                                                        className: "w-8 h-8 animate-spin text-primary"
                                                    }, void 0, false, {
                                                        fileName: "[project]/app/dashboard/profile/page.tsx",
                                                        lineNumber: 354,
                                                        columnNumber: 21
                                                    }, this)
                                                }, void 0, false, {
                                                    fileName: "[project]/app/dashboard/profile/page.tsx",
                                                    lineNumber: 353,
                                                    columnNumber: 19
                                                }, this)
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/app/dashboard/profile/page.tsx",
                                            lineNumber: 339,
                                            columnNumber: 15
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "flex gap-2",
                                            children: [
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("input", {
                                                    ref: fileInputRef,
                                                    type: "file",
                                                    accept: "image/jpeg,image/jpg,image/png,image/webp",
                                                    onChange: handleImageSelect,
                                                    className: "hidden",
                                                    disabled: uploadingImage || saving
                                                }, void 0, false, {
                                                    fileName: "[project]/app/dashboard/profile/page.tsx",
                                                    lineNumber: 359,
                                                    columnNumber: 17
                                                }, this),
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$button$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Button"], {
                                                    type: "button",
                                                    variant: "outline",
                                                    size: "sm",
                                                    onClick: ()=>fileInputRef.current?.click(),
                                                    disabled: uploadingImage || saving,
                                                    className: "flex items-center gap-2",
                                                    children: uploadingImage ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Fragment"], {
                                                        children: [
                                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$loader$2d$circle$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__default__as__Loader2$3e$__["Loader2"], {
                                                                className: "w-4 h-4 animate-spin"
                                                            }, void 0, false, {
                                                                fileName: "[project]/app/dashboard/profile/page.tsx",
                                                                lineNumber: 377,
                                                                columnNumber: 23
                                                            }, this),
                                                            "Uploading..."
                                                        ]
                                                    }, void 0, true) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Fragment"], {
                                                        children: [
                                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$camera$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__default__as__Camera$3e$__["Camera"], {
                                                                className: "w-4 h-4"
                                                            }, void 0, false, {
                                                                fileName: "[project]/app/dashboard/profile/page.tsx",
                                                                lineNumber: 382,
                                                                columnNumber: 23
                                                            }, this),
                                                            profile?.avatar_url || previewImage ? 'Change Photo' : 'Upload Photo'
                                                        ]
                                                    }, void 0, true)
                                                }, void 0, false, {
                                                    fileName: "[project]/app/dashboard/profile/page.tsx",
                                                    lineNumber: 367,
                                                    columnNumber: 17
                                                }, this),
                                                (profile?.avatar_url || previewImage) && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$button$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Button"], {
                                                    type: "button",
                                                    variant: "outline",
                                                    size: "sm",
                                                    onClick: handleRemoveImage,
                                                    disabled: uploadingImage || saving,
                                                    className: "flex items-center gap-2 text-destructive hover:text-destructive",
                                                    children: [
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$x$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__default__as__X$3e$__["X"], {
                                                            className: "w-4 h-4"
                                                        }, void 0, false, {
                                                            fileName: "[project]/app/dashboard/profile/page.tsx",
                                                            lineNumber: 396,
                                                            columnNumber: 21
                                                        }, this),
                                                        "Remove"
                                                    ]
                                                }, void 0, true, {
                                                    fileName: "[project]/app/dashboard/profile/page.tsx",
                                                    lineNumber: 388,
                                                    columnNumber: 19
                                                }, this)
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/app/dashboard/profile/page.tsx",
                                            lineNumber: 358,
                                            columnNumber: 15
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                            className: "text-xs text-muted-foreground text-center max-w-md",
                                            children: "Upload a JPEG, PNG, or WebP image. Maximum file size is 5MB."
                                        }, void 0, false, {
                                            fileName: "[project]/app/dashboard/profile/page.tsx",
                                            lineNumber: 401,
                                            columnNumber: 15
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/app/dashboard/profile/page.tsx",
                                    lineNumber: 338,
                                    columnNumber: 13
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "grid md:grid-cols-2 gap-6",
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "space-y-2",
                                            children: [
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$label$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Label"], {
                                                    htmlFor: "first_name",
                                                    children: "First Name *"
                                                }, void 0, false, {
                                                    fileName: "[project]/app/dashboard/profile/page.tsx",
                                                    lineNumber: 409,
                                                    columnNumber: 17
                                                }, this),
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                    className: "relative",
                                                    children: [
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$user$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__default__as__User$3e$__["User"], {
                                                            className: "absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"
                                                        }, void 0, false, {
                                                            fileName: "[project]/app/dashboard/profile/page.tsx",
                                                            lineNumber: 411,
                                                            columnNumber: 19
                                                        }, this),
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$input$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Input"], {
                                                            id: "first_name",
                                                            placeholder: "John",
                                                            className: "pl-10",
                                                            value: formData.first_name,
                                                            onChange: (e)=>handleInputChange('first_name', e.target.value),
                                                            required: true
                                                        }, void 0, false, {
                                                            fileName: "[project]/app/dashboard/profile/page.tsx",
                                                            lineNumber: 412,
                                                            columnNumber: 19
                                                        }, this)
                                                    ]
                                                }, void 0, true, {
                                                    fileName: "[project]/app/dashboard/profile/page.tsx",
                                                    lineNumber: 410,
                                                    columnNumber: 17
                                                }, this)
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/app/dashboard/profile/page.tsx",
                                            lineNumber: 408,
                                            columnNumber: 15
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "space-y-2",
                                            children: [
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$label$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Label"], {
                                                    htmlFor: "last_name",
                                                    children: "Last Name *"
                                                }, void 0, false, {
                                                    fileName: "[project]/app/dashboard/profile/page.tsx",
                                                    lineNumber: 425,
                                                    columnNumber: 17
                                                }, this),
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                    className: "relative",
                                                    children: [
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$user$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__default__as__User$3e$__["User"], {
                                                            className: "absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"
                                                        }, void 0, false, {
                                                            fileName: "[project]/app/dashboard/profile/page.tsx",
                                                            lineNumber: 427,
                                                            columnNumber: 19
                                                        }, this),
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$input$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Input"], {
                                                            id: "last_name",
                                                            placeholder: "Doe",
                                                            className: "pl-10",
                                                            value: formData.last_name,
                                                            onChange: (e)=>handleInputChange('last_name', e.target.value),
                                                            required: true
                                                        }, void 0, false, {
                                                            fileName: "[project]/app/dashboard/profile/page.tsx",
                                                            lineNumber: 428,
                                                            columnNumber: 19
                                                        }, this)
                                                    ]
                                                }, void 0, true, {
                                                    fileName: "[project]/app/dashboard/profile/page.tsx",
                                                    lineNumber: 426,
                                                    columnNumber: 17
                                                }, this)
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/app/dashboard/profile/page.tsx",
                                            lineNumber: 424,
                                            columnNumber: 15
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "space-y-2",
                                            children: [
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$label$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Label"], {
                                                    htmlFor: "email",
                                                    children: "Email Address *"
                                                }, void 0, false, {
                                                    fileName: "[project]/app/dashboard/profile/page.tsx",
                                                    lineNumber: 441,
                                                    columnNumber: 17
                                                }, this),
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                    className: "relative",
                                                    children: [
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$mail$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__default__as__Mail$3e$__["Mail"], {
                                                            className: "absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"
                                                        }, void 0, false, {
                                                            fileName: "[project]/app/dashboard/profile/page.tsx",
                                                            lineNumber: 443,
                                                            columnNumber: 19
                                                        }, this),
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$input$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Input"], {
                                                            id: "email",
                                                            type: "email",
                                                            placeholder: "john@example.com",
                                                            className: "pl-10",
                                                            value: formData.email,
                                                            onChange: (e)=>handleInputChange('email', e.target.value),
                                                            required: true
                                                        }, void 0, false, {
                                                            fileName: "[project]/app/dashboard/profile/page.tsx",
                                                            lineNumber: 444,
                                                            columnNumber: 19
                                                        }, this)
                                                    ]
                                                }, void 0, true, {
                                                    fileName: "[project]/app/dashboard/profile/page.tsx",
                                                    lineNumber: 442,
                                                    columnNumber: 17
                                                }, this)
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/app/dashboard/profile/page.tsx",
                                            lineNumber: 440,
                                            columnNumber: 15
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "space-y-2",
                                            children: [
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$label$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Label"], {
                                                    htmlFor: "phone",
                                                    children: "Phone Number"
                                                }, void 0, false, {
                                                    fileName: "[project]/app/dashboard/profile/page.tsx",
                                                    lineNumber: 458,
                                                    columnNumber: 17
                                                }, this),
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                    className: "relative",
                                                    children: [
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$phone$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__default__as__Phone$3e$__["Phone"], {
                                                            className: "absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"
                                                        }, void 0, false, {
                                                            fileName: "[project]/app/dashboard/profile/page.tsx",
                                                            lineNumber: 460,
                                                            columnNumber: 19
                                                        }, this),
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$input$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Input"], {
                                                            id: "phone",
                                                            type: "tel",
                                                            placeholder: "0821234567 or +27821234567",
                                                            className: "pl-10",
                                                            value: formData.phone,
                                                            onChange: (e)=>handleInputChange('phone', e.target.value)
                                                        }, void 0, false, {
                                                            fileName: "[project]/app/dashboard/profile/page.tsx",
                                                            lineNumber: 461,
                                                            columnNumber: 19
                                                        }, this)
                                                    ]
                                                }, void 0, true, {
                                                    fileName: "[project]/app/dashboard/profile/page.tsx",
                                                    lineNumber: 459,
                                                    columnNumber: 17
                                                }, this)
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/app/dashboard/profile/page.tsx",
                                            lineNumber: 457,
                                            columnNumber: 15
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/app/dashboard/profile/page.tsx",
                                    lineNumber: 406,
                                    columnNumber: 13
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "flex justify-end gap-4 pt-4",
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$button$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Button"], {
                                            type: "button",
                                            variant: "outline",
                                            onClick: ()=>{
                                                // Reset form to original profile data
                                                if (profile) {
                                                    setFormData({
                                                        first_name: profile.first_name,
                                                        last_name: profile.last_name,
                                                        email: profile.email,
                                                        phone: profile.phone || '',
                                                        avatar_url: profile.avatar_url || null
                                                    });
                                                    setPreviewImage(null);
                                                }
                                            },
                                            disabled: saving,
                                            children: "Reset"
                                        }, void 0, false, {
                                            fileName: "[project]/app/dashboard/profile/page.tsx",
                                            lineNumber: 474,
                                            columnNumber: 15
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$button$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Button"], {
                                            type: "submit",
                                            disabled: saving,
                                            children: saving ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Fragment"], {
                                                children: [
                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$loader$2d$circle$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__default__as__Loader2$3e$__["Loader2"], {
                                                        className: "w-4 h-4 mr-2 animate-spin"
                                                    }, void 0, false, {
                                                        fileName: "[project]/app/dashboard/profile/page.tsx",
                                                        lineNumber: 497,
                                                        columnNumber: 21
                                                    }, this),
                                                    "Saving..."
                                                ]
                                            }, void 0, true) : 'Save Changes'
                                        }, void 0, false, {
                                            fileName: "[project]/app/dashboard/profile/page.tsx",
                                            lineNumber: 494,
                                            columnNumber: 15
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/app/dashboard/profile/page.tsx",
                                    lineNumber: 473,
                                    columnNumber: 13
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/app/dashboard/profile/page.tsx",
                            lineNumber: 336,
                            columnNumber: 11
                        }, this)
                    }, void 0, false, {
                        fileName: "[project]/app/dashboard/profile/page.tsx",
                        lineNumber: 335,
                        columnNumber: 9
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/app/dashboard/profile/page.tsx",
                lineNumber: 328,
                columnNumber: 7
            }, this)
        ]
    }, void 0, true, {
        fileName: "[project]/app/dashboard/profile/page.tsx",
        lineNumber: 322,
        columnNumber: 5
    }, this);
}
}),
];

//# sourceMappingURL=_64b45fd4._.js.map