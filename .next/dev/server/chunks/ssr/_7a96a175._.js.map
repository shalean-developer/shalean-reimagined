{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/27825/shalean-v2/shalean-reimagined/src/lib/supabase/server-admin.ts"],"sourcesContent":["import { createClient as createSupabaseClient } from '@supabase/supabase-js'\r\n\r\n/**\r\n * Creates a Supabase client with service role key (bypasses RLS)\r\n * Use this ONLY for server-side operations that need to bypass Row Level Security\r\n * This should only be used in server actions, API routes, and server components\r\n * \r\n * IMPORTANT: Add SUPABASE_SERVICE_ROLE_KEY to your .env.local file\r\n * Get it from: Supabase Dashboard -> Settings -> API -> service_role key (secret)\r\n */\r\nexport function createAdminClient() {\r\n  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!\r\n  const supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY\r\n\r\n  if (!supabaseServiceRoleKey) {\r\n    const errorMsg = 'SUPABASE_SERVICE_ROLE_KEY is not set. This is REQUIRED for profile operations.'\r\n    console.error('‚ùå', errorMsg)\r\n    console.error('üìù Get your service role key from: Supabase Dashboard -> Settings -> API -> service_role key (secret)')\r\n    console.error('üìù Add it to your .env.local file as: SUPABASE_SERVICE_ROLE_KEY=your_key_here')\r\n    \r\n    // Throw an error instead of falling back to anon key\r\n    // This forces users to set the service role key\r\n    throw new Error(errorMsg)\r\n  }\r\n\r\n  // Create client with service role key (bypasses RLS completely)\r\n  const client = createSupabaseClient(supabaseUrl, supabaseServiceRoleKey, {\r\n    auth: {\r\n      autoRefreshToken: false,\r\n      persistSession: false,\r\n    },\r\n    db: {\r\n      schema: 'public',\r\n    },\r\n  })\r\n  \r\n  return client\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAAA;;AAUO,SAAS;IACd,MAAM;IACN,MAAM,yBAAyB,QAAQ,GAAG,CAAC,yBAAyB;IAEpE,IAAI,CAAC,wBAAwB;QAC3B,MAAM,WAAW;QACjB,QAAQ,KAAK,CAAC,KAAK;QACnB,QAAQ,KAAK,CAAC;QACd,QAAQ,KAAK,CAAC;QAEd,qDAAqD;QACrD,gDAAgD;QAChD,MAAM,IAAI,MAAM;IAClB;IAEA,gEAAgE;IAChE,MAAM,SAAS,IAAA,8LAAoB,EAAC,aAAa,wBAAwB;QACvE,MAAM;YACJ,kBAAkB;YAClB,gBAAgB;QAClB;QACA,IAAI;YACF,QAAQ;QACV;IACF;IAEA,OAAO;AACT"}},
    {"offset": {"line": 38, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/27825/shalean-v2/shalean-reimagined/app/dashboard/actions.ts"],"sourcesContent":["'use server';\r\n\r\nimport { createClient } from '@/lib/supabase/server';\r\nimport { createAdminClient } from '@/lib/supabase/server-admin';\r\nimport { Booking } from '@/types/booking';\r\nimport { Profile, ProfileUpdateInput } from '@/types/profile';\r\nimport { Location, LocationCreateInput, LocationUpdateInput } from '@/types/location';\r\n\r\nexport async function getAuthenticatedUser(): Promise<{\r\n  success: boolean;\r\n  email?: string;\r\n  error?: string;\r\n}> {\r\n  try {\r\n    const supabase = await createClient();\r\n    const { data: { user }, error } = await supabase.auth.getUser();\r\n\r\n    if (error || !user) {\r\n      return { success: false, error: 'Not authenticated' };\r\n    }\r\n\r\n    return { success: true, email: user.email || undefined };\r\n  } catch (error) {\r\n    console.error('Error in getAuthenticatedUser:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Failed to get user',\r\n    };\r\n  }\r\n}\r\n\r\nexport async function getCustomerBookings(\r\n  email: string,\r\n  phone?: string,\r\n  filter?: 'all' | 'upcoming' | 'completed' | 'cancelled'\r\n): Promise<{\r\n  success: boolean;\r\n  bookings?: Booking[];\r\n  error?: string;\r\n}> {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    let query = supabase\r\n      .from('bookings')\r\n      .select('*')\r\n      .order('service_date', { ascending: false })\r\n      .order('created_at', { ascending: false });\r\n\r\n    // Build query for email/phone lookup\r\n    if (email && phone) {\r\n      query = query.or(`customer_email.eq.${email},customer_phone.eq.${phone}`);\r\n    } else if (email) {\r\n      query = query.eq('customer_email', email);\r\n    } else if (phone) {\r\n      query = query.eq('customer_phone', phone);\r\n    } else {\r\n      return { success: false, error: 'Email or phone is required' };\r\n    }\r\n\r\n    // Apply status filter\r\n    if (filter && filter !== 'all') {\r\n      if (filter === 'upcoming') {\r\n        query = query.in('status', ['pending', 'confirmed']);\r\n      } else {\r\n        query = query.eq('status', filter);\r\n      }\r\n    }\r\n\r\n    const { data, error } = await query;\r\n\r\n    if (error) {\r\n      console.error('Error fetching bookings:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n\r\n    return { success: true, bookings: data || [] };\r\n  } catch (error) {\r\n    console.error('Error in getCustomerBookings:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Failed to fetch bookings',\r\n    };\r\n  }\r\n}\r\n\r\nexport async function getCustomerBookingStats(\r\n  email: string,\r\n  phone?: string\r\n): Promise<{\r\n  success: boolean;\r\n  stats?: {\r\n    total: number;\r\n    upcoming: number;\r\n    completed: number;\r\n    cancelled: number;\r\n    totalSpent: number;\r\n  };\r\n  error?: string;\r\n}> {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    let query = supabase\r\n      .from('bookings')\r\n      .select('status, total_amount, payment_status');\r\n\r\n    // Build query for email/phone lookup\r\n    if (email && phone) {\r\n      query = query.or(`customer_email.eq.${email},customer_phone.eq.${phone}`);\r\n    } else if (email) {\r\n      query = query.eq('customer_email', email);\r\n    } else if (phone) {\r\n      query = query.eq('customer_phone', phone);\r\n    } else {\r\n      return { success: false, error: 'Email or phone is required' };\r\n    }\r\n\r\n    const { data, error } = await query;\r\n\r\n    if (error) {\r\n      return { success: false, error: error.message };\r\n    }\r\n\r\n    const stats = {\r\n      total: data?.length || 0,\r\n      upcoming: data?.filter((b) => b.status === 'pending' || b.status === 'confirmed').length || 0,\r\n      completed: data?.filter((b) => b.status === 'completed').length || 0,\r\n      cancelled: data?.filter((b) => b.status === 'cancelled').length || 0,\r\n      totalSpent: data\r\n        ?.filter((b) => b.payment_status === 'paid')\r\n        .reduce((sum, b) => sum + (b.total_amount || 0), 0) || 0,\r\n    };\r\n\r\n    return { success: true, stats };\r\n  } catch (error) {\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Failed to fetch stats',\r\n    };\r\n  }\r\n}\r\n\r\nexport async function getBookingById(id: string): Promise<{\r\n  success: boolean;\r\n  booking?: Booking;\r\n  error?: string;\r\n}> {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    const { data, error } = await supabase\r\n      .from('bookings')\r\n      .select('*')\r\n      .eq('id', id)\r\n      .single();\r\n\r\n    if (error) {\r\n      console.error('Error fetching booking:', error);\r\n      return { success: false, error: 'Booking not found' };\r\n    }\r\n\r\n    return { success: true, booking: data };\r\n  } catch (error) {\r\n    console.error('Unexpected error fetching booking:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'An unexpected error occurred',\r\n    };\r\n  }\r\n}\r\n\r\nexport async function getCustomerProfile(\r\n  email: string,\r\n  phone?: string\r\n): Promise<{\r\n  success: boolean;\r\n  profile?: Profile;\r\n  error?: string;\r\n}> {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    // First, try to get profile from profiles table\r\n    let query = supabase.from('profiles').select('*');\r\n\r\n    if (email) {\r\n      query = query.eq('email', email);\r\n    } else if (phone) {\r\n      query = query.eq('phone', phone);\r\n    } else {\r\n      return { success: false, error: 'Email or phone is required' };\r\n    }\r\n\r\n    const { data: profileData, error: profileError } = await query.maybeSingle();\r\n\r\n    // If profile exists, return it\r\n    if (profileData && !profileError) {\r\n      return { success: true, profile: profileData };\r\n    }\r\n\r\n    // If no profile exists, derive from most recent booking\r\n    let bookingQuery = supabase\r\n      .from('bookings')\r\n      .select('customer_first_name, customer_last_name, customer_email, customer_phone')\r\n      .order('created_at', { ascending: false })\r\n      .limit(1);\r\n\r\n    if (email && phone) {\r\n      bookingQuery = bookingQuery.or(`customer_email.eq.${email},customer_phone.eq.${phone}`);\r\n    } else if (email) {\r\n      bookingQuery = bookingQuery.eq('customer_email', email);\r\n    } else if (phone) {\r\n      bookingQuery = bookingQuery.eq('customer_phone', phone);\r\n    }\r\n\r\n    const { data: bookingData, error: bookingError } = await bookingQuery.maybeSingle();\r\n\r\n    if (bookingError || !bookingData) {\r\n      return {\r\n        success: false,\r\n        error: 'No profile or booking found. Please create a booking first.',\r\n      };\r\n    }\r\n\r\n    // Create a profile object from booking data\r\n    const derivedProfile: Profile = {\r\n      id: '', // Will be generated when saved\r\n      email: bookingData.customer_email,\r\n      phone: bookingData.customer_phone || null,\r\n      first_name: bookingData.customer_first_name,\r\n      last_name: bookingData.customer_last_name,\r\n      referral_code: null,\r\n      avatar_url: null,\r\n      created_at: new Date().toISOString(),\r\n      updated_at: new Date().toISOString(),\r\n    };\r\n\r\n    return { success: true, profile: derivedProfile };\r\n  } catch (error) {\r\n    console.error('Error in getCustomerProfile:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Failed to fetch profile',\r\n    };\r\n  }\r\n}\r\n\r\nexport async function uploadProfilePicture(\r\n  email: string,\r\n  fileData: string, // base64 encoded string\r\n  fileName: string,\r\n  fileType: string\r\n): Promise<{\r\n  success: boolean;\r\n  url?: string;\r\n  error?: string;\r\n}> {\r\n  try {\r\n    // Use admin client for storage uploads if service role key is available\r\n    // If not available, fall back to authenticated client for storage (storage policies may still work)\r\n    let supabase;\r\n    try {\r\n      supabase = createAdminClient();\r\n      console.log('‚úÖ Using admin client for storage upload');\r\n    } catch (error) {\r\n      console.warn('‚ö†Ô∏è Service role key not set, using authenticated client for storage upload');\r\n      supabase = await createClient();\r\n    }\r\n\r\n    // Validate file type\r\n    const validImageTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp'];\r\n    if (!validImageTypes.includes(fileType)) {\r\n      return { success: false, error: 'Invalid file type. Please upload a JPEG, PNG, or WebP image.' };\r\n    }\r\n\r\n    // Decode base64 data\r\n    const base64Data = fileData.replace(/^data:image\\/\\w+;base64,/, '');\r\n    const buffer = Buffer.from(base64Data, 'base64');\r\n\r\n    // Validate file size (max 5MB)\r\n    const maxSize = 5 * 1024 * 1024; // 5MB in bytes\r\n    if (buffer.length > maxSize) {\r\n      return { success: false, error: 'File size too large. Please upload an image smaller than 5MB.' };\r\n    }\r\n\r\n    // Generate unique filename using email and timestamp\r\n    const fileExt = fileName.split('.').pop() || 'jpg';\r\n    const sanitizedEmail = email.replace(/[^a-zA-Z0-9]/g, '_');\r\n    const uniqueFileName = `${sanitizedEmail}_${Date.now()}.${fileExt}`;\r\n    const filePath = `avatars/${uniqueFileName}`;\r\n\r\n    // Upload to Supabase Storage\r\n    const { data: uploadData, error: uploadError } = await supabase.storage\r\n      .from('profile-pictures')\r\n      .upload(filePath, buffer, {\r\n        contentType: fileType,\r\n        upsert: false,\r\n      });\r\n\r\n      if (uploadError) {\r\n        console.error('‚ùå Storage upload error:', uploadError);\r\n        console.error('Upload error details:', {\r\n          message: uploadError.message,\r\n          statusCode: uploadError.statusCode,\r\n          error: uploadError.error,\r\n        });\r\n        \r\n        // Check for storage RLS errors\r\n        if (uploadError.message?.includes('row-level security') || \r\n            uploadError.message?.includes('RLS') ||\r\n            uploadError.message?.includes('policy')) {\r\n          return { \r\n            success: false, \r\n            error: 'Storage bucket RLS policy error. Please check your \"profile-pictures\" bucket policies in Supabase Storage. The bucket needs policies that allow authenticated users to upload files.',\r\n          };\r\n        }\r\n        \r\n        // If bucket doesn't exist, return helpful error\r\n        if (uploadError.message.includes('not found') || uploadError.message.includes('Bucket')) {\r\n          return { \r\n            success: false, \r\n            error: 'Storage bucket not configured. Please create a \"profile-pictures\" bucket in Supabase Storage.',\r\n          };\r\n        }\r\n        return { \r\n          success: false, \r\n          error: uploadError.message || 'Failed to upload file',\r\n        };\r\n      }\r\n\r\n    // Get public URL\r\n    const { data: urlData } = supabase.storage\r\n      .from('profile-pictures')\r\n      .getPublicUrl(filePath);\r\n\r\n    return { success: true, url: urlData.publicUrl };\r\n  } catch (error) {\r\n    console.error('Error in uploadProfilePicture:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Failed to upload profile picture',\r\n    };\r\n  }\r\n}\r\n\r\nexport async function deleteProfilePicture(email: string, avatarUrl: string): Promise<{\r\n  success: boolean;\r\n  error?: string;\r\n}> {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    // Extract file path from URL\r\n    // URL format: https://[project].supabase.co/storage/v1/object/public/profile-pictures/avatars/filename.jpg\r\n    const urlPattern = /\\/profile-pictures\\/(.+)$/;\r\n    const match = avatarUrl.match(urlPattern);\r\n    \r\n    if (!match || !match[1]) {\r\n      // If URL doesn't match expected pattern, try alternative parsing\r\n      const urlParts = avatarUrl.split('/avatars/');\r\n      if (urlParts.length < 2) {\r\n        // If we can't parse the URL, just return success (the file might already be deleted)\r\n        console.warn('Could not parse avatar URL for deletion:', avatarUrl);\r\n        return { success: true };\r\n      }\r\n      const filePath = `avatars/${urlParts[1].split('?')[0]}`;\r\n      const { error: deleteError } = await supabase.storage\r\n        .from('profile-pictures')\r\n        .remove([filePath]);\r\n\r\n      if (deleteError && !deleteError.message.includes('not found')) {\r\n        console.error('Error deleting file:', deleteError);\r\n        return { success: false, error: deleteError.message };\r\n      }\r\n      return { success: true };\r\n    }\r\n\r\n    const filePath = match[1].split('?')[0]; // Remove query parameters if any\r\n\r\n    // Delete from storage\r\n    const { error: deleteError } = await supabase.storage\r\n      .from('profile-pictures')\r\n      .remove([filePath]);\r\n\r\n    if (deleteError) {\r\n      console.error('Error deleting file:', deleteError);\r\n      // Don't fail if file doesn't exist\r\n      if (deleteError.message.includes('not found') || deleteError.message.includes('No such file')) {\r\n        return { success: true };\r\n      }\r\n      return { success: false, error: deleteError.message };\r\n    }\r\n\r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error('Error in deleteProfilePicture:', error);\r\n    // Don't fail completely - the URL in database will be removed anyway\r\n    return { success: true };\r\n  }\r\n}\r\n\r\nexport async function updateCustomerProfile(\r\n  email: string,\r\n  data: ProfileUpdateInput\r\n): Promise<{\r\n  success: boolean;\r\n  profile?: Profile;\r\n  error?: string;\r\n}> {\r\n  try {\r\n    // First, verify the authenticated user matches the email\r\n    const authSupabase = await createClient();\r\n    const { data: { user }, error: authError } = await authSupabase.auth.getUser();\r\n    \r\n    if (authError || !user) {\r\n      return { success: false, error: 'Not authenticated' };\r\n    }\r\n\r\n    // Verify that the email parameter matches the authenticated user's email\r\n    // This ensures users can only update their own profile\r\n    if (user.email?.toLowerCase() !== email.toLowerCase() && user.email?.toLowerCase() !== data.email?.toLowerCase()) {\r\n      return { success: false, error: 'Unauthorized: You can only update your own profile' };\r\n    }\r\n\r\n    // ALWAYS use admin client for profile operations - it bypasses RLS completely\r\n    // This is REQUIRED - we cannot use authenticated client as it may still check RLS policies\r\n    let supabase;\r\n    try {\r\n      supabase = createAdminClient();\r\n      console.log('‚úÖ Using admin client for profile operations');\r\n    } catch (error) {\r\n      // Do NOT fall back to authenticated client - it will cause RLS errors\r\n      console.error('‚ùå Failed to create admin client:', error);\r\n      return {\r\n        success: false,\r\n        error: 'SUPABASE_SERVICE_ROLE_KEY is not set. This is REQUIRED for profile operations. Please add it to your .env.local file. Get it from: Supabase Dashboard ‚Üí Settings ‚Üí API ‚Üí service_role key (secret)',\r\n      };\r\n    }\r\n    \r\n    // Verify we have a valid client (should never happen due to error above, but double-check)\r\n    if (!supabase) {\r\n      return { \r\n        success: false, \r\n        error: 'Failed to initialize database client. Please check your SUPABASE_SERVICE_ROLE_KEY in .env.local' \r\n      };\r\n    }\r\n\r\n    // Validate input\r\n    if (!data.first_name?.trim()) {\r\n      return { success: false, error: 'First name is required' };\r\n    }\r\n    if (!data.last_name?.trim()) {\r\n      return { success: false, error: 'Last name is required' };\r\n    }\r\n    if (!data.email?.trim()) {\r\n      return { success: false, error: 'Email is required' };\r\n    }\r\n    if (!/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(data.email)) {\r\n      return { success: false, error: 'Invalid email format' };\r\n    }\r\n\r\n    // Verify the new email (if changed) still matches the authenticated user\r\n    if (data.email.toLowerCase() !== user.email?.toLowerCase()) {\r\n      // Allow email change only if it's the same user (case insensitive check above passed)\r\n      // But we should verify it's a valid change (user updating their own email)\r\n      if (data.email.toLowerCase() !== email.toLowerCase()) {\r\n        // Email is being changed - verify it's still the same user\r\n        // For now, we'll allow it but in production you might want to require email verification\r\n      }\r\n    }\r\n\r\n    // Check if profile exists\r\n    console.log('üîç Checking if profile exists for email:', email);\r\n    console.log('üîç Using client type:', process.env.SUPABASE_SERVICE_ROLE_KEY ? 'ADMIN (service role)' : 'AUTHENTICATED (anon key)');\r\n    \r\n    const { data: existingProfile, error: selectError } = await supabase\r\n      .from('profiles')\r\n      .select('*')\r\n      .eq('email', email)\r\n      .maybeSingle();\r\n    \r\n    if (selectError) {\r\n      console.error('‚ùå Error selecting profile:', selectError);\r\n      return { success: false, error: `Failed to check profile: ${selectError.message}` };\r\n    }\r\n    \r\n    console.log('‚úÖ Profile check result:', existingProfile ? 'Profile exists (will UPDATE)' : 'Profile does not exist (will INSERT)');\r\n\r\n    // If avatar_url is being removed, delete the old file\r\n    if (existingProfile?.avatar_url && data.avatar_url === null) {\r\n      await deleteProfilePicture(email, existingProfile.avatar_url);\r\n    }\r\n\r\n    let result;\r\n    if (existingProfile) {\r\n      // Update existing profile\r\n      // If email changed, we need to handle it carefully\r\n      if (data.email !== email) {\r\n        // Check if new email already exists\r\n        const { data: emailCheck } = await supabase\r\n          .from('profiles')\r\n          .select('id')\r\n          .eq('email', data.email)\r\n          .maybeSingle();\r\n\r\n        if (emailCheck) {\r\n          return { success: false, error: 'Email already exists' };\r\n        }\r\n      }\r\n\r\n      const updateData: any = {\r\n          first_name: data.first_name.trim(),\r\n          last_name: data.last_name.trim(),\r\n          email: data.email.trim(),\r\n          phone: data.phone?.trim() || null,\r\n          updated_at: new Date().toISOString(),\r\n      };\r\n\r\n      // Handle avatar_url: undefined means don't change, null means remove, string means set\r\n      if (data.avatar_url !== undefined) {\r\n        updateData.avatar_url = data.avatar_url === null ? null : data.avatar_url;\r\n      }\r\n\r\n      console.log('üìù Attempting to UPDATE profile with data:', updateData);\r\n      console.log('üìù Update WHERE email =', email);\r\n      \r\n      const { data: updatedProfile, error: updateError } = await supabase\r\n        .from('profiles')\r\n        .update(updateData)\r\n        .eq('email', email)\r\n        .select()\r\n        .single();\r\n\r\n      if (updateError) {\r\n        console.error('‚ùå Error updating profile:', updateError);\r\n        console.error('‚ùå Update error details:', {\r\n          code: updateError.code,\r\n          message: updateError.message,\r\n          details: updateError.details,\r\n          hint: updateError.hint,\r\n          statusCode: (updateError as any).statusCode,\r\n          status: (updateError as any).status,\r\n          serviceRoleKeySet: !!process.env.SUPABASE_SERVICE_ROLE_KEY,\r\n        });\r\n        \r\n        // Check for RLS errors specifically\r\n        if (updateError.message?.includes('row-level security') || \r\n            updateError.code === '42501' ||\r\n            updateError.message?.includes('RLS')) {\r\n          return { \r\n            success: false, \r\n            error: 'Row Level Security error. Please ensure: 1) RLS is disabled on profiles table, 2) SUPABASE_SERVICE_ROLE_KEY is set in .env.local',\r\n          };\r\n        }\r\n        \r\n        return { \r\n          success: false, \r\n          error: updateError.message || 'Failed to update profile',\r\n        };\r\n      }\r\n\r\n      result = updatedProfile;\r\n    } else {\r\n      // Create new profile\r\n      const insertData: any = {\r\n          email: data.email.trim(),\r\n          phone: data.phone?.trim() || null,\r\n          first_name: data.first_name.trim(),\r\n          last_name: data.last_name.trim(),\r\n      };\r\n\r\n      // Only set avatar_url if it's provided\r\n      if (data.avatar_url) {\r\n        insertData.avatar_url = data.avatar_url;\r\n      }\r\n\r\n      const { data: newProfile, error: insertError } = await supabase\r\n        .from('profiles')\r\n        .insert(insertData)\r\n        .select()\r\n        .single();\r\n\r\n      if (insertError) {\r\n        console.error('Error creating profile:', insertError);\r\n        console.error('‚ùå Insert error details:', {\r\n          code: insertError.code,\r\n          message: insertError.message,\r\n          details: insertError.details,\r\n          hint: insertError.hint,\r\n          serviceRoleKeySet: !!process.env.SUPABASE_SERVICE_ROLE_KEY,\r\n        });\r\n        // Check if it's a unique constraint violation\r\n        if (insertError.code === '23505') {\r\n          return { success: false, error: 'Email already exists' };\r\n        }\r\n        // Check if it's an RLS error\r\n        if (insertError.message?.includes('row-level security') || \r\n            insertError.code === '42501' ||\r\n            insertError.message?.includes('RLS')) {\r\n          return { \r\n            success: false, \r\n            error: 'Row Level Security error. Please ensure: 1) RLS is disabled on profiles table, 2) SUPABASE_SERVICE_ROLE_KEY is set in .env.local',\r\n          };\r\n        }\r\n        return { \r\n          success: false, \r\n          error: insertError.message || 'Failed to create profile',\r\n        };\r\n      }\r\n\r\n      result = newProfile;\r\n    }\r\n\r\n    return { success: true, profile: result };\r\n  } catch (error) {\r\n    console.error('Error in updateCustomerProfile:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Failed to update profile',\r\n    };\r\n  }\r\n}\r\n\r\nexport async function getCustomerLocations(\r\n  email: string,\r\n  phone?: string\r\n): Promise<{\r\n  success: boolean;\r\n  locations?: Location[];\r\n  error?: string;\r\n}> {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    let query = supabase\r\n      .from('locations')\r\n      .select('*')\r\n      .order('is_default', { ascending: false })\r\n      .order('created_at', { ascending: false });\r\n\r\n    // Build query for email/phone lookup\r\n    if (email && phone) {\r\n      query = query.or(`customer_email.eq.${email},customer_phone.eq.${phone}`);\r\n    } else if (email) {\r\n      query = query.eq('customer_email', email);\r\n    } else if (phone) {\r\n      query = query.eq('customer_phone', phone);\r\n    } else {\r\n      return { success: false, error: 'Email or phone is required' };\r\n    }\r\n\r\n    const { data, error } = await query;\r\n\r\n    if (error) {\r\n      console.error('Error fetching locations:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n\r\n    return { success: true, locations: data || [] };\r\n  } catch (error) {\r\n    console.error('Error in getCustomerLocations:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Failed to fetch locations',\r\n    };\r\n  }\r\n}\r\n\r\nexport async function createLocation(\r\n  email: string,\r\n  phone: string | undefined,\r\n  locationData: LocationCreateInput\r\n): Promise<{\r\n  success: boolean;\r\n  location?: Location;\r\n  error?: string;\r\n}> {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    // Validate input\r\n    if (!locationData.nickname?.trim()) {\r\n      return { success: false, error: 'Nickname is required' };\r\n    }\r\n    if (!locationData.address?.trim()) {\r\n      return { success: false, error: 'Address is required' };\r\n    }\r\n    if (!locationData.suburb?.trim()) {\r\n      return { success: false, error: 'Suburb is required' };\r\n    }\r\n    if (!locationData.city?.trim()) {\r\n      return { success: false, error: 'City is required' };\r\n    }\r\n\r\n    // If setting as default, unset all other defaults for this customer\r\n    if (locationData.is_default) {\r\n      let updateQuery = supabase\r\n        .from('locations')\r\n        .update({ is_default: false });\r\n\r\n      if (email && phone) {\r\n        updateQuery = updateQuery.or(`customer_email.eq.${email},customer_phone.eq.${phone}`);\r\n      } else if (email) {\r\n        updateQuery = updateQuery.eq('customer_email', email);\r\n      } else if (phone) {\r\n        updateQuery = updateQuery.eq('customer_phone', phone);\r\n      }\r\n\r\n      await updateQuery;\r\n    }\r\n\r\n    const { data: newLocation, error: insertError } = await supabase\r\n      .from('locations')\r\n      .insert({\r\n        customer_email: email,\r\n        customer_phone: phone || null,\r\n        nickname: locationData.nickname.trim(),\r\n        address: locationData.address.trim(),\r\n        apt_unit: locationData.apt_unit?.trim() || null,\r\n        suburb: locationData.suburb.trim(),\r\n        city: locationData.city.trim(),\r\n        postal_code: locationData.postal_code?.trim() || null,\r\n        is_default: locationData.is_default || false,\r\n      })\r\n      .select()\r\n      .single();\r\n\r\n    if (insertError) {\r\n      console.error('Error creating location:', insertError);\r\n      return { success: false, error: insertError.message };\r\n    }\r\n\r\n    return { success: true, location: newLocation };\r\n  } catch (error) {\r\n    console.error('Error in createLocation:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Failed to create location',\r\n    };\r\n  }\r\n}\r\n\r\nexport async function updateLocation(\r\n  locationId: string,\r\n  locationData: LocationUpdateInput\r\n): Promise<{\r\n  success: boolean;\r\n  location?: Location;\r\n  error?: string;\r\n}> {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    // Validate input if provided\r\n    if (locationData.nickname !== undefined && !locationData.nickname.trim()) {\r\n      return { success: false, error: 'Nickname is required' };\r\n    }\r\n    if (locationData.address !== undefined && !locationData.address.trim()) {\r\n      return { success: false, error: 'Address is required' };\r\n    }\r\n    if (locationData.suburb !== undefined && !locationData.suburb.trim()) {\r\n      return { success: false, error: 'Suburb is required' };\r\n    }\r\n    if (locationData.city !== undefined && !locationData.city.trim()) {\r\n      return { success: false, error: 'City is required' };\r\n    }\r\n\r\n    // Get current location to check customer email\r\n    const { data: currentLocation, error: fetchError } = await supabase\r\n      .from('locations')\r\n      .select('customer_email, customer_phone')\r\n      .eq('id', locationId)\r\n      .single();\r\n\r\n    if (fetchError || !currentLocation) {\r\n      return { success: false, error: 'Location not found' };\r\n    }\r\n\r\n    // If setting as default, unset all other defaults for this customer\r\n    if (locationData.is_default) {\r\n      let updateQuery = supabase\r\n        .from('locations')\r\n        .update({ is_default: false });\r\n\r\n      if (currentLocation.customer_email && currentLocation.customer_phone) {\r\n        updateQuery = updateQuery.or(`customer_email.eq.${currentLocation.customer_email},customer_phone.eq.${currentLocation.customer_phone}`);\r\n      } else if (currentLocation.customer_email) {\r\n        updateQuery = updateQuery.eq('customer_email', currentLocation.customer_email);\r\n      } else if (currentLocation.customer_phone) {\r\n        updateQuery = updateQuery.eq('customer_phone', currentLocation.customer_phone);\r\n      }\r\n\r\n      // Don't unset the current location\r\n      updateQuery = updateQuery.neq('id', locationId);\r\n\r\n      await updateQuery;\r\n    }\r\n\r\n    // Build update object with only provided fields\r\n    const updateData: any = {\r\n      updated_at: new Date().toISOString(),\r\n    };\r\n\r\n    if (locationData.nickname !== undefined) {\r\n      updateData.nickname = locationData.nickname.trim();\r\n    }\r\n    if (locationData.address !== undefined) {\r\n      updateData.address = locationData.address.trim();\r\n    }\r\n    if (locationData.apt_unit !== undefined) {\r\n      updateData.apt_unit = locationData.apt_unit?.trim() || null;\r\n    }\r\n    if (locationData.suburb !== undefined) {\r\n      updateData.suburb = locationData.suburb.trim();\r\n    }\r\n    if (locationData.city !== undefined) {\r\n      updateData.city = locationData.city.trim();\r\n    }\r\n    if (locationData.postal_code !== undefined) {\r\n      updateData.postal_code = locationData.postal_code?.trim() || null;\r\n    }\r\n    if (locationData.is_default !== undefined) {\r\n      updateData.is_default = locationData.is_default;\r\n    }\r\n\r\n    const { data: updatedLocation, error: updateError } = await supabase\r\n      .from('locations')\r\n      .update(updateData)\r\n      .eq('id', locationId)\r\n      .select()\r\n      .single();\r\n\r\n    if (updateError) {\r\n      console.error('Error updating location:', updateError);\r\n      return { success: false, error: updateError.message };\r\n    }\r\n\r\n    return { success: true, location: updatedLocation };\r\n  } catch (error) {\r\n    console.error('Error in updateLocation:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Failed to update location',\r\n    };\r\n  }\r\n}\r\n\r\nexport async function deleteLocation(locationId: string): Promise<{\r\n  success: boolean;\r\n  error?: string;\r\n}> {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    const { error } = await supabase\r\n      .from('locations')\r\n      .delete()\r\n      .eq('id', locationId);\r\n\r\n    if (error) {\r\n      console.error('Error deleting location:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n\r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error('Error in deleteLocation:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Failed to delete location',\r\n    };\r\n  }\r\n}\r\n\r\nexport async function setDefaultLocation(\r\n  locationId: string,\r\n  email: string,\r\n  phone?: string\r\n): Promise<{\r\n  success: boolean;\r\n  location?: Location;\r\n  error?: string;\r\n}> {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    // Get current location to verify ownership\r\n    const { data: currentLocation, error: fetchError } = await supabase\r\n      .from('locations')\r\n      .select('customer_email, customer_phone')\r\n      .eq('id', locationId)\r\n      .single();\r\n\r\n    if (fetchError || !currentLocation) {\r\n      return { success: false, error: 'Location not found' };\r\n    }\r\n\r\n    // Verify ownership\r\n    const isOwner = \r\n      currentLocation.customer_email === email ||\r\n      (phone && currentLocation.customer_phone === phone);\r\n\r\n    if (!isOwner) {\r\n      return { success: false, error: 'Unauthorized' };\r\n    }\r\n\r\n    // Unset all other defaults for this customer\r\n    let updateQuery = supabase\r\n      .from('locations')\r\n      .update({ is_default: false });\r\n\r\n    if (email && phone) {\r\n      updateQuery = updateQuery.or(`customer_email.eq.${email},customer_phone.eq.${phone}`);\r\n    } else if (email) {\r\n      updateQuery = updateQuery.eq('customer_email', email);\r\n    } else if (phone) {\r\n      updateQuery = updateQuery.eq('customer_phone', phone);\r\n    }\r\n\r\n    // Don't unset the current location\r\n    updateQuery = updateQuery.neq('id', locationId);\r\n\r\n    await updateQuery;\r\n\r\n    // Set this location as default\r\n    const { data: updatedLocation, error: updateError } = await supabase\r\n      .from('locations')\r\n      .update({ is_default: true })\r\n      .eq('id', locationId)\r\n      .select()\r\n      .single();\r\n\r\n    if (updateError) {\r\n      console.error('Error setting default location:', updateError);\r\n      return { success: false, error: updateError.message };\r\n    }\r\n\r\n    return { success: true, location: updatedLocation };\r\n  } catch (error) {\r\n    console.error('Error in setDefaultLocation:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Failed to set default location',\r\n    };\r\n  }\r\n}\r\n\r\nexport async function getOrCreateReferralCode(\r\n  email: string\r\n): Promise<{\r\n  success: boolean;\r\n  referralCode?: string;\r\n  error?: string;\r\n}> {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    // Check if profile exists and has a referral code\r\n    const { data: profile, error: profileError } = await supabase\r\n      .from('profiles')\r\n      .select('referral_code')\r\n      .eq('email', email)\r\n      .maybeSingle();\r\n\r\n    if (profileError && profileError.code !== 'PGRST116') {\r\n      console.error('Error fetching profile:', profileError);\r\n      return { success: false, error: profileError.message };\r\n    }\r\n\r\n    // If profile exists and has a referral code, return it\r\n    if (profile?.referral_code) {\r\n      return { success: true, referralCode: profile.referral_code };\r\n    }\r\n\r\n    // Generate a new referral code\r\n    // Try using the database function first, but fallback to client-side generation\r\n    let generatedCode: string | null = null;\r\n    \r\n    try {\r\n      const { data: dbCode, error: codeError } = await supabase\r\n        .rpc('generate_referral_code');\r\n      \r\n      if (!codeError && dbCode) {\r\n        generatedCode = dbCode;\r\n      }\r\n    } catch (rpcError) {\r\n      // RPC function might not exist yet, that's okay\r\n      console.log('RPC function not available, using fallback');\r\n    }\r\n\r\n    if (!generatedCode) {\r\n      // Fallback: generate code client-side style\r\n      const fallbackCode = Math.random().toString(36).substring(2, 8).toUpperCase();\r\n      \r\n      // Check if fallback code exists, retry if it does\r\n      let finalCode = fallbackCode;\r\n      let attempts = 0;\r\n      const maxAttempts = 5;\r\n\r\n      while (attempts < maxAttempts) {\r\n        const { data: existing } = await supabase\r\n          .from('profiles')\r\n          .select('id')\r\n          .eq('referral_code', finalCode)\r\n          .maybeSingle();\r\n\r\n        if (!existing) {\r\n          break; // Code is unique\r\n        }\r\n\r\n        // Generate a new code\r\n        finalCode = Math.random().toString(36).substring(2, 8).toUpperCase();\r\n        attempts++;\r\n      }\r\n\r\n      // Update or insert profile with referral code\r\n      // First, try to update existing profile\r\n      const { data: existingProfile } = await supabase\r\n        .from('profiles')\r\n        .select('id, first_name, last_name')\r\n        .eq('email', email)\r\n        .maybeSingle();\r\n\r\n      let updatedProfile;\r\n      if (existingProfile) {\r\n        // Update existing profile\r\n        const { data: updated, error: updateError } = await supabase\r\n          .from('profiles')\r\n          .update({\r\n            referral_code: finalCode,\r\n            updated_at: new Date().toISOString(),\r\n          })\r\n          .eq('email', email)\r\n          .select('referral_code')\r\n          .single();\r\n\r\n        if (updateError) {\r\n          console.error('Error updating referral code:', updateError);\r\n          return { success: false, error: updateError.message };\r\n        }\r\n        updatedProfile = updated;\r\n      } else {\r\n        // Insert new profile with referral code\r\n        const { data: inserted, error: insertError } = await supabase\r\n          .from('profiles')\r\n          .insert({\r\n            email,\r\n            referral_code: finalCode,\r\n            first_name: email.split('@')[0],\r\n            last_name: '',\r\n          })\r\n          .select('referral_code')\r\n          .single();\r\n\r\n        if (insertError) {\r\n          console.error('Error creating referral code:', insertError);\r\n          return { success: false, error: insertError.message };\r\n        }\r\n        updatedProfile = inserted;\r\n      }\r\n\r\n      return { success: true, referralCode: updatedProfile?.referral_code || finalCode };\r\n    }\r\n\r\n    // Use the generated code from database function\r\n    // Update or insert profile with generated code\r\n    const { data: existingProfile } = await supabase\r\n      .from('profiles')\r\n      .select('id, first_name, last_name')\r\n      .eq('email', email)\r\n      .maybeSingle();\r\n\r\n    let updatedProfile;\r\n    if (existingProfile) {\r\n      // Update existing profile\r\n      const { data: updated, error: updateError } = await supabase\r\n        .from('profiles')\r\n        .update({\r\n          referral_code: generatedCode,\r\n          updated_at: new Date().toISOString(),\r\n        })\r\n        .eq('email', email)\r\n        .select('referral_code')\r\n        .single();\r\n\r\n      if (updateError) {\r\n        console.error('Error updating referral code:', updateError);\r\n        return { success: false, error: updateError.message };\r\n      }\r\n      updatedProfile = updated;\r\n    } else {\r\n      // Insert new profile with referral code\r\n      const { data: inserted, error: insertError } = await supabase\r\n        .from('profiles')\r\n        .insert({\r\n          email,\r\n          referral_code: generatedCode,\r\n          first_name: email.split('@')[0],\r\n          last_name: '',\r\n        })\r\n        .select('referral_code')\r\n        .single();\r\n\r\n      if (insertError) {\r\n        console.error('Error creating referral code:', insertError);\r\n        return { success: false, error: insertError.message };\r\n      }\r\n      updatedProfile = inserted;\r\n    }\r\n\r\n    return { success: true, referralCode: updatedProfile?.referral_code || generatedCode };\r\n  } catch (error) {\r\n    console.error('Error in getOrCreateReferralCode:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Failed to get referral code',\r\n    };\r\n  }\r\n}\r\n\r\nexport async function sendReferralInvites(\r\n  email: string,\r\n  inviteEmails: string[],\r\n  referralCode: string\r\n): Promise<{\r\n  success: boolean;\r\n  sent?: number;\r\n  error?: string;\r\n}> {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    // Validate email addresses\r\n    const validEmails = inviteEmails\r\n      .map((e) => e.trim())\r\n      .filter((e) => {\r\n        if (!e) return false;\r\n        return /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(e);\r\n      });\r\n\r\n    if (validEmails.length === 0) {\r\n      return { success: false, error: 'No valid email addresses provided' };\r\n    }\r\n\r\n    // Create referral records for tracking\r\n    const referralRecords = validEmails.map((referredEmail) => ({\r\n      referrer_email: email,\r\n      referred_email: referredEmail,\r\n      referral_code: referralCode,\r\n      status: 'pending',\r\n    }));\r\n\r\n    const { error: insertError } = await supabase\r\n      .from('referrals')\r\n      .insert(referralRecords);\r\n\r\n    if (insertError) {\r\n      console.error('Error creating referral records:', insertError);\r\n      // Continue even if insert fails - we still want to send emails\r\n    }\r\n\r\n    // Generate referral link\r\n    const baseUrl = process.env.NEXT_PUBLIC_SITE_URL || 'https://shalean.co.za';\r\n    const referralLink = `${baseUrl}/booking/details?ref=${referralCode}`;\r\n\r\n    // TODO: Implement actual email sending using your email service (Resend, SendGrid, etc.)\r\n    // For now, we'll just log the emails that would be sent\r\n    console.log('Referral invites to send:', {\r\n      from: email,\r\n      to: validEmails,\r\n      referralCode,\r\n      referralLink,\r\n    });\r\n\r\n    // In a real implementation, you would send emails here\r\n    // Example with Resend:\r\n    // await resend.emails.send({\r\n    //   from: 'Shalean <noreply@shalean.co.za>',\r\n    //   to: validEmails,\r\n    //   subject: 'You\\'ve been invited to try Shalean Cleaning Services!',\r\n    //   html: `<p>Your friend has invited you to try Shalean. Use code ${referralCode} to get R150 off your first booking!</p><p><a href=\"${referralLink}\">Book Now</a></p>`,\r\n    // });\r\n\r\n    return { success: true, sent: validEmails.length };\r\n  } catch (error) {\r\n    console.error('Error in sendReferralInvites:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Failed to send invites',\r\n    };\r\n  }\r\n}\r\n\r\nexport async function getReferralStats(\r\n  email: string\r\n): Promise<{\r\n  success: boolean;\r\n  stats?: {\r\n    totalReferrals: number;\r\n    completedReferrals: number;\r\n    pendingRewards: number;\r\n    totalRewards: number;\r\n  };\r\n  error?: string;\r\n}> {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    const { data: referrals, error } = await supabase\r\n      .from('referrals')\r\n      .select('status, referrer_reward_amount, referrer_reward_status')\r\n      .eq('referrer_email', email);\r\n\r\n    if (error) {\r\n      console.error('Error fetching referral stats:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n\r\n    const stats = {\r\n      totalReferrals: referrals?.length || 0,\r\n      completedReferrals:\r\n        referrals?.filter((r) => r.status === 'completed').length || 0,\r\n      pendingRewards:\r\n        referrals?.filter((r) => r.referrer_reward_status === 'pending').length || 0,\r\n      totalRewards:\r\n        referrals\r\n          ?.filter((r) => r.referrer_reward_status === 'credited')\r\n          .reduce((sum, r) => sum + (r.referrer_reward_amount || 0), 0) || 0,\r\n    };\r\n\r\n    return { success: true, stats };\r\n  } catch (error) {\r\n    console.error('Error in getReferralStats:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Failed to fetch referral stats',\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Initialize a credit purchase with Paystack\r\n */\r\nexport async function initializeCreditPurchase(\r\n  email: string,\r\n  amount: number,\r\n  paymentMethod: 'credit_card' | 'eft'\r\n): Promise<{\r\n  success: boolean;\r\n  authorizationUrl?: string;\r\n  reference?: string;\r\n  error?: string;\r\n}> {\r\n  try {\r\n    if (amount < 20 || amount > 5000) {\r\n      return {\r\n        success: false,\r\n        error: 'Amount must be between R20 and R5000',\r\n      };\r\n    }\r\n\r\n    // Generate a unique reference for this credit purchase\r\n    const reference = `CREDIT_${Date.now()}_${Math.random().toString(36).substring(2, 9)}`;\r\n\r\n    // Create a pending credit transaction\r\n    const supabase = await createClient();\r\n    \r\n    // Get or create profile\r\n    let { data: profile } = await supabase\r\n      .from('profiles')\r\n      .select('id, credit_balance')\r\n      .eq('email', email)\r\n      .maybeSingle();\r\n\r\n    if (!profile) {\r\n      // Create a basic profile if it doesn't exist\r\n      const { data: newProfile, error: createError } = await supabase\r\n        .from('profiles')\r\n        .insert({\r\n          email,\r\n          credit_balance: 0,\r\n          first_name: '',\r\n          last_name: '',\r\n        })\r\n        .select('id, credit_balance')\r\n        .single();\r\n\r\n      if (createError || !newProfile) {\r\n        return {\r\n          success: false,\r\n          error: 'Failed to create profile',\r\n        };\r\n      }\r\n      profile = newProfile;\r\n    }\r\n\r\n    // Create pending credit transaction\r\n    const { error: transactionError } = await supabase\r\n      .from('credit_transactions')\r\n      .insert({\r\n        profile_id: profile.id,\r\n        email,\r\n        transaction_type: 'purchase',\r\n        amount,\r\n        balance_before: profile.credit_balance || 0,\r\n        balance_after: profile.credit_balance || 0, // Won't update until payment succeeds\r\n        payment_method: paymentMethod,\r\n        paystack_reference: reference,\r\n        payment_status: 'pending',\r\n        description: `Purchase of R${amount} ShaleanCred`,\r\n      });\r\n\r\n    if (transactionError) {\r\n      console.error('Error creating credit transaction:', transactionError);\r\n      return {\r\n        success: false,\r\n        error: 'Failed to create transaction record',\r\n      };\r\n    }\r\n\r\n    // Initialize Paystack payment\r\n    const response = await fetch('/api/paystack/initialize', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({\r\n        email,\r\n        amount,\r\n        reference,\r\n        metadata: {\r\n          transaction_type: 'credit_purchase',\r\n          payment_method: paymentMethod,\r\n        },\r\n      }),\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const error = await response.json();\r\n      return {\r\n        success: false,\r\n        error: error.error || 'Failed to initialize payment',\r\n      };\r\n    }\r\n\r\n    const paymentData = await response.json();\r\n\r\n    if (!paymentData.status) {\r\n      return {\r\n        success: false,\r\n        error: paymentData.message || 'Failed to initialize payment',\r\n      };\r\n    }\r\n\r\n    return {\r\n      success: true,\r\n      authorizationUrl: paymentData.data.authorization_url,\r\n      reference: paymentData.data.reference,\r\n    };\r\n  } catch (error) {\r\n    console.error('Error initializing credit purchase:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Failed to initialize payment',\r\n    };\r\n  }\r\n}\r\n\r\nexport interface VoucherRedemption {\r\n  id: string;\r\n  voucher_code: string;\r\n  amount: number;\r\n  redeemed_at: string;\r\n  booking_id?: string;\r\n}\r\n\r\nexport async function redeemVoucher(\r\n  code: string,\r\n  email: string,\r\n  phone?: string\r\n): Promise<{\r\n  success: boolean;\r\n  amount?: number;\r\n  newBalance?: number;\r\n  error?: string;\r\n}> {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    // Call the database function to redeem the voucher\r\n    const { data, error } = await supabase.rpc('redeem_voucher', {\r\n      p_code: code.trim().toUpperCase(),\r\n      p_email: email.trim(),\r\n      p_phone: phone?.trim() || null,\r\n    });\r\n\r\n    if (error) {\r\n      console.error('Error redeeming voucher:', error);\r\n      return {\r\n        success: false,\r\n        error: error.message || 'Failed to redeem voucher',\r\n      };\r\n    }\r\n\r\n    // Parse the result from the function (handle both object and string JSONB)\r\n    let result = data;\r\n    if (typeof data === 'string') {\r\n      try {\r\n        result = JSON.parse(data);\r\n      } catch (parseError) {\r\n        console.error('Error parsing voucher redemption result:', parseError);\r\n        return {\r\n          success: false,\r\n          error: 'Invalid response from server',\r\n        };\r\n      }\r\n    }\r\n\r\n    if (result && typeof result === 'object' && 'success' in result) {\r\n      if (result.success === false) {\r\n        return {\r\n          success: false,\r\n          error: result.error || 'Failed to redeem voucher',\r\n        };\r\n      }\r\n\r\n      return {\r\n        success: true,\r\n        amount: result.amount,\r\n        newBalance: result.new_balance,\r\n      };\r\n    }\r\n\r\n    return {\r\n      success: false,\r\n      error: 'Unexpected response from server',\r\n    };\r\n  } catch (error) {\r\n    console.error('Error in redeemVoucher:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Failed to redeem voucher',\r\n    };\r\n  }\r\n}\r\n\r\nexport async function getVoucherRedemptions(\r\n  email: string,\r\n  phone?: string\r\n): Promise<{\r\n  success: boolean;\r\n  redemptions?: VoucherRedemption[];\r\n  error?: string;\r\n}> {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    let query = supabase\r\n      .from('voucher_redemptions')\r\n      .select('id, voucher_code, amount, redeemed_at, booking_id')\r\n      .order('redeemed_at', { ascending: false });\r\n\r\n    // Build query for email/phone lookup\r\n    // Prioritize email as it's the primary identifier to prevent cross-account visibility\r\n    if (email) {\r\n      query = query.eq('email', email);\r\n      // If phone is also provided, we can optionally filter by both for extra security\r\n      // but email alone should be sufficient since it's unique\r\n    } else if (phone) {\r\n      query = query.eq('phone', phone);\r\n    } else {\r\n      return { success: false, error: 'Email or phone is required' };\r\n    }\r\n\r\n    const { data, error } = await query;\r\n\r\n    if (error) {\r\n      console.error('Error fetching voucher redemptions:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n\r\n    // Transform the data to match the interface\r\n    const redemptions: VoucherRedemption[] = (data || []).map((redemption) => ({\r\n      id: redemption.id,\r\n      voucher_code: redemption.voucher_code,\r\n      amount: redemption.amount,\r\n      redeemed_at: redemption.redeemed_at,\r\n      booking_id: redemption.booking_id || undefined,\r\n    }));\r\n\r\n    return { success: true, redemptions };\r\n  } catch (error) {\r\n    console.error('Error in getVoucherRedemptions:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Failed to fetch voucher redemptions',\r\n    };\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1381, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/27825/shalean-v2/shalean-reimagined/app/booking/quote/actions.ts"],"sourcesContent":["'use server';\r\n\r\nimport { createClient } from '@/lib/supabase/server';\r\nimport { QuoteFormData, QuoteStatus, Quote, Service, AdditionalService, HomeDetailOption, CleaningEquipment } from '@/types/quote';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\nexport interface SaveQuoteResult {\r\n  success: boolean;\r\n  data?: Quote;\r\n  error?: string;\r\n}\r\n\r\n/**\r\n * Save or update a quote draft\r\n */\r\nexport async function saveQuoteDraft(\r\n  email: string,\r\n  formData: QuoteFormData\r\n): Promise<SaveQuoteResult> {\r\n  try {\r\n    if (!email || !email.trim()) {\r\n      return { success: false, error: 'Email is required' };\r\n    }\r\n\r\n    const supabase = await createClient();\r\n\r\n    // Check if a draft already exists for this email\r\n    const { data: existingDraft } = await supabase\r\n      .from('quotes')\r\n      .select('id')\r\n      .eq('email', email.trim().toLowerCase())\r\n      .eq('status', 'draft')\r\n      .order('updated_at', { ascending: false })\r\n      .limit(1)\r\n      .single();\r\n\r\n    if (existingDraft) {\r\n      // Update existing draft\r\n      const { data, error } = await supabase\r\n        .from('quotes')\r\n        .update({\r\n          form_data: formData,\r\n          updated_at: new Date().toISOString(),\r\n        })\r\n        .eq('id', existingDraft.id)\r\n        .select()\r\n        .single();\r\n\r\n      if (error) {\r\n        console.error('Error updating quote draft:', error);\r\n        return { success: false, error: error.message };\r\n      }\r\n\r\n      return { success: true, data: data as Quote };\r\n    } else {\r\n      // Create new draft\r\n      const { data, error } = await supabase\r\n        .from('quotes')\r\n        .insert({\r\n          email: email.trim().toLowerCase(),\r\n          status: 'draft',\r\n          form_data: formData,\r\n        })\r\n        .select()\r\n        .single();\r\n\r\n      if (error) {\r\n        console.error('Error creating quote draft:', error);\r\n        return { success: false, error: error.message };\r\n      }\r\n\r\n      return { success: true, data: data as Quote };\r\n    }\r\n  } catch (error) {\r\n    console.error('Unexpected error saving quote draft:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'An unexpected error occurred',\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Get the latest draft quote for an email\r\n */\r\nexport async function getQuoteDraft(email: string): Promise<Quote | null> {\r\n  try {\r\n    if (!email || !email.trim()) {\r\n      return null;\r\n    }\r\n\r\n    const supabase = await createClient();\r\n\r\n    const { data, error } = await supabase\r\n      .from('quotes')\r\n      .select('*')\r\n      .eq('email', email.trim().toLowerCase())\r\n      .eq('status', 'draft')\r\n      .order('updated_at', { ascending: false })\r\n      .limit(1)\r\n      .single();\r\n\r\n    if (error) {\r\n      // If no draft exists, that's okay - return null\r\n      if (error.code === 'PGRST116') {\r\n        return null;\r\n      }\r\n      console.error('Error fetching quote draft:', error);\r\n      return null;\r\n    }\r\n\r\n    return data as Quote;\r\n  } catch (error) {\r\n    console.error('Unexpected error fetching quote draft:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get all quotes (drafts and submitted) for an email\r\n */\r\nexport async function getQuotesByEmail(email: string): Promise<Quote[]> {\r\n  try {\r\n    if (!email || !email.trim()) {\r\n      return [];\r\n    }\r\n\r\n    const supabase = await createClient();\r\n\r\n    const { data, error } = await supabase\r\n      .from('quotes')\r\n      .select('*')\r\n      .eq('email', email.trim().toLowerCase())\r\n      .order('updated_at', { ascending: false });\r\n\r\n    if (error) {\r\n      console.error('Error fetching quotes:', error);\r\n      return [];\r\n    }\r\n\r\n    return (data || []) as Quote[];\r\n  } catch (error) {\r\n    console.error('Unexpected error fetching quotes:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Submit a quote (change status from draft to submitted)\r\n */\r\nexport async function submitQuote(\r\n  email: string,\r\n  formData: QuoteFormData\r\n): Promise<SaveQuoteResult> {\r\n  try {\r\n    if (!email || !email.trim()) {\r\n      return { success: false, error: 'Email is required' };\r\n    }\r\n\r\n    const supabase = await createClient();\r\n\r\n    // Check if a draft exists for this email\r\n    const { data: existingDraft } = await supabase\r\n      .from('quotes')\r\n      .select('id')\r\n      .eq('email', email.trim().toLowerCase())\r\n      .eq('status', 'draft')\r\n      .order('updated_at', { ascending: false })\r\n      .limit(1)\r\n      .single();\r\n\r\n    if (existingDraft) {\r\n      // Update existing draft to submitted\r\n      const { data, error } = await supabase\r\n        .from('quotes')\r\n        .update({\r\n          status: 'submitted',\r\n          form_data: formData,\r\n          updated_at: new Date().toISOString(),\r\n        })\r\n        .eq('id', existingDraft.id)\r\n        .select()\r\n        .single();\r\n\r\n      if (error) {\r\n        console.error('Error submitting quote:', error);\r\n        return { success: false, error: error.message };\r\n      }\r\n\r\n      revalidatePath('/booking/quote');\r\n      return { success: true, data: data as Quote };\r\n    } else {\r\n      // Create new submitted quote\r\n      const { data, error } = await supabase\r\n        .from('quotes')\r\n        .insert({\r\n          email: email.trim().toLowerCase(),\r\n          status: 'submitted',\r\n          form_data: formData,\r\n        })\r\n        .select()\r\n        .single();\r\n\r\n      if (error) {\r\n        console.error('Error creating submitted quote:', error);\r\n        return { success: false, error: error.message };\r\n      }\r\n\r\n      revalidatePath('/booking/quote');\r\n      return { success: true, data: data as Quote };\r\n    }\r\n  } catch (error) {\r\n    console.error('Unexpected error submitting quote:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'An unexpected error occurred',\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Get all active services ordered by display_order\r\n */\r\nexport async function getServices(): Promise<Service[]> {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    const { data, error } = await supabase\r\n      .from('services')\r\n      .select('*')\r\n      .eq('is_active', true)\r\n      .order('display_order', { ascending: true });\r\n\r\n    if (error) {\r\n      console.error('Error fetching services:', error);\r\n      return [];\r\n    }\r\n\r\n    return (data || []) as Service[];\r\n  } catch (error) {\r\n    console.error('Unexpected error fetching services:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get additional services, optionally filtered by main service\r\n */\r\nexport async function getAdditionalServices(serviceId?: string): Promise<AdditionalService[]> {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    if (serviceId) {\r\n      // Get additional services filtered by service rules\r\n      const { data, error } = await supabase\r\n        .from('service_additional_service_rules')\r\n        .select(`\r\n          additional_service_id,\r\n          additional_services:additional_service_id(*)\r\n        `)\r\n        .eq('service_id', serviceId);\r\n\r\n      if (error) {\r\n        console.error('Error fetching additional services by service:', error);\r\n        return [];\r\n      }\r\n\r\n      // Extract and format the additional services\r\n      const additionalServices = (data || [])\r\n        .map((rule: any) => rule.additional_services)\r\n        .filter((service: AdditionalService) => service && service.is_active)\r\n        .sort((a: AdditionalService, b: AdditionalService) => a.display_order - b.display_order);\r\n\r\n      return additionalServices as AdditionalService[];\r\n    } else {\r\n      // Get all active additional services\r\n      const { data, error } = await supabase\r\n        .from('additional_services')\r\n        .select('*')\r\n        .eq('is_active', true)\r\n        .order('display_order', { ascending: true });\r\n\r\n      if (error) {\r\n        console.error('Error fetching all additional services:', error);\r\n        return [];\r\n      }\r\n\r\n      return (data || []) as AdditionalService[];\r\n    }\r\n  } catch (error) {\r\n    console.error('Unexpected error fetching additional services:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get home detail options for a specific type (bedrooms, bathrooms, carpet_type, room_status)\r\n */\r\nexport async function getHomeDetailOptions(optionType: string): Promise<HomeDetailOption[]> {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    const { data, error } = await supabase\r\n      .from('home_detail_options')\r\n      .select('*')\r\n      .eq('option_type', optionType)\r\n      .eq('is_active', true)\r\n      .order('display_order', { ascending: true });\r\n\r\n    if (error) {\r\n      console.error(`Error fetching home detail options for ${optionType}:`, error);\r\n      return [];\r\n    }\r\n\r\n    return (data || []) as HomeDetailOption[];\r\n  } catch (error) {\r\n    console.error(`Unexpected error fetching home detail options for ${optionType}:`, error);\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get all active cleaning equipment ordered by display_order\r\n */\r\nexport async function getCleaningEquipment(): Promise<CleaningEquipment[]> {\r\n  try {\r\n    const supabase = await createClient();\r\n\r\n    const { data, error } = await supabase\r\n      .from('cleaning_equipment')\r\n      .select('*')\r\n      .eq('is_active', true)\r\n      .order('display_order', { ascending: true });\r\n\r\n    if (error) {\r\n      console.error('Error fetching cleaning equipment:', error);\r\n      return [];\r\n    }\r\n\r\n    return (data || []) as CleaningEquipment[];\r\n  } catch (error) {\r\n    console.error('Unexpected error fetching cleaning equipment:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1668, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/27825/shalean-v2/shalean-reimagined/.next-internal/server/app/dashboard/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {getAuthenticatedUser as '00d62cc413d9b16ce2ea0ff37e9486d3704f49d049'} from 'ACTIONS_MODULE0'\nexport {getCustomerProfile as '60d1908fde86ac220eb7a80a2be1b3941c55a8b34b'} from 'ACTIONS_MODULE0'\nexport {getCustomerBookings as '70caa94967fdb96320fe4ad03b796848c625ec7638'} from 'ACTIONS_MODULE0'\nexport {getServices as '00f6a41d53889140d7e9eb8567bc58b1384742947f'} from 'ACTIONS_MODULE1'\n"],"names":[],"mappings":";AAAA;AAGA"}}]
}