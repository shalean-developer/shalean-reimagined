module.exports = [
"[project]/src/components/ui/card.tsx [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "Card",
    ()=>Card,
    "CardContent",
    ()=>CardContent,
    "CardDescription",
    ()=>CardDescription,
    "CardFooter",
    ()=>CardFooter,
    "CardHeader",
    ()=>CardHeader,
    "CardTitle",
    ()=>CardTitle
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/ssr/react-jsx-dev-runtime.js [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/ssr/react.js [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/utils.ts [app-ssr] (ecmascript)");
;
;
;
const Card = /*#__PURE__*/ __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["forwardRef"](({ className, ...props }, ref)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        ref: ref,
        className: (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["cn"])("rounded-lg border bg-card text-card-foreground shadow-sm", className),
        ...props
    }, void 0, false, {
        fileName: "[project]/src/components/ui/card.tsx",
        lineNumber: 6,
        columnNumber: 3
    }, ("TURBOPACK compile-time value", void 0)));
Card.displayName = "Card";
const CardHeader = /*#__PURE__*/ __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["forwardRef"](({ className, ...props }, ref)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        ref: ref,
        className: (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["cn"])("flex flex-col space-y-1.5 p-6", className),
        ...props
    }, void 0, false, {
        fileName: "[project]/src/components/ui/card.tsx",
        lineNumber: 12,
        columnNumber: 5
    }, ("TURBOPACK compile-time value", void 0)));
CardHeader.displayName = "CardHeader";
const CardTitle = /*#__PURE__*/ __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["forwardRef"](({ className, ...props }, ref)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("h3", {
        ref: ref,
        className: (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["cn"])("text-2xl font-semibold leading-none tracking-tight", className),
        ...props
    }, void 0, false, {
        fileName: "[project]/src/components/ui/card.tsx",
        lineNumber: 19,
        columnNumber: 5
    }, ("TURBOPACK compile-time value", void 0)));
CardTitle.displayName = "CardTitle";
const CardDescription = /*#__PURE__*/ __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["forwardRef"](({ className, ...props }, ref)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
        ref: ref,
        className: (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["cn"])("text-sm text-muted-foreground", className),
        ...props
    }, void 0, false, {
        fileName: "[project]/src/components/ui/card.tsx",
        lineNumber: 26,
        columnNumber: 5
    }, ("TURBOPACK compile-time value", void 0)));
CardDescription.displayName = "CardDescription";
const CardContent = /*#__PURE__*/ __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["forwardRef"](({ className, ...props }, ref)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        ref: ref,
        className: (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["cn"])("p-6 pt-0", className),
        ...props
    }, void 0, false, {
        fileName: "[project]/src/components/ui/card.tsx",
        lineNumber: 32,
        columnNumber: 37
    }, ("TURBOPACK compile-time value", void 0)));
CardContent.displayName = "CardContent";
const CardFooter = /*#__PURE__*/ __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["forwardRef"](({ className, ...props }, ref)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        ref: ref,
        className: (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["cn"])("flex items-center p-6 pt-0", className),
        ...props
    }, void 0, false, {
        fileName: "[project]/src/components/ui/card.tsx",
        lineNumber: 38,
        columnNumber: 5
    }, ("TURBOPACK compile-time value", void 0)));
CardFooter.displayName = "CardFooter";
;
}),
"[project]/app/dashboard/data:ea305d [app-ssr] (ecmascript) <text/javascript>", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "getCustomerLocations",
    ()=>$$RSC_SERVER_ACTION_8
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-ssr] (ecmascript)");
/* __next_internal_action_entry_do_not_use__ [{"6081b7c391ca46ac8c956a5d06a8f5364e25eb8c48":"getCustomerLocations"},"app/dashboard/actions.ts",""] */ "use turbopack no side effects";
;
const $$RSC_SERVER_ACTION_8 = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["createServerReference"])("6081b7c391ca46ac8c956a5d06a8f5364e25eb8c48", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["findSourceMapURL"], "getCustomerLocations");
;
 //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vYWN0aW9ucy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHNlcnZlcic7XHJcblxyXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAL2xpYi9zdXBhYmFzZS9zZXJ2ZXInO1xyXG5pbXBvcnQgeyBCb29raW5nIH0gZnJvbSAnQC90eXBlcy9ib29raW5nJztcclxuaW1wb3J0IHsgUHJvZmlsZSwgUHJvZmlsZVVwZGF0ZUlucHV0IH0gZnJvbSAnQC90eXBlcy9wcm9maWxlJztcclxuaW1wb3J0IHsgTG9jYXRpb24sIExvY2F0aW9uQ3JlYXRlSW5wdXQsIExvY2F0aW9uVXBkYXRlSW5wdXQgfSBmcm9tICdAL3R5cGVzL2xvY2F0aW9uJztcclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBdXRoZW50aWNhdGVkVXNlcigpOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGVtYWlsPzogc3RyaW5nO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcbiAgICBjb25zdCB7IGRhdGE6IHsgdXNlciB9LCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XHJcblxyXG4gICAgaWYgKGVycm9yIHx8ICF1c2VyKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ05vdCBhdXRoZW50aWNhdGVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGVtYWlsOiB1c2VyLmVtYWlsIHx8IHVuZGVmaW5lZCB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBnZXRBdXRoZW50aWNhdGVkVXNlcjonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBnZXQgdXNlcicsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEN1c3RvbWVyQm9va2luZ3MoXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBwaG9uZT86IHN0cmluZyxcclxuICBmaWx0ZXI/OiAnYWxsJyB8ICd1cGNvbWluZycgfCAnY29tcGxldGVkJyB8ICdjYW5jZWxsZWQnXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgYm9va2luZ3M/OiBCb29raW5nW107XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICBsZXQgcXVlcnkgPSBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnYm9va2luZ3MnKVxyXG4gICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgLm9yZGVyKCdzZXJ2aWNlX2RhdGUnLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcclxuICAgICAgLm9yZGVyKCdjcmVhdGVkX2F0JywgeyBhc2NlbmRpbmc6IGZhbHNlIH0pO1xyXG5cclxuICAgIC8vIEJ1aWxkIHF1ZXJ5IGZvciBlbWFpbC9waG9uZSBsb29rdXBcclxuICAgIGlmIChlbWFpbCAmJiBwaG9uZSkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5Lm9yKGBjdXN0b21lcl9lbWFpbC5lcS4ke2VtYWlsfSxjdXN0b21lcl9waG9uZS5lcS4ke3Bob25lfWApO1xyXG4gICAgfSBlbHNlIGlmIChlbWFpbCkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdjdXN0b21lcl9lbWFpbCcsIGVtYWlsKTtcclxuICAgIH0gZWxzZSBpZiAocGhvbmUpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnY3VzdG9tZXJfcGhvbmUnLCBwaG9uZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdFbWFpbCBvciBwaG9uZSBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBBcHBseSBzdGF0dXMgZmlsdGVyXHJcbiAgICBpZiAoZmlsdGVyICYmIGZpbHRlciAhPT0gJ2FsbCcpIHtcclxuICAgICAgaWYgKGZpbHRlciA9PT0gJ3VwY29taW5nJykge1xyXG4gICAgICAgIHF1ZXJ5ID0gcXVlcnkuaW4oJ3N0YXR1cycsIFsncGVuZGluZycsICdjb25maXJtZWQnXSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnc3RhdHVzJywgZmlsdGVyKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHF1ZXJ5O1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBib29raW5nczonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGJvb2tpbmdzOiBkYXRhIHx8IFtdIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGdldEN1c3RvbWVyQm9va2luZ3M6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gZmV0Y2ggYm9va2luZ3MnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDdXN0b21lckJvb2tpbmdTdGF0cyhcclxuICBlbWFpbDogc3RyaW5nLFxyXG4gIHBob25lPzogc3RyaW5nXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgc3RhdHM/OiB7XHJcbiAgICB0b3RhbDogbnVtYmVyO1xyXG4gICAgdXBjb21pbmc6IG51bWJlcjtcclxuICAgIGNvbXBsZXRlZDogbnVtYmVyO1xyXG4gICAgY2FuY2VsbGVkOiBudW1iZXI7XHJcbiAgICB0b3RhbFNwZW50OiBudW1iZXI7XHJcbiAgfTtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIGxldCBxdWVyeSA9IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdib29raW5ncycpXHJcbiAgICAgIC5zZWxlY3QoJ3N0YXR1cywgdG90YWxfYW1vdW50LCBwYXltZW50X3N0YXR1cycpO1xyXG5cclxuICAgIC8vIEJ1aWxkIHF1ZXJ5IGZvciBlbWFpbC9waG9uZSBsb29rdXBcclxuICAgIGlmIChlbWFpbCAmJiBwaG9uZSkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5Lm9yKGBjdXN0b21lcl9lbWFpbC5lcS4ke2VtYWlsfSxjdXN0b21lcl9waG9uZS5lcS4ke3Bob25lfWApO1xyXG4gICAgfSBlbHNlIGlmIChlbWFpbCkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdjdXN0b21lcl9lbWFpbCcsIGVtYWlsKTtcclxuICAgIH0gZWxzZSBpZiAocGhvbmUpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnY3VzdG9tZXJfcGhvbmUnLCBwaG9uZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdFbWFpbCBvciBwaG9uZSBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBxdWVyeTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgc3RhdHMgPSB7XHJcbiAgICAgIHRvdGFsOiBkYXRhPy5sZW5ndGggfHwgMCxcclxuICAgICAgdXBjb21pbmc6IGRhdGE/LmZpbHRlcigoYikgPT4gYi5zdGF0dXMgPT09ICdwZW5kaW5nJyB8fCBiLnN0YXR1cyA9PT0gJ2NvbmZpcm1lZCcpLmxlbmd0aCB8fCAwLFxyXG4gICAgICBjb21wbGV0ZWQ6IGRhdGE/LmZpbHRlcigoYikgPT4gYi5zdGF0dXMgPT09ICdjb21wbGV0ZWQnKS5sZW5ndGggfHwgMCxcclxuICAgICAgY2FuY2VsbGVkOiBkYXRhPy5maWx0ZXIoKGIpID0+IGIuc3RhdHVzID09PSAnY2FuY2VsbGVkJykubGVuZ3RoIHx8IDAsXHJcbiAgICAgIHRvdGFsU3BlbnQ6IGRhdGFcclxuICAgICAgICA/LmZpbHRlcigoYikgPT4gYi5wYXltZW50X3N0YXR1cyA9PT0gJ3BhaWQnKVxyXG4gICAgICAgIC5yZWR1Y2UoKHN1bSwgYikgPT4gc3VtICsgKGIudG90YWxfYW1vdW50IHx8IDApLCAwKSB8fCAwLFxyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBzdGF0cyB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBmZXRjaCBzdGF0cycsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEJvb2tpbmdCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGJvb2tpbmc/OiBCb29raW5nO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2Jvb2tpbmdzJylcclxuICAgICAgLnNlbGVjdCgnKicpXHJcbiAgICAgIC5lcSgnaWQnLCBpZClcclxuICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBib29raW5nOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnQm9va2luZyBub3QgZm91bmQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYm9va2luZzogZGF0YSB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdVbmV4cGVjdGVkIGVycm9yIGZldGNoaW5nIGJvb2tpbmc6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q3VzdG9tZXJQcm9maWxlKFxyXG4gIGVtYWlsOiBzdHJpbmcsXHJcbiAgcGhvbmU/OiBzdHJpbmdcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBwcm9maWxlPzogUHJvZmlsZTtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIEZpcnN0LCB0cnkgdG8gZ2V0IHByb2ZpbGUgZnJvbSBwcm9maWxlcyB0YWJsZVxyXG4gICAgbGV0IHF1ZXJ5ID0gc3VwYWJhc2UuZnJvbSgncHJvZmlsZXMnKS5zZWxlY3QoJyonKTtcclxuXHJcbiAgICBpZiAoZW1haWwpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnZW1haWwnLCBlbWFpbCk7XHJcbiAgICB9IGVsc2UgaWYgKHBob25lKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ3Bob25lJywgcGhvbmUpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRW1haWwgb3IgcGhvbmUgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBkYXRhOiBwcm9maWxlRGF0YSwgZXJyb3I6IHByb2ZpbGVFcnJvciB9ID0gYXdhaXQgcXVlcnkubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgICAvLyBJZiBwcm9maWxlIGV4aXN0cywgcmV0dXJuIGl0XHJcbiAgICBpZiAocHJvZmlsZURhdGEgJiYgIXByb2ZpbGVFcnJvcikge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBwcm9maWxlOiBwcm9maWxlRGF0YSB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIElmIG5vIHByb2ZpbGUgZXhpc3RzLCBkZXJpdmUgZnJvbSBtb3N0IHJlY2VudCBib29raW5nXHJcbiAgICBsZXQgYm9va2luZ1F1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2Jvb2tpbmdzJylcclxuICAgICAgLnNlbGVjdCgnY3VzdG9tZXJfZmlyc3RfbmFtZSwgY3VzdG9tZXJfbGFzdF9uYW1lLCBjdXN0b21lcl9lbWFpbCwgY3VzdG9tZXJfcGhvbmUnKVxyXG4gICAgICAub3JkZXIoJ2NyZWF0ZWRfYXQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcclxuICAgICAgLmxpbWl0KDEpO1xyXG5cclxuICAgIGlmIChlbWFpbCAmJiBwaG9uZSkge1xyXG4gICAgICBib29raW5nUXVlcnkgPSBib29raW5nUXVlcnkub3IoYGN1c3RvbWVyX2VtYWlsLmVxLiR7ZW1haWx9LGN1c3RvbWVyX3Bob25lLmVxLiR7cGhvbmV9YCk7XHJcbiAgICB9IGVsc2UgaWYgKGVtYWlsKSB7XHJcbiAgICAgIGJvb2tpbmdRdWVyeSA9IGJvb2tpbmdRdWVyeS5lcSgnY3VzdG9tZXJfZW1haWwnLCBlbWFpbCk7XHJcbiAgICB9IGVsc2UgaWYgKHBob25lKSB7XHJcbiAgICAgIGJvb2tpbmdRdWVyeSA9IGJvb2tpbmdRdWVyeS5lcSgnY3VzdG9tZXJfcGhvbmUnLCBwaG9uZSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBkYXRhOiBib29raW5nRGF0YSwgZXJyb3I6IGJvb2tpbmdFcnJvciB9ID0gYXdhaXQgYm9va2luZ1F1ZXJ5Lm1heWJlU2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKGJvb2tpbmdFcnJvciB8fCAhYm9va2luZ0RhdGEpIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogJ05vIHByb2ZpbGUgb3IgYm9va2luZyBmb3VuZC4gUGxlYXNlIGNyZWF0ZSBhIGJvb2tpbmcgZmlyc3QuJyxcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDcmVhdGUgYSBwcm9maWxlIG9iamVjdCBmcm9tIGJvb2tpbmcgZGF0YVxyXG4gICAgY29uc3QgZGVyaXZlZFByb2ZpbGU6IFByb2ZpbGUgPSB7XHJcbiAgICAgIGlkOiAnJywgLy8gV2lsbCBiZSBnZW5lcmF0ZWQgd2hlbiBzYXZlZFxyXG4gICAgICBlbWFpbDogYm9va2luZ0RhdGEuY3VzdG9tZXJfZW1haWwsXHJcbiAgICAgIHBob25lOiBib29raW5nRGF0YS5jdXN0b21lcl9waG9uZSB8fCBudWxsLFxyXG4gICAgICBmaXJzdF9uYW1lOiBib29raW5nRGF0YS5jdXN0b21lcl9maXJzdF9uYW1lLFxyXG4gICAgICBsYXN0X25hbWU6IGJvb2tpbmdEYXRhLmN1c3RvbWVyX2xhc3RfbmFtZSxcclxuICAgICAgY3JlYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHByb2ZpbGU6IGRlcml2ZWRQcm9maWxlIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGdldEN1c3RvbWVyUHJvZmlsZTonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBmZXRjaCBwcm9maWxlJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBsb2FkUHJvZmlsZVBpY3R1cmUoXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBmaWxlOiBGaWxlXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgdXJsPzogc3RyaW5nO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgLy8gVmFsaWRhdGUgZmlsZVxyXG4gICAgaWYgKCFmaWxlKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ05vIGZpbGUgcHJvdmlkZWQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVmFsaWRhdGUgZmlsZSB0eXBlXHJcbiAgICBjb25zdCB2YWxpZEltYWdlVHlwZXMgPSBbJ2ltYWdlL2pwZWcnLCAnaW1hZ2UvanBnJywgJ2ltYWdlL3BuZycsICdpbWFnZS93ZWJwJ107XHJcbiAgICBpZiAoIXZhbGlkSW1hZ2VUeXBlcy5pbmNsdWRlcyhmaWxlLnR5cGUpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ludmFsaWQgZmlsZSB0eXBlLiBQbGVhc2UgdXBsb2FkIGEgSlBFRywgUE5HLCBvciBXZWJQIGltYWdlLicgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBWYWxpZGF0ZSBmaWxlIHNpemUgKG1heCA1TUIpXHJcbiAgICBjb25zdCBtYXhTaXplID0gNSAqIDEwMjQgKiAxMDI0OyAvLyA1TUIgaW4gYnl0ZXNcclxuICAgIGlmIChmaWxlLnNpemUgPiBtYXhTaXplKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ZpbGUgc2l6ZSB0b28gbGFyZ2UuIFBsZWFzZSB1cGxvYWQgYW4gaW1hZ2Ugc21hbGxlciB0aGFuIDVNQi4nIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gR2VuZXJhdGUgdW5pcXVlIGZpbGVuYW1lIHVzaW5nIGVtYWlsIGFuZCB0aW1lc3RhbXBcclxuICAgIGNvbnN0IGZpbGVFeHQgPSBmaWxlLm5hbWUuc3BsaXQoJy4nKS5wb3AoKTtcclxuICAgIGNvbnN0IGZpbGVOYW1lID0gYCR7ZW1haWwucmVwbGFjZSgvW15hLXpBLVowLTldL2csICdfJyl9XyR7RGF0ZS5ub3coKX0uJHtmaWxlRXh0fWA7XHJcbiAgICBjb25zdCBmaWxlUGF0aCA9IGBhdmF0YXJzLyR7ZmlsZU5hbWV9YDtcclxuXHJcbiAgICAvLyBDb252ZXJ0IEZpbGUgdG8gQXJyYXlCdWZmZXIgZm9yIHVwbG9hZFxyXG4gICAgY29uc3QgYXJyYXlCdWZmZXIgPSBhd2FpdCBmaWxlLmFycmF5QnVmZmVyKCk7XHJcbiAgICBjb25zdCBidWZmZXIgPSBCdWZmZXIuZnJvbShhcnJheUJ1ZmZlcik7XHJcblxyXG4gICAgLy8gVXBsb2FkIHRvIFN1cGFiYXNlIFN0b3JhZ2VcclxuICAgIGNvbnN0IHsgZGF0YTogdXBsb2FkRGF0YSwgZXJyb3I6IHVwbG9hZEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5zdG9yYWdlXHJcbiAgICAgIC5mcm9tKCdwcm9maWxlLXBpY3R1cmVzJylcclxuICAgICAgLnVwbG9hZChmaWxlUGF0aCwgYnVmZmVyLCB7XHJcbiAgICAgICAgY29udGVudFR5cGU6IGZpbGUudHlwZSxcclxuICAgICAgICB1cHNlcnQ6IGZhbHNlLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICBpZiAodXBsb2FkRXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBsb2FkaW5nIGZpbGU6JywgdXBsb2FkRXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHVwbG9hZEVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBHZXQgcHVibGljIFVSTFxyXG4gICAgY29uc3QgeyBkYXRhOiB1cmxEYXRhIH0gPSBzdXBhYmFzZS5zdG9yYWdlXHJcbiAgICAgIC5mcm9tKCdwcm9maWxlLXBpY3R1cmVzJylcclxuICAgICAgLmdldFB1YmxpY1VybChmaWxlUGF0aCk7XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdXJsOiB1cmxEYXRhLnB1YmxpY1VybCB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiB1cGxvYWRQcm9maWxlUGljdHVyZTonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byB1cGxvYWQgcHJvZmlsZSBwaWN0dXJlJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZGVsZXRlUHJvZmlsZVBpY3R1cmUoZW1haWw6IHN0cmluZywgYXZhdGFyVXJsOiBzdHJpbmcpOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgLy8gRXh0cmFjdCBmaWxlIHBhdGggZnJvbSBVUkxcclxuICAgIGNvbnN0IHVybFBhcnRzID0gYXZhdGFyVXJsLnNwbGl0KCcvcHJvZmlsZS1waWN0dXJlcy8nKTtcclxuICAgIGlmICh1cmxQYXJ0cy5sZW5ndGggPCAyKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ludmFsaWQgYXZhdGFyIFVSTCcgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBmaWxlUGF0aCA9IGBhdmF0YXJzLyR7dXJsUGFydHNbMV0uc3BsaXQoJy8nKS5wb3AoKX1gO1xyXG5cclxuICAgIC8vIERlbGV0ZSBmcm9tIHN0b3JhZ2VcclxuICAgIGNvbnN0IHsgZXJyb3I6IGRlbGV0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5zdG9yYWdlXHJcbiAgICAgIC5mcm9tKCdwcm9maWxlLXBpY3R1cmVzJylcclxuICAgICAgLnJlbW92ZShbZmlsZVBhdGhdKTtcclxuXHJcbiAgICBpZiAoZGVsZXRlRXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZGVsZXRpbmcgZmlsZTonLCBkZWxldGVFcnJvcik7XHJcbiAgICAgIC8vIERvbid0IGZhaWwgaWYgZmlsZSBkb2Vzbid0IGV4aXN0XHJcbiAgICAgIGlmIChkZWxldGVFcnJvci5tZXNzYWdlLmluY2x1ZGVzKCdub3QgZm91bmQnKSkge1xyXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGRlbGV0ZUVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGRlbGV0ZVByb2ZpbGVQaWN0dXJlOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGRlbGV0ZSBwcm9maWxlIHBpY3R1cmUnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGRhdGVDdXN0b21lclByb2ZpbGUoXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBkYXRhOiBQcm9maWxlVXBkYXRlSW5wdXRcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBwcm9maWxlPzogUHJvZmlsZTtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIFZhbGlkYXRlIGlucHV0XHJcbiAgICBpZiAoIWRhdGEuZmlyc3RfbmFtZT8udHJpbSgpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ZpcnN0IG5hbWUgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcbiAgICBpZiAoIWRhdGEubGFzdF9uYW1lPy50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTGFzdCBuYW1lIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG4gICAgaWYgKCFkYXRhLmVtYWlsPy50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRW1haWwgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcbiAgICBpZiAoIS9eW15cXHNAXStAW15cXHNAXStcXC5bXlxcc0BdKyQvLnRlc3QoZGF0YS5lbWFpbCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnSW52YWxpZCBlbWFpbCBmb3JtYXQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ2hlY2sgaWYgcHJvZmlsZSBleGlzdHNcclxuICAgIGNvbnN0IHsgZGF0YTogZXhpc3RpbmdQcm9maWxlIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgLmVxKCdlbWFpbCcsIGVtYWlsKVxyXG4gICAgICAubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgICAvLyBJZiBhdmF0YXJfdXJsIGlzIGJlaW5nIHJlbW92ZWQsIGRlbGV0ZSB0aGUgb2xkIGZpbGVcclxuICAgIGlmIChleGlzdGluZ1Byb2ZpbGU/LmF2YXRhcl91cmwgJiYgZGF0YS5hdmF0YXJfdXJsID09PSBudWxsKSB7XHJcbiAgICAgIGF3YWl0IGRlbGV0ZVByb2ZpbGVQaWN0dXJlKGVtYWlsLCBleGlzdGluZ1Byb2ZpbGUuYXZhdGFyX3VybCk7XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IHJlc3VsdDtcclxuICAgIGlmIChleGlzdGluZ1Byb2ZpbGUpIHtcclxuICAgICAgLy8gVXBkYXRlIGV4aXN0aW5nIHByb2ZpbGVcclxuICAgICAgLy8gSWYgZW1haWwgY2hhbmdlZCwgd2UgbmVlZCB0byBoYW5kbGUgaXQgY2FyZWZ1bGx5XHJcbiAgICAgIGlmIChkYXRhLmVtYWlsICE9PSBlbWFpbCkge1xyXG4gICAgICAgIC8vIENoZWNrIGlmIG5ldyBlbWFpbCBhbHJlYWR5IGV4aXN0c1xyXG4gICAgICAgIGNvbnN0IHsgZGF0YTogZW1haWxDaGVjayB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgICAgICAuc2VsZWN0KCdpZCcpXHJcbiAgICAgICAgICAuZXEoJ2VtYWlsJywgZGF0YS5lbWFpbClcclxuICAgICAgICAgIC5tYXliZVNpbmdsZSgpO1xyXG5cclxuICAgICAgICBpZiAoZW1haWxDaGVjaykge1xyXG4gICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRW1haWwgYWxyZWFkeSBleGlzdHMnIH07XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCB1cGRhdGVEYXRhOiBhbnkgPSB7XHJcbiAgICAgICAgZmlyc3RfbmFtZTogZGF0YS5maXJzdF9uYW1lLnRyaW0oKSxcclxuICAgICAgICBsYXN0X25hbWU6IGRhdGEubGFzdF9uYW1lLnRyaW0oKSxcclxuICAgICAgICBlbWFpbDogZGF0YS5lbWFpbC50cmltKCksXHJcbiAgICAgICAgcGhvbmU6IGRhdGEucGhvbmU/LnRyaW0oKSB8fCBudWxsLFxyXG4gICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8vIE9ubHkgdXBkYXRlIGF2YXRhcl91cmwgaWYgaXQncyBwcm92aWRlZFxyXG4gICAgICBpZiAoZGF0YS5hdmF0YXJfdXJsICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICB1cGRhdGVEYXRhLmF2YXRhcl91cmwgPSBkYXRhLmF2YXRhcl91cmw7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IHsgZGF0YTogdXBkYXRlZFByb2ZpbGUsIGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgIC51cGRhdGUodXBkYXRlRGF0YSlcclxuICAgICAgICAuZXEoJ2VtYWlsJywgZW1haWwpXHJcbiAgICAgICAgLnNlbGVjdCgpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgaWYgKHVwZGF0ZUVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBkYXRpbmcgcHJvZmlsZTonLCB1cGRhdGVFcnJvcik7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB1cGRhdGVFcnJvci5tZXNzYWdlIH07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJlc3VsdCA9IHVwZGF0ZWRQcm9maWxlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8gQ3JlYXRlIG5ldyBwcm9maWxlXHJcbiAgICAgIGNvbnN0IGluc2VydERhdGE6IGFueSA9IHtcclxuICAgICAgICBlbWFpbDogZGF0YS5lbWFpbC50cmltKCksXHJcbiAgICAgICAgcGhvbmU6IGRhdGEucGhvbmU/LnRyaW0oKSB8fCBudWxsLFxyXG4gICAgICAgIGZpcnN0X25hbWU6IGRhdGEuZmlyc3RfbmFtZS50cmltKCksXHJcbiAgICAgICAgbGFzdF9uYW1lOiBkYXRhLmxhc3RfbmFtZS50cmltKCksXHJcbiAgICAgIH07XHJcblxyXG4gICAgICAvLyBPbmx5IHNldCBhdmF0YXJfdXJsIGlmIGl0J3MgcHJvdmlkZWRcclxuICAgICAgaWYgKGRhdGEuYXZhdGFyX3VybCkge1xyXG4gICAgICAgIGluc2VydERhdGEuYXZhdGFyX3VybCA9IGRhdGEuYXZhdGFyX3VybDtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgeyBkYXRhOiBuZXdQcm9maWxlLCBlcnJvcjogaW5zZXJ0RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcclxuICAgICAgICAuaW5zZXJ0KGluc2VydERhdGEpXHJcbiAgICAgICAgLnNlbGVjdCgpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgaWYgKGluc2VydEVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYXRpbmcgcHJvZmlsZTonLCBpbnNlcnRFcnJvcik7XHJcbiAgICAgICAgLy8gQ2hlY2sgaWYgaXQncyBhIHVuaXF1ZSBjb25zdHJhaW50IHZpb2xhdGlvblxyXG4gICAgICAgIGlmIChpbnNlcnRFcnJvci5jb2RlID09PSAnMjM1MDUnKSB7XHJcbiAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdFbWFpbCBhbHJlYWR5IGV4aXN0cycgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBpbnNlcnRFcnJvci5tZXNzYWdlIH07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJlc3VsdCA9IG5ld1Byb2ZpbGU7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcHJvZmlsZTogcmVzdWx0IH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHVwZGF0ZUN1c3RvbWVyUHJvZmlsZTonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byB1cGRhdGUgcHJvZmlsZScsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEN1c3RvbWVyTG9jYXRpb25zKFxyXG4gIGVtYWlsOiBzdHJpbmcsXHJcbiAgcGhvbmU/OiBzdHJpbmdcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBsb2NhdGlvbnM/OiBMb2NhdGlvbltdO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgbGV0IHF1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2xvY2F0aW9ucycpXHJcbiAgICAgIC5zZWxlY3QoJyonKVxyXG4gICAgICAub3JkZXIoJ2lzX2RlZmF1bHQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcclxuICAgICAgLm9yZGVyKCdjcmVhdGVkX2F0JywgeyBhc2NlbmRpbmc6IGZhbHNlIH0pO1xyXG5cclxuICAgIC8vIEJ1aWxkIHF1ZXJ5IGZvciBlbWFpbC9waG9uZSBsb29rdXBcclxuICAgIGlmIChlbWFpbCAmJiBwaG9uZSkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5Lm9yKGBjdXN0b21lcl9lbWFpbC5lcS4ke2VtYWlsfSxjdXN0b21lcl9waG9uZS5lcS4ke3Bob25lfWApO1xyXG4gICAgfSBlbHNlIGlmIChlbWFpbCkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdjdXN0b21lcl9lbWFpbCcsIGVtYWlsKTtcclxuICAgIH0gZWxzZSBpZiAocGhvbmUpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnY3VzdG9tZXJfcGhvbmUnLCBwaG9uZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdFbWFpbCBvciBwaG9uZSBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBxdWVyeTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgbG9jYXRpb25zOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgbG9jYXRpb25zOiBkYXRhIHx8IFtdIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGdldEN1c3RvbWVyTG9jYXRpb25zOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGZldGNoIGxvY2F0aW9ucycsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUxvY2F0aW9uKFxyXG4gIGVtYWlsOiBzdHJpbmcsXHJcbiAgcGhvbmU6IHN0cmluZyB8IHVuZGVmaW5lZCxcclxuICBsb2NhdGlvbkRhdGE6IExvY2F0aW9uQ3JlYXRlSW5wdXRcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBsb2NhdGlvbj86IExvY2F0aW9uO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgLy8gVmFsaWRhdGUgaW5wdXRcclxuICAgIGlmICghbG9jYXRpb25EYXRhLm5pY2tuYW1lPy50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTmlja25hbWUgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcbiAgICBpZiAoIWxvY2F0aW9uRGF0YS5hZGRyZXNzPy50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnQWRkcmVzcyBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuICAgIGlmICghbG9jYXRpb25EYXRhLnN1YnVyYj8udHJpbSgpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ1N1YnVyYiBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuICAgIGlmICghbG9jYXRpb25EYXRhLmNpdHk/LnRyaW0oKSkge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdDaXR5IGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIElmIHNldHRpbmcgYXMgZGVmYXVsdCwgdW5zZXQgYWxsIG90aGVyIGRlZmF1bHRzIGZvciB0aGlzIGN1c3RvbWVyXHJcbiAgICBpZiAobG9jYXRpb25EYXRhLmlzX2RlZmF1bHQpIHtcclxuICAgICAgbGV0IHVwZGF0ZVF1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgnbG9jYXRpb25zJylcclxuICAgICAgICAudXBkYXRlKHsgaXNfZGVmYXVsdDogZmFsc2UgfSk7XHJcblxyXG4gICAgICBpZiAoZW1haWwgJiYgcGhvbmUpIHtcclxuICAgICAgICB1cGRhdGVRdWVyeSA9IHVwZGF0ZVF1ZXJ5Lm9yKGBjdXN0b21lcl9lbWFpbC5lcS4ke2VtYWlsfSxjdXN0b21lcl9waG9uZS5lcS4ke3Bob25lfWApO1xyXG4gICAgICB9IGVsc2UgaWYgKGVtYWlsKSB7XHJcbiAgICAgICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5lcSgnY3VzdG9tZXJfZW1haWwnLCBlbWFpbCk7XHJcbiAgICAgIH0gZWxzZSBpZiAocGhvbmUpIHtcclxuICAgICAgICB1cGRhdGVRdWVyeSA9IHVwZGF0ZVF1ZXJ5LmVxKCdjdXN0b21lcl9waG9uZScsIHBob25lKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgYXdhaXQgdXBkYXRlUXVlcnk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBkYXRhOiBuZXdMb2NhdGlvbiwgZXJyb3I6IGluc2VydEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnbG9jYXRpb25zJylcclxuICAgICAgLmluc2VydCh7XHJcbiAgICAgICAgY3VzdG9tZXJfZW1haWw6IGVtYWlsLFxyXG4gICAgICAgIGN1c3RvbWVyX3Bob25lOiBwaG9uZSB8fCBudWxsLFxyXG4gICAgICAgIG5pY2tuYW1lOiBsb2NhdGlvbkRhdGEubmlja25hbWUudHJpbSgpLFxyXG4gICAgICAgIGFkZHJlc3M6IGxvY2F0aW9uRGF0YS5hZGRyZXNzLnRyaW0oKSxcclxuICAgICAgICBhcHRfdW5pdDogbG9jYXRpb25EYXRhLmFwdF91bml0Py50cmltKCkgfHwgbnVsbCxcclxuICAgICAgICBzdWJ1cmI6IGxvY2F0aW9uRGF0YS5zdWJ1cmIudHJpbSgpLFxyXG4gICAgICAgIGNpdHk6IGxvY2F0aW9uRGF0YS5jaXR5LnRyaW0oKSxcclxuICAgICAgICBwb3N0YWxfY29kZTogbG9jYXRpb25EYXRhLnBvc3RhbF9jb2RlPy50cmltKCkgfHwgbnVsbCxcclxuICAgICAgICBpc19kZWZhdWx0OiBsb2NhdGlvbkRhdGEuaXNfZGVmYXVsdCB8fCBmYWxzZSxcclxuICAgICAgfSlcclxuICAgICAgLnNlbGVjdCgpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoaW5zZXJ0RXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYXRpbmcgbG9jYXRpb246JywgaW5zZXJ0RXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGluc2VydEVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBsb2NhdGlvbjogbmV3TG9jYXRpb24gfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gY3JlYXRlTG9jYXRpb246JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gY3JlYXRlIGxvY2F0aW9uJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlTG9jYXRpb24oXHJcbiAgbG9jYXRpb25JZDogc3RyaW5nLFxyXG4gIGxvY2F0aW9uRGF0YTogTG9jYXRpb25VcGRhdGVJbnB1dFxyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGxvY2F0aW9uPzogTG9jYXRpb247XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICAvLyBWYWxpZGF0ZSBpbnB1dCBpZiBwcm92aWRlZFxyXG4gICAgaWYgKGxvY2F0aW9uRGF0YS5uaWNrbmFtZSAhPT0gdW5kZWZpbmVkICYmICFsb2NhdGlvbkRhdGEubmlja25hbWUudHJpbSgpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ05pY2tuYW1lIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG4gICAgaWYgKGxvY2F0aW9uRGF0YS5hZGRyZXNzICE9PSB1bmRlZmluZWQgJiYgIWxvY2F0aW9uRGF0YS5hZGRyZXNzLnRyaW0oKSkge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdBZGRyZXNzIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG4gICAgaWYgKGxvY2F0aW9uRGF0YS5zdWJ1cmIgIT09IHVuZGVmaW5lZCAmJiAhbG9jYXRpb25EYXRhLnN1YnVyYi50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnU3VidXJiIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG4gICAgaWYgKGxvY2F0aW9uRGF0YS5jaXR5ICE9PSB1bmRlZmluZWQgJiYgIWxvY2F0aW9uRGF0YS5jaXR5LnRyaW0oKSkge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdDaXR5IGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEdldCBjdXJyZW50IGxvY2F0aW9uIHRvIGNoZWNrIGN1c3RvbWVyIGVtYWlsXHJcbiAgICBjb25zdCB7IGRhdGE6IGN1cnJlbnRMb2NhdGlvbiwgZXJyb3I6IGZldGNoRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdsb2NhdGlvbnMnKVxyXG4gICAgICAuc2VsZWN0KCdjdXN0b21lcl9lbWFpbCwgY3VzdG9tZXJfcGhvbmUnKVxyXG4gICAgICAuZXEoJ2lkJywgbG9jYXRpb25JZClcclxuICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgIGlmIChmZXRjaEVycm9yIHx8ICFjdXJyZW50TG9jYXRpb24pIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTG9jYXRpb24gbm90IGZvdW5kJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIElmIHNldHRpbmcgYXMgZGVmYXVsdCwgdW5zZXQgYWxsIG90aGVyIGRlZmF1bHRzIGZvciB0aGlzIGN1c3RvbWVyXHJcbiAgICBpZiAobG9jYXRpb25EYXRhLmlzX2RlZmF1bHQpIHtcclxuICAgICAgbGV0IHVwZGF0ZVF1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgnbG9jYXRpb25zJylcclxuICAgICAgICAudXBkYXRlKHsgaXNfZGVmYXVsdDogZmFsc2UgfSk7XHJcblxyXG4gICAgICBpZiAoY3VycmVudExvY2F0aW9uLmN1c3RvbWVyX2VtYWlsICYmIGN1cnJlbnRMb2NhdGlvbi5jdXN0b21lcl9waG9uZSkge1xyXG4gICAgICAgIHVwZGF0ZVF1ZXJ5ID0gdXBkYXRlUXVlcnkub3IoYGN1c3RvbWVyX2VtYWlsLmVxLiR7Y3VycmVudExvY2F0aW9uLmN1c3RvbWVyX2VtYWlsfSxjdXN0b21lcl9waG9uZS5lcS4ke2N1cnJlbnRMb2NhdGlvbi5jdXN0b21lcl9waG9uZX1gKTtcclxuICAgICAgfSBlbHNlIGlmIChjdXJyZW50TG9jYXRpb24uY3VzdG9tZXJfZW1haWwpIHtcclxuICAgICAgICB1cGRhdGVRdWVyeSA9IHVwZGF0ZVF1ZXJ5LmVxKCdjdXN0b21lcl9lbWFpbCcsIGN1cnJlbnRMb2NhdGlvbi5jdXN0b21lcl9lbWFpbCk7XHJcbiAgICAgIH0gZWxzZSBpZiAoY3VycmVudExvY2F0aW9uLmN1c3RvbWVyX3Bob25lKSB7XHJcbiAgICAgICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5lcSgnY3VzdG9tZXJfcGhvbmUnLCBjdXJyZW50TG9jYXRpb24uY3VzdG9tZXJfcGhvbmUpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBEb24ndCB1bnNldCB0aGUgY3VycmVudCBsb2NhdGlvblxyXG4gICAgICB1cGRhdGVRdWVyeSA9IHVwZGF0ZVF1ZXJ5Lm5lcSgnaWQnLCBsb2NhdGlvbklkKTtcclxuXHJcbiAgICAgIGF3YWl0IHVwZGF0ZVF1ZXJ5O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEJ1aWxkIHVwZGF0ZSBvYmplY3Qgd2l0aCBvbmx5IHByb3ZpZGVkIGZpZWxkc1xyXG4gICAgY29uc3QgdXBkYXRlRGF0YTogYW55ID0ge1xyXG4gICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICB9O1xyXG5cclxuICAgIGlmIChsb2NhdGlvbkRhdGEubmlja25hbWUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB1cGRhdGVEYXRhLm5pY2tuYW1lID0gbG9jYXRpb25EYXRhLm5pY2tuYW1lLnRyaW0oKTtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuYWRkcmVzcyAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHVwZGF0ZURhdGEuYWRkcmVzcyA9IGxvY2F0aW9uRGF0YS5hZGRyZXNzLnRyaW0oKTtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuYXB0X3VuaXQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB1cGRhdGVEYXRhLmFwdF91bml0ID0gbG9jYXRpb25EYXRhLmFwdF91bml0Py50cmltKCkgfHwgbnVsbDtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuc3VidXJiICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgdXBkYXRlRGF0YS5zdWJ1cmIgPSBsb2NhdGlvbkRhdGEuc3VidXJiLnRyaW0oKTtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuY2l0eSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHVwZGF0ZURhdGEuY2l0eSA9IGxvY2F0aW9uRGF0YS5jaXR5LnRyaW0oKTtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEucG9zdGFsX2NvZGUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB1cGRhdGVEYXRhLnBvc3RhbF9jb2RlID0gbG9jYXRpb25EYXRhLnBvc3RhbF9jb2RlPy50cmltKCkgfHwgbnVsbDtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuaXNfZGVmYXVsdCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHVwZGF0ZURhdGEuaXNfZGVmYXVsdCA9IGxvY2F0aW9uRGF0YS5pc19kZWZhdWx0O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgZGF0YTogdXBkYXRlZExvY2F0aW9uLCBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdsb2NhdGlvbnMnKVxyXG4gICAgICAudXBkYXRlKHVwZGF0ZURhdGEpXHJcbiAgICAgIC5lcSgnaWQnLCBsb2NhdGlvbklkKVxyXG4gICAgICAuc2VsZWN0KClcclxuICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgIGlmICh1cGRhdGVFcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciB1cGRhdGluZyBsb2NhdGlvbjonLCB1cGRhdGVFcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogdXBkYXRlRXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGxvY2F0aW9uOiB1cGRhdGVkTG9jYXRpb24gfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gdXBkYXRlTG9jYXRpb246JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gdXBkYXRlIGxvY2F0aW9uJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZGVsZXRlTG9jYXRpb24obG9jYXRpb25JZDogc3RyaW5nKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdsb2NhdGlvbnMnKVxyXG4gICAgICAuZGVsZXRlKClcclxuICAgICAgLmVxKCdpZCcsIGxvY2F0aW9uSWQpO1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBkZWxldGluZyBsb2NhdGlvbjonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gZGVsZXRlTG9jYXRpb246JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gZGVsZXRlIGxvY2F0aW9uJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2V0RGVmYXVsdExvY2F0aW9uKFxyXG4gIGxvY2F0aW9uSWQ6IHN0cmluZyxcclxuICBlbWFpbDogc3RyaW5nLFxyXG4gIHBob25lPzogc3RyaW5nXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgbG9jYXRpb24/OiBMb2NhdGlvbjtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIEdldCBjdXJyZW50IGxvY2F0aW9uIHRvIHZlcmlmeSBvd25lcnNoaXBcclxuICAgIGNvbnN0IHsgZGF0YTogY3VycmVudExvY2F0aW9uLCBlcnJvcjogZmV0Y2hFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2xvY2F0aW9ucycpXHJcbiAgICAgIC5zZWxlY3QoJ2N1c3RvbWVyX2VtYWlsLCBjdXN0b21lcl9waG9uZScpXHJcbiAgICAgIC5lcSgnaWQnLCBsb2NhdGlvbklkKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKGZldGNoRXJyb3IgfHwgIWN1cnJlbnRMb2NhdGlvbikge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdMb2NhdGlvbiBub3QgZm91bmQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVmVyaWZ5IG93bmVyc2hpcFxyXG4gICAgY29uc3QgaXNPd25lciA9IFxyXG4gICAgICBjdXJyZW50TG9jYXRpb24uY3VzdG9tZXJfZW1haWwgPT09IGVtYWlsIHx8XHJcbiAgICAgIChwaG9uZSAmJiBjdXJyZW50TG9jYXRpb24uY3VzdG9tZXJfcGhvbmUgPT09IHBob25lKTtcclxuXHJcbiAgICBpZiAoIWlzT3duZXIpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnVW5hdXRob3JpemVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFVuc2V0IGFsbCBvdGhlciBkZWZhdWx0cyBmb3IgdGhpcyBjdXN0b21lclxyXG4gICAgbGV0IHVwZGF0ZVF1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2xvY2F0aW9ucycpXHJcbiAgICAgIC51cGRhdGUoeyBpc19kZWZhdWx0OiBmYWxzZSB9KTtcclxuXHJcbiAgICBpZiAoZW1haWwgJiYgcGhvbmUpIHtcclxuICAgICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5vcihgY3VzdG9tZXJfZW1haWwuZXEuJHtlbWFpbH0sY3VzdG9tZXJfcGhvbmUuZXEuJHtwaG9uZX1gKTtcclxuICAgIH0gZWxzZSBpZiAoZW1haWwpIHtcclxuICAgICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5lcSgnY3VzdG9tZXJfZW1haWwnLCBlbWFpbCk7XHJcbiAgICB9IGVsc2UgaWYgKHBob25lKSB7XHJcbiAgICAgIHVwZGF0ZVF1ZXJ5ID0gdXBkYXRlUXVlcnkuZXEoJ2N1c3RvbWVyX3Bob25lJywgcGhvbmUpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIERvbid0IHVuc2V0IHRoZSBjdXJyZW50IGxvY2F0aW9uXHJcbiAgICB1cGRhdGVRdWVyeSA9IHVwZGF0ZVF1ZXJ5Lm5lcSgnaWQnLCBsb2NhdGlvbklkKTtcclxuXHJcbiAgICBhd2FpdCB1cGRhdGVRdWVyeTtcclxuXHJcbiAgICAvLyBTZXQgdGhpcyBsb2NhdGlvbiBhcyBkZWZhdWx0XHJcbiAgICBjb25zdCB7IGRhdGE6IHVwZGF0ZWRMb2NhdGlvbiwgZXJyb3I6IHVwZGF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnbG9jYXRpb25zJylcclxuICAgICAgLnVwZGF0ZSh7IGlzX2RlZmF1bHQ6IHRydWUgfSlcclxuICAgICAgLmVxKCdpZCcsIGxvY2F0aW9uSWQpXHJcbiAgICAgIC5zZWxlY3QoKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKHVwZGF0ZUVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHNldHRpbmcgZGVmYXVsdCBsb2NhdGlvbjonLCB1cGRhdGVFcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogdXBkYXRlRXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGxvY2F0aW9uOiB1cGRhdGVkTG9jYXRpb24gfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gc2V0RGVmYXVsdExvY2F0aW9uOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIHNldCBkZWZhdWx0IGxvY2F0aW9uJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0T3JDcmVhdGVSZWZlcnJhbENvZGUoXHJcbiAgZW1haWw6IHN0cmluZ1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIHJlZmVycmFsQ29kZT86IHN0cmluZztcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIENoZWNrIGlmIHByb2ZpbGUgZXhpc3RzIGFuZCBoYXMgYSByZWZlcnJhbCBjb2RlXHJcbiAgICBjb25zdCB7IGRhdGE6IHByb2ZpbGUsIGVycm9yOiBwcm9maWxlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgIC5zZWxlY3QoJ3JlZmVycmFsX2NvZGUnKVxyXG4gICAgICAuZXEoJ2VtYWlsJywgZW1haWwpXHJcbiAgICAgIC5tYXliZVNpbmdsZSgpO1xyXG5cclxuICAgIGlmIChwcm9maWxlRXJyb3IgJiYgcHJvZmlsZUVycm9yLmNvZGUgIT09ICdQR1JTVDExNicpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgcHJvZmlsZTonLCBwcm9maWxlRXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHByb2ZpbGVFcnJvci5tZXNzYWdlIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gSWYgcHJvZmlsZSBleGlzdHMgYW5kIGhhcyBhIHJlZmVycmFsIGNvZGUsIHJldHVybiBpdFxyXG4gICAgaWYgKHByb2ZpbGU/LnJlZmVycmFsX2NvZGUpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcmVmZXJyYWxDb2RlOiBwcm9maWxlLnJlZmVycmFsX2NvZGUgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBHZW5lcmF0ZSBhIG5ldyByZWZlcnJhbCBjb2RlXHJcbiAgICAvLyBUcnkgdXNpbmcgdGhlIGRhdGFiYXNlIGZ1bmN0aW9uIGZpcnN0LCBidXQgZmFsbGJhY2sgdG8gY2xpZW50LXNpZGUgZ2VuZXJhdGlvblxyXG4gICAgbGV0IGdlbmVyYXRlZENvZGU6IHN0cmluZyB8IG51bGwgPSBudWxsO1xyXG4gICAgXHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB7IGRhdGE6IGRiQ29kZSwgZXJyb3I6IGNvZGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAucnBjKCdnZW5lcmF0ZV9yZWZlcnJhbF9jb2RlJyk7XHJcbiAgICAgIFxyXG4gICAgICBpZiAoIWNvZGVFcnJvciAmJiBkYkNvZGUpIHtcclxuICAgICAgICBnZW5lcmF0ZWRDb2RlID0gZGJDb2RlO1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChycGNFcnJvcikge1xyXG4gICAgICAvLyBSUEMgZnVuY3Rpb24gbWlnaHQgbm90IGV4aXN0IHlldCwgdGhhdCdzIG9rYXlcclxuICAgICAgY29uc29sZS5sb2coJ1JQQyBmdW5jdGlvbiBub3QgYXZhaWxhYmxlLCB1c2luZyBmYWxsYmFjaycpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghZ2VuZXJhdGVkQ29kZSkge1xyXG4gICAgICAvLyBGYWxsYmFjazogZ2VuZXJhdGUgY29kZSBjbGllbnQtc2lkZSBzdHlsZVxyXG4gICAgICBjb25zdCBmYWxsYmFja0NvZGUgPSBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoMiwgOCkudG9VcHBlckNhc2UoKTtcclxuICAgICAgXHJcbiAgICAgIC8vIENoZWNrIGlmIGZhbGxiYWNrIGNvZGUgZXhpc3RzLCByZXRyeSBpZiBpdCBkb2VzXHJcbiAgICAgIGxldCBmaW5hbENvZGUgPSBmYWxsYmFja0NvZGU7XHJcbiAgICAgIGxldCBhdHRlbXB0cyA9IDA7XHJcbiAgICAgIGNvbnN0IG1heEF0dGVtcHRzID0gNTtcclxuXHJcbiAgICAgIHdoaWxlIChhdHRlbXB0cyA8IG1heEF0dGVtcHRzKSB7XHJcbiAgICAgICAgY29uc3QgeyBkYXRhOiBleGlzdGluZyB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgICAgICAuc2VsZWN0KCdpZCcpXHJcbiAgICAgICAgICAuZXEoJ3JlZmVycmFsX2NvZGUnLCBmaW5hbENvZGUpXHJcbiAgICAgICAgICAubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgICAgICAgaWYgKCFleGlzdGluZykge1xyXG4gICAgICAgICAgYnJlYWs7IC8vIENvZGUgaXMgdW5pcXVlXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBHZW5lcmF0ZSBhIG5ldyBjb2RlXHJcbiAgICAgICAgZmluYWxDb2RlID0gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIsIDgpLnRvVXBwZXJDYXNlKCk7XHJcbiAgICAgICAgYXR0ZW1wdHMrKztcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gVXBkYXRlIG9yIGluc2VydCBwcm9maWxlIHdpdGggcmVmZXJyYWwgY29kZVxyXG4gICAgICAvLyBGaXJzdCwgdHJ5IHRvIHVwZGF0ZSBleGlzdGluZyBwcm9maWxlXHJcbiAgICAgIGNvbnN0IHsgZGF0YTogZXhpc3RpbmdQcm9maWxlIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgICAgLnNlbGVjdCgnaWQsIGZpcnN0X25hbWUsIGxhc3RfbmFtZScpXHJcbiAgICAgICAgLmVxKCdlbWFpbCcsIGVtYWlsKVxyXG4gICAgICAgIC5tYXliZVNpbmdsZSgpO1xyXG5cclxuICAgICAgbGV0IHVwZGF0ZWRQcm9maWxlO1xyXG4gICAgICBpZiAoZXhpc3RpbmdQcm9maWxlKSB7XHJcbiAgICAgICAgLy8gVXBkYXRlIGV4aXN0aW5nIHByb2ZpbGVcclxuICAgICAgICBjb25zdCB7IGRhdGE6IHVwZGF0ZWQsIGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgICAgICAudXBkYXRlKHtcclxuICAgICAgICAgICAgcmVmZXJyYWxfY29kZTogZmluYWxDb2RlLFxyXG4gICAgICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgLmVxKCdlbWFpbCcsIGVtYWlsKVxyXG4gICAgICAgICAgLnNlbGVjdCgncmVmZXJyYWxfY29kZScpXHJcbiAgICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICAgIGlmICh1cGRhdGVFcnJvcikge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBkYXRpbmcgcmVmZXJyYWwgY29kZTonLCB1cGRhdGVFcnJvcik7XHJcbiAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHVwZGF0ZUVycm9yLm1lc3NhZ2UgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdXBkYXRlZFByb2ZpbGUgPSB1cGRhdGVkO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEluc2VydCBuZXcgcHJvZmlsZSB3aXRoIHJlZmVycmFsIGNvZGVcclxuICAgICAgICBjb25zdCB7IGRhdGE6IGluc2VydGVkLCBlcnJvcjogaW5zZXJ0RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgICAgLmluc2VydCh7XHJcbiAgICAgICAgICAgIGVtYWlsLFxyXG4gICAgICAgICAgICByZWZlcnJhbF9jb2RlOiBmaW5hbENvZGUsXHJcbiAgICAgICAgICAgIGZpcnN0X25hbWU6IGVtYWlsLnNwbGl0KCdAJylbMF0sXHJcbiAgICAgICAgICAgIGxhc3RfbmFtZTogJycsXHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgLnNlbGVjdCgncmVmZXJyYWxfY29kZScpXHJcbiAgICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICAgIGlmIChpbnNlcnRFcnJvcikge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYXRpbmcgcmVmZXJyYWwgY29kZTonLCBpbnNlcnRFcnJvcik7XHJcbiAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGluc2VydEVycm9yLm1lc3NhZ2UgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdXBkYXRlZFByb2ZpbGUgPSBpbnNlcnRlZDtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcmVmZXJyYWxDb2RlOiB1cGRhdGVkUHJvZmlsZT8ucmVmZXJyYWxfY29kZSB8fCBmaW5hbENvZGUgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBVc2UgdGhlIGdlbmVyYXRlZCBjb2RlIGZyb20gZGF0YWJhc2UgZnVuY3Rpb25cclxuICAgIC8vIFVwZGF0ZSBvciBpbnNlcnQgcHJvZmlsZSB3aXRoIGdlbmVyYXRlZCBjb2RlXHJcbiAgICBjb25zdCB7IGRhdGE6IGV4aXN0aW5nUHJvZmlsZSB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcclxuICAgICAgLnNlbGVjdCgnaWQsIGZpcnN0X25hbWUsIGxhc3RfbmFtZScpXHJcbiAgICAgIC5lcSgnZW1haWwnLCBlbWFpbClcclxuICAgICAgLm1heWJlU2luZ2xlKCk7XHJcblxyXG4gICAgbGV0IHVwZGF0ZWRQcm9maWxlO1xyXG4gICAgaWYgKGV4aXN0aW5nUHJvZmlsZSkge1xyXG4gICAgICAvLyBVcGRhdGUgZXhpc3RpbmcgcHJvZmlsZVxyXG4gICAgICBjb25zdCB7IGRhdGE6IHVwZGF0ZWQsIGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgIC51cGRhdGUoe1xyXG4gICAgICAgICAgcmVmZXJyYWxfY29kZTogZ2VuZXJhdGVkQ29kZSxcclxuICAgICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5lcSgnZW1haWwnLCBlbWFpbClcclxuICAgICAgICAuc2VsZWN0KCdyZWZlcnJhbF9jb2RlJylcclxuICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICBpZiAodXBkYXRlRXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciB1cGRhdGluZyByZWZlcnJhbCBjb2RlOicsIHVwZGF0ZUVycm9yKTtcclxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHVwZGF0ZUVycm9yLm1lc3NhZ2UgfTtcclxuICAgICAgfVxyXG4gICAgICB1cGRhdGVkUHJvZmlsZSA9IHVwZGF0ZWQ7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyBJbnNlcnQgbmV3IHByb2ZpbGUgd2l0aCByZWZlcnJhbCBjb2RlXHJcbiAgICAgIGNvbnN0IHsgZGF0YTogaW5zZXJ0ZWQsIGVycm9yOiBpbnNlcnRFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgIC5pbnNlcnQoe1xyXG4gICAgICAgICAgZW1haWwsXHJcbiAgICAgICAgICByZWZlcnJhbF9jb2RlOiBnZW5lcmF0ZWRDb2RlLFxyXG4gICAgICAgICAgZmlyc3RfbmFtZTogZW1haWwuc3BsaXQoJ0AnKVswXSxcclxuICAgICAgICAgIGxhc3RfbmFtZTogJycsXHJcbiAgICAgICAgfSlcclxuICAgICAgICAuc2VsZWN0KCdyZWZlcnJhbF9jb2RlJylcclxuICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICBpZiAoaW5zZXJ0RXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjcmVhdGluZyByZWZlcnJhbCBjb2RlOicsIGluc2VydEVycm9yKTtcclxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGluc2VydEVycm9yLm1lc3NhZ2UgfTtcclxuICAgICAgfVxyXG4gICAgICB1cGRhdGVkUHJvZmlsZSA9IGluc2VydGVkO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHJlZmVycmFsQ29kZTogdXBkYXRlZFByb2ZpbGU/LnJlZmVycmFsX2NvZGUgfHwgZ2VuZXJhdGVkQ29kZSB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBnZXRPckNyZWF0ZVJlZmVycmFsQ29kZTonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBnZXQgcmVmZXJyYWwgY29kZScsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNlbmRSZWZlcnJhbEludml0ZXMoXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBpbnZpdGVFbWFpbHM6IHN0cmluZ1tdLFxyXG4gIHJlZmVycmFsQ29kZTogc3RyaW5nXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgc2VudD86IG51bWJlcjtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIFZhbGlkYXRlIGVtYWlsIGFkZHJlc3Nlc1xyXG4gICAgY29uc3QgdmFsaWRFbWFpbHMgPSBpbnZpdGVFbWFpbHNcclxuICAgICAgLm1hcCgoZSkgPT4gZS50cmltKCkpXHJcbiAgICAgIC5maWx0ZXIoKGUpID0+IHtcclxuICAgICAgICBpZiAoIWUpIHJldHVybiBmYWxzZTtcclxuICAgICAgICByZXR1cm4gL15bXlxcc0BdK0BbXlxcc0BdK1xcLlteXFxzQF0rJC8udGVzdChlKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgaWYgKHZhbGlkRW1haWxzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdObyB2YWxpZCBlbWFpbCBhZGRyZXNzZXMgcHJvdmlkZWQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ3JlYXRlIHJlZmVycmFsIHJlY29yZHMgZm9yIHRyYWNraW5nXHJcbiAgICBjb25zdCByZWZlcnJhbFJlY29yZHMgPSB2YWxpZEVtYWlscy5tYXAoKHJlZmVycmVkRW1haWwpID0+ICh7XHJcbiAgICAgIHJlZmVycmVyX2VtYWlsOiBlbWFpbCxcclxuICAgICAgcmVmZXJyZWRfZW1haWw6IHJlZmVycmVkRW1haWwsXHJcbiAgICAgIHJlZmVycmFsX2NvZGU6IHJlZmVycmFsQ29kZSxcclxuICAgICAgc3RhdHVzOiAncGVuZGluZycsXHJcbiAgICB9KSk7XHJcblxyXG4gICAgY29uc3QgeyBlcnJvcjogaW5zZXJ0RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdyZWZlcnJhbHMnKVxyXG4gICAgICAuaW5zZXJ0KHJlZmVycmFsUmVjb3Jkcyk7XHJcblxyXG4gICAgaWYgKGluc2VydEVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIHJlZmVycmFsIHJlY29yZHM6JywgaW5zZXJ0RXJyb3IpO1xyXG4gICAgICAvLyBDb250aW51ZSBldmVuIGlmIGluc2VydCBmYWlscyAtIHdlIHN0aWxsIHdhbnQgdG8gc2VuZCBlbWFpbHNcclxuICAgIH1cclxuXHJcbiAgICAvLyBHZW5lcmF0ZSByZWZlcnJhbCBsaW5rXHJcbiAgICBjb25zdCBiYXNlVXJsID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU0lURV9VUkwgfHwgJ2h0dHBzOi8vc2hhbGVhbi5jby56YSc7XHJcbiAgICBjb25zdCByZWZlcnJhbExpbmsgPSBgJHtiYXNlVXJsfS9ib29raW5nL2RldGFpbHM/cmVmPSR7cmVmZXJyYWxDb2RlfWA7XHJcblxyXG4gICAgLy8gVE9ETzogSW1wbGVtZW50IGFjdHVhbCBlbWFpbCBzZW5kaW5nIHVzaW5nIHlvdXIgZW1haWwgc2VydmljZSAoUmVzZW5kLCBTZW5kR3JpZCwgZXRjLilcclxuICAgIC8vIEZvciBub3csIHdlJ2xsIGp1c3QgbG9nIHRoZSBlbWFpbHMgdGhhdCB3b3VsZCBiZSBzZW50XHJcbiAgICBjb25zb2xlLmxvZygnUmVmZXJyYWwgaW52aXRlcyB0byBzZW5kOicsIHtcclxuICAgICAgZnJvbTogZW1haWwsXHJcbiAgICAgIHRvOiB2YWxpZEVtYWlscyxcclxuICAgICAgcmVmZXJyYWxDb2RlLFxyXG4gICAgICByZWZlcnJhbExpbmssXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBJbiBhIHJlYWwgaW1wbGVtZW50YXRpb24sIHlvdSB3b3VsZCBzZW5kIGVtYWlscyBoZXJlXHJcbiAgICAvLyBFeGFtcGxlIHdpdGggUmVzZW5kOlxyXG4gICAgLy8gYXdhaXQgcmVzZW5kLmVtYWlscy5zZW5kKHtcclxuICAgIC8vICAgZnJvbTogJ1NoYWxlYW4gPG5vcmVwbHlAc2hhbGVhbi5jby56YT4nLFxyXG4gICAgLy8gICB0bzogdmFsaWRFbWFpbHMsXHJcbiAgICAvLyAgIHN1YmplY3Q6ICdZb3VcXCd2ZSBiZWVuIGludml0ZWQgdG8gdHJ5IFNoYWxlYW4gQ2xlYW5pbmcgU2VydmljZXMhJyxcclxuICAgIC8vICAgaHRtbDogYDxwPllvdXIgZnJpZW5kIGhhcyBpbnZpdGVkIHlvdSB0byB0cnkgU2hhbGVhbi4gVXNlIGNvZGUgJHtyZWZlcnJhbENvZGV9IHRvIGdldCBSMTUwIG9mZiB5b3VyIGZpcnN0IGJvb2tpbmchPC9wPjxwPjxhIGhyZWY9XCIke3JlZmVycmFsTGlua31cIj5Cb29rIE5vdzwvYT48L3A+YCxcclxuICAgIC8vIH0pO1xyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHNlbnQ6IHZhbGlkRW1haWxzLmxlbmd0aCB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBzZW5kUmVmZXJyYWxJbnZpdGVzOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIHNlbmQgaW52aXRlcycsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFJlZmVycmFsU3RhdHMoXHJcbiAgZW1haWw6IHN0cmluZ1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIHN0YXRzPzoge1xyXG4gICAgdG90YWxSZWZlcnJhbHM6IG51bWJlcjtcclxuICAgIGNvbXBsZXRlZFJlZmVycmFsczogbnVtYmVyO1xyXG4gICAgcGVuZGluZ1Jld2FyZHM6IG51bWJlcjtcclxuICAgIHRvdGFsUmV3YXJkczogbnVtYmVyO1xyXG4gIH07XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICBjb25zdCB7IGRhdGE6IHJlZmVycmFscywgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdyZWZlcnJhbHMnKVxyXG4gICAgICAuc2VsZWN0KCdzdGF0dXMsIHJlZmVycmVyX3Jld2FyZF9hbW91bnQsIHJlZmVycmVyX3Jld2FyZF9zdGF0dXMnKVxyXG4gICAgICAuZXEoJ3JlZmVycmVyX2VtYWlsJywgZW1haWwpO1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyByZWZlcnJhbCBzdGF0czonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHN0YXRzID0ge1xyXG4gICAgICB0b3RhbFJlZmVycmFsczogcmVmZXJyYWxzPy5sZW5ndGggfHwgMCxcclxuICAgICAgY29tcGxldGVkUmVmZXJyYWxzOlxyXG4gICAgICAgIHJlZmVycmFscz8uZmlsdGVyKChyKSA9PiByLnN0YXR1cyA9PT0gJ2NvbXBsZXRlZCcpLmxlbmd0aCB8fCAwLFxyXG4gICAgICBwZW5kaW5nUmV3YXJkczpcclxuICAgICAgICByZWZlcnJhbHM/LmZpbHRlcigocikgPT4gci5yZWZlcnJlcl9yZXdhcmRfc3RhdHVzID09PSAncGVuZGluZycpLmxlbmd0aCB8fCAwLFxyXG4gICAgICB0b3RhbFJld2FyZHM6XHJcbiAgICAgICAgcmVmZXJyYWxzXHJcbiAgICAgICAgICA/LmZpbHRlcigocikgPT4gci5yZWZlcnJlcl9yZXdhcmRfc3RhdHVzID09PSAnY3JlZGl0ZWQnKVxyXG4gICAgICAgICAgLnJlZHVjZSgoc3VtLCByKSA9PiBzdW0gKyAoci5yZWZlcnJlcl9yZXdhcmRfYW1vdW50IHx8IDApLCAwKSB8fCAwLFxyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBzdGF0cyB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBnZXRSZWZlcnJhbFN0YXRzOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGZldGNoIHJlZmVycmFsIHN0YXRzJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogSW5pdGlhbGl6ZSBhIGNyZWRpdCBwdXJjaGFzZSB3aXRoIFBheXN0YWNrXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaW5pdGlhbGl6ZUNyZWRpdFB1cmNoYXNlKFxyXG4gIGVtYWlsOiBzdHJpbmcsXHJcbiAgYW1vdW50OiBudW1iZXIsXHJcbiAgcGF5bWVudE1ldGhvZDogJ2NyZWRpdF9jYXJkJyB8ICdlZnQnXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgYXV0aG9yaXphdGlvblVybD86IHN0cmluZztcclxuICByZWZlcmVuY2U/OiBzdHJpbmc7XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgaWYgKGFtb3VudCA8IDIwIHx8IGFtb3VudCA+IDUwMDApIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogJ0Ftb3VudCBtdXN0IGJlIGJldHdlZW4gUjIwIGFuZCBSNTAwMCcsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gR2VuZXJhdGUgYSB1bmlxdWUgcmVmZXJlbmNlIGZvciB0aGlzIGNyZWRpdCBwdXJjaGFzZVxyXG4gICAgY29uc3QgcmVmZXJlbmNlID0gYENSRURJVF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIsIDkpfWA7XHJcblxyXG4gICAgLy8gQ3JlYXRlIGEgcGVuZGluZyBjcmVkaXQgdHJhbnNhY3Rpb25cclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcbiAgICBcclxuICAgIC8vIEdldCBvciBjcmVhdGUgcHJvZmlsZVxyXG4gICAgbGV0IHsgZGF0YTogcHJvZmlsZSB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcclxuICAgICAgLnNlbGVjdCgnaWQsIGNyZWRpdF9iYWxhbmNlJylcclxuICAgICAgLmVxKCdlbWFpbCcsIGVtYWlsKVxyXG4gICAgICAubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoIXByb2ZpbGUpIHtcclxuICAgICAgLy8gQ3JlYXRlIGEgYmFzaWMgcHJvZmlsZSBpZiBpdCBkb2Vzbid0IGV4aXN0XHJcbiAgICAgIGNvbnN0IHsgZGF0YTogbmV3UHJvZmlsZSwgZXJyb3I6IGNyZWF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgICAgLmluc2VydCh7XHJcbiAgICAgICAgICBlbWFpbCxcclxuICAgICAgICAgIGNyZWRpdF9iYWxhbmNlOiAwLFxyXG4gICAgICAgICAgZmlyc3RfbmFtZTogJycsXHJcbiAgICAgICAgICBsYXN0X25hbWU6ICcnLFxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnNlbGVjdCgnaWQsIGNyZWRpdF9iYWxhbmNlJylcclxuICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICBpZiAoY3JlYXRlRXJyb3IgfHwgIW5ld1Byb2ZpbGUpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICBlcnJvcjogJ0ZhaWxlZCB0byBjcmVhdGUgcHJvZmlsZScsXHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG4gICAgICBwcm9maWxlID0gbmV3UHJvZmlsZTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDcmVhdGUgcGVuZGluZyBjcmVkaXQgdHJhbnNhY3Rpb25cclxuICAgIGNvbnN0IHsgZXJyb3I6IHRyYW5zYWN0aW9uRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdjcmVkaXRfdHJhbnNhY3Rpb25zJylcclxuICAgICAgLmluc2VydCh7XHJcbiAgICAgICAgcHJvZmlsZV9pZDogcHJvZmlsZS5pZCxcclxuICAgICAgICBlbWFpbCxcclxuICAgICAgICB0cmFuc2FjdGlvbl90eXBlOiAncHVyY2hhc2UnLFxyXG4gICAgICAgIGFtb3VudCxcclxuICAgICAgICBiYWxhbmNlX2JlZm9yZTogcHJvZmlsZS5jcmVkaXRfYmFsYW5jZSB8fCAwLFxyXG4gICAgICAgIGJhbGFuY2VfYWZ0ZXI6IHByb2ZpbGUuY3JlZGl0X2JhbGFuY2UgfHwgMCwgLy8gV29uJ3QgdXBkYXRlIHVudGlsIHBheW1lbnQgc3VjY2VlZHNcclxuICAgICAgICBwYXltZW50X21ldGhvZDogcGF5bWVudE1ldGhvZCxcclxuICAgICAgICBwYXlzdGFja19yZWZlcmVuY2U6IHJlZmVyZW5jZSxcclxuICAgICAgICBwYXltZW50X3N0YXR1czogJ3BlbmRpbmcnLFxyXG4gICAgICAgIGRlc2NyaXB0aW9uOiBgUHVyY2hhc2Ugb2YgUiR7YW1vdW50fSBTaGFsZWFuQ3JlZGAsXHJcbiAgICAgIH0pO1xyXG5cclxuICAgIGlmICh0cmFuc2FjdGlvbkVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIGNyZWRpdCB0cmFuc2FjdGlvbjonLCB0cmFuc2FjdGlvbkVycm9yKTtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogJ0ZhaWxlZCB0byBjcmVhdGUgdHJhbnNhY3Rpb24gcmVjb3JkJyxcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBJbml0aWFsaXplIFBheXN0YWNrIHBheW1lbnRcclxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goJy9hcGkvcGF5c3RhY2svaW5pdGlhbGl6ZScsIHtcclxuICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxyXG4gICAgICB9LFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgZW1haWwsXHJcbiAgICAgICAgYW1vdW50LFxyXG4gICAgICAgIHJlZmVyZW5jZSxcclxuICAgICAgICBtZXRhZGF0YToge1xyXG4gICAgICAgICAgdHJhbnNhY3Rpb25fdHlwZTogJ2NyZWRpdF9wdXJjaGFzZScsXHJcbiAgICAgICAgICBwYXltZW50X21ldGhvZDogcGF5bWVudE1ldGhvZCxcclxuICAgICAgICB9LFxyXG4gICAgICB9KSxcclxuICAgIH0pO1xyXG5cclxuICAgIGlmICghcmVzcG9uc2Uub2spIHtcclxuICAgICAgY29uc3QgZXJyb3IgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6IGVycm9yLmVycm9yIHx8ICdGYWlsZWQgdG8gaW5pdGlhbGl6ZSBwYXltZW50JyxcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBwYXltZW50RGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcclxuXHJcbiAgICBpZiAoIXBheW1lbnREYXRhLnN0YXR1cykge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIGVycm9yOiBwYXltZW50RGF0YS5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gaW5pdGlhbGl6ZSBwYXltZW50JyxcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICBhdXRob3JpemF0aW9uVXJsOiBwYXltZW50RGF0YS5kYXRhLmF1dGhvcml6YXRpb25fdXJsLFxyXG4gICAgICByZWZlcmVuY2U6IHBheW1lbnREYXRhLmRhdGEucmVmZXJlbmNlLFxyXG4gICAgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW5pdGlhbGl6aW5nIGNyZWRpdCBwdXJjaGFzZTonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBpbml0aWFsaXplIHBheW1lbnQnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgVm91Y2hlclJlZGVtcHRpb24ge1xyXG4gIGlkOiBzdHJpbmc7XHJcbiAgdm91Y2hlcl9jb2RlOiBzdHJpbmc7XHJcbiAgYW1vdW50OiBudW1iZXI7XHJcbiAgcmVkZWVtZWRfYXQ6IHN0cmluZztcclxuICBib29raW5nX2lkPzogc3RyaW5nO1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVkZWVtVm91Y2hlcihcclxuICBjb2RlOiBzdHJpbmcsXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBwaG9uZT86IHN0cmluZ1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGFtb3VudD86IG51bWJlcjtcclxuICBuZXdCYWxhbmNlPzogbnVtYmVyO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgLy8gQ2FsbCB0aGUgZGF0YWJhc2UgZnVuY3Rpb24gdG8gcmVkZWVtIHRoZSB2b3VjaGVyXHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5ycGMoJ3JlZGVlbV92b3VjaGVyJywge1xyXG4gICAgICBwX2NvZGU6IGNvZGUudHJpbSgpLnRvVXBwZXJDYXNlKCksXHJcbiAgICAgIHBfZW1haWw6IGVtYWlsLnRyaW0oKSxcclxuICAgICAgcF9waG9uZTogcGhvbmU/LnRyaW0oKSB8fCBudWxsLFxyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHJlZGVlbWluZyB2b3VjaGVyOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZSB8fCAnRmFpbGVkIHRvIHJlZGVlbSB2b3VjaGVyJyxcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBQYXJzZSB0aGUgcmVzdWx0IGZyb20gdGhlIGZ1bmN0aW9uIChoYW5kbGUgYm90aCBvYmplY3QgYW5kIHN0cmluZyBKU09OQilcclxuICAgIGxldCByZXN1bHQgPSBkYXRhO1xyXG4gICAgaWYgKHR5cGVvZiBkYXRhID09PSAnc3RyaW5nJykge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIHJlc3VsdCA9IEpTT04ucGFyc2UoZGF0YSk7XHJcbiAgICAgIH0gY2F0Y2ggKHBhcnNlRXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBwYXJzaW5nIHZvdWNoZXIgcmVkZW1wdGlvbiByZXN1bHQ6JywgcGFyc2VFcnJvcik7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgZXJyb3I6ICdJbnZhbGlkIHJlc3BvbnNlIGZyb20gc2VydmVyJyxcclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHJlc3VsdCAmJiB0eXBlb2YgcmVzdWx0ID09PSAnb2JqZWN0JyAmJiAnc3VjY2VzcycgaW4gcmVzdWx0KSB7XHJcbiAgICAgIGlmIChyZXN1bHQuc3VjY2VzcyA9PT0gZmFsc2UpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICBlcnJvcjogcmVzdWx0LmVycm9yIHx8ICdGYWlsZWQgdG8gcmVkZWVtIHZvdWNoZXInLFxyXG4gICAgICAgIH07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICBhbW91bnQ6IHJlc3VsdC5hbW91bnQsXHJcbiAgICAgICAgbmV3QmFsYW5jZTogcmVzdWx0Lm5ld19iYWxhbmNlLFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogJ1VuZXhwZWN0ZWQgcmVzcG9uc2UgZnJvbSBzZXJ2ZXInLFxyXG4gICAgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gcmVkZWVtVm91Y2hlcjonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byByZWRlZW0gdm91Y2hlcicsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFZvdWNoZXJSZWRlbXB0aW9ucyhcclxuICBlbWFpbDogc3RyaW5nLFxyXG4gIHBob25lPzogc3RyaW5nXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgcmVkZW1wdGlvbnM/OiBWb3VjaGVyUmVkZW1wdGlvbltdO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgbGV0IHF1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ3ZvdWNoZXJfcmVkZW1wdGlvbnMnKVxyXG4gICAgICAuc2VsZWN0KCdpZCwgdm91Y2hlcl9jb2RlLCBhbW91bnQsIHJlZGVlbWVkX2F0LCBib29raW5nX2lkJylcclxuICAgICAgLm9yZGVyKCdyZWRlZW1lZF9hdCcsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KTtcclxuXHJcbiAgICAvLyBCdWlsZCBxdWVyeSBmb3IgZW1haWwvcGhvbmUgbG9va3VwXHJcbiAgICAvLyBQcmlvcml0aXplIGVtYWlsIGFzIGl0J3MgdGhlIHByaW1hcnkgaWRlbnRpZmllciB0byBwcmV2ZW50IGNyb3NzLWFjY291bnQgdmlzaWJpbGl0eVxyXG4gICAgaWYgKGVtYWlsKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ2VtYWlsJywgZW1haWwpO1xyXG4gICAgICAvLyBJZiBwaG9uZSBpcyBhbHNvIHByb3ZpZGVkLCB3ZSBjYW4gb3B0aW9uYWxseSBmaWx0ZXIgYnkgYm90aCBmb3IgZXh0cmEgc2VjdXJpdHlcclxuICAgICAgLy8gYnV0IGVtYWlsIGFsb25lIHNob3VsZCBiZSBzdWZmaWNpZW50IHNpbmNlIGl0J3MgdW5pcXVlXHJcbiAgICB9IGVsc2UgaWYgKHBob25lKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ3Bob25lJywgcGhvbmUpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRW1haWwgb3IgcGhvbmUgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgcXVlcnk7XHJcblxyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIHZvdWNoZXIgcmVkZW1wdGlvbnM6JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBUcmFuc2Zvcm0gdGhlIGRhdGEgdG8gbWF0Y2ggdGhlIGludGVyZmFjZVxyXG4gICAgY29uc3QgcmVkZW1wdGlvbnM6IFZvdWNoZXJSZWRlbXB0aW9uW10gPSAoZGF0YSB8fCBbXSkubWFwKChyZWRlbXB0aW9uKSA9PiAoe1xyXG4gICAgICBpZDogcmVkZW1wdGlvbi5pZCxcclxuICAgICAgdm91Y2hlcl9jb2RlOiByZWRlbXB0aW9uLnZvdWNoZXJfY29kZSxcclxuICAgICAgYW1vdW50OiByZWRlbXB0aW9uLmFtb3VudCxcclxuICAgICAgcmVkZWVtZWRfYXQ6IHJlZGVtcHRpb24ucmVkZWVtZWRfYXQsXHJcbiAgICAgIGJvb2tpbmdfaWQ6IHJlZGVtcHRpb24uYm9va2luZ19pZCB8fCB1bmRlZmluZWQsXHJcbiAgICB9KSk7XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcmVkZW1wdGlvbnMgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gZ2V0Vm91Y2hlclJlZGVtcHRpb25zOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGZldGNoIHZvdWNoZXIgcmVkZW1wdGlvbnMnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiaVNBdWRzQixpTUFBQSJ9
}),
"[project]/app/dashboard/data:bba00b [app-ssr] (ecmascript) <text/javascript>", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "createLocation",
    ()=>$$RSC_SERVER_ACTION_9
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-ssr] (ecmascript)");
/* __next_internal_action_entry_do_not_use__ [{"708760b781486bdaa46639d3bdf4f0104447aee4f1":"createLocation"},"app/dashboard/actions.ts",""] */ "use turbopack no side effects";
;
const $$RSC_SERVER_ACTION_9 = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["createServerReference"])("708760b781486bdaa46639d3bdf4f0104447aee4f1", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["findSourceMapURL"], "createLocation");
;
 //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vYWN0aW9ucy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHNlcnZlcic7XHJcblxyXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAL2xpYi9zdXBhYmFzZS9zZXJ2ZXInO1xyXG5pbXBvcnQgeyBCb29raW5nIH0gZnJvbSAnQC90eXBlcy9ib29raW5nJztcclxuaW1wb3J0IHsgUHJvZmlsZSwgUHJvZmlsZVVwZGF0ZUlucHV0IH0gZnJvbSAnQC90eXBlcy9wcm9maWxlJztcclxuaW1wb3J0IHsgTG9jYXRpb24sIExvY2F0aW9uQ3JlYXRlSW5wdXQsIExvY2F0aW9uVXBkYXRlSW5wdXQgfSBmcm9tICdAL3R5cGVzL2xvY2F0aW9uJztcclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBdXRoZW50aWNhdGVkVXNlcigpOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGVtYWlsPzogc3RyaW5nO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcbiAgICBjb25zdCB7IGRhdGE6IHsgdXNlciB9LCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XHJcblxyXG4gICAgaWYgKGVycm9yIHx8ICF1c2VyKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ05vdCBhdXRoZW50aWNhdGVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGVtYWlsOiB1c2VyLmVtYWlsIHx8IHVuZGVmaW5lZCB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBnZXRBdXRoZW50aWNhdGVkVXNlcjonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBnZXQgdXNlcicsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEN1c3RvbWVyQm9va2luZ3MoXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBwaG9uZT86IHN0cmluZyxcclxuICBmaWx0ZXI/OiAnYWxsJyB8ICd1cGNvbWluZycgfCAnY29tcGxldGVkJyB8ICdjYW5jZWxsZWQnXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgYm9va2luZ3M/OiBCb29raW5nW107XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICBsZXQgcXVlcnkgPSBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnYm9va2luZ3MnKVxyXG4gICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgLm9yZGVyKCdzZXJ2aWNlX2RhdGUnLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcclxuICAgICAgLm9yZGVyKCdjcmVhdGVkX2F0JywgeyBhc2NlbmRpbmc6IGZhbHNlIH0pO1xyXG5cclxuICAgIC8vIEJ1aWxkIHF1ZXJ5IGZvciBlbWFpbC9waG9uZSBsb29rdXBcclxuICAgIGlmIChlbWFpbCAmJiBwaG9uZSkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5Lm9yKGBjdXN0b21lcl9lbWFpbC5lcS4ke2VtYWlsfSxjdXN0b21lcl9waG9uZS5lcS4ke3Bob25lfWApO1xyXG4gICAgfSBlbHNlIGlmIChlbWFpbCkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdjdXN0b21lcl9lbWFpbCcsIGVtYWlsKTtcclxuICAgIH0gZWxzZSBpZiAocGhvbmUpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnY3VzdG9tZXJfcGhvbmUnLCBwaG9uZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdFbWFpbCBvciBwaG9uZSBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBBcHBseSBzdGF0dXMgZmlsdGVyXHJcbiAgICBpZiAoZmlsdGVyICYmIGZpbHRlciAhPT0gJ2FsbCcpIHtcclxuICAgICAgaWYgKGZpbHRlciA9PT0gJ3VwY29taW5nJykge1xyXG4gICAgICAgIHF1ZXJ5ID0gcXVlcnkuaW4oJ3N0YXR1cycsIFsncGVuZGluZycsICdjb25maXJtZWQnXSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnc3RhdHVzJywgZmlsdGVyKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHF1ZXJ5O1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBib29raW5nczonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGJvb2tpbmdzOiBkYXRhIHx8IFtdIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGdldEN1c3RvbWVyQm9va2luZ3M6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gZmV0Y2ggYm9va2luZ3MnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDdXN0b21lckJvb2tpbmdTdGF0cyhcclxuICBlbWFpbDogc3RyaW5nLFxyXG4gIHBob25lPzogc3RyaW5nXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgc3RhdHM/OiB7XHJcbiAgICB0b3RhbDogbnVtYmVyO1xyXG4gICAgdXBjb21pbmc6IG51bWJlcjtcclxuICAgIGNvbXBsZXRlZDogbnVtYmVyO1xyXG4gICAgY2FuY2VsbGVkOiBudW1iZXI7XHJcbiAgICB0b3RhbFNwZW50OiBudW1iZXI7XHJcbiAgfTtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIGxldCBxdWVyeSA9IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdib29raW5ncycpXHJcbiAgICAgIC5zZWxlY3QoJ3N0YXR1cywgdG90YWxfYW1vdW50LCBwYXltZW50X3N0YXR1cycpO1xyXG5cclxuICAgIC8vIEJ1aWxkIHF1ZXJ5IGZvciBlbWFpbC9waG9uZSBsb29rdXBcclxuICAgIGlmIChlbWFpbCAmJiBwaG9uZSkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5Lm9yKGBjdXN0b21lcl9lbWFpbC5lcS4ke2VtYWlsfSxjdXN0b21lcl9waG9uZS5lcS4ke3Bob25lfWApO1xyXG4gICAgfSBlbHNlIGlmIChlbWFpbCkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdjdXN0b21lcl9lbWFpbCcsIGVtYWlsKTtcclxuICAgIH0gZWxzZSBpZiAocGhvbmUpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnY3VzdG9tZXJfcGhvbmUnLCBwaG9uZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdFbWFpbCBvciBwaG9uZSBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBxdWVyeTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgc3RhdHMgPSB7XHJcbiAgICAgIHRvdGFsOiBkYXRhPy5sZW5ndGggfHwgMCxcclxuICAgICAgdXBjb21pbmc6IGRhdGE/LmZpbHRlcigoYikgPT4gYi5zdGF0dXMgPT09ICdwZW5kaW5nJyB8fCBiLnN0YXR1cyA9PT0gJ2NvbmZpcm1lZCcpLmxlbmd0aCB8fCAwLFxyXG4gICAgICBjb21wbGV0ZWQ6IGRhdGE/LmZpbHRlcigoYikgPT4gYi5zdGF0dXMgPT09ICdjb21wbGV0ZWQnKS5sZW5ndGggfHwgMCxcclxuICAgICAgY2FuY2VsbGVkOiBkYXRhPy5maWx0ZXIoKGIpID0+IGIuc3RhdHVzID09PSAnY2FuY2VsbGVkJykubGVuZ3RoIHx8IDAsXHJcbiAgICAgIHRvdGFsU3BlbnQ6IGRhdGFcclxuICAgICAgICA/LmZpbHRlcigoYikgPT4gYi5wYXltZW50X3N0YXR1cyA9PT0gJ3BhaWQnKVxyXG4gICAgICAgIC5yZWR1Y2UoKHN1bSwgYikgPT4gc3VtICsgKGIudG90YWxfYW1vdW50IHx8IDApLCAwKSB8fCAwLFxyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBzdGF0cyB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBmZXRjaCBzdGF0cycsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEJvb2tpbmdCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGJvb2tpbmc/OiBCb29raW5nO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2Jvb2tpbmdzJylcclxuICAgICAgLnNlbGVjdCgnKicpXHJcbiAgICAgIC5lcSgnaWQnLCBpZClcclxuICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBib29raW5nOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnQm9va2luZyBub3QgZm91bmQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYm9va2luZzogZGF0YSB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdVbmV4cGVjdGVkIGVycm9yIGZldGNoaW5nIGJvb2tpbmc6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q3VzdG9tZXJQcm9maWxlKFxyXG4gIGVtYWlsOiBzdHJpbmcsXHJcbiAgcGhvbmU/OiBzdHJpbmdcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBwcm9maWxlPzogUHJvZmlsZTtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIEZpcnN0LCB0cnkgdG8gZ2V0IHByb2ZpbGUgZnJvbSBwcm9maWxlcyB0YWJsZVxyXG4gICAgbGV0IHF1ZXJ5ID0gc3VwYWJhc2UuZnJvbSgncHJvZmlsZXMnKS5zZWxlY3QoJyonKTtcclxuXHJcbiAgICBpZiAoZW1haWwpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnZW1haWwnLCBlbWFpbCk7XHJcbiAgICB9IGVsc2UgaWYgKHBob25lKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ3Bob25lJywgcGhvbmUpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRW1haWwgb3IgcGhvbmUgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBkYXRhOiBwcm9maWxlRGF0YSwgZXJyb3I6IHByb2ZpbGVFcnJvciB9ID0gYXdhaXQgcXVlcnkubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgICAvLyBJZiBwcm9maWxlIGV4aXN0cywgcmV0dXJuIGl0XHJcbiAgICBpZiAocHJvZmlsZURhdGEgJiYgIXByb2ZpbGVFcnJvcikge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBwcm9maWxlOiBwcm9maWxlRGF0YSB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIElmIG5vIHByb2ZpbGUgZXhpc3RzLCBkZXJpdmUgZnJvbSBtb3N0IHJlY2VudCBib29raW5nXHJcbiAgICBsZXQgYm9va2luZ1F1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2Jvb2tpbmdzJylcclxuICAgICAgLnNlbGVjdCgnY3VzdG9tZXJfZmlyc3RfbmFtZSwgY3VzdG9tZXJfbGFzdF9uYW1lLCBjdXN0b21lcl9lbWFpbCwgY3VzdG9tZXJfcGhvbmUnKVxyXG4gICAgICAub3JkZXIoJ2NyZWF0ZWRfYXQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcclxuICAgICAgLmxpbWl0KDEpO1xyXG5cclxuICAgIGlmIChlbWFpbCAmJiBwaG9uZSkge1xyXG4gICAgICBib29raW5nUXVlcnkgPSBib29raW5nUXVlcnkub3IoYGN1c3RvbWVyX2VtYWlsLmVxLiR7ZW1haWx9LGN1c3RvbWVyX3Bob25lLmVxLiR7cGhvbmV9YCk7XHJcbiAgICB9IGVsc2UgaWYgKGVtYWlsKSB7XHJcbiAgICAgIGJvb2tpbmdRdWVyeSA9IGJvb2tpbmdRdWVyeS5lcSgnY3VzdG9tZXJfZW1haWwnLCBlbWFpbCk7XHJcbiAgICB9IGVsc2UgaWYgKHBob25lKSB7XHJcbiAgICAgIGJvb2tpbmdRdWVyeSA9IGJvb2tpbmdRdWVyeS5lcSgnY3VzdG9tZXJfcGhvbmUnLCBwaG9uZSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBkYXRhOiBib29raW5nRGF0YSwgZXJyb3I6IGJvb2tpbmdFcnJvciB9ID0gYXdhaXQgYm9va2luZ1F1ZXJ5Lm1heWJlU2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKGJvb2tpbmdFcnJvciB8fCAhYm9va2luZ0RhdGEpIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogJ05vIHByb2ZpbGUgb3IgYm9va2luZyBmb3VuZC4gUGxlYXNlIGNyZWF0ZSBhIGJvb2tpbmcgZmlyc3QuJyxcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDcmVhdGUgYSBwcm9maWxlIG9iamVjdCBmcm9tIGJvb2tpbmcgZGF0YVxyXG4gICAgY29uc3QgZGVyaXZlZFByb2ZpbGU6IFByb2ZpbGUgPSB7XHJcbiAgICAgIGlkOiAnJywgLy8gV2lsbCBiZSBnZW5lcmF0ZWQgd2hlbiBzYXZlZFxyXG4gICAgICBlbWFpbDogYm9va2luZ0RhdGEuY3VzdG9tZXJfZW1haWwsXHJcbiAgICAgIHBob25lOiBib29raW5nRGF0YS5jdXN0b21lcl9waG9uZSB8fCBudWxsLFxyXG4gICAgICBmaXJzdF9uYW1lOiBib29raW5nRGF0YS5jdXN0b21lcl9maXJzdF9uYW1lLFxyXG4gICAgICBsYXN0X25hbWU6IGJvb2tpbmdEYXRhLmN1c3RvbWVyX2xhc3RfbmFtZSxcclxuICAgICAgY3JlYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHByb2ZpbGU6IGRlcml2ZWRQcm9maWxlIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGdldEN1c3RvbWVyUHJvZmlsZTonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBmZXRjaCBwcm9maWxlJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBsb2FkUHJvZmlsZVBpY3R1cmUoXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBmaWxlOiBGaWxlXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgdXJsPzogc3RyaW5nO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgLy8gVmFsaWRhdGUgZmlsZVxyXG4gICAgaWYgKCFmaWxlKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ05vIGZpbGUgcHJvdmlkZWQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVmFsaWRhdGUgZmlsZSB0eXBlXHJcbiAgICBjb25zdCB2YWxpZEltYWdlVHlwZXMgPSBbJ2ltYWdlL2pwZWcnLCAnaW1hZ2UvanBnJywgJ2ltYWdlL3BuZycsICdpbWFnZS93ZWJwJ107XHJcbiAgICBpZiAoIXZhbGlkSW1hZ2VUeXBlcy5pbmNsdWRlcyhmaWxlLnR5cGUpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ludmFsaWQgZmlsZSB0eXBlLiBQbGVhc2UgdXBsb2FkIGEgSlBFRywgUE5HLCBvciBXZWJQIGltYWdlLicgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBWYWxpZGF0ZSBmaWxlIHNpemUgKG1heCA1TUIpXHJcbiAgICBjb25zdCBtYXhTaXplID0gNSAqIDEwMjQgKiAxMDI0OyAvLyA1TUIgaW4gYnl0ZXNcclxuICAgIGlmIChmaWxlLnNpemUgPiBtYXhTaXplKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ZpbGUgc2l6ZSB0b28gbGFyZ2UuIFBsZWFzZSB1cGxvYWQgYW4gaW1hZ2Ugc21hbGxlciB0aGFuIDVNQi4nIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gR2VuZXJhdGUgdW5pcXVlIGZpbGVuYW1lIHVzaW5nIGVtYWlsIGFuZCB0aW1lc3RhbXBcclxuICAgIGNvbnN0IGZpbGVFeHQgPSBmaWxlLm5hbWUuc3BsaXQoJy4nKS5wb3AoKTtcclxuICAgIGNvbnN0IGZpbGVOYW1lID0gYCR7ZW1haWwucmVwbGFjZSgvW15hLXpBLVowLTldL2csICdfJyl9XyR7RGF0ZS5ub3coKX0uJHtmaWxlRXh0fWA7XHJcbiAgICBjb25zdCBmaWxlUGF0aCA9IGBhdmF0YXJzLyR7ZmlsZU5hbWV9YDtcclxuXHJcbiAgICAvLyBDb252ZXJ0IEZpbGUgdG8gQXJyYXlCdWZmZXIgZm9yIHVwbG9hZFxyXG4gICAgY29uc3QgYXJyYXlCdWZmZXIgPSBhd2FpdCBmaWxlLmFycmF5QnVmZmVyKCk7XHJcbiAgICBjb25zdCBidWZmZXIgPSBCdWZmZXIuZnJvbShhcnJheUJ1ZmZlcik7XHJcblxyXG4gICAgLy8gVXBsb2FkIHRvIFN1cGFiYXNlIFN0b3JhZ2VcclxuICAgIGNvbnN0IHsgZGF0YTogdXBsb2FkRGF0YSwgZXJyb3I6IHVwbG9hZEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5zdG9yYWdlXHJcbiAgICAgIC5mcm9tKCdwcm9maWxlLXBpY3R1cmVzJylcclxuICAgICAgLnVwbG9hZChmaWxlUGF0aCwgYnVmZmVyLCB7XHJcbiAgICAgICAgY29udGVudFR5cGU6IGZpbGUudHlwZSxcclxuICAgICAgICB1cHNlcnQ6IGZhbHNlLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICBpZiAodXBsb2FkRXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBsb2FkaW5nIGZpbGU6JywgdXBsb2FkRXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHVwbG9hZEVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBHZXQgcHVibGljIFVSTFxyXG4gICAgY29uc3QgeyBkYXRhOiB1cmxEYXRhIH0gPSBzdXBhYmFzZS5zdG9yYWdlXHJcbiAgICAgIC5mcm9tKCdwcm9maWxlLXBpY3R1cmVzJylcclxuICAgICAgLmdldFB1YmxpY1VybChmaWxlUGF0aCk7XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdXJsOiB1cmxEYXRhLnB1YmxpY1VybCB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiB1cGxvYWRQcm9maWxlUGljdHVyZTonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byB1cGxvYWQgcHJvZmlsZSBwaWN0dXJlJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZGVsZXRlUHJvZmlsZVBpY3R1cmUoZW1haWw6IHN0cmluZywgYXZhdGFyVXJsOiBzdHJpbmcpOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgLy8gRXh0cmFjdCBmaWxlIHBhdGggZnJvbSBVUkxcclxuICAgIGNvbnN0IHVybFBhcnRzID0gYXZhdGFyVXJsLnNwbGl0KCcvcHJvZmlsZS1waWN0dXJlcy8nKTtcclxuICAgIGlmICh1cmxQYXJ0cy5sZW5ndGggPCAyKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ludmFsaWQgYXZhdGFyIFVSTCcgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBmaWxlUGF0aCA9IGBhdmF0YXJzLyR7dXJsUGFydHNbMV0uc3BsaXQoJy8nKS5wb3AoKX1gO1xyXG5cclxuICAgIC8vIERlbGV0ZSBmcm9tIHN0b3JhZ2VcclxuICAgIGNvbnN0IHsgZXJyb3I6IGRlbGV0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5zdG9yYWdlXHJcbiAgICAgIC5mcm9tKCdwcm9maWxlLXBpY3R1cmVzJylcclxuICAgICAgLnJlbW92ZShbZmlsZVBhdGhdKTtcclxuXHJcbiAgICBpZiAoZGVsZXRlRXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZGVsZXRpbmcgZmlsZTonLCBkZWxldGVFcnJvcik7XHJcbiAgICAgIC8vIERvbid0IGZhaWwgaWYgZmlsZSBkb2Vzbid0IGV4aXN0XHJcbiAgICAgIGlmIChkZWxldGVFcnJvci5tZXNzYWdlLmluY2x1ZGVzKCdub3QgZm91bmQnKSkge1xyXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGRlbGV0ZUVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGRlbGV0ZVByb2ZpbGVQaWN0dXJlOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGRlbGV0ZSBwcm9maWxlIHBpY3R1cmUnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGRhdGVDdXN0b21lclByb2ZpbGUoXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBkYXRhOiBQcm9maWxlVXBkYXRlSW5wdXRcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBwcm9maWxlPzogUHJvZmlsZTtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIFZhbGlkYXRlIGlucHV0XHJcbiAgICBpZiAoIWRhdGEuZmlyc3RfbmFtZT8udHJpbSgpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ZpcnN0IG5hbWUgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcbiAgICBpZiAoIWRhdGEubGFzdF9uYW1lPy50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTGFzdCBuYW1lIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG4gICAgaWYgKCFkYXRhLmVtYWlsPy50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRW1haWwgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcbiAgICBpZiAoIS9eW15cXHNAXStAW15cXHNAXStcXC5bXlxcc0BdKyQvLnRlc3QoZGF0YS5lbWFpbCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnSW52YWxpZCBlbWFpbCBmb3JtYXQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ2hlY2sgaWYgcHJvZmlsZSBleGlzdHNcclxuICAgIGNvbnN0IHsgZGF0YTogZXhpc3RpbmdQcm9maWxlIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgLmVxKCdlbWFpbCcsIGVtYWlsKVxyXG4gICAgICAubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgICAvLyBJZiBhdmF0YXJfdXJsIGlzIGJlaW5nIHJlbW92ZWQsIGRlbGV0ZSB0aGUgb2xkIGZpbGVcclxuICAgIGlmIChleGlzdGluZ1Byb2ZpbGU/LmF2YXRhcl91cmwgJiYgZGF0YS5hdmF0YXJfdXJsID09PSBudWxsKSB7XHJcbiAgICAgIGF3YWl0IGRlbGV0ZVByb2ZpbGVQaWN0dXJlKGVtYWlsLCBleGlzdGluZ1Byb2ZpbGUuYXZhdGFyX3VybCk7XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IHJlc3VsdDtcclxuICAgIGlmIChleGlzdGluZ1Byb2ZpbGUpIHtcclxuICAgICAgLy8gVXBkYXRlIGV4aXN0aW5nIHByb2ZpbGVcclxuICAgICAgLy8gSWYgZW1haWwgY2hhbmdlZCwgd2UgbmVlZCB0byBoYW5kbGUgaXQgY2FyZWZ1bGx5XHJcbiAgICAgIGlmIChkYXRhLmVtYWlsICE9PSBlbWFpbCkge1xyXG4gICAgICAgIC8vIENoZWNrIGlmIG5ldyBlbWFpbCBhbHJlYWR5IGV4aXN0c1xyXG4gICAgICAgIGNvbnN0IHsgZGF0YTogZW1haWxDaGVjayB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgICAgICAuc2VsZWN0KCdpZCcpXHJcbiAgICAgICAgICAuZXEoJ2VtYWlsJywgZGF0YS5lbWFpbClcclxuICAgICAgICAgIC5tYXliZVNpbmdsZSgpO1xyXG5cclxuICAgICAgICBpZiAoZW1haWxDaGVjaykge1xyXG4gICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRW1haWwgYWxyZWFkeSBleGlzdHMnIH07XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCB1cGRhdGVEYXRhOiBhbnkgPSB7XHJcbiAgICAgICAgZmlyc3RfbmFtZTogZGF0YS5maXJzdF9uYW1lLnRyaW0oKSxcclxuICAgICAgICBsYXN0X25hbWU6IGRhdGEubGFzdF9uYW1lLnRyaW0oKSxcclxuICAgICAgICBlbWFpbDogZGF0YS5lbWFpbC50cmltKCksXHJcbiAgICAgICAgcGhvbmU6IGRhdGEucGhvbmU/LnRyaW0oKSB8fCBudWxsLFxyXG4gICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8vIE9ubHkgdXBkYXRlIGF2YXRhcl91cmwgaWYgaXQncyBwcm92aWRlZFxyXG4gICAgICBpZiAoZGF0YS5hdmF0YXJfdXJsICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICB1cGRhdGVEYXRhLmF2YXRhcl91cmwgPSBkYXRhLmF2YXRhcl91cmw7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IHsgZGF0YTogdXBkYXRlZFByb2ZpbGUsIGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgIC51cGRhdGUodXBkYXRlRGF0YSlcclxuICAgICAgICAuZXEoJ2VtYWlsJywgZW1haWwpXHJcbiAgICAgICAgLnNlbGVjdCgpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgaWYgKHVwZGF0ZUVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBkYXRpbmcgcHJvZmlsZTonLCB1cGRhdGVFcnJvcik7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB1cGRhdGVFcnJvci5tZXNzYWdlIH07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJlc3VsdCA9IHVwZGF0ZWRQcm9maWxlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8gQ3JlYXRlIG5ldyBwcm9maWxlXHJcbiAgICAgIGNvbnN0IGluc2VydERhdGE6IGFueSA9IHtcclxuICAgICAgICBlbWFpbDogZGF0YS5lbWFpbC50cmltKCksXHJcbiAgICAgICAgcGhvbmU6IGRhdGEucGhvbmU/LnRyaW0oKSB8fCBudWxsLFxyXG4gICAgICAgIGZpcnN0X25hbWU6IGRhdGEuZmlyc3RfbmFtZS50cmltKCksXHJcbiAgICAgICAgbGFzdF9uYW1lOiBkYXRhLmxhc3RfbmFtZS50cmltKCksXHJcbiAgICAgIH07XHJcblxyXG4gICAgICAvLyBPbmx5IHNldCBhdmF0YXJfdXJsIGlmIGl0J3MgcHJvdmlkZWRcclxuICAgICAgaWYgKGRhdGEuYXZhdGFyX3VybCkge1xyXG4gICAgICAgIGluc2VydERhdGEuYXZhdGFyX3VybCA9IGRhdGEuYXZhdGFyX3VybDtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgeyBkYXRhOiBuZXdQcm9maWxlLCBlcnJvcjogaW5zZXJ0RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcclxuICAgICAgICAuaW5zZXJ0KGluc2VydERhdGEpXHJcbiAgICAgICAgLnNlbGVjdCgpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgaWYgKGluc2VydEVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYXRpbmcgcHJvZmlsZTonLCBpbnNlcnRFcnJvcik7XHJcbiAgICAgICAgLy8gQ2hlY2sgaWYgaXQncyBhIHVuaXF1ZSBjb25zdHJhaW50IHZpb2xhdGlvblxyXG4gICAgICAgIGlmIChpbnNlcnRFcnJvci5jb2RlID09PSAnMjM1MDUnKSB7XHJcbiAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdFbWFpbCBhbHJlYWR5IGV4aXN0cycgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBpbnNlcnRFcnJvci5tZXNzYWdlIH07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJlc3VsdCA9IG5ld1Byb2ZpbGU7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcHJvZmlsZTogcmVzdWx0IH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHVwZGF0ZUN1c3RvbWVyUHJvZmlsZTonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byB1cGRhdGUgcHJvZmlsZScsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEN1c3RvbWVyTG9jYXRpb25zKFxyXG4gIGVtYWlsOiBzdHJpbmcsXHJcbiAgcGhvbmU/OiBzdHJpbmdcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBsb2NhdGlvbnM/OiBMb2NhdGlvbltdO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgbGV0IHF1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2xvY2F0aW9ucycpXHJcbiAgICAgIC5zZWxlY3QoJyonKVxyXG4gICAgICAub3JkZXIoJ2lzX2RlZmF1bHQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcclxuICAgICAgLm9yZGVyKCdjcmVhdGVkX2F0JywgeyBhc2NlbmRpbmc6IGZhbHNlIH0pO1xyXG5cclxuICAgIC8vIEJ1aWxkIHF1ZXJ5IGZvciBlbWFpbC9waG9uZSBsb29rdXBcclxuICAgIGlmIChlbWFpbCAmJiBwaG9uZSkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5Lm9yKGBjdXN0b21lcl9lbWFpbC5lcS4ke2VtYWlsfSxjdXN0b21lcl9waG9uZS5lcS4ke3Bob25lfWApO1xyXG4gICAgfSBlbHNlIGlmIChlbWFpbCkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdjdXN0b21lcl9lbWFpbCcsIGVtYWlsKTtcclxuICAgIH0gZWxzZSBpZiAocGhvbmUpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnY3VzdG9tZXJfcGhvbmUnLCBwaG9uZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdFbWFpbCBvciBwaG9uZSBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBxdWVyeTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgbG9jYXRpb25zOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgbG9jYXRpb25zOiBkYXRhIHx8IFtdIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGdldEN1c3RvbWVyTG9jYXRpb25zOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGZldGNoIGxvY2F0aW9ucycsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUxvY2F0aW9uKFxyXG4gIGVtYWlsOiBzdHJpbmcsXHJcbiAgcGhvbmU6IHN0cmluZyB8IHVuZGVmaW5lZCxcclxuICBsb2NhdGlvbkRhdGE6IExvY2F0aW9uQ3JlYXRlSW5wdXRcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBsb2NhdGlvbj86IExvY2F0aW9uO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgLy8gVmFsaWRhdGUgaW5wdXRcclxuICAgIGlmICghbG9jYXRpb25EYXRhLm5pY2tuYW1lPy50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTmlja25hbWUgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcbiAgICBpZiAoIWxvY2F0aW9uRGF0YS5hZGRyZXNzPy50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnQWRkcmVzcyBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuICAgIGlmICghbG9jYXRpb25EYXRhLnN1YnVyYj8udHJpbSgpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ1N1YnVyYiBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuICAgIGlmICghbG9jYXRpb25EYXRhLmNpdHk/LnRyaW0oKSkge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdDaXR5IGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIElmIHNldHRpbmcgYXMgZGVmYXVsdCwgdW5zZXQgYWxsIG90aGVyIGRlZmF1bHRzIGZvciB0aGlzIGN1c3RvbWVyXHJcbiAgICBpZiAobG9jYXRpb25EYXRhLmlzX2RlZmF1bHQpIHtcclxuICAgICAgbGV0IHVwZGF0ZVF1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgnbG9jYXRpb25zJylcclxuICAgICAgICAudXBkYXRlKHsgaXNfZGVmYXVsdDogZmFsc2UgfSk7XHJcblxyXG4gICAgICBpZiAoZW1haWwgJiYgcGhvbmUpIHtcclxuICAgICAgICB1cGRhdGVRdWVyeSA9IHVwZGF0ZVF1ZXJ5Lm9yKGBjdXN0b21lcl9lbWFpbC5lcS4ke2VtYWlsfSxjdXN0b21lcl9waG9uZS5lcS4ke3Bob25lfWApO1xyXG4gICAgICB9IGVsc2UgaWYgKGVtYWlsKSB7XHJcbiAgICAgICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5lcSgnY3VzdG9tZXJfZW1haWwnLCBlbWFpbCk7XHJcbiAgICAgIH0gZWxzZSBpZiAocGhvbmUpIHtcclxuICAgICAgICB1cGRhdGVRdWVyeSA9IHVwZGF0ZVF1ZXJ5LmVxKCdjdXN0b21lcl9waG9uZScsIHBob25lKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgYXdhaXQgdXBkYXRlUXVlcnk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBkYXRhOiBuZXdMb2NhdGlvbiwgZXJyb3I6IGluc2VydEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnbG9jYXRpb25zJylcclxuICAgICAgLmluc2VydCh7XHJcbiAgICAgICAgY3VzdG9tZXJfZW1haWw6IGVtYWlsLFxyXG4gICAgICAgIGN1c3RvbWVyX3Bob25lOiBwaG9uZSB8fCBudWxsLFxyXG4gICAgICAgIG5pY2tuYW1lOiBsb2NhdGlvbkRhdGEubmlja25hbWUudHJpbSgpLFxyXG4gICAgICAgIGFkZHJlc3M6IGxvY2F0aW9uRGF0YS5hZGRyZXNzLnRyaW0oKSxcclxuICAgICAgICBhcHRfdW5pdDogbG9jYXRpb25EYXRhLmFwdF91bml0Py50cmltKCkgfHwgbnVsbCxcclxuICAgICAgICBzdWJ1cmI6IGxvY2F0aW9uRGF0YS5zdWJ1cmIudHJpbSgpLFxyXG4gICAgICAgIGNpdHk6IGxvY2F0aW9uRGF0YS5jaXR5LnRyaW0oKSxcclxuICAgICAgICBwb3N0YWxfY29kZTogbG9jYXRpb25EYXRhLnBvc3RhbF9jb2RlPy50cmltKCkgfHwgbnVsbCxcclxuICAgICAgICBpc19kZWZhdWx0OiBsb2NhdGlvbkRhdGEuaXNfZGVmYXVsdCB8fCBmYWxzZSxcclxuICAgICAgfSlcclxuICAgICAgLnNlbGVjdCgpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoaW5zZXJ0RXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYXRpbmcgbG9jYXRpb246JywgaW5zZXJ0RXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGluc2VydEVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBsb2NhdGlvbjogbmV3TG9jYXRpb24gfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gY3JlYXRlTG9jYXRpb246JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gY3JlYXRlIGxvY2F0aW9uJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlTG9jYXRpb24oXHJcbiAgbG9jYXRpb25JZDogc3RyaW5nLFxyXG4gIGxvY2F0aW9uRGF0YTogTG9jYXRpb25VcGRhdGVJbnB1dFxyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGxvY2F0aW9uPzogTG9jYXRpb247XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICAvLyBWYWxpZGF0ZSBpbnB1dCBpZiBwcm92aWRlZFxyXG4gICAgaWYgKGxvY2F0aW9uRGF0YS5uaWNrbmFtZSAhPT0gdW5kZWZpbmVkICYmICFsb2NhdGlvbkRhdGEubmlja25hbWUudHJpbSgpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ05pY2tuYW1lIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG4gICAgaWYgKGxvY2F0aW9uRGF0YS5hZGRyZXNzICE9PSB1bmRlZmluZWQgJiYgIWxvY2F0aW9uRGF0YS5hZGRyZXNzLnRyaW0oKSkge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdBZGRyZXNzIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG4gICAgaWYgKGxvY2F0aW9uRGF0YS5zdWJ1cmIgIT09IHVuZGVmaW5lZCAmJiAhbG9jYXRpb25EYXRhLnN1YnVyYi50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnU3VidXJiIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG4gICAgaWYgKGxvY2F0aW9uRGF0YS5jaXR5ICE9PSB1bmRlZmluZWQgJiYgIWxvY2F0aW9uRGF0YS5jaXR5LnRyaW0oKSkge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdDaXR5IGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEdldCBjdXJyZW50IGxvY2F0aW9uIHRvIGNoZWNrIGN1c3RvbWVyIGVtYWlsXHJcbiAgICBjb25zdCB7IGRhdGE6IGN1cnJlbnRMb2NhdGlvbiwgZXJyb3I6IGZldGNoRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdsb2NhdGlvbnMnKVxyXG4gICAgICAuc2VsZWN0KCdjdXN0b21lcl9lbWFpbCwgY3VzdG9tZXJfcGhvbmUnKVxyXG4gICAgICAuZXEoJ2lkJywgbG9jYXRpb25JZClcclxuICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgIGlmIChmZXRjaEVycm9yIHx8ICFjdXJyZW50TG9jYXRpb24pIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTG9jYXRpb24gbm90IGZvdW5kJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIElmIHNldHRpbmcgYXMgZGVmYXVsdCwgdW5zZXQgYWxsIG90aGVyIGRlZmF1bHRzIGZvciB0aGlzIGN1c3RvbWVyXHJcbiAgICBpZiAobG9jYXRpb25EYXRhLmlzX2RlZmF1bHQpIHtcclxuICAgICAgbGV0IHVwZGF0ZVF1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgnbG9jYXRpb25zJylcclxuICAgICAgICAudXBkYXRlKHsgaXNfZGVmYXVsdDogZmFsc2UgfSk7XHJcblxyXG4gICAgICBpZiAoY3VycmVudExvY2F0aW9uLmN1c3RvbWVyX2VtYWlsICYmIGN1cnJlbnRMb2NhdGlvbi5jdXN0b21lcl9waG9uZSkge1xyXG4gICAgICAgIHVwZGF0ZVF1ZXJ5ID0gdXBkYXRlUXVlcnkub3IoYGN1c3RvbWVyX2VtYWlsLmVxLiR7Y3VycmVudExvY2F0aW9uLmN1c3RvbWVyX2VtYWlsfSxjdXN0b21lcl9waG9uZS5lcS4ke2N1cnJlbnRMb2NhdGlvbi5jdXN0b21lcl9waG9uZX1gKTtcclxuICAgICAgfSBlbHNlIGlmIChjdXJyZW50TG9jYXRpb24uY3VzdG9tZXJfZW1haWwpIHtcclxuICAgICAgICB1cGRhdGVRdWVyeSA9IHVwZGF0ZVF1ZXJ5LmVxKCdjdXN0b21lcl9lbWFpbCcsIGN1cnJlbnRMb2NhdGlvbi5jdXN0b21lcl9lbWFpbCk7XHJcbiAgICAgIH0gZWxzZSBpZiAoY3VycmVudExvY2F0aW9uLmN1c3RvbWVyX3Bob25lKSB7XHJcbiAgICAgICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5lcSgnY3VzdG9tZXJfcGhvbmUnLCBjdXJyZW50TG9jYXRpb24uY3VzdG9tZXJfcGhvbmUpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBEb24ndCB1bnNldCB0aGUgY3VycmVudCBsb2NhdGlvblxyXG4gICAgICB1cGRhdGVRdWVyeSA9IHVwZGF0ZVF1ZXJ5Lm5lcSgnaWQnLCBsb2NhdGlvbklkKTtcclxuXHJcbiAgICAgIGF3YWl0IHVwZGF0ZVF1ZXJ5O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEJ1aWxkIHVwZGF0ZSBvYmplY3Qgd2l0aCBvbmx5IHByb3ZpZGVkIGZpZWxkc1xyXG4gICAgY29uc3QgdXBkYXRlRGF0YTogYW55ID0ge1xyXG4gICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICB9O1xyXG5cclxuICAgIGlmIChsb2NhdGlvbkRhdGEubmlja25hbWUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB1cGRhdGVEYXRhLm5pY2tuYW1lID0gbG9jYXRpb25EYXRhLm5pY2tuYW1lLnRyaW0oKTtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuYWRkcmVzcyAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHVwZGF0ZURhdGEuYWRkcmVzcyA9IGxvY2F0aW9uRGF0YS5hZGRyZXNzLnRyaW0oKTtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuYXB0X3VuaXQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB1cGRhdGVEYXRhLmFwdF91bml0ID0gbG9jYXRpb25EYXRhLmFwdF91bml0Py50cmltKCkgfHwgbnVsbDtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuc3VidXJiICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgdXBkYXRlRGF0YS5zdWJ1cmIgPSBsb2NhdGlvbkRhdGEuc3VidXJiLnRyaW0oKTtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuY2l0eSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHVwZGF0ZURhdGEuY2l0eSA9IGxvY2F0aW9uRGF0YS5jaXR5LnRyaW0oKTtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEucG9zdGFsX2NvZGUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB1cGRhdGVEYXRhLnBvc3RhbF9jb2RlID0gbG9jYXRpb25EYXRhLnBvc3RhbF9jb2RlPy50cmltKCkgfHwgbnVsbDtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuaXNfZGVmYXVsdCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHVwZGF0ZURhdGEuaXNfZGVmYXVsdCA9IGxvY2F0aW9uRGF0YS5pc19kZWZhdWx0O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgZGF0YTogdXBkYXRlZExvY2F0aW9uLCBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdsb2NhdGlvbnMnKVxyXG4gICAgICAudXBkYXRlKHVwZGF0ZURhdGEpXHJcbiAgICAgIC5lcSgnaWQnLCBsb2NhdGlvbklkKVxyXG4gICAgICAuc2VsZWN0KClcclxuICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgIGlmICh1cGRhdGVFcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciB1cGRhdGluZyBsb2NhdGlvbjonLCB1cGRhdGVFcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogdXBkYXRlRXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGxvY2F0aW9uOiB1cGRhdGVkTG9jYXRpb24gfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gdXBkYXRlTG9jYXRpb246JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gdXBkYXRlIGxvY2F0aW9uJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZGVsZXRlTG9jYXRpb24obG9jYXRpb25JZDogc3RyaW5nKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdsb2NhdGlvbnMnKVxyXG4gICAgICAuZGVsZXRlKClcclxuICAgICAgLmVxKCdpZCcsIGxvY2F0aW9uSWQpO1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBkZWxldGluZyBsb2NhdGlvbjonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gZGVsZXRlTG9jYXRpb246JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gZGVsZXRlIGxvY2F0aW9uJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2V0RGVmYXVsdExvY2F0aW9uKFxyXG4gIGxvY2F0aW9uSWQ6IHN0cmluZyxcclxuICBlbWFpbDogc3RyaW5nLFxyXG4gIHBob25lPzogc3RyaW5nXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgbG9jYXRpb24/OiBMb2NhdGlvbjtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIEdldCBjdXJyZW50IGxvY2F0aW9uIHRvIHZlcmlmeSBvd25lcnNoaXBcclxuICAgIGNvbnN0IHsgZGF0YTogY3VycmVudExvY2F0aW9uLCBlcnJvcjogZmV0Y2hFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2xvY2F0aW9ucycpXHJcbiAgICAgIC5zZWxlY3QoJ2N1c3RvbWVyX2VtYWlsLCBjdXN0b21lcl9waG9uZScpXHJcbiAgICAgIC5lcSgnaWQnLCBsb2NhdGlvbklkKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKGZldGNoRXJyb3IgfHwgIWN1cnJlbnRMb2NhdGlvbikge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdMb2NhdGlvbiBub3QgZm91bmQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVmVyaWZ5IG93bmVyc2hpcFxyXG4gICAgY29uc3QgaXNPd25lciA9IFxyXG4gICAgICBjdXJyZW50TG9jYXRpb24uY3VzdG9tZXJfZW1haWwgPT09IGVtYWlsIHx8XHJcbiAgICAgIChwaG9uZSAmJiBjdXJyZW50TG9jYXRpb24uY3VzdG9tZXJfcGhvbmUgPT09IHBob25lKTtcclxuXHJcbiAgICBpZiAoIWlzT3duZXIpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnVW5hdXRob3JpemVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFVuc2V0IGFsbCBvdGhlciBkZWZhdWx0cyBmb3IgdGhpcyBjdXN0b21lclxyXG4gICAgbGV0IHVwZGF0ZVF1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2xvY2F0aW9ucycpXHJcbiAgICAgIC51cGRhdGUoeyBpc19kZWZhdWx0OiBmYWxzZSB9KTtcclxuXHJcbiAgICBpZiAoZW1haWwgJiYgcGhvbmUpIHtcclxuICAgICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5vcihgY3VzdG9tZXJfZW1haWwuZXEuJHtlbWFpbH0sY3VzdG9tZXJfcGhvbmUuZXEuJHtwaG9uZX1gKTtcclxuICAgIH0gZWxzZSBpZiAoZW1haWwpIHtcclxuICAgICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5lcSgnY3VzdG9tZXJfZW1haWwnLCBlbWFpbCk7XHJcbiAgICB9IGVsc2UgaWYgKHBob25lKSB7XHJcbiAgICAgIHVwZGF0ZVF1ZXJ5ID0gdXBkYXRlUXVlcnkuZXEoJ2N1c3RvbWVyX3Bob25lJywgcGhvbmUpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIERvbid0IHVuc2V0IHRoZSBjdXJyZW50IGxvY2F0aW9uXHJcbiAgICB1cGRhdGVRdWVyeSA9IHVwZGF0ZVF1ZXJ5Lm5lcSgnaWQnLCBsb2NhdGlvbklkKTtcclxuXHJcbiAgICBhd2FpdCB1cGRhdGVRdWVyeTtcclxuXHJcbiAgICAvLyBTZXQgdGhpcyBsb2NhdGlvbiBhcyBkZWZhdWx0XHJcbiAgICBjb25zdCB7IGRhdGE6IHVwZGF0ZWRMb2NhdGlvbiwgZXJyb3I6IHVwZGF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnbG9jYXRpb25zJylcclxuICAgICAgLnVwZGF0ZSh7IGlzX2RlZmF1bHQ6IHRydWUgfSlcclxuICAgICAgLmVxKCdpZCcsIGxvY2F0aW9uSWQpXHJcbiAgICAgIC5zZWxlY3QoKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKHVwZGF0ZUVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHNldHRpbmcgZGVmYXVsdCBsb2NhdGlvbjonLCB1cGRhdGVFcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogdXBkYXRlRXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGxvY2F0aW9uOiB1cGRhdGVkTG9jYXRpb24gfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gc2V0RGVmYXVsdExvY2F0aW9uOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIHNldCBkZWZhdWx0IGxvY2F0aW9uJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0T3JDcmVhdGVSZWZlcnJhbENvZGUoXHJcbiAgZW1haWw6IHN0cmluZ1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIHJlZmVycmFsQ29kZT86IHN0cmluZztcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIENoZWNrIGlmIHByb2ZpbGUgZXhpc3RzIGFuZCBoYXMgYSByZWZlcnJhbCBjb2RlXHJcbiAgICBjb25zdCB7IGRhdGE6IHByb2ZpbGUsIGVycm9yOiBwcm9maWxlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgIC5zZWxlY3QoJ3JlZmVycmFsX2NvZGUnKVxyXG4gICAgICAuZXEoJ2VtYWlsJywgZW1haWwpXHJcbiAgICAgIC5tYXliZVNpbmdsZSgpO1xyXG5cclxuICAgIGlmIChwcm9maWxlRXJyb3IgJiYgcHJvZmlsZUVycm9yLmNvZGUgIT09ICdQR1JTVDExNicpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgcHJvZmlsZTonLCBwcm9maWxlRXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHByb2ZpbGVFcnJvci5tZXNzYWdlIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gSWYgcHJvZmlsZSBleGlzdHMgYW5kIGhhcyBhIHJlZmVycmFsIGNvZGUsIHJldHVybiBpdFxyXG4gICAgaWYgKHByb2ZpbGU/LnJlZmVycmFsX2NvZGUpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcmVmZXJyYWxDb2RlOiBwcm9maWxlLnJlZmVycmFsX2NvZGUgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBHZW5lcmF0ZSBhIG5ldyByZWZlcnJhbCBjb2RlXHJcbiAgICAvLyBUcnkgdXNpbmcgdGhlIGRhdGFiYXNlIGZ1bmN0aW9uIGZpcnN0LCBidXQgZmFsbGJhY2sgdG8gY2xpZW50LXNpZGUgZ2VuZXJhdGlvblxyXG4gICAgbGV0IGdlbmVyYXRlZENvZGU6IHN0cmluZyB8IG51bGwgPSBudWxsO1xyXG4gICAgXHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB7IGRhdGE6IGRiQ29kZSwgZXJyb3I6IGNvZGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAucnBjKCdnZW5lcmF0ZV9yZWZlcnJhbF9jb2RlJyk7XHJcbiAgICAgIFxyXG4gICAgICBpZiAoIWNvZGVFcnJvciAmJiBkYkNvZGUpIHtcclxuICAgICAgICBnZW5lcmF0ZWRDb2RlID0gZGJDb2RlO1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChycGNFcnJvcikge1xyXG4gICAgICAvLyBSUEMgZnVuY3Rpb24gbWlnaHQgbm90IGV4aXN0IHlldCwgdGhhdCdzIG9rYXlcclxuICAgICAgY29uc29sZS5sb2coJ1JQQyBmdW5jdGlvbiBub3QgYXZhaWxhYmxlLCB1c2luZyBmYWxsYmFjaycpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghZ2VuZXJhdGVkQ29kZSkge1xyXG4gICAgICAvLyBGYWxsYmFjazogZ2VuZXJhdGUgY29kZSBjbGllbnQtc2lkZSBzdHlsZVxyXG4gICAgICBjb25zdCBmYWxsYmFja0NvZGUgPSBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoMiwgOCkudG9VcHBlckNhc2UoKTtcclxuICAgICAgXHJcbiAgICAgIC8vIENoZWNrIGlmIGZhbGxiYWNrIGNvZGUgZXhpc3RzLCByZXRyeSBpZiBpdCBkb2VzXHJcbiAgICAgIGxldCBmaW5hbENvZGUgPSBmYWxsYmFja0NvZGU7XHJcbiAgICAgIGxldCBhdHRlbXB0cyA9IDA7XHJcbiAgICAgIGNvbnN0IG1heEF0dGVtcHRzID0gNTtcclxuXHJcbiAgICAgIHdoaWxlIChhdHRlbXB0cyA8IG1heEF0dGVtcHRzKSB7XHJcbiAgICAgICAgY29uc3QgeyBkYXRhOiBleGlzdGluZyB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgICAgICAuc2VsZWN0KCdpZCcpXHJcbiAgICAgICAgICAuZXEoJ3JlZmVycmFsX2NvZGUnLCBmaW5hbENvZGUpXHJcbiAgICAgICAgICAubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgICAgICAgaWYgKCFleGlzdGluZykge1xyXG4gICAgICAgICAgYnJlYWs7IC8vIENvZGUgaXMgdW5pcXVlXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBHZW5lcmF0ZSBhIG5ldyBjb2RlXHJcbiAgICAgICAgZmluYWxDb2RlID0gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIsIDgpLnRvVXBwZXJDYXNlKCk7XHJcbiAgICAgICAgYXR0ZW1wdHMrKztcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gVXBkYXRlIG9yIGluc2VydCBwcm9maWxlIHdpdGggcmVmZXJyYWwgY29kZVxyXG4gICAgICAvLyBGaXJzdCwgdHJ5IHRvIHVwZGF0ZSBleGlzdGluZyBwcm9maWxlXHJcbiAgICAgIGNvbnN0IHsgZGF0YTogZXhpc3RpbmdQcm9maWxlIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgICAgLnNlbGVjdCgnaWQsIGZpcnN0X25hbWUsIGxhc3RfbmFtZScpXHJcbiAgICAgICAgLmVxKCdlbWFpbCcsIGVtYWlsKVxyXG4gICAgICAgIC5tYXliZVNpbmdsZSgpO1xyXG5cclxuICAgICAgbGV0IHVwZGF0ZWRQcm9maWxlO1xyXG4gICAgICBpZiAoZXhpc3RpbmdQcm9maWxlKSB7XHJcbiAgICAgICAgLy8gVXBkYXRlIGV4aXN0aW5nIHByb2ZpbGVcclxuICAgICAgICBjb25zdCB7IGRhdGE6IHVwZGF0ZWQsIGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgICAgICAudXBkYXRlKHtcclxuICAgICAgICAgICAgcmVmZXJyYWxfY29kZTogZmluYWxDb2RlLFxyXG4gICAgICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgLmVxKCdlbWFpbCcsIGVtYWlsKVxyXG4gICAgICAgICAgLnNlbGVjdCgncmVmZXJyYWxfY29kZScpXHJcbiAgICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICAgIGlmICh1cGRhdGVFcnJvcikge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBkYXRpbmcgcmVmZXJyYWwgY29kZTonLCB1cGRhdGVFcnJvcik7XHJcbiAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHVwZGF0ZUVycm9yLm1lc3NhZ2UgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdXBkYXRlZFByb2ZpbGUgPSB1cGRhdGVkO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEluc2VydCBuZXcgcHJvZmlsZSB3aXRoIHJlZmVycmFsIGNvZGVcclxuICAgICAgICBjb25zdCB7IGRhdGE6IGluc2VydGVkLCBlcnJvcjogaW5zZXJ0RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgICAgLmluc2VydCh7XHJcbiAgICAgICAgICAgIGVtYWlsLFxyXG4gICAgICAgICAgICByZWZlcnJhbF9jb2RlOiBmaW5hbENvZGUsXHJcbiAgICAgICAgICAgIGZpcnN0X25hbWU6IGVtYWlsLnNwbGl0KCdAJylbMF0sXHJcbiAgICAgICAgICAgIGxhc3RfbmFtZTogJycsXHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgLnNlbGVjdCgncmVmZXJyYWxfY29kZScpXHJcbiAgICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICAgIGlmIChpbnNlcnRFcnJvcikge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYXRpbmcgcmVmZXJyYWwgY29kZTonLCBpbnNlcnRFcnJvcik7XHJcbiAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGluc2VydEVycm9yLm1lc3NhZ2UgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdXBkYXRlZFByb2ZpbGUgPSBpbnNlcnRlZDtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcmVmZXJyYWxDb2RlOiB1cGRhdGVkUHJvZmlsZT8ucmVmZXJyYWxfY29kZSB8fCBmaW5hbENvZGUgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBVc2UgdGhlIGdlbmVyYXRlZCBjb2RlIGZyb20gZGF0YWJhc2UgZnVuY3Rpb25cclxuICAgIC8vIFVwZGF0ZSBvciBpbnNlcnQgcHJvZmlsZSB3aXRoIGdlbmVyYXRlZCBjb2RlXHJcbiAgICBjb25zdCB7IGRhdGE6IGV4aXN0aW5nUHJvZmlsZSB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcclxuICAgICAgLnNlbGVjdCgnaWQsIGZpcnN0X25hbWUsIGxhc3RfbmFtZScpXHJcbiAgICAgIC5lcSgnZW1haWwnLCBlbWFpbClcclxuICAgICAgLm1heWJlU2luZ2xlKCk7XHJcblxyXG4gICAgbGV0IHVwZGF0ZWRQcm9maWxlO1xyXG4gICAgaWYgKGV4aXN0aW5nUHJvZmlsZSkge1xyXG4gICAgICAvLyBVcGRhdGUgZXhpc3RpbmcgcHJvZmlsZVxyXG4gICAgICBjb25zdCB7IGRhdGE6IHVwZGF0ZWQsIGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgIC51cGRhdGUoe1xyXG4gICAgICAgICAgcmVmZXJyYWxfY29kZTogZ2VuZXJhdGVkQ29kZSxcclxuICAgICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5lcSgnZW1haWwnLCBlbWFpbClcclxuICAgICAgICAuc2VsZWN0KCdyZWZlcnJhbF9jb2RlJylcclxuICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICBpZiAodXBkYXRlRXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciB1cGRhdGluZyByZWZlcnJhbCBjb2RlOicsIHVwZGF0ZUVycm9yKTtcclxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHVwZGF0ZUVycm9yLm1lc3NhZ2UgfTtcclxuICAgICAgfVxyXG4gICAgICB1cGRhdGVkUHJvZmlsZSA9IHVwZGF0ZWQ7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyBJbnNlcnQgbmV3IHByb2ZpbGUgd2l0aCByZWZlcnJhbCBjb2RlXHJcbiAgICAgIGNvbnN0IHsgZGF0YTogaW5zZXJ0ZWQsIGVycm9yOiBpbnNlcnRFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgIC5pbnNlcnQoe1xyXG4gICAgICAgICAgZW1haWwsXHJcbiAgICAgICAgICByZWZlcnJhbF9jb2RlOiBnZW5lcmF0ZWRDb2RlLFxyXG4gICAgICAgICAgZmlyc3RfbmFtZTogZW1haWwuc3BsaXQoJ0AnKVswXSxcclxuICAgICAgICAgIGxhc3RfbmFtZTogJycsXHJcbiAgICAgICAgfSlcclxuICAgICAgICAuc2VsZWN0KCdyZWZlcnJhbF9jb2RlJylcclxuICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICBpZiAoaW5zZXJ0RXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjcmVhdGluZyByZWZlcnJhbCBjb2RlOicsIGluc2VydEVycm9yKTtcclxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGluc2VydEVycm9yLm1lc3NhZ2UgfTtcclxuICAgICAgfVxyXG4gICAgICB1cGRhdGVkUHJvZmlsZSA9IGluc2VydGVkO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHJlZmVycmFsQ29kZTogdXBkYXRlZFByb2ZpbGU/LnJlZmVycmFsX2NvZGUgfHwgZ2VuZXJhdGVkQ29kZSB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBnZXRPckNyZWF0ZVJlZmVycmFsQ29kZTonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBnZXQgcmVmZXJyYWwgY29kZScsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNlbmRSZWZlcnJhbEludml0ZXMoXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBpbnZpdGVFbWFpbHM6IHN0cmluZ1tdLFxyXG4gIHJlZmVycmFsQ29kZTogc3RyaW5nXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgc2VudD86IG51bWJlcjtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIFZhbGlkYXRlIGVtYWlsIGFkZHJlc3Nlc1xyXG4gICAgY29uc3QgdmFsaWRFbWFpbHMgPSBpbnZpdGVFbWFpbHNcclxuICAgICAgLm1hcCgoZSkgPT4gZS50cmltKCkpXHJcbiAgICAgIC5maWx0ZXIoKGUpID0+IHtcclxuICAgICAgICBpZiAoIWUpIHJldHVybiBmYWxzZTtcclxuICAgICAgICByZXR1cm4gL15bXlxcc0BdK0BbXlxcc0BdK1xcLlteXFxzQF0rJC8udGVzdChlKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgaWYgKHZhbGlkRW1haWxzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdObyB2YWxpZCBlbWFpbCBhZGRyZXNzZXMgcHJvdmlkZWQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ3JlYXRlIHJlZmVycmFsIHJlY29yZHMgZm9yIHRyYWNraW5nXHJcbiAgICBjb25zdCByZWZlcnJhbFJlY29yZHMgPSB2YWxpZEVtYWlscy5tYXAoKHJlZmVycmVkRW1haWwpID0+ICh7XHJcbiAgICAgIHJlZmVycmVyX2VtYWlsOiBlbWFpbCxcclxuICAgICAgcmVmZXJyZWRfZW1haWw6IHJlZmVycmVkRW1haWwsXHJcbiAgICAgIHJlZmVycmFsX2NvZGU6IHJlZmVycmFsQ29kZSxcclxuICAgICAgc3RhdHVzOiAncGVuZGluZycsXHJcbiAgICB9KSk7XHJcblxyXG4gICAgY29uc3QgeyBlcnJvcjogaW5zZXJ0RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdyZWZlcnJhbHMnKVxyXG4gICAgICAuaW5zZXJ0KHJlZmVycmFsUmVjb3Jkcyk7XHJcblxyXG4gICAgaWYgKGluc2VydEVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIHJlZmVycmFsIHJlY29yZHM6JywgaW5zZXJ0RXJyb3IpO1xyXG4gICAgICAvLyBDb250aW51ZSBldmVuIGlmIGluc2VydCBmYWlscyAtIHdlIHN0aWxsIHdhbnQgdG8gc2VuZCBlbWFpbHNcclxuICAgIH1cclxuXHJcbiAgICAvLyBHZW5lcmF0ZSByZWZlcnJhbCBsaW5rXHJcbiAgICBjb25zdCBiYXNlVXJsID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU0lURV9VUkwgfHwgJ2h0dHBzOi8vc2hhbGVhbi5jby56YSc7XHJcbiAgICBjb25zdCByZWZlcnJhbExpbmsgPSBgJHtiYXNlVXJsfS9ib29raW5nL2RldGFpbHM/cmVmPSR7cmVmZXJyYWxDb2RlfWA7XHJcblxyXG4gICAgLy8gVE9ETzogSW1wbGVtZW50IGFjdHVhbCBlbWFpbCBzZW5kaW5nIHVzaW5nIHlvdXIgZW1haWwgc2VydmljZSAoUmVzZW5kLCBTZW5kR3JpZCwgZXRjLilcclxuICAgIC8vIEZvciBub3csIHdlJ2xsIGp1c3QgbG9nIHRoZSBlbWFpbHMgdGhhdCB3b3VsZCBiZSBzZW50XHJcbiAgICBjb25zb2xlLmxvZygnUmVmZXJyYWwgaW52aXRlcyB0byBzZW5kOicsIHtcclxuICAgICAgZnJvbTogZW1haWwsXHJcbiAgICAgIHRvOiB2YWxpZEVtYWlscyxcclxuICAgICAgcmVmZXJyYWxDb2RlLFxyXG4gICAgICByZWZlcnJhbExpbmssXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBJbiBhIHJlYWwgaW1wbGVtZW50YXRpb24sIHlvdSB3b3VsZCBzZW5kIGVtYWlscyBoZXJlXHJcbiAgICAvLyBFeGFtcGxlIHdpdGggUmVzZW5kOlxyXG4gICAgLy8gYXdhaXQgcmVzZW5kLmVtYWlscy5zZW5kKHtcclxuICAgIC8vICAgZnJvbTogJ1NoYWxlYW4gPG5vcmVwbHlAc2hhbGVhbi5jby56YT4nLFxyXG4gICAgLy8gICB0bzogdmFsaWRFbWFpbHMsXHJcbiAgICAvLyAgIHN1YmplY3Q6ICdZb3VcXCd2ZSBiZWVuIGludml0ZWQgdG8gdHJ5IFNoYWxlYW4gQ2xlYW5pbmcgU2VydmljZXMhJyxcclxuICAgIC8vICAgaHRtbDogYDxwPllvdXIgZnJpZW5kIGhhcyBpbnZpdGVkIHlvdSB0byB0cnkgU2hhbGVhbi4gVXNlIGNvZGUgJHtyZWZlcnJhbENvZGV9IHRvIGdldCBSMTUwIG9mZiB5b3VyIGZpcnN0IGJvb2tpbmchPC9wPjxwPjxhIGhyZWY9XCIke3JlZmVycmFsTGlua31cIj5Cb29rIE5vdzwvYT48L3A+YCxcclxuICAgIC8vIH0pO1xyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHNlbnQ6IHZhbGlkRW1haWxzLmxlbmd0aCB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBzZW5kUmVmZXJyYWxJbnZpdGVzOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIHNlbmQgaW52aXRlcycsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFJlZmVycmFsU3RhdHMoXHJcbiAgZW1haWw6IHN0cmluZ1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIHN0YXRzPzoge1xyXG4gICAgdG90YWxSZWZlcnJhbHM6IG51bWJlcjtcclxuICAgIGNvbXBsZXRlZFJlZmVycmFsczogbnVtYmVyO1xyXG4gICAgcGVuZGluZ1Jld2FyZHM6IG51bWJlcjtcclxuICAgIHRvdGFsUmV3YXJkczogbnVtYmVyO1xyXG4gIH07XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICBjb25zdCB7IGRhdGE6IHJlZmVycmFscywgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdyZWZlcnJhbHMnKVxyXG4gICAgICAuc2VsZWN0KCdzdGF0dXMsIHJlZmVycmVyX3Jld2FyZF9hbW91bnQsIHJlZmVycmVyX3Jld2FyZF9zdGF0dXMnKVxyXG4gICAgICAuZXEoJ3JlZmVycmVyX2VtYWlsJywgZW1haWwpO1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyByZWZlcnJhbCBzdGF0czonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHN0YXRzID0ge1xyXG4gICAgICB0b3RhbFJlZmVycmFsczogcmVmZXJyYWxzPy5sZW5ndGggfHwgMCxcclxuICAgICAgY29tcGxldGVkUmVmZXJyYWxzOlxyXG4gICAgICAgIHJlZmVycmFscz8uZmlsdGVyKChyKSA9PiByLnN0YXR1cyA9PT0gJ2NvbXBsZXRlZCcpLmxlbmd0aCB8fCAwLFxyXG4gICAgICBwZW5kaW5nUmV3YXJkczpcclxuICAgICAgICByZWZlcnJhbHM/LmZpbHRlcigocikgPT4gci5yZWZlcnJlcl9yZXdhcmRfc3RhdHVzID09PSAncGVuZGluZycpLmxlbmd0aCB8fCAwLFxyXG4gICAgICB0b3RhbFJld2FyZHM6XHJcbiAgICAgICAgcmVmZXJyYWxzXHJcbiAgICAgICAgICA/LmZpbHRlcigocikgPT4gci5yZWZlcnJlcl9yZXdhcmRfc3RhdHVzID09PSAnY3JlZGl0ZWQnKVxyXG4gICAgICAgICAgLnJlZHVjZSgoc3VtLCByKSA9PiBzdW0gKyAoci5yZWZlcnJlcl9yZXdhcmRfYW1vdW50IHx8IDApLCAwKSB8fCAwLFxyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBzdGF0cyB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBnZXRSZWZlcnJhbFN0YXRzOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGZldGNoIHJlZmVycmFsIHN0YXRzJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogSW5pdGlhbGl6ZSBhIGNyZWRpdCBwdXJjaGFzZSB3aXRoIFBheXN0YWNrXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaW5pdGlhbGl6ZUNyZWRpdFB1cmNoYXNlKFxyXG4gIGVtYWlsOiBzdHJpbmcsXHJcbiAgYW1vdW50OiBudW1iZXIsXHJcbiAgcGF5bWVudE1ldGhvZDogJ2NyZWRpdF9jYXJkJyB8ICdlZnQnXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgYXV0aG9yaXphdGlvblVybD86IHN0cmluZztcclxuICByZWZlcmVuY2U/OiBzdHJpbmc7XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgaWYgKGFtb3VudCA8IDIwIHx8IGFtb3VudCA+IDUwMDApIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogJ0Ftb3VudCBtdXN0IGJlIGJldHdlZW4gUjIwIGFuZCBSNTAwMCcsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gR2VuZXJhdGUgYSB1bmlxdWUgcmVmZXJlbmNlIGZvciB0aGlzIGNyZWRpdCBwdXJjaGFzZVxyXG4gICAgY29uc3QgcmVmZXJlbmNlID0gYENSRURJVF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIsIDkpfWA7XHJcblxyXG4gICAgLy8gQ3JlYXRlIGEgcGVuZGluZyBjcmVkaXQgdHJhbnNhY3Rpb25cclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcbiAgICBcclxuICAgIC8vIEdldCBvciBjcmVhdGUgcHJvZmlsZVxyXG4gICAgbGV0IHsgZGF0YTogcHJvZmlsZSB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcclxuICAgICAgLnNlbGVjdCgnaWQsIGNyZWRpdF9iYWxhbmNlJylcclxuICAgICAgLmVxKCdlbWFpbCcsIGVtYWlsKVxyXG4gICAgICAubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoIXByb2ZpbGUpIHtcclxuICAgICAgLy8gQ3JlYXRlIGEgYmFzaWMgcHJvZmlsZSBpZiBpdCBkb2Vzbid0IGV4aXN0XHJcbiAgICAgIGNvbnN0IHsgZGF0YTogbmV3UHJvZmlsZSwgZXJyb3I6IGNyZWF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgICAgLmluc2VydCh7XHJcbiAgICAgICAgICBlbWFpbCxcclxuICAgICAgICAgIGNyZWRpdF9iYWxhbmNlOiAwLFxyXG4gICAgICAgICAgZmlyc3RfbmFtZTogJycsXHJcbiAgICAgICAgICBsYXN0X25hbWU6ICcnLFxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnNlbGVjdCgnaWQsIGNyZWRpdF9iYWxhbmNlJylcclxuICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICBpZiAoY3JlYXRlRXJyb3IgfHwgIW5ld1Byb2ZpbGUpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICBlcnJvcjogJ0ZhaWxlZCB0byBjcmVhdGUgcHJvZmlsZScsXHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG4gICAgICBwcm9maWxlID0gbmV3UHJvZmlsZTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDcmVhdGUgcGVuZGluZyBjcmVkaXQgdHJhbnNhY3Rpb25cclxuICAgIGNvbnN0IHsgZXJyb3I6IHRyYW5zYWN0aW9uRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdjcmVkaXRfdHJhbnNhY3Rpb25zJylcclxuICAgICAgLmluc2VydCh7XHJcbiAgICAgICAgcHJvZmlsZV9pZDogcHJvZmlsZS5pZCxcclxuICAgICAgICBlbWFpbCxcclxuICAgICAgICB0cmFuc2FjdGlvbl90eXBlOiAncHVyY2hhc2UnLFxyXG4gICAgICAgIGFtb3VudCxcclxuICAgICAgICBiYWxhbmNlX2JlZm9yZTogcHJvZmlsZS5jcmVkaXRfYmFsYW5jZSB8fCAwLFxyXG4gICAgICAgIGJhbGFuY2VfYWZ0ZXI6IHByb2ZpbGUuY3JlZGl0X2JhbGFuY2UgfHwgMCwgLy8gV29uJ3QgdXBkYXRlIHVudGlsIHBheW1lbnQgc3VjY2VlZHNcclxuICAgICAgICBwYXltZW50X21ldGhvZDogcGF5bWVudE1ldGhvZCxcclxuICAgICAgICBwYXlzdGFja19yZWZlcmVuY2U6IHJlZmVyZW5jZSxcclxuICAgICAgICBwYXltZW50X3N0YXR1czogJ3BlbmRpbmcnLFxyXG4gICAgICAgIGRlc2NyaXB0aW9uOiBgUHVyY2hhc2Ugb2YgUiR7YW1vdW50fSBTaGFsZWFuQ3JlZGAsXHJcbiAgICAgIH0pO1xyXG5cclxuICAgIGlmICh0cmFuc2FjdGlvbkVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIGNyZWRpdCB0cmFuc2FjdGlvbjonLCB0cmFuc2FjdGlvbkVycm9yKTtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogJ0ZhaWxlZCB0byBjcmVhdGUgdHJhbnNhY3Rpb24gcmVjb3JkJyxcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBJbml0aWFsaXplIFBheXN0YWNrIHBheW1lbnRcclxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goJy9hcGkvcGF5c3RhY2svaW5pdGlhbGl6ZScsIHtcclxuICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxyXG4gICAgICB9LFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgZW1haWwsXHJcbiAgICAgICAgYW1vdW50LFxyXG4gICAgICAgIHJlZmVyZW5jZSxcclxuICAgICAgICBtZXRhZGF0YToge1xyXG4gICAgICAgICAgdHJhbnNhY3Rpb25fdHlwZTogJ2NyZWRpdF9wdXJjaGFzZScsXHJcbiAgICAgICAgICBwYXltZW50X21ldGhvZDogcGF5bWVudE1ldGhvZCxcclxuICAgICAgICB9LFxyXG4gICAgICB9KSxcclxuICAgIH0pO1xyXG5cclxuICAgIGlmICghcmVzcG9uc2Uub2spIHtcclxuICAgICAgY29uc3QgZXJyb3IgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6IGVycm9yLmVycm9yIHx8ICdGYWlsZWQgdG8gaW5pdGlhbGl6ZSBwYXltZW50JyxcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBwYXltZW50RGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcclxuXHJcbiAgICBpZiAoIXBheW1lbnREYXRhLnN0YXR1cykge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIGVycm9yOiBwYXltZW50RGF0YS5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gaW5pdGlhbGl6ZSBwYXltZW50JyxcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICBhdXRob3JpemF0aW9uVXJsOiBwYXltZW50RGF0YS5kYXRhLmF1dGhvcml6YXRpb25fdXJsLFxyXG4gICAgICByZWZlcmVuY2U6IHBheW1lbnREYXRhLmRhdGEucmVmZXJlbmNlLFxyXG4gICAgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW5pdGlhbGl6aW5nIGNyZWRpdCBwdXJjaGFzZTonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBpbml0aWFsaXplIHBheW1lbnQnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgVm91Y2hlclJlZGVtcHRpb24ge1xyXG4gIGlkOiBzdHJpbmc7XHJcbiAgdm91Y2hlcl9jb2RlOiBzdHJpbmc7XHJcbiAgYW1vdW50OiBudW1iZXI7XHJcbiAgcmVkZWVtZWRfYXQ6IHN0cmluZztcclxuICBib29raW5nX2lkPzogc3RyaW5nO1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVkZWVtVm91Y2hlcihcclxuICBjb2RlOiBzdHJpbmcsXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBwaG9uZT86IHN0cmluZ1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGFtb3VudD86IG51bWJlcjtcclxuICBuZXdCYWxhbmNlPzogbnVtYmVyO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgLy8gQ2FsbCB0aGUgZGF0YWJhc2UgZnVuY3Rpb24gdG8gcmVkZWVtIHRoZSB2b3VjaGVyXHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5ycGMoJ3JlZGVlbV92b3VjaGVyJywge1xyXG4gICAgICBwX2NvZGU6IGNvZGUudHJpbSgpLnRvVXBwZXJDYXNlKCksXHJcbiAgICAgIHBfZW1haWw6IGVtYWlsLnRyaW0oKSxcclxuICAgICAgcF9waG9uZTogcGhvbmU/LnRyaW0oKSB8fCBudWxsLFxyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHJlZGVlbWluZyB2b3VjaGVyOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZSB8fCAnRmFpbGVkIHRvIHJlZGVlbSB2b3VjaGVyJyxcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBQYXJzZSB0aGUgcmVzdWx0IGZyb20gdGhlIGZ1bmN0aW9uIChoYW5kbGUgYm90aCBvYmplY3QgYW5kIHN0cmluZyBKU09OQilcclxuICAgIGxldCByZXN1bHQgPSBkYXRhO1xyXG4gICAgaWYgKHR5cGVvZiBkYXRhID09PSAnc3RyaW5nJykge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIHJlc3VsdCA9IEpTT04ucGFyc2UoZGF0YSk7XHJcbiAgICAgIH0gY2F0Y2ggKHBhcnNlRXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBwYXJzaW5nIHZvdWNoZXIgcmVkZW1wdGlvbiByZXN1bHQ6JywgcGFyc2VFcnJvcik7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgZXJyb3I6ICdJbnZhbGlkIHJlc3BvbnNlIGZyb20gc2VydmVyJyxcclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHJlc3VsdCAmJiB0eXBlb2YgcmVzdWx0ID09PSAnb2JqZWN0JyAmJiAnc3VjY2VzcycgaW4gcmVzdWx0KSB7XHJcbiAgICAgIGlmIChyZXN1bHQuc3VjY2VzcyA9PT0gZmFsc2UpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICBlcnJvcjogcmVzdWx0LmVycm9yIHx8ICdGYWlsZWQgdG8gcmVkZWVtIHZvdWNoZXInLFxyXG4gICAgICAgIH07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICBhbW91bnQ6IHJlc3VsdC5hbW91bnQsXHJcbiAgICAgICAgbmV3QmFsYW5jZTogcmVzdWx0Lm5ld19iYWxhbmNlLFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogJ1VuZXhwZWN0ZWQgcmVzcG9uc2UgZnJvbSBzZXJ2ZXInLFxyXG4gICAgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gcmVkZWVtVm91Y2hlcjonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byByZWRlZW0gdm91Y2hlcicsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFZvdWNoZXJSZWRlbXB0aW9ucyhcclxuICBlbWFpbDogc3RyaW5nLFxyXG4gIHBob25lPzogc3RyaW5nXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgcmVkZW1wdGlvbnM/OiBWb3VjaGVyUmVkZW1wdGlvbltdO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgbGV0IHF1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ3ZvdWNoZXJfcmVkZW1wdGlvbnMnKVxyXG4gICAgICAuc2VsZWN0KCdpZCwgdm91Y2hlcl9jb2RlLCBhbW91bnQsIHJlZGVlbWVkX2F0LCBib29raW5nX2lkJylcclxuICAgICAgLm9yZGVyKCdyZWRlZW1lZF9hdCcsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KTtcclxuXHJcbiAgICAvLyBCdWlsZCBxdWVyeSBmb3IgZW1haWwvcGhvbmUgbG9va3VwXHJcbiAgICAvLyBQcmlvcml0aXplIGVtYWlsIGFzIGl0J3MgdGhlIHByaW1hcnkgaWRlbnRpZmllciB0byBwcmV2ZW50IGNyb3NzLWFjY291bnQgdmlzaWJpbGl0eVxyXG4gICAgaWYgKGVtYWlsKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ2VtYWlsJywgZW1haWwpO1xyXG4gICAgICAvLyBJZiBwaG9uZSBpcyBhbHNvIHByb3ZpZGVkLCB3ZSBjYW4gb3B0aW9uYWxseSBmaWx0ZXIgYnkgYm90aCBmb3IgZXh0cmEgc2VjdXJpdHlcclxuICAgICAgLy8gYnV0IGVtYWlsIGFsb25lIHNob3VsZCBiZSBzdWZmaWNpZW50IHNpbmNlIGl0J3MgdW5pcXVlXHJcbiAgICB9IGVsc2UgaWYgKHBob25lKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ3Bob25lJywgcGhvbmUpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRW1haWwgb3IgcGhvbmUgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgcXVlcnk7XHJcblxyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIHZvdWNoZXIgcmVkZW1wdGlvbnM6JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBUcmFuc2Zvcm0gdGhlIGRhdGEgdG8gbWF0Y2ggdGhlIGludGVyZmFjZVxyXG4gICAgY29uc3QgcmVkZW1wdGlvbnM6IFZvdWNoZXJSZWRlbXB0aW9uW10gPSAoZGF0YSB8fCBbXSkubWFwKChyZWRlbXB0aW9uKSA9PiAoe1xyXG4gICAgICBpZDogcmVkZW1wdGlvbi5pZCxcclxuICAgICAgdm91Y2hlcl9jb2RlOiByZWRlbXB0aW9uLnZvdWNoZXJfY29kZSxcclxuICAgICAgYW1vdW50OiByZWRlbXB0aW9uLmFtb3VudCxcclxuICAgICAgcmVkZWVtZWRfYXQ6IHJlZGVtcHRpb24ucmVkZWVtZWRfYXQsXHJcbiAgICAgIGJvb2tpbmdfaWQ6IHJlZGVtcHRpb24uYm9va2luZ19pZCB8fCB1bmRlZmluZWQsXHJcbiAgICB9KSk7XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcmVkZW1wdGlvbnMgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gZ2V0Vm91Y2hlclJlZGVtcHRpb25zOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGZldGNoIHZvdWNoZXIgcmVkZW1wdGlvbnMnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiMlJBb2dCc0IsMkxBQUEifQ==
}),
"[project]/app/dashboard/data:2709a4 [app-ssr] (ecmascript) <text/javascript>", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "updateLocation",
    ()=>$$RSC_SERVER_ACTION_10
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-ssr] (ecmascript)");
/* __next_internal_action_entry_do_not_use__ [{"60d9b390bb62bf267a9022110594d83f38b182252b":"updateLocation"},"app/dashboard/actions.ts",""] */ "use turbopack no side effects";
;
const $$RSC_SERVER_ACTION_10 = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["createServerReference"])("60d9b390bb62bf267a9022110594d83f38b182252b", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["findSourceMapURL"], "updateLocation");
;
 //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vYWN0aW9ucy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHNlcnZlcic7XHJcblxyXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAL2xpYi9zdXBhYmFzZS9zZXJ2ZXInO1xyXG5pbXBvcnQgeyBCb29raW5nIH0gZnJvbSAnQC90eXBlcy9ib29raW5nJztcclxuaW1wb3J0IHsgUHJvZmlsZSwgUHJvZmlsZVVwZGF0ZUlucHV0IH0gZnJvbSAnQC90eXBlcy9wcm9maWxlJztcclxuaW1wb3J0IHsgTG9jYXRpb24sIExvY2F0aW9uQ3JlYXRlSW5wdXQsIExvY2F0aW9uVXBkYXRlSW5wdXQgfSBmcm9tICdAL3R5cGVzL2xvY2F0aW9uJztcclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBdXRoZW50aWNhdGVkVXNlcigpOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGVtYWlsPzogc3RyaW5nO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcbiAgICBjb25zdCB7IGRhdGE6IHsgdXNlciB9LCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XHJcblxyXG4gICAgaWYgKGVycm9yIHx8ICF1c2VyKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ05vdCBhdXRoZW50aWNhdGVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGVtYWlsOiB1c2VyLmVtYWlsIHx8IHVuZGVmaW5lZCB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBnZXRBdXRoZW50aWNhdGVkVXNlcjonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBnZXQgdXNlcicsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEN1c3RvbWVyQm9va2luZ3MoXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBwaG9uZT86IHN0cmluZyxcclxuICBmaWx0ZXI/OiAnYWxsJyB8ICd1cGNvbWluZycgfCAnY29tcGxldGVkJyB8ICdjYW5jZWxsZWQnXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgYm9va2luZ3M/OiBCb29raW5nW107XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICBsZXQgcXVlcnkgPSBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnYm9va2luZ3MnKVxyXG4gICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgLm9yZGVyKCdzZXJ2aWNlX2RhdGUnLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcclxuICAgICAgLm9yZGVyKCdjcmVhdGVkX2F0JywgeyBhc2NlbmRpbmc6IGZhbHNlIH0pO1xyXG5cclxuICAgIC8vIEJ1aWxkIHF1ZXJ5IGZvciBlbWFpbC9waG9uZSBsb29rdXBcclxuICAgIGlmIChlbWFpbCAmJiBwaG9uZSkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5Lm9yKGBjdXN0b21lcl9lbWFpbC5lcS4ke2VtYWlsfSxjdXN0b21lcl9waG9uZS5lcS4ke3Bob25lfWApO1xyXG4gICAgfSBlbHNlIGlmIChlbWFpbCkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdjdXN0b21lcl9lbWFpbCcsIGVtYWlsKTtcclxuICAgIH0gZWxzZSBpZiAocGhvbmUpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnY3VzdG9tZXJfcGhvbmUnLCBwaG9uZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdFbWFpbCBvciBwaG9uZSBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBBcHBseSBzdGF0dXMgZmlsdGVyXHJcbiAgICBpZiAoZmlsdGVyICYmIGZpbHRlciAhPT0gJ2FsbCcpIHtcclxuICAgICAgaWYgKGZpbHRlciA9PT0gJ3VwY29taW5nJykge1xyXG4gICAgICAgIHF1ZXJ5ID0gcXVlcnkuaW4oJ3N0YXR1cycsIFsncGVuZGluZycsICdjb25maXJtZWQnXSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnc3RhdHVzJywgZmlsdGVyKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHF1ZXJ5O1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBib29raW5nczonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGJvb2tpbmdzOiBkYXRhIHx8IFtdIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGdldEN1c3RvbWVyQm9va2luZ3M6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gZmV0Y2ggYm9va2luZ3MnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDdXN0b21lckJvb2tpbmdTdGF0cyhcclxuICBlbWFpbDogc3RyaW5nLFxyXG4gIHBob25lPzogc3RyaW5nXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgc3RhdHM/OiB7XHJcbiAgICB0b3RhbDogbnVtYmVyO1xyXG4gICAgdXBjb21pbmc6IG51bWJlcjtcclxuICAgIGNvbXBsZXRlZDogbnVtYmVyO1xyXG4gICAgY2FuY2VsbGVkOiBudW1iZXI7XHJcbiAgICB0b3RhbFNwZW50OiBudW1iZXI7XHJcbiAgfTtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIGxldCBxdWVyeSA9IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdib29raW5ncycpXHJcbiAgICAgIC5zZWxlY3QoJ3N0YXR1cywgdG90YWxfYW1vdW50LCBwYXltZW50X3N0YXR1cycpO1xyXG5cclxuICAgIC8vIEJ1aWxkIHF1ZXJ5IGZvciBlbWFpbC9waG9uZSBsb29rdXBcclxuICAgIGlmIChlbWFpbCAmJiBwaG9uZSkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5Lm9yKGBjdXN0b21lcl9lbWFpbC5lcS4ke2VtYWlsfSxjdXN0b21lcl9waG9uZS5lcS4ke3Bob25lfWApO1xyXG4gICAgfSBlbHNlIGlmIChlbWFpbCkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdjdXN0b21lcl9lbWFpbCcsIGVtYWlsKTtcclxuICAgIH0gZWxzZSBpZiAocGhvbmUpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnY3VzdG9tZXJfcGhvbmUnLCBwaG9uZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdFbWFpbCBvciBwaG9uZSBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBxdWVyeTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgc3RhdHMgPSB7XHJcbiAgICAgIHRvdGFsOiBkYXRhPy5sZW5ndGggfHwgMCxcclxuICAgICAgdXBjb21pbmc6IGRhdGE/LmZpbHRlcigoYikgPT4gYi5zdGF0dXMgPT09ICdwZW5kaW5nJyB8fCBiLnN0YXR1cyA9PT0gJ2NvbmZpcm1lZCcpLmxlbmd0aCB8fCAwLFxyXG4gICAgICBjb21wbGV0ZWQ6IGRhdGE/LmZpbHRlcigoYikgPT4gYi5zdGF0dXMgPT09ICdjb21wbGV0ZWQnKS5sZW5ndGggfHwgMCxcclxuICAgICAgY2FuY2VsbGVkOiBkYXRhPy5maWx0ZXIoKGIpID0+IGIuc3RhdHVzID09PSAnY2FuY2VsbGVkJykubGVuZ3RoIHx8IDAsXHJcbiAgICAgIHRvdGFsU3BlbnQ6IGRhdGFcclxuICAgICAgICA/LmZpbHRlcigoYikgPT4gYi5wYXltZW50X3N0YXR1cyA9PT0gJ3BhaWQnKVxyXG4gICAgICAgIC5yZWR1Y2UoKHN1bSwgYikgPT4gc3VtICsgKGIudG90YWxfYW1vdW50IHx8IDApLCAwKSB8fCAwLFxyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBzdGF0cyB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBmZXRjaCBzdGF0cycsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEJvb2tpbmdCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGJvb2tpbmc/OiBCb29raW5nO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2Jvb2tpbmdzJylcclxuICAgICAgLnNlbGVjdCgnKicpXHJcbiAgICAgIC5lcSgnaWQnLCBpZClcclxuICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBib29raW5nOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnQm9va2luZyBub3QgZm91bmQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYm9va2luZzogZGF0YSB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdVbmV4cGVjdGVkIGVycm9yIGZldGNoaW5nIGJvb2tpbmc6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q3VzdG9tZXJQcm9maWxlKFxyXG4gIGVtYWlsOiBzdHJpbmcsXHJcbiAgcGhvbmU/OiBzdHJpbmdcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBwcm9maWxlPzogUHJvZmlsZTtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIEZpcnN0LCB0cnkgdG8gZ2V0IHByb2ZpbGUgZnJvbSBwcm9maWxlcyB0YWJsZVxyXG4gICAgbGV0IHF1ZXJ5ID0gc3VwYWJhc2UuZnJvbSgncHJvZmlsZXMnKS5zZWxlY3QoJyonKTtcclxuXHJcbiAgICBpZiAoZW1haWwpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnZW1haWwnLCBlbWFpbCk7XHJcbiAgICB9IGVsc2UgaWYgKHBob25lKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ3Bob25lJywgcGhvbmUpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRW1haWwgb3IgcGhvbmUgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBkYXRhOiBwcm9maWxlRGF0YSwgZXJyb3I6IHByb2ZpbGVFcnJvciB9ID0gYXdhaXQgcXVlcnkubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgICAvLyBJZiBwcm9maWxlIGV4aXN0cywgcmV0dXJuIGl0XHJcbiAgICBpZiAocHJvZmlsZURhdGEgJiYgIXByb2ZpbGVFcnJvcikge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBwcm9maWxlOiBwcm9maWxlRGF0YSB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIElmIG5vIHByb2ZpbGUgZXhpc3RzLCBkZXJpdmUgZnJvbSBtb3N0IHJlY2VudCBib29raW5nXHJcbiAgICBsZXQgYm9va2luZ1F1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2Jvb2tpbmdzJylcclxuICAgICAgLnNlbGVjdCgnY3VzdG9tZXJfZmlyc3RfbmFtZSwgY3VzdG9tZXJfbGFzdF9uYW1lLCBjdXN0b21lcl9lbWFpbCwgY3VzdG9tZXJfcGhvbmUnKVxyXG4gICAgICAub3JkZXIoJ2NyZWF0ZWRfYXQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcclxuICAgICAgLmxpbWl0KDEpO1xyXG5cclxuICAgIGlmIChlbWFpbCAmJiBwaG9uZSkge1xyXG4gICAgICBib29raW5nUXVlcnkgPSBib29raW5nUXVlcnkub3IoYGN1c3RvbWVyX2VtYWlsLmVxLiR7ZW1haWx9LGN1c3RvbWVyX3Bob25lLmVxLiR7cGhvbmV9YCk7XHJcbiAgICB9IGVsc2UgaWYgKGVtYWlsKSB7XHJcbiAgICAgIGJvb2tpbmdRdWVyeSA9IGJvb2tpbmdRdWVyeS5lcSgnY3VzdG9tZXJfZW1haWwnLCBlbWFpbCk7XHJcbiAgICB9IGVsc2UgaWYgKHBob25lKSB7XHJcbiAgICAgIGJvb2tpbmdRdWVyeSA9IGJvb2tpbmdRdWVyeS5lcSgnY3VzdG9tZXJfcGhvbmUnLCBwaG9uZSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBkYXRhOiBib29raW5nRGF0YSwgZXJyb3I6IGJvb2tpbmdFcnJvciB9ID0gYXdhaXQgYm9va2luZ1F1ZXJ5Lm1heWJlU2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKGJvb2tpbmdFcnJvciB8fCAhYm9va2luZ0RhdGEpIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogJ05vIHByb2ZpbGUgb3IgYm9va2luZyBmb3VuZC4gUGxlYXNlIGNyZWF0ZSBhIGJvb2tpbmcgZmlyc3QuJyxcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDcmVhdGUgYSBwcm9maWxlIG9iamVjdCBmcm9tIGJvb2tpbmcgZGF0YVxyXG4gICAgY29uc3QgZGVyaXZlZFByb2ZpbGU6IFByb2ZpbGUgPSB7XHJcbiAgICAgIGlkOiAnJywgLy8gV2lsbCBiZSBnZW5lcmF0ZWQgd2hlbiBzYXZlZFxyXG4gICAgICBlbWFpbDogYm9va2luZ0RhdGEuY3VzdG9tZXJfZW1haWwsXHJcbiAgICAgIHBob25lOiBib29raW5nRGF0YS5jdXN0b21lcl9waG9uZSB8fCBudWxsLFxyXG4gICAgICBmaXJzdF9uYW1lOiBib29raW5nRGF0YS5jdXN0b21lcl9maXJzdF9uYW1lLFxyXG4gICAgICBsYXN0X25hbWU6IGJvb2tpbmdEYXRhLmN1c3RvbWVyX2xhc3RfbmFtZSxcclxuICAgICAgY3JlYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHByb2ZpbGU6IGRlcml2ZWRQcm9maWxlIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGdldEN1c3RvbWVyUHJvZmlsZTonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBmZXRjaCBwcm9maWxlJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBsb2FkUHJvZmlsZVBpY3R1cmUoXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBmaWxlOiBGaWxlXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgdXJsPzogc3RyaW5nO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgLy8gVmFsaWRhdGUgZmlsZVxyXG4gICAgaWYgKCFmaWxlKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ05vIGZpbGUgcHJvdmlkZWQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVmFsaWRhdGUgZmlsZSB0eXBlXHJcbiAgICBjb25zdCB2YWxpZEltYWdlVHlwZXMgPSBbJ2ltYWdlL2pwZWcnLCAnaW1hZ2UvanBnJywgJ2ltYWdlL3BuZycsICdpbWFnZS93ZWJwJ107XHJcbiAgICBpZiAoIXZhbGlkSW1hZ2VUeXBlcy5pbmNsdWRlcyhmaWxlLnR5cGUpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ludmFsaWQgZmlsZSB0eXBlLiBQbGVhc2UgdXBsb2FkIGEgSlBFRywgUE5HLCBvciBXZWJQIGltYWdlLicgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBWYWxpZGF0ZSBmaWxlIHNpemUgKG1heCA1TUIpXHJcbiAgICBjb25zdCBtYXhTaXplID0gNSAqIDEwMjQgKiAxMDI0OyAvLyA1TUIgaW4gYnl0ZXNcclxuICAgIGlmIChmaWxlLnNpemUgPiBtYXhTaXplKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ZpbGUgc2l6ZSB0b28gbGFyZ2UuIFBsZWFzZSB1cGxvYWQgYW4gaW1hZ2Ugc21hbGxlciB0aGFuIDVNQi4nIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gR2VuZXJhdGUgdW5pcXVlIGZpbGVuYW1lIHVzaW5nIGVtYWlsIGFuZCB0aW1lc3RhbXBcclxuICAgIGNvbnN0IGZpbGVFeHQgPSBmaWxlLm5hbWUuc3BsaXQoJy4nKS5wb3AoKTtcclxuICAgIGNvbnN0IGZpbGVOYW1lID0gYCR7ZW1haWwucmVwbGFjZSgvW15hLXpBLVowLTldL2csICdfJyl9XyR7RGF0ZS5ub3coKX0uJHtmaWxlRXh0fWA7XHJcbiAgICBjb25zdCBmaWxlUGF0aCA9IGBhdmF0YXJzLyR7ZmlsZU5hbWV9YDtcclxuXHJcbiAgICAvLyBDb252ZXJ0IEZpbGUgdG8gQXJyYXlCdWZmZXIgZm9yIHVwbG9hZFxyXG4gICAgY29uc3QgYXJyYXlCdWZmZXIgPSBhd2FpdCBmaWxlLmFycmF5QnVmZmVyKCk7XHJcbiAgICBjb25zdCBidWZmZXIgPSBCdWZmZXIuZnJvbShhcnJheUJ1ZmZlcik7XHJcblxyXG4gICAgLy8gVXBsb2FkIHRvIFN1cGFiYXNlIFN0b3JhZ2VcclxuICAgIGNvbnN0IHsgZGF0YTogdXBsb2FkRGF0YSwgZXJyb3I6IHVwbG9hZEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5zdG9yYWdlXHJcbiAgICAgIC5mcm9tKCdwcm9maWxlLXBpY3R1cmVzJylcclxuICAgICAgLnVwbG9hZChmaWxlUGF0aCwgYnVmZmVyLCB7XHJcbiAgICAgICAgY29udGVudFR5cGU6IGZpbGUudHlwZSxcclxuICAgICAgICB1cHNlcnQ6IGZhbHNlLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICBpZiAodXBsb2FkRXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBsb2FkaW5nIGZpbGU6JywgdXBsb2FkRXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHVwbG9hZEVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBHZXQgcHVibGljIFVSTFxyXG4gICAgY29uc3QgeyBkYXRhOiB1cmxEYXRhIH0gPSBzdXBhYmFzZS5zdG9yYWdlXHJcbiAgICAgIC5mcm9tKCdwcm9maWxlLXBpY3R1cmVzJylcclxuICAgICAgLmdldFB1YmxpY1VybChmaWxlUGF0aCk7XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdXJsOiB1cmxEYXRhLnB1YmxpY1VybCB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiB1cGxvYWRQcm9maWxlUGljdHVyZTonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byB1cGxvYWQgcHJvZmlsZSBwaWN0dXJlJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZGVsZXRlUHJvZmlsZVBpY3R1cmUoZW1haWw6IHN0cmluZywgYXZhdGFyVXJsOiBzdHJpbmcpOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgLy8gRXh0cmFjdCBmaWxlIHBhdGggZnJvbSBVUkxcclxuICAgIGNvbnN0IHVybFBhcnRzID0gYXZhdGFyVXJsLnNwbGl0KCcvcHJvZmlsZS1waWN0dXJlcy8nKTtcclxuICAgIGlmICh1cmxQYXJ0cy5sZW5ndGggPCAyKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ludmFsaWQgYXZhdGFyIFVSTCcgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBmaWxlUGF0aCA9IGBhdmF0YXJzLyR7dXJsUGFydHNbMV0uc3BsaXQoJy8nKS5wb3AoKX1gO1xyXG5cclxuICAgIC8vIERlbGV0ZSBmcm9tIHN0b3JhZ2VcclxuICAgIGNvbnN0IHsgZXJyb3I6IGRlbGV0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5zdG9yYWdlXHJcbiAgICAgIC5mcm9tKCdwcm9maWxlLXBpY3R1cmVzJylcclxuICAgICAgLnJlbW92ZShbZmlsZVBhdGhdKTtcclxuXHJcbiAgICBpZiAoZGVsZXRlRXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZGVsZXRpbmcgZmlsZTonLCBkZWxldGVFcnJvcik7XHJcbiAgICAgIC8vIERvbid0IGZhaWwgaWYgZmlsZSBkb2Vzbid0IGV4aXN0XHJcbiAgICAgIGlmIChkZWxldGVFcnJvci5tZXNzYWdlLmluY2x1ZGVzKCdub3QgZm91bmQnKSkge1xyXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGRlbGV0ZUVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGRlbGV0ZVByb2ZpbGVQaWN0dXJlOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGRlbGV0ZSBwcm9maWxlIHBpY3R1cmUnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGRhdGVDdXN0b21lclByb2ZpbGUoXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBkYXRhOiBQcm9maWxlVXBkYXRlSW5wdXRcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBwcm9maWxlPzogUHJvZmlsZTtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIFZhbGlkYXRlIGlucHV0XHJcbiAgICBpZiAoIWRhdGEuZmlyc3RfbmFtZT8udHJpbSgpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ZpcnN0IG5hbWUgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcbiAgICBpZiAoIWRhdGEubGFzdF9uYW1lPy50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTGFzdCBuYW1lIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG4gICAgaWYgKCFkYXRhLmVtYWlsPy50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRW1haWwgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcbiAgICBpZiAoIS9eW15cXHNAXStAW15cXHNAXStcXC5bXlxcc0BdKyQvLnRlc3QoZGF0YS5lbWFpbCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnSW52YWxpZCBlbWFpbCBmb3JtYXQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ2hlY2sgaWYgcHJvZmlsZSBleGlzdHNcclxuICAgIGNvbnN0IHsgZGF0YTogZXhpc3RpbmdQcm9maWxlIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgLmVxKCdlbWFpbCcsIGVtYWlsKVxyXG4gICAgICAubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgICAvLyBJZiBhdmF0YXJfdXJsIGlzIGJlaW5nIHJlbW92ZWQsIGRlbGV0ZSB0aGUgb2xkIGZpbGVcclxuICAgIGlmIChleGlzdGluZ1Byb2ZpbGU/LmF2YXRhcl91cmwgJiYgZGF0YS5hdmF0YXJfdXJsID09PSBudWxsKSB7XHJcbiAgICAgIGF3YWl0IGRlbGV0ZVByb2ZpbGVQaWN0dXJlKGVtYWlsLCBleGlzdGluZ1Byb2ZpbGUuYXZhdGFyX3VybCk7XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IHJlc3VsdDtcclxuICAgIGlmIChleGlzdGluZ1Byb2ZpbGUpIHtcclxuICAgICAgLy8gVXBkYXRlIGV4aXN0aW5nIHByb2ZpbGVcclxuICAgICAgLy8gSWYgZW1haWwgY2hhbmdlZCwgd2UgbmVlZCB0byBoYW5kbGUgaXQgY2FyZWZ1bGx5XHJcbiAgICAgIGlmIChkYXRhLmVtYWlsICE9PSBlbWFpbCkge1xyXG4gICAgICAgIC8vIENoZWNrIGlmIG5ldyBlbWFpbCBhbHJlYWR5IGV4aXN0c1xyXG4gICAgICAgIGNvbnN0IHsgZGF0YTogZW1haWxDaGVjayB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgICAgICAuc2VsZWN0KCdpZCcpXHJcbiAgICAgICAgICAuZXEoJ2VtYWlsJywgZGF0YS5lbWFpbClcclxuICAgICAgICAgIC5tYXliZVNpbmdsZSgpO1xyXG5cclxuICAgICAgICBpZiAoZW1haWxDaGVjaykge1xyXG4gICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRW1haWwgYWxyZWFkeSBleGlzdHMnIH07XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCB1cGRhdGVEYXRhOiBhbnkgPSB7XHJcbiAgICAgICAgZmlyc3RfbmFtZTogZGF0YS5maXJzdF9uYW1lLnRyaW0oKSxcclxuICAgICAgICBsYXN0X25hbWU6IGRhdGEubGFzdF9uYW1lLnRyaW0oKSxcclxuICAgICAgICBlbWFpbDogZGF0YS5lbWFpbC50cmltKCksXHJcbiAgICAgICAgcGhvbmU6IGRhdGEucGhvbmU/LnRyaW0oKSB8fCBudWxsLFxyXG4gICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8vIE9ubHkgdXBkYXRlIGF2YXRhcl91cmwgaWYgaXQncyBwcm92aWRlZFxyXG4gICAgICBpZiAoZGF0YS5hdmF0YXJfdXJsICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICB1cGRhdGVEYXRhLmF2YXRhcl91cmwgPSBkYXRhLmF2YXRhcl91cmw7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IHsgZGF0YTogdXBkYXRlZFByb2ZpbGUsIGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgIC51cGRhdGUodXBkYXRlRGF0YSlcclxuICAgICAgICAuZXEoJ2VtYWlsJywgZW1haWwpXHJcbiAgICAgICAgLnNlbGVjdCgpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgaWYgKHVwZGF0ZUVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBkYXRpbmcgcHJvZmlsZTonLCB1cGRhdGVFcnJvcik7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB1cGRhdGVFcnJvci5tZXNzYWdlIH07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJlc3VsdCA9IHVwZGF0ZWRQcm9maWxlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8gQ3JlYXRlIG5ldyBwcm9maWxlXHJcbiAgICAgIGNvbnN0IGluc2VydERhdGE6IGFueSA9IHtcclxuICAgICAgICBlbWFpbDogZGF0YS5lbWFpbC50cmltKCksXHJcbiAgICAgICAgcGhvbmU6IGRhdGEucGhvbmU/LnRyaW0oKSB8fCBudWxsLFxyXG4gICAgICAgIGZpcnN0X25hbWU6IGRhdGEuZmlyc3RfbmFtZS50cmltKCksXHJcbiAgICAgICAgbGFzdF9uYW1lOiBkYXRhLmxhc3RfbmFtZS50cmltKCksXHJcbiAgICAgIH07XHJcblxyXG4gICAgICAvLyBPbmx5IHNldCBhdmF0YXJfdXJsIGlmIGl0J3MgcHJvdmlkZWRcclxuICAgICAgaWYgKGRhdGEuYXZhdGFyX3VybCkge1xyXG4gICAgICAgIGluc2VydERhdGEuYXZhdGFyX3VybCA9IGRhdGEuYXZhdGFyX3VybDtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgeyBkYXRhOiBuZXdQcm9maWxlLCBlcnJvcjogaW5zZXJ0RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcclxuICAgICAgICAuaW5zZXJ0KGluc2VydERhdGEpXHJcbiAgICAgICAgLnNlbGVjdCgpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgaWYgKGluc2VydEVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYXRpbmcgcHJvZmlsZTonLCBpbnNlcnRFcnJvcik7XHJcbiAgICAgICAgLy8gQ2hlY2sgaWYgaXQncyBhIHVuaXF1ZSBjb25zdHJhaW50IHZpb2xhdGlvblxyXG4gICAgICAgIGlmIChpbnNlcnRFcnJvci5jb2RlID09PSAnMjM1MDUnKSB7XHJcbiAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdFbWFpbCBhbHJlYWR5IGV4aXN0cycgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBpbnNlcnRFcnJvci5tZXNzYWdlIH07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJlc3VsdCA9IG5ld1Byb2ZpbGU7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcHJvZmlsZTogcmVzdWx0IH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHVwZGF0ZUN1c3RvbWVyUHJvZmlsZTonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byB1cGRhdGUgcHJvZmlsZScsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEN1c3RvbWVyTG9jYXRpb25zKFxyXG4gIGVtYWlsOiBzdHJpbmcsXHJcbiAgcGhvbmU/OiBzdHJpbmdcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBsb2NhdGlvbnM/OiBMb2NhdGlvbltdO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgbGV0IHF1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2xvY2F0aW9ucycpXHJcbiAgICAgIC5zZWxlY3QoJyonKVxyXG4gICAgICAub3JkZXIoJ2lzX2RlZmF1bHQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcclxuICAgICAgLm9yZGVyKCdjcmVhdGVkX2F0JywgeyBhc2NlbmRpbmc6IGZhbHNlIH0pO1xyXG5cclxuICAgIC8vIEJ1aWxkIHF1ZXJ5IGZvciBlbWFpbC9waG9uZSBsb29rdXBcclxuICAgIGlmIChlbWFpbCAmJiBwaG9uZSkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5Lm9yKGBjdXN0b21lcl9lbWFpbC5lcS4ke2VtYWlsfSxjdXN0b21lcl9waG9uZS5lcS4ke3Bob25lfWApO1xyXG4gICAgfSBlbHNlIGlmIChlbWFpbCkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdjdXN0b21lcl9lbWFpbCcsIGVtYWlsKTtcclxuICAgIH0gZWxzZSBpZiAocGhvbmUpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnY3VzdG9tZXJfcGhvbmUnLCBwaG9uZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdFbWFpbCBvciBwaG9uZSBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBxdWVyeTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgbG9jYXRpb25zOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgbG9jYXRpb25zOiBkYXRhIHx8IFtdIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGdldEN1c3RvbWVyTG9jYXRpb25zOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGZldGNoIGxvY2F0aW9ucycsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUxvY2F0aW9uKFxyXG4gIGVtYWlsOiBzdHJpbmcsXHJcbiAgcGhvbmU6IHN0cmluZyB8IHVuZGVmaW5lZCxcclxuICBsb2NhdGlvbkRhdGE6IExvY2F0aW9uQ3JlYXRlSW5wdXRcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBsb2NhdGlvbj86IExvY2F0aW9uO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgLy8gVmFsaWRhdGUgaW5wdXRcclxuICAgIGlmICghbG9jYXRpb25EYXRhLm5pY2tuYW1lPy50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTmlja25hbWUgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcbiAgICBpZiAoIWxvY2F0aW9uRGF0YS5hZGRyZXNzPy50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnQWRkcmVzcyBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuICAgIGlmICghbG9jYXRpb25EYXRhLnN1YnVyYj8udHJpbSgpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ1N1YnVyYiBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuICAgIGlmICghbG9jYXRpb25EYXRhLmNpdHk/LnRyaW0oKSkge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdDaXR5IGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIElmIHNldHRpbmcgYXMgZGVmYXVsdCwgdW5zZXQgYWxsIG90aGVyIGRlZmF1bHRzIGZvciB0aGlzIGN1c3RvbWVyXHJcbiAgICBpZiAobG9jYXRpb25EYXRhLmlzX2RlZmF1bHQpIHtcclxuICAgICAgbGV0IHVwZGF0ZVF1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgnbG9jYXRpb25zJylcclxuICAgICAgICAudXBkYXRlKHsgaXNfZGVmYXVsdDogZmFsc2UgfSk7XHJcblxyXG4gICAgICBpZiAoZW1haWwgJiYgcGhvbmUpIHtcclxuICAgICAgICB1cGRhdGVRdWVyeSA9IHVwZGF0ZVF1ZXJ5Lm9yKGBjdXN0b21lcl9lbWFpbC5lcS4ke2VtYWlsfSxjdXN0b21lcl9waG9uZS5lcS4ke3Bob25lfWApO1xyXG4gICAgICB9IGVsc2UgaWYgKGVtYWlsKSB7XHJcbiAgICAgICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5lcSgnY3VzdG9tZXJfZW1haWwnLCBlbWFpbCk7XHJcbiAgICAgIH0gZWxzZSBpZiAocGhvbmUpIHtcclxuICAgICAgICB1cGRhdGVRdWVyeSA9IHVwZGF0ZVF1ZXJ5LmVxKCdjdXN0b21lcl9waG9uZScsIHBob25lKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgYXdhaXQgdXBkYXRlUXVlcnk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBkYXRhOiBuZXdMb2NhdGlvbiwgZXJyb3I6IGluc2VydEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnbG9jYXRpb25zJylcclxuICAgICAgLmluc2VydCh7XHJcbiAgICAgICAgY3VzdG9tZXJfZW1haWw6IGVtYWlsLFxyXG4gICAgICAgIGN1c3RvbWVyX3Bob25lOiBwaG9uZSB8fCBudWxsLFxyXG4gICAgICAgIG5pY2tuYW1lOiBsb2NhdGlvbkRhdGEubmlja25hbWUudHJpbSgpLFxyXG4gICAgICAgIGFkZHJlc3M6IGxvY2F0aW9uRGF0YS5hZGRyZXNzLnRyaW0oKSxcclxuICAgICAgICBhcHRfdW5pdDogbG9jYXRpb25EYXRhLmFwdF91bml0Py50cmltKCkgfHwgbnVsbCxcclxuICAgICAgICBzdWJ1cmI6IGxvY2F0aW9uRGF0YS5zdWJ1cmIudHJpbSgpLFxyXG4gICAgICAgIGNpdHk6IGxvY2F0aW9uRGF0YS5jaXR5LnRyaW0oKSxcclxuICAgICAgICBwb3N0YWxfY29kZTogbG9jYXRpb25EYXRhLnBvc3RhbF9jb2RlPy50cmltKCkgfHwgbnVsbCxcclxuICAgICAgICBpc19kZWZhdWx0OiBsb2NhdGlvbkRhdGEuaXNfZGVmYXVsdCB8fCBmYWxzZSxcclxuICAgICAgfSlcclxuICAgICAgLnNlbGVjdCgpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoaW5zZXJ0RXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYXRpbmcgbG9jYXRpb246JywgaW5zZXJ0RXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGluc2VydEVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBsb2NhdGlvbjogbmV3TG9jYXRpb24gfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gY3JlYXRlTG9jYXRpb246JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gY3JlYXRlIGxvY2F0aW9uJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlTG9jYXRpb24oXHJcbiAgbG9jYXRpb25JZDogc3RyaW5nLFxyXG4gIGxvY2F0aW9uRGF0YTogTG9jYXRpb25VcGRhdGVJbnB1dFxyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGxvY2F0aW9uPzogTG9jYXRpb247XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICAvLyBWYWxpZGF0ZSBpbnB1dCBpZiBwcm92aWRlZFxyXG4gICAgaWYgKGxvY2F0aW9uRGF0YS5uaWNrbmFtZSAhPT0gdW5kZWZpbmVkICYmICFsb2NhdGlvbkRhdGEubmlja25hbWUudHJpbSgpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ05pY2tuYW1lIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG4gICAgaWYgKGxvY2F0aW9uRGF0YS5hZGRyZXNzICE9PSB1bmRlZmluZWQgJiYgIWxvY2F0aW9uRGF0YS5hZGRyZXNzLnRyaW0oKSkge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdBZGRyZXNzIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG4gICAgaWYgKGxvY2F0aW9uRGF0YS5zdWJ1cmIgIT09IHVuZGVmaW5lZCAmJiAhbG9jYXRpb25EYXRhLnN1YnVyYi50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnU3VidXJiIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG4gICAgaWYgKGxvY2F0aW9uRGF0YS5jaXR5ICE9PSB1bmRlZmluZWQgJiYgIWxvY2F0aW9uRGF0YS5jaXR5LnRyaW0oKSkge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdDaXR5IGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEdldCBjdXJyZW50IGxvY2F0aW9uIHRvIGNoZWNrIGN1c3RvbWVyIGVtYWlsXHJcbiAgICBjb25zdCB7IGRhdGE6IGN1cnJlbnRMb2NhdGlvbiwgZXJyb3I6IGZldGNoRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdsb2NhdGlvbnMnKVxyXG4gICAgICAuc2VsZWN0KCdjdXN0b21lcl9lbWFpbCwgY3VzdG9tZXJfcGhvbmUnKVxyXG4gICAgICAuZXEoJ2lkJywgbG9jYXRpb25JZClcclxuICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgIGlmIChmZXRjaEVycm9yIHx8ICFjdXJyZW50TG9jYXRpb24pIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTG9jYXRpb24gbm90IGZvdW5kJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIElmIHNldHRpbmcgYXMgZGVmYXVsdCwgdW5zZXQgYWxsIG90aGVyIGRlZmF1bHRzIGZvciB0aGlzIGN1c3RvbWVyXHJcbiAgICBpZiAobG9jYXRpb25EYXRhLmlzX2RlZmF1bHQpIHtcclxuICAgICAgbGV0IHVwZGF0ZVF1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgnbG9jYXRpb25zJylcclxuICAgICAgICAudXBkYXRlKHsgaXNfZGVmYXVsdDogZmFsc2UgfSk7XHJcblxyXG4gICAgICBpZiAoY3VycmVudExvY2F0aW9uLmN1c3RvbWVyX2VtYWlsICYmIGN1cnJlbnRMb2NhdGlvbi5jdXN0b21lcl9waG9uZSkge1xyXG4gICAgICAgIHVwZGF0ZVF1ZXJ5ID0gdXBkYXRlUXVlcnkub3IoYGN1c3RvbWVyX2VtYWlsLmVxLiR7Y3VycmVudExvY2F0aW9uLmN1c3RvbWVyX2VtYWlsfSxjdXN0b21lcl9waG9uZS5lcS4ke2N1cnJlbnRMb2NhdGlvbi5jdXN0b21lcl9waG9uZX1gKTtcclxuICAgICAgfSBlbHNlIGlmIChjdXJyZW50TG9jYXRpb24uY3VzdG9tZXJfZW1haWwpIHtcclxuICAgICAgICB1cGRhdGVRdWVyeSA9IHVwZGF0ZVF1ZXJ5LmVxKCdjdXN0b21lcl9lbWFpbCcsIGN1cnJlbnRMb2NhdGlvbi5jdXN0b21lcl9lbWFpbCk7XHJcbiAgICAgIH0gZWxzZSBpZiAoY3VycmVudExvY2F0aW9uLmN1c3RvbWVyX3Bob25lKSB7XHJcbiAgICAgICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5lcSgnY3VzdG9tZXJfcGhvbmUnLCBjdXJyZW50TG9jYXRpb24uY3VzdG9tZXJfcGhvbmUpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBEb24ndCB1bnNldCB0aGUgY3VycmVudCBsb2NhdGlvblxyXG4gICAgICB1cGRhdGVRdWVyeSA9IHVwZGF0ZVF1ZXJ5Lm5lcSgnaWQnLCBsb2NhdGlvbklkKTtcclxuXHJcbiAgICAgIGF3YWl0IHVwZGF0ZVF1ZXJ5O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEJ1aWxkIHVwZGF0ZSBvYmplY3Qgd2l0aCBvbmx5IHByb3ZpZGVkIGZpZWxkc1xyXG4gICAgY29uc3QgdXBkYXRlRGF0YTogYW55ID0ge1xyXG4gICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICB9O1xyXG5cclxuICAgIGlmIChsb2NhdGlvbkRhdGEubmlja25hbWUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB1cGRhdGVEYXRhLm5pY2tuYW1lID0gbG9jYXRpb25EYXRhLm5pY2tuYW1lLnRyaW0oKTtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuYWRkcmVzcyAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHVwZGF0ZURhdGEuYWRkcmVzcyA9IGxvY2F0aW9uRGF0YS5hZGRyZXNzLnRyaW0oKTtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuYXB0X3VuaXQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB1cGRhdGVEYXRhLmFwdF91bml0ID0gbG9jYXRpb25EYXRhLmFwdF91bml0Py50cmltKCkgfHwgbnVsbDtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuc3VidXJiICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgdXBkYXRlRGF0YS5zdWJ1cmIgPSBsb2NhdGlvbkRhdGEuc3VidXJiLnRyaW0oKTtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuY2l0eSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHVwZGF0ZURhdGEuY2l0eSA9IGxvY2F0aW9uRGF0YS5jaXR5LnRyaW0oKTtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEucG9zdGFsX2NvZGUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB1cGRhdGVEYXRhLnBvc3RhbF9jb2RlID0gbG9jYXRpb25EYXRhLnBvc3RhbF9jb2RlPy50cmltKCkgfHwgbnVsbDtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuaXNfZGVmYXVsdCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHVwZGF0ZURhdGEuaXNfZGVmYXVsdCA9IGxvY2F0aW9uRGF0YS5pc19kZWZhdWx0O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgZGF0YTogdXBkYXRlZExvY2F0aW9uLCBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdsb2NhdGlvbnMnKVxyXG4gICAgICAudXBkYXRlKHVwZGF0ZURhdGEpXHJcbiAgICAgIC5lcSgnaWQnLCBsb2NhdGlvbklkKVxyXG4gICAgICAuc2VsZWN0KClcclxuICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgIGlmICh1cGRhdGVFcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciB1cGRhdGluZyBsb2NhdGlvbjonLCB1cGRhdGVFcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogdXBkYXRlRXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGxvY2F0aW9uOiB1cGRhdGVkTG9jYXRpb24gfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gdXBkYXRlTG9jYXRpb246JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gdXBkYXRlIGxvY2F0aW9uJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZGVsZXRlTG9jYXRpb24obG9jYXRpb25JZDogc3RyaW5nKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdsb2NhdGlvbnMnKVxyXG4gICAgICAuZGVsZXRlKClcclxuICAgICAgLmVxKCdpZCcsIGxvY2F0aW9uSWQpO1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBkZWxldGluZyBsb2NhdGlvbjonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gZGVsZXRlTG9jYXRpb246JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gZGVsZXRlIGxvY2F0aW9uJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2V0RGVmYXVsdExvY2F0aW9uKFxyXG4gIGxvY2F0aW9uSWQ6IHN0cmluZyxcclxuICBlbWFpbDogc3RyaW5nLFxyXG4gIHBob25lPzogc3RyaW5nXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgbG9jYXRpb24/OiBMb2NhdGlvbjtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIEdldCBjdXJyZW50IGxvY2F0aW9uIHRvIHZlcmlmeSBvd25lcnNoaXBcclxuICAgIGNvbnN0IHsgZGF0YTogY3VycmVudExvY2F0aW9uLCBlcnJvcjogZmV0Y2hFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2xvY2F0aW9ucycpXHJcbiAgICAgIC5zZWxlY3QoJ2N1c3RvbWVyX2VtYWlsLCBjdXN0b21lcl9waG9uZScpXHJcbiAgICAgIC5lcSgnaWQnLCBsb2NhdGlvbklkKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKGZldGNoRXJyb3IgfHwgIWN1cnJlbnRMb2NhdGlvbikge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdMb2NhdGlvbiBub3QgZm91bmQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVmVyaWZ5IG93bmVyc2hpcFxyXG4gICAgY29uc3QgaXNPd25lciA9IFxyXG4gICAgICBjdXJyZW50TG9jYXRpb24uY3VzdG9tZXJfZW1haWwgPT09IGVtYWlsIHx8XHJcbiAgICAgIChwaG9uZSAmJiBjdXJyZW50TG9jYXRpb24uY3VzdG9tZXJfcGhvbmUgPT09IHBob25lKTtcclxuXHJcbiAgICBpZiAoIWlzT3duZXIpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnVW5hdXRob3JpemVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFVuc2V0IGFsbCBvdGhlciBkZWZhdWx0cyBmb3IgdGhpcyBjdXN0b21lclxyXG4gICAgbGV0IHVwZGF0ZVF1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2xvY2F0aW9ucycpXHJcbiAgICAgIC51cGRhdGUoeyBpc19kZWZhdWx0OiBmYWxzZSB9KTtcclxuXHJcbiAgICBpZiAoZW1haWwgJiYgcGhvbmUpIHtcclxuICAgICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5vcihgY3VzdG9tZXJfZW1haWwuZXEuJHtlbWFpbH0sY3VzdG9tZXJfcGhvbmUuZXEuJHtwaG9uZX1gKTtcclxuICAgIH0gZWxzZSBpZiAoZW1haWwpIHtcclxuICAgICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5lcSgnY3VzdG9tZXJfZW1haWwnLCBlbWFpbCk7XHJcbiAgICB9IGVsc2UgaWYgKHBob25lKSB7XHJcbiAgICAgIHVwZGF0ZVF1ZXJ5ID0gdXBkYXRlUXVlcnkuZXEoJ2N1c3RvbWVyX3Bob25lJywgcGhvbmUpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIERvbid0IHVuc2V0IHRoZSBjdXJyZW50IGxvY2F0aW9uXHJcbiAgICB1cGRhdGVRdWVyeSA9IHVwZGF0ZVF1ZXJ5Lm5lcSgnaWQnLCBsb2NhdGlvbklkKTtcclxuXHJcbiAgICBhd2FpdCB1cGRhdGVRdWVyeTtcclxuXHJcbiAgICAvLyBTZXQgdGhpcyBsb2NhdGlvbiBhcyBkZWZhdWx0XHJcbiAgICBjb25zdCB7IGRhdGE6IHVwZGF0ZWRMb2NhdGlvbiwgZXJyb3I6IHVwZGF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnbG9jYXRpb25zJylcclxuICAgICAgLnVwZGF0ZSh7IGlzX2RlZmF1bHQ6IHRydWUgfSlcclxuICAgICAgLmVxKCdpZCcsIGxvY2F0aW9uSWQpXHJcbiAgICAgIC5zZWxlY3QoKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKHVwZGF0ZUVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHNldHRpbmcgZGVmYXVsdCBsb2NhdGlvbjonLCB1cGRhdGVFcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogdXBkYXRlRXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGxvY2F0aW9uOiB1cGRhdGVkTG9jYXRpb24gfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gc2V0RGVmYXVsdExvY2F0aW9uOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIHNldCBkZWZhdWx0IGxvY2F0aW9uJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0T3JDcmVhdGVSZWZlcnJhbENvZGUoXHJcbiAgZW1haWw6IHN0cmluZ1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIHJlZmVycmFsQ29kZT86IHN0cmluZztcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIENoZWNrIGlmIHByb2ZpbGUgZXhpc3RzIGFuZCBoYXMgYSByZWZlcnJhbCBjb2RlXHJcbiAgICBjb25zdCB7IGRhdGE6IHByb2ZpbGUsIGVycm9yOiBwcm9maWxlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgIC5zZWxlY3QoJ3JlZmVycmFsX2NvZGUnKVxyXG4gICAgICAuZXEoJ2VtYWlsJywgZW1haWwpXHJcbiAgICAgIC5tYXliZVNpbmdsZSgpO1xyXG5cclxuICAgIGlmIChwcm9maWxlRXJyb3IgJiYgcHJvZmlsZUVycm9yLmNvZGUgIT09ICdQR1JTVDExNicpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgcHJvZmlsZTonLCBwcm9maWxlRXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHByb2ZpbGVFcnJvci5tZXNzYWdlIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gSWYgcHJvZmlsZSBleGlzdHMgYW5kIGhhcyBhIHJlZmVycmFsIGNvZGUsIHJldHVybiBpdFxyXG4gICAgaWYgKHByb2ZpbGU/LnJlZmVycmFsX2NvZGUpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcmVmZXJyYWxDb2RlOiBwcm9maWxlLnJlZmVycmFsX2NvZGUgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBHZW5lcmF0ZSBhIG5ldyByZWZlcnJhbCBjb2RlXHJcbiAgICAvLyBUcnkgdXNpbmcgdGhlIGRhdGFiYXNlIGZ1bmN0aW9uIGZpcnN0LCBidXQgZmFsbGJhY2sgdG8gY2xpZW50LXNpZGUgZ2VuZXJhdGlvblxyXG4gICAgbGV0IGdlbmVyYXRlZENvZGU6IHN0cmluZyB8IG51bGwgPSBudWxsO1xyXG4gICAgXHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB7IGRhdGE6IGRiQ29kZSwgZXJyb3I6IGNvZGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAucnBjKCdnZW5lcmF0ZV9yZWZlcnJhbF9jb2RlJyk7XHJcbiAgICAgIFxyXG4gICAgICBpZiAoIWNvZGVFcnJvciAmJiBkYkNvZGUpIHtcclxuICAgICAgICBnZW5lcmF0ZWRDb2RlID0gZGJDb2RlO1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChycGNFcnJvcikge1xyXG4gICAgICAvLyBSUEMgZnVuY3Rpb24gbWlnaHQgbm90IGV4aXN0IHlldCwgdGhhdCdzIG9rYXlcclxuICAgICAgY29uc29sZS5sb2coJ1JQQyBmdW5jdGlvbiBub3QgYXZhaWxhYmxlLCB1c2luZyBmYWxsYmFjaycpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghZ2VuZXJhdGVkQ29kZSkge1xyXG4gICAgICAvLyBGYWxsYmFjazogZ2VuZXJhdGUgY29kZSBjbGllbnQtc2lkZSBzdHlsZVxyXG4gICAgICBjb25zdCBmYWxsYmFja0NvZGUgPSBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoMiwgOCkudG9VcHBlckNhc2UoKTtcclxuICAgICAgXHJcbiAgICAgIC8vIENoZWNrIGlmIGZhbGxiYWNrIGNvZGUgZXhpc3RzLCByZXRyeSBpZiBpdCBkb2VzXHJcbiAgICAgIGxldCBmaW5hbENvZGUgPSBmYWxsYmFja0NvZGU7XHJcbiAgICAgIGxldCBhdHRlbXB0cyA9IDA7XHJcbiAgICAgIGNvbnN0IG1heEF0dGVtcHRzID0gNTtcclxuXHJcbiAgICAgIHdoaWxlIChhdHRlbXB0cyA8IG1heEF0dGVtcHRzKSB7XHJcbiAgICAgICAgY29uc3QgeyBkYXRhOiBleGlzdGluZyB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgICAgICAuc2VsZWN0KCdpZCcpXHJcbiAgICAgICAgICAuZXEoJ3JlZmVycmFsX2NvZGUnLCBmaW5hbENvZGUpXHJcbiAgICAgICAgICAubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgICAgICAgaWYgKCFleGlzdGluZykge1xyXG4gICAgICAgICAgYnJlYWs7IC8vIENvZGUgaXMgdW5pcXVlXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBHZW5lcmF0ZSBhIG5ldyBjb2RlXHJcbiAgICAgICAgZmluYWxDb2RlID0gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIsIDgpLnRvVXBwZXJDYXNlKCk7XHJcbiAgICAgICAgYXR0ZW1wdHMrKztcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gVXBkYXRlIG9yIGluc2VydCBwcm9maWxlIHdpdGggcmVmZXJyYWwgY29kZVxyXG4gICAgICAvLyBGaXJzdCwgdHJ5IHRvIHVwZGF0ZSBleGlzdGluZyBwcm9maWxlXHJcbiAgICAgIGNvbnN0IHsgZGF0YTogZXhpc3RpbmdQcm9maWxlIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgICAgLnNlbGVjdCgnaWQsIGZpcnN0X25hbWUsIGxhc3RfbmFtZScpXHJcbiAgICAgICAgLmVxKCdlbWFpbCcsIGVtYWlsKVxyXG4gICAgICAgIC5tYXliZVNpbmdsZSgpO1xyXG5cclxuICAgICAgbGV0IHVwZGF0ZWRQcm9maWxlO1xyXG4gICAgICBpZiAoZXhpc3RpbmdQcm9maWxlKSB7XHJcbiAgICAgICAgLy8gVXBkYXRlIGV4aXN0aW5nIHByb2ZpbGVcclxuICAgICAgICBjb25zdCB7IGRhdGE6IHVwZGF0ZWQsIGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgICAgICAudXBkYXRlKHtcclxuICAgICAgICAgICAgcmVmZXJyYWxfY29kZTogZmluYWxDb2RlLFxyXG4gICAgICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgLmVxKCdlbWFpbCcsIGVtYWlsKVxyXG4gICAgICAgICAgLnNlbGVjdCgncmVmZXJyYWxfY29kZScpXHJcbiAgICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICAgIGlmICh1cGRhdGVFcnJvcikge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBkYXRpbmcgcmVmZXJyYWwgY29kZTonLCB1cGRhdGVFcnJvcik7XHJcbiAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHVwZGF0ZUVycm9yLm1lc3NhZ2UgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdXBkYXRlZFByb2ZpbGUgPSB1cGRhdGVkO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEluc2VydCBuZXcgcHJvZmlsZSB3aXRoIHJlZmVycmFsIGNvZGVcclxuICAgICAgICBjb25zdCB7IGRhdGE6IGluc2VydGVkLCBlcnJvcjogaW5zZXJ0RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgICAgLmluc2VydCh7XHJcbiAgICAgICAgICAgIGVtYWlsLFxyXG4gICAgICAgICAgICByZWZlcnJhbF9jb2RlOiBmaW5hbENvZGUsXHJcbiAgICAgICAgICAgIGZpcnN0X25hbWU6IGVtYWlsLnNwbGl0KCdAJylbMF0sXHJcbiAgICAgICAgICAgIGxhc3RfbmFtZTogJycsXHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgLnNlbGVjdCgncmVmZXJyYWxfY29kZScpXHJcbiAgICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICAgIGlmIChpbnNlcnRFcnJvcikge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYXRpbmcgcmVmZXJyYWwgY29kZTonLCBpbnNlcnRFcnJvcik7XHJcbiAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGluc2VydEVycm9yLm1lc3NhZ2UgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdXBkYXRlZFByb2ZpbGUgPSBpbnNlcnRlZDtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcmVmZXJyYWxDb2RlOiB1cGRhdGVkUHJvZmlsZT8ucmVmZXJyYWxfY29kZSB8fCBmaW5hbENvZGUgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBVc2UgdGhlIGdlbmVyYXRlZCBjb2RlIGZyb20gZGF0YWJhc2UgZnVuY3Rpb25cclxuICAgIC8vIFVwZGF0ZSBvciBpbnNlcnQgcHJvZmlsZSB3aXRoIGdlbmVyYXRlZCBjb2RlXHJcbiAgICBjb25zdCB7IGRhdGE6IGV4aXN0aW5nUHJvZmlsZSB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcclxuICAgICAgLnNlbGVjdCgnaWQsIGZpcnN0X25hbWUsIGxhc3RfbmFtZScpXHJcbiAgICAgIC5lcSgnZW1haWwnLCBlbWFpbClcclxuICAgICAgLm1heWJlU2luZ2xlKCk7XHJcblxyXG4gICAgbGV0IHVwZGF0ZWRQcm9maWxlO1xyXG4gICAgaWYgKGV4aXN0aW5nUHJvZmlsZSkge1xyXG4gICAgICAvLyBVcGRhdGUgZXhpc3RpbmcgcHJvZmlsZVxyXG4gICAgICBjb25zdCB7IGRhdGE6IHVwZGF0ZWQsIGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgIC51cGRhdGUoe1xyXG4gICAgICAgICAgcmVmZXJyYWxfY29kZTogZ2VuZXJhdGVkQ29kZSxcclxuICAgICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5lcSgnZW1haWwnLCBlbWFpbClcclxuICAgICAgICAuc2VsZWN0KCdyZWZlcnJhbF9jb2RlJylcclxuICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICBpZiAodXBkYXRlRXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciB1cGRhdGluZyByZWZlcnJhbCBjb2RlOicsIHVwZGF0ZUVycm9yKTtcclxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHVwZGF0ZUVycm9yLm1lc3NhZ2UgfTtcclxuICAgICAgfVxyXG4gICAgICB1cGRhdGVkUHJvZmlsZSA9IHVwZGF0ZWQ7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyBJbnNlcnQgbmV3IHByb2ZpbGUgd2l0aCByZWZlcnJhbCBjb2RlXHJcbiAgICAgIGNvbnN0IHsgZGF0YTogaW5zZXJ0ZWQsIGVycm9yOiBpbnNlcnRFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgIC5pbnNlcnQoe1xyXG4gICAgICAgICAgZW1haWwsXHJcbiAgICAgICAgICByZWZlcnJhbF9jb2RlOiBnZW5lcmF0ZWRDb2RlLFxyXG4gICAgICAgICAgZmlyc3RfbmFtZTogZW1haWwuc3BsaXQoJ0AnKVswXSxcclxuICAgICAgICAgIGxhc3RfbmFtZTogJycsXHJcbiAgICAgICAgfSlcclxuICAgICAgICAuc2VsZWN0KCdyZWZlcnJhbF9jb2RlJylcclxuICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICBpZiAoaW5zZXJ0RXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjcmVhdGluZyByZWZlcnJhbCBjb2RlOicsIGluc2VydEVycm9yKTtcclxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGluc2VydEVycm9yLm1lc3NhZ2UgfTtcclxuICAgICAgfVxyXG4gICAgICB1cGRhdGVkUHJvZmlsZSA9IGluc2VydGVkO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHJlZmVycmFsQ29kZTogdXBkYXRlZFByb2ZpbGU/LnJlZmVycmFsX2NvZGUgfHwgZ2VuZXJhdGVkQ29kZSB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBnZXRPckNyZWF0ZVJlZmVycmFsQ29kZTonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBnZXQgcmVmZXJyYWwgY29kZScsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNlbmRSZWZlcnJhbEludml0ZXMoXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBpbnZpdGVFbWFpbHM6IHN0cmluZ1tdLFxyXG4gIHJlZmVycmFsQ29kZTogc3RyaW5nXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgc2VudD86IG51bWJlcjtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIFZhbGlkYXRlIGVtYWlsIGFkZHJlc3Nlc1xyXG4gICAgY29uc3QgdmFsaWRFbWFpbHMgPSBpbnZpdGVFbWFpbHNcclxuICAgICAgLm1hcCgoZSkgPT4gZS50cmltKCkpXHJcbiAgICAgIC5maWx0ZXIoKGUpID0+IHtcclxuICAgICAgICBpZiAoIWUpIHJldHVybiBmYWxzZTtcclxuICAgICAgICByZXR1cm4gL15bXlxcc0BdK0BbXlxcc0BdK1xcLlteXFxzQF0rJC8udGVzdChlKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgaWYgKHZhbGlkRW1haWxzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdObyB2YWxpZCBlbWFpbCBhZGRyZXNzZXMgcHJvdmlkZWQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ3JlYXRlIHJlZmVycmFsIHJlY29yZHMgZm9yIHRyYWNraW5nXHJcbiAgICBjb25zdCByZWZlcnJhbFJlY29yZHMgPSB2YWxpZEVtYWlscy5tYXAoKHJlZmVycmVkRW1haWwpID0+ICh7XHJcbiAgICAgIHJlZmVycmVyX2VtYWlsOiBlbWFpbCxcclxuICAgICAgcmVmZXJyZWRfZW1haWw6IHJlZmVycmVkRW1haWwsXHJcbiAgICAgIHJlZmVycmFsX2NvZGU6IHJlZmVycmFsQ29kZSxcclxuICAgICAgc3RhdHVzOiAncGVuZGluZycsXHJcbiAgICB9KSk7XHJcblxyXG4gICAgY29uc3QgeyBlcnJvcjogaW5zZXJ0RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdyZWZlcnJhbHMnKVxyXG4gICAgICAuaW5zZXJ0KHJlZmVycmFsUmVjb3Jkcyk7XHJcblxyXG4gICAgaWYgKGluc2VydEVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIHJlZmVycmFsIHJlY29yZHM6JywgaW5zZXJ0RXJyb3IpO1xyXG4gICAgICAvLyBDb250aW51ZSBldmVuIGlmIGluc2VydCBmYWlscyAtIHdlIHN0aWxsIHdhbnQgdG8gc2VuZCBlbWFpbHNcclxuICAgIH1cclxuXHJcbiAgICAvLyBHZW5lcmF0ZSByZWZlcnJhbCBsaW5rXHJcbiAgICBjb25zdCBiYXNlVXJsID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU0lURV9VUkwgfHwgJ2h0dHBzOi8vc2hhbGVhbi5jby56YSc7XHJcbiAgICBjb25zdCByZWZlcnJhbExpbmsgPSBgJHtiYXNlVXJsfS9ib29raW5nL2RldGFpbHM/cmVmPSR7cmVmZXJyYWxDb2RlfWA7XHJcblxyXG4gICAgLy8gVE9ETzogSW1wbGVtZW50IGFjdHVhbCBlbWFpbCBzZW5kaW5nIHVzaW5nIHlvdXIgZW1haWwgc2VydmljZSAoUmVzZW5kLCBTZW5kR3JpZCwgZXRjLilcclxuICAgIC8vIEZvciBub3csIHdlJ2xsIGp1c3QgbG9nIHRoZSBlbWFpbHMgdGhhdCB3b3VsZCBiZSBzZW50XHJcbiAgICBjb25zb2xlLmxvZygnUmVmZXJyYWwgaW52aXRlcyB0byBzZW5kOicsIHtcclxuICAgICAgZnJvbTogZW1haWwsXHJcbiAgICAgIHRvOiB2YWxpZEVtYWlscyxcclxuICAgICAgcmVmZXJyYWxDb2RlLFxyXG4gICAgICByZWZlcnJhbExpbmssXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBJbiBhIHJlYWwgaW1wbGVtZW50YXRpb24sIHlvdSB3b3VsZCBzZW5kIGVtYWlscyBoZXJlXHJcbiAgICAvLyBFeGFtcGxlIHdpdGggUmVzZW5kOlxyXG4gICAgLy8gYXdhaXQgcmVzZW5kLmVtYWlscy5zZW5kKHtcclxuICAgIC8vICAgZnJvbTogJ1NoYWxlYW4gPG5vcmVwbHlAc2hhbGVhbi5jby56YT4nLFxyXG4gICAgLy8gICB0bzogdmFsaWRFbWFpbHMsXHJcbiAgICAvLyAgIHN1YmplY3Q6ICdZb3VcXCd2ZSBiZWVuIGludml0ZWQgdG8gdHJ5IFNoYWxlYW4gQ2xlYW5pbmcgU2VydmljZXMhJyxcclxuICAgIC8vICAgaHRtbDogYDxwPllvdXIgZnJpZW5kIGhhcyBpbnZpdGVkIHlvdSB0byB0cnkgU2hhbGVhbi4gVXNlIGNvZGUgJHtyZWZlcnJhbENvZGV9IHRvIGdldCBSMTUwIG9mZiB5b3VyIGZpcnN0IGJvb2tpbmchPC9wPjxwPjxhIGhyZWY9XCIke3JlZmVycmFsTGlua31cIj5Cb29rIE5vdzwvYT48L3A+YCxcclxuICAgIC8vIH0pO1xyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHNlbnQ6IHZhbGlkRW1haWxzLmxlbmd0aCB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBzZW5kUmVmZXJyYWxJbnZpdGVzOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIHNlbmQgaW52aXRlcycsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFJlZmVycmFsU3RhdHMoXHJcbiAgZW1haWw6IHN0cmluZ1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIHN0YXRzPzoge1xyXG4gICAgdG90YWxSZWZlcnJhbHM6IG51bWJlcjtcclxuICAgIGNvbXBsZXRlZFJlZmVycmFsczogbnVtYmVyO1xyXG4gICAgcGVuZGluZ1Jld2FyZHM6IG51bWJlcjtcclxuICAgIHRvdGFsUmV3YXJkczogbnVtYmVyO1xyXG4gIH07XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICBjb25zdCB7IGRhdGE6IHJlZmVycmFscywgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdyZWZlcnJhbHMnKVxyXG4gICAgICAuc2VsZWN0KCdzdGF0dXMsIHJlZmVycmVyX3Jld2FyZF9hbW91bnQsIHJlZmVycmVyX3Jld2FyZF9zdGF0dXMnKVxyXG4gICAgICAuZXEoJ3JlZmVycmVyX2VtYWlsJywgZW1haWwpO1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyByZWZlcnJhbCBzdGF0czonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHN0YXRzID0ge1xyXG4gICAgICB0b3RhbFJlZmVycmFsczogcmVmZXJyYWxzPy5sZW5ndGggfHwgMCxcclxuICAgICAgY29tcGxldGVkUmVmZXJyYWxzOlxyXG4gICAgICAgIHJlZmVycmFscz8uZmlsdGVyKChyKSA9PiByLnN0YXR1cyA9PT0gJ2NvbXBsZXRlZCcpLmxlbmd0aCB8fCAwLFxyXG4gICAgICBwZW5kaW5nUmV3YXJkczpcclxuICAgICAgICByZWZlcnJhbHM/LmZpbHRlcigocikgPT4gci5yZWZlcnJlcl9yZXdhcmRfc3RhdHVzID09PSAncGVuZGluZycpLmxlbmd0aCB8fCAwLFxyXG4gICAgICB0b3RhbFJld2FyZHM6XHJcbiAgICAgICAgcmVmZXJyYWxzXHJcbiAgICAgICAgICA/LmZpbHRlcigocikgPT4gci5yZWZlcnJlcl9yZXdhcmRfc3RhdHVzID09PSAnY3JlZGl0ZWQnKVxyXG4gICAgICAgICAgLnJlZHVjZSgoc3VtLCByKSA9PiBzdW0gKyAoci5yZWZlcnJlcl9yZXdhcmRfYW1vdW50IHx8IDApLCAwKSB8fCAwLFxyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBzdGF0cyB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBnZXRSZWZlcnJhbFN0YXRzOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGZldGNoIHJlZmVycmFsIHN0YXRzJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogSW5pdGlhbGl6ZSBhIGNyZWRpdCBwdXJjaGFzZSB3aXRoIFBheXN0YWNrXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaW5pdGlhbGl6ZUNyZWRpdFB1cmNoYXNlKFxyXG4gIGVtYWlsOiBzdHJpbmcsXHJcbiAgYW1vdW50OiBudW1iZXIsXHJcbiAgcGF5bWVudE1ldGhvZDogJ2NyZWRpdF9jYXJkJyB8ICdlZnQnXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgYXV0aG9yaXphdGlvblVybD86IHN0cmluZztcclxuICByZWZlcmVuY2U/OiBzdHJpbmc7XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgaWYgKGFtb3VudCA8IDIwIHx8IGFtb3VudCA+IDUwMDApIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogJ0Ftb3VudCBtdXN0IGJlIGJldHdlZW4gUjIwIGFuZCBSNTAwMCcsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gR2VuZXJhdGUgYSB1bmlxdWUgcmVmZXJlbmNlIGZvciB0aGlzIGNyZWRpdCBwdXJjaGFzZVxyXG4gICAgY29uc3QgcmVmZXJlbmNlID0gYENSRURJVF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIsIDkpfWA7XHJcblxyXG4gICAgLy8gQ3JlYXRlIGEgcGVuZGluZyBjcmVkaXQgdHJhbnNhY3Rpb25cclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcbiAgICBcclxuICAgIC8vIEdldCBvciBjcmVhdGUgcHJvZmlsZVxyXG4gICAgbGV0IHsgZGF0YTogcHJvZmlsZSB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcclxuICAgICAgLnNlbGVjdCgnaWQsIGNyZWRpdF9iYWxhbmNlJylcclxuICAgICAgLmVxKCdlbWFpbCcsIGVtYWlsKVxyXG4gICAgICAubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoIXByb2ZpbGUpIHtcclxuICAgICAgLy8gQ3JlYXRlIGEgYmFzaWMgcHJvZmlsZSBpZiBpdCBkb2Vzbid0IGV4aXN0XHJcbiAgICAgIGNvbnN0IHsgZGF0YTogbmV3UHJvZmlsZSwgZXJyb3I6IGNyZWF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgICAgLmluc2VydCh7XHJcbiAgICAgICAgICBlbWFpbCxcclxuICAgICAgICAgIGNyZWRpdF9iYWxhbmNlOiAwLFxyXG4gICAgICAgICAgZmlyc3RfbmFtZTogJycsXHJcbiAgICAgICAgICBsYXN0X25hbWU6ICcnLFxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnNlbGVjdCgnaWQsIGNyZWRpdF9iYWxhbmNlJylcclxuICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICBpZiAoY3JlYXRlRXJyb3IgfHwgIW5ld1Byb2ZpbGUpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICBlcnJvcjogJ0ZhaWxlZCB0byBjcmVhdGUgcHJvZmlsZScsXHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG4gICAgICBwcm9maWxlID0gbmV3UHJvZmlsZTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDcmVhdGUgcGVuZGluZyBjcmVkaXQgdHJhbnNhY3Rpb25cclxuICAgIGNvbnN0IHsgZXJyb3I6IHRyYW5zYWN0aW9uRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdjcmVkaXRfdHJhbnNhY3Rpb25zJylcclxuICAgICAgLmluc2VydCh7XHJcbiAgICAgICAgcHJvZmlsZV9pZDogcHJvZmlsZS5pZCxcclxuICAgICAgICBlbWFpbCxcclxuICAgICAgICB0cmFuc2FjdGlvbl90eXBlOiAncHVyY2hhc2UnLFxyXG4gICAgICAgIGFtb3VudCxcclxuICAgICAgICBiYWxhbmNlX2JlZm9yZTogcHJvZmlsZS5jcmVkaXRfYmFsYW5jZSB8fCAwLFxyXG4gICAgICAgIGJhbGFuY2VfYWZ0ZXI6IHByb2ZpbGUuY3JlZGl0X2JhbGFuY2UgfHwgMCwgLy8gV29uJ3QgdXBkYXRlIHVudGlsIHBheW1lbnQgc3VjY2VlZHNcclxuICAgICAgICBwYXltZW50X21ldGhvZDogcGF5bWVudE1ldGhvZCxcclxuICAgICAgICBwYXlzdGFja19yZWZlcmVuY2U6IHJlZmVyZW5jZSxcclxuICAgICAgICBwYXltZW50X3N0YXR1czogJ3BlbmRpbmcnLFxyXG4gICAgICAgIGRlc2NyaXB0aW9uOiBgUHVyY2hhc2Ugb2YgUiR7YW1vdW50fSBTaGFsZWFuQ3JlZGAsXHJcbiAgICAgIH0pO1xyXG5cclxuICAgIGlmICh0cmFuc2FjdGlvbkVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIGNyZWRpdCB0cmFuc2FjdGlvbjonLCB0cmFuc2FjdGlvbkVycm9yKTtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogJ0ZhaWxlZCB0byBjcmVhdGUgdHJhbnNhY3Rpb24gcmVjb3JkJyxcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBJbml0aWFsaXplIFBheXN0YWNrIHBheW1lbnRcclxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goJy9hcGkvcGF5c3RhY2svaW5pdGlhbGl6ZScsIHtcclxuICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxyXG4gICAgICB9LFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgZW1haWwsXHJcbiAgICAgICAgYW1vdW50LFxyXG4gICAgICAgIHJlZmVyZW5jZSxcclxuICAgICAgICBtZXRhZGF0YToge1xyXG4gICAgICAgICAgdHJhbnNhY3Rpb25fdHlwZTogJ2NyZWRpdF9wdXJjaGFzZScsXHJcbiAgICAgICAgICBwYXltZW50X21ldGhvZDogcGF5bWVudE1ldGhvZCxcclxuICAgICAgICB9LFxyXG4gICAgICB9KSxcclxuICAgIH0pO1xyXG5cclxuICAgIGlmICghcmVzcG9uc2Uub2spIHtcclxuICAgICAgY29uc3QgZXJyb3IgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6IGVycm9yLmVycm9yIHx8ICdGYWlsZWQgdG8gaW5pdGlhbGl6ZSBwYXltZW50JyxcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBwYXltZW50RGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcclxuXHJcbiAgICBpZiAoIXBheW1lbnREYXRhLnN0YXR1cykge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIGVycm9yOiBwYXltZW50RGF0YS5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gaW5pdGlhbGl6ZSBwYXltZW50JyxcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICBhdXRob3JpemF0aW9uVXJsOiBwYXltZW50RGF0YS5kYXRhLmF1dGhvcml6YXRpb25fdXJsLFxyXG4gICAgICByZWZlcmVuY2U6IHBheW1lbnREYXRhLmRhdGEucmVmZXJlbmNlLFxyXG4gICAgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW5pdGlhbGl6aW5nIGNyZWRpdCBwdXJjaGFzZTonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBpbml0aWFsaXplIHBheW1lbnQnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgVm91Y2hlclJlZGVtcHRpb24ge1xyXG4gIGlkOiBzdHJpbmc7XHJcbiAgdm91Y2hlcl9jb2RlOiBzdHJpbmc7XHJcbiAgYW1vdW50OiBudW1iZXI7XHJcbiAgcmVkZWVtZWRfYXQ6IHN0cmluZztcclxuICBib29raW5nX2lkPzogc3RyaW5nO1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVkZWVtVm91Y2hlcihcclxuICBjb2RlOiBzdHJpbmcsXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBwaG9uZT86IHN0cmluZ1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGFtb3VudD86IG51bWJlcjtcclxuICBuZXdCYWxhbmNlPzogbnVtYmVyO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgLy8gQ2FsbCB0aGUgZGF0YWJhc2UgZnVuY3Rpb24gdG8gcmVkZWVtIHRoZSB2b3VjaGVyXHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5ycGMoJ3JlZGVlbV92b3VjaGVyJywge1xyXG4gICAgICBwX2NvZGU6IGNvZGUudHJpbSgpLnRvVXBwZXJDYXNlKCksXHJcbiAgICAgIHBfZW1haWw6IGVtYWlsLnRyaW0oKSxcclxuICAgICAgcF9waG9uZTogcGhvbmU/LnRyaW0oKSB8fCBudWxsLFxyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHJlZGVlbWluZyB2b3VjaGVyOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZSB8fCAnRmFpbGVkIHRvIHJlZGVlbSB2b3VjaGVyJyxcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBQYXJzZSB0aGUgcmVzdWx0IGZyb20gdGhlIGZ1bmN0aW9uIChoYW5kbGUgYm90aCBvYmplY3QgYW5kIHN0cmluZyBKU09OQilcclxuICAgIGxldCByZXN1bHQgPSBkYXRhO1xyXG4gICAgaWYgKHR5cGVvZiBkYXRhID09PSAnc3RyaW5nJykge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIHJlc3VsdCA9IEpTT04ucGFyc2UoZGF0YSk7XHJcbiAgICAgIH0gY2F0Y2ggKHBhcnNlRXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBwYXJzaW5nIHZvdWNoZXIgcmVkZW1wdGlvbiByZXN1bHQ6JywgcGFyc2VFcnJvcik7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgZXJyb3I6ICdJbnZhbGlkIHJlc3BvbnNlIGZyb20gc2VydmVyJyxcclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHJlc3VsdCAmJiB0eXBlb2YgcmVzdWx0ID09PSAnb2JqZWN0JyAmJiAnc3VjY2VzcycgaW4gcmVzdWx0KSB7XHJcbiAgICAgIGlmIChyZXN1bHQuc3VjY2VzcyA9PT0gZmFsc2UpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICBlcnJvcjogcmVzdWx0LmVycm9yIHx8ICdGYWlsZWQgdG8gcmVkZWVtIHZvdWNoZXInLFxyXG4gICAgICAgIH07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICBhbW91bnQ6IHJlc3VsdC5hbW91bnQsXHJcbiAgICAgICAgbmV3QmFsYW5jZTogcmVzdWx0Lm5ld19iYWxhbmNlLFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogJ1VuZXhwZWN0ZWQgcmVzcG9uc2UgZnJvbSBzZXJ2ZXInLFxyXG4gICAgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gcmVkZWVtVm91Y2hlcjonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byByZWRlZW0gdm91Y2hlcicsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFZvdWNoZXJSZWRlbXB0aW9ucyhcclxuICBlbWFpbDogc3RyaW5nLFxyXG4gIHBob25lPzogc3RyaW5nXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgcmVkZW1wdGlvbnM/OiBWb3VjaGVyUmVkZW1wdGlvbltdO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgbGV0IHF1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ3ZvdWNoZXJfcmVkZW1wdGlvbnMnKVxyXG4gICAgICAuc2VsZWN0KCdpZCwgdm91Y2hlcl9jb2RlLCBhbW91bnQsIHJlZGVlbWVkX2F0LCBib29raW5nX2lkJylcclxuICAgICAgLm9yZGVyKCdyZWRlZW1lZF9hdCcsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KTtcclxuXHJcbiAgICAvLyBCdWlsZCBxdWVyeSBmb3IgZW1haWwvcGhvbmUgbG9va3VwXHJcbiAgICAvLyBQcmlvcml0aXplIGVtYWlsIGFzIGl0J3MgdGhlIHByaW1hcnkgaWRlbnRpZmllciB0byBwcmV2ZW50IGNyb3NzLWFjY291bnQgdmlzaWJpbGl0eVxyXG4gICAgaWYgKGVtYWlsKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ2VtYWlsJywgZW1haWwpO1xyXG4gICAgICAvLyBJZiBwaG9uZSBpcyBhbHNvIHByb3ZpZGVkLCB3ZSBjYW4gb3B0aW9uYWxseSBmaWx0ZXIgYnkgYm90aCBmb3IgZXh0cmEgc2VjdXJpdHlcclxuICAgICAgLy8gYnV0IGVtYWlsIGFsb25lIHNob3VsZCBiZSBzdWZmaWNpZW50IHNpbmNlIGl0J3MgdW5pcXVlXHJcbiAgICB9IGVsc2UgaWYgKHBob25lKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ3Bob25lJywgcGhvbmUpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRW1haWwgb3IgcGhvbmUgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgcXVlcnk7XHJcblxyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIHZvdWNoZXIgcmVkZW1wdGlvbnM6JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBUcmFuc2Zvcm0gdGhlIGRhdGEgdG8gbWF0Y2ggdGhlIGludGVyZmFjZVxyXG4gICAgY29uc3QgcmVkZW1wdGlvbnM6IFZvdWNoZXJSZWRlbXB0aW9uW10gPSAoZGF0YSB8fCBbXSkubWFwKChyZWRlbXB0aW9uKSA9PiAoe1xyXG4gICAgICBpZDogcmVkZW1wdGlvbi5pZCxcclxuICAgICAgdm91Y2hlcl9jb2RlOiByZWRlbXB0aW9uLnZvdWNoZXJfY29kZSxcclxuICAgICAgYW1vdW50OiByZWRlbXB0aW9uLmFtb3VudCxcclxuICAgICAgcmVkZWVtZWRfYXQ6IHJlZGVtcHRpb24ucmVkZWVtZWRfYXQsXHJcbiAgICAgIGJvb2tpbmdfaWQ6IHJlZGVtcHRpb24uYm9va2luZ19pZCB8fCB1bmRlZmluZWQsXHJcbiAgICB9KSk7XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcmVkZW1wdGlvbnMgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gZ2V0Vm91Y2hlclJlZGVtcHRpb25zOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGZldGNoIHZvdWNoZXIgcmVkZW1wdGlvbnMnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiMlJBOGtCc0IsNkxBQUEifQ==
}),
"[project]/app/dashboard/data:487a6b [app-ssr] (ecmascript) <text/javascript>", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "deleteLocation",
    ()=>$$RSC_SERVER_ACTION_11
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-ssr] (ecmascript)");
/* __next_internal_action_entry_do_not_use__ [{"407b8db984c03bd19df0cbb8fb8e3216b7e89c78a3":"deleteLocation"},"app/dashboard/actions.ts",""] */ "use turbopack no side effects";
;
const $$RSC_SERVER_ACTION_11 = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["createServerReference"])("407b8db984c03bd19df0cbb8fb8e3216b7e89c78a3", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["findSourceMapURL"], "deleteLocation");
;
 //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vYWN0aW9ucy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHNlcnZlcic7XHJcblxyXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAL2xpYi9zdXBhYmFzZS9zZXJ2ZXInO1xyXG5pbXBvcnQgeyBCb29raW5nIH0gZnJvbSAnQC90eXBlcy9ib29raW5nJztcclxuaW1wb3J0IHsgUHJvZmlsZSwgUHJvZmlsZVVwZGF0ZUlucHV0IH0gZnJvbSAnQC90eXBlcy9wcm9maWxlJztcclxuaW1wb3J0IHsgTG9jYXRpb24sIExvY2F0aW9uQ3JlYXRlSW5wdXQsIExvY2F0aW9uVXBkYXRlSW5wdXQgfSBmcm9tICdAL3R5cGVzL2xvY2F0aW9uJztcclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBdXRoZW50aWNhdGVkVXNlcigpOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGVtYWlsPzogc3RyaW5nO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcbiAgICBjb25zdCB7IGRhdGE6IHsgdXNlciB9LCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XHJcblxyXG4gICAgaWYgKGVycm9yIHx8ICF1c2VyKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ05vdCBhdXRoZW50aWNhdGVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGVtYWlsOiB1c2VyLmVtYWlsIHx8IHVuZGVmaW5lZCB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBnZXRBdXRoZW50aWNhdGVkVXNlcjonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBnZXQgdXNlcicsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEN1c3RvbWVyQm9va2luZ3MoXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBwaG9uZT86IHN0cmluZyxcclxuICBmaWx0ZXI/OiAnYWxsJyB8ICd1cGNvbWluZycgfCAnY29tcGxldGVkJyB8ICdjYW5jZWxsZWQnXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgYm9va2luZ3M/OiBCb29raW5nW107XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICBsZXQgcXVlcnkgPSBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnYm9va2luZ3MnKVxyXG4gICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgLm9yZGVyKCdzZXJ2aWNlX2RhdGUnLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcclxuICAgICAgLm9yZGVyKCdjcmVhdGVkX2F0JywgeyBhc2NlbmRpbmc6IGZhbHNlIH0pO1xyXG5cclxuICAgIC8vIEJ1aWxkIHF1ZXJ5IGZvciBlbWFpbC9waG9uZSBsb29rdXBcclxuICAgIGlmIChlbWFpbCAmJiBwaG9uZSkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5Lm9yKGBjdXN0b21lcl9lbWFpbC5lcS4ke2VtYWlsfSxjdXN0b21lcl9waG9uZS5lcS4ke3Bob25lfWApO1xyXG4gICAgfSBlbHNlIGlmIChlbWFpbCkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdjdXN0b21lcl9lbWFpbCcsIGVtYWlsKTtcclxuICAgIH0gZWxzZSBpZiAocGhvbmUpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnY3VzdG9tZXJfcGhvbmUnLCBwaG9uZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdFbWFpbCBvciBwaG9uZSBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBBcHBseSBzdGF0dXMgZmlsdGVyXHJcbiAgICBpZiAoZmlsdGVyICYmIGZpbHRlciAhPT0gJ2FsbCcpIHtcclxuICAgICAgaWYgKGZpbHRlciA9PT0gJ3VwY29taW5nJykge1xyXG4gICAgICAgIHF1ZXJ5ID0gcXVlcnkuaW4oJ3N0YXR1cycsIFsncGVuZGluZycsICdjb25maXJtZWQnXSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnc3RhdHVzJywgZmlsdGVyKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHF1ZXJ5O1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBib29raW5nczonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGJvb2tpbmdzOiBkYXRhIHx8IFtdIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGdldEN1c3RvbWVyQm9va2luZ3M6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gZmV0Y2ggYm9va2luZ3MnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDdXN0b21lckJvb2tpbmdTdGF0cyhcclxuICBlbWFpbDogc3RyaW5nLFxyXG4gIHBob25lPzogc3RyaW5nXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgc3RhdHM/OiB7XHJcbiAgICB0b3RhbDogbnVtYmVyO1xyXG4gICAgdXBjb21pbmc6IG51bWJlcjtcclxuICAgIGNvbXBsZXRlZDogbnVtYmVyO1xyXG4gICAgY2FuY2VsbGVkOiBudW1iZXI7XHJcbiAgICB0b3RhbFNwZW50OiBudW1iZXI7XHJcbiAgfTtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIGxldCBxdWVyeSA9IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdib29raW5ncycpXHJcbiAgICAgIC5zZWxlY3QoJ3N0YXR1cywgdG90YWxfYW1vdW50LCBwYXltZW50X3N0YXR1cycpO1xyXG5cclxuICAgIC8vIEJ1aWxkIHF1ZXJ5IGZvciBlbWFpbC9waG9uZSBsb29rdXBcclxuICAgIGlmIChlbWFpbCAmJiBwaG9uZSkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5Lm9yKGBjdXN0b21lcl9lbWFpbC5lcS4ke2VtYWlsfSxjdXN0b21lcl9waG9uZS5lcS4ke3Bob25lfWApO1xyXG4gICAgfSBlbHNlIGlmIChlbWFpbCkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdjdXN0b21lcl9lbWFpbCcsIGVtYWlsKTtcclxuICAgIH0gZWxzZSBpZiAocGhvbmUpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnY3VzdG9tZXJfcGhvbmUnLCBwaG9uZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdFbWFpbCBvciBwaG9uZSBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBxdWVyeTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgc3RhdHMgPSB7XHJcbiAgICAgIHRvdGFsOiBkYXRhPy5sZW5ndGggfHwgMCxcclxuICAgICAgdXBjb21pbmc6IGRhdGE/LmZpbHRlcigoYikgPT4gYi5zdGF0dXMgPT09ICdwZW5kaW5nJyB8fCBiLnN0YXR1cyA9PT0gJ2NvbmZpcm1lZCcpLmxlbmd0aCB8fCAwLFxyXG4gICAgICBjb21wbGV0ZWQ6IGRhdGE/LmZpbHRlcigoYikgPT4gYi5zdGF0dXMgPT09ICdjb21wbGV0ZWQnKS5sZW5ndGggfHwgMCxcclxuICAgICAgY2FuY2VsbGVkOiBkYXRhPy5maWx0ZXIoKGIpID0+IGIuc3RhdHVzID09PSAnY2FuY2VsbGVkJykubGVuZ3RoIHx8IDAsXHJcbiAgICAgIHRvdGFsU3BlbnQ6IGRhdGFcclxuICAgICAgICA/LmZpbHRlcigoYikgPT4gYi5wYXltZW50X3N0YXR1cyA9PT0gJ3BhaWQnKVxyXG4gICAgICAgIC5yZWR1Y2UoKHN1bSwgYikgPT4gc3VtICsgKGIudG90YWxfYW1vdW50IHx8IDApLCAwKSB8fCAwLFxyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBzdGF0cyB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBmZXRjaCBzdGF0cycsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEJvb2tpbmdCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGJvb2tpbmc/OiBCb29raW5nO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2Jvb2tpbmdzJylcclxuICAgICAgLnNlbGVjdCgnKicpXHJcbiAgICAgIC5lcSgnaWQnLCBpZClcclxuICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBib29raW5nOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnQm9va2luZyBub3QgZm91bmQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYm9va2luZzogZGF0YSB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdVbmV4cGVjdGVkIGVycm9yIGZldGNoaW5nIGJvb2tpbmc6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q3VzdG9tZXJQcm9maWxlKFxyXG4gIGVtYWlsOiBzdHJpbmcsXHJcbiAgcGhvbmU/OiBzdHJpbmdcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBwcm9maWxlPzogUHJvZmlsZTtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIEZpcnN0LCB0cnkgdG8gZ2V0IHByb2ZpbGUgZnJvbSBwcm9maWxlcyB0YWJsZVxyXG4gICAgbGV0IHF1ZXJ5ID0gc3VwYWJhc2UuZnJvbSgncHJvZmlsZXMnKS5zZWxlY3QoJyonKTtcclxuXHJcbiAgICBpZiAoZW1haWwpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnZW1haWwnLCBlbWFpbCk7XHJcbiAgICB9IGVsc2UgaWYgKHBob25lKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ3Bob25lJywgcGhvbmUpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRW1haWwgb3IgcGhvbmUgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBkYXRhOiBwcm9maWxlRGF0YSwgZXJyb3I6IHByb2ZpbGVFcnJvciB9ID0gYXdhaXQgcXVlcnkubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgICAvLyBJZiBwcm9maWxlIGV4aXN0cywgcmV0dXJuIGl0XHJcbiAgICBpZiAocHJvZmlsZURhdGEgJiYgIXByb2ZpbGVFcnJvcikge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBwcm9maWxlOiBwcm9maWxlRGF0YSB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIElmIG5vIHByb2ZpbGUgZXhpc3RzLCBkZXJpdmUgZnJvbSBtb3N0IHJlY2VudCBib29raW5nXHJcbiAgICBsZXQgYm9va2luZ1F1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2Jvb2tpbmdzJylcclxuICAgICAgLnNlbGVjdCgnY3VzdG9tZXJfZmlyc3RfbmFtZSwgY3VzdG9tZXJfbGFzdF9uYW1lLCBjdXN0b21lcl9lbWFpbCwgY3VzdG9tZXJfcGhvbmUnKVxyXG4gICAgICAub3JkZXIoJ2NyZWF0ZWRfYXQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcclxuICAgICAgLmxpbWl0KDEpO1xyXG5cclxuICAgIGlmIChlbWFpbCAmJiBwaG9uZSkge1xyXG4gICAgICBib29raW5nUXVlcnkgPSBib29raW5nUXVlcnkub3IoYGN1c3RvbWVyX2VtYWlsLmVxLiR7ZW1haWx9LGN1c3RvbWVyX3Bob25lLmVxLiR7cGhvbmV9YCk7XHJcbiAgICB9IGVsc2UgaWYgKGVtYWlsKSB7XHJcbiAgICAgIGJvb2tpbmdRdWVyeSA9IGJvb2tpbmdRdWVyeS5lcSgnY3VzdG9tZXJfZW1haWwnLCBlbWFpbCk7XHJcbiAgICB9IGVsc2UgaWYgKHBob25lKSB7XHJcbiAgICAgIGJvb2tpbmdRdWVyeSA9IGJvb2tpbmdRdWVyeS5lcSgnY3VzdG9tZXJfcGhvbmUnLCBwaG9uZSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBkYXRhOiBib29raW5nRGF0YSwgZXJyb3I6IGJvb2tpbmdFcnJvciB9ID0gYXdhaXQgYm9va2luZ1F1ZXJ5Lm1heWJlU2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKGJvb2tpbmdFcnJvciB8fCAhYm9va2luZ0RhdGEpIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogJ05vIHByb2ZpbGUgb3IgYm9va2luZyBmb3VuZC4gUGxlYXNlIGNyZWF0ZSBhIGJvb2tpbmcgZmlyc3QuJyxcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDcmVhdGUgYSBwcm9maWxlIG9iamVjdCBmcm9tIGJvb2tpbmcgZGF0YVxyXG4gICAgY29uc3QgZGVyaXZlZFByb2ZpbGU6IFByb2ZpbGUgPSB7XHJcbiAgICAgIGlkOiAnJywgLy8gV2lsbCBiZSBnZW5lcmF0ZWQgd2hlbiBzYXZlZFxyXG4gICAgICBlbWFpbDogYm9va2luZ0RhdGEuY3VzdG9tZXJfZW1haWwsXHJcbiAgICAgIHBob25lOiBib29raW5nRGF0YS5jdXN0b21lcl9waG9uZSB8fCBudWxsLFxyXG4gICAgICBmaXJzdF9uYW1lOiBib29raW5nRGF0YS5jdXN0b21lcl9maXJzdF9uYW1lLFxyXG4gICAgICBsYXN0X25hbWU6IGJvb2tpbmdEYXRhLmN1c3RvbWVyX2xhc3RfbmFtZSxcclxuICAgICAgY3JlYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHByb2ZpbGU6IGRlcml2ZWRQcm9maWxlIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGdldEN1c3RvbWVyUHJvZmlsZTonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBmZXRjaCBwcm9maWxlJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBsb2FkUHJvZmlsZVBpY3R1cmUoXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBmaWxlOiBGaWxlXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgdXJsPzogc3RyaW5nO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgLy8gVmFsaWRhdGUgZmlsZVxyXG4gICAgaWYgKCFmaWxlKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ05vIGZpbGUgcHJvdmlkZWQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVmFsaWRhdGUgZmlsZSB0eXBlXHJcbiAgICBjb25zdCB2YWxpZEltYWdlVHlwZXMgPSBbJ2ltYWdlL2pwZWcnLCAnaW1hZ2UvanBnJywgJ2ltYWdlL3BuZycsICdpbWFnZS93ZWJwJ107XHJcbiAgICBpZiAoIXZhbGlkSW1hZ2VUeXBlcy5pbmNsdWRlcyhmaWxlLnR5cGUpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ludmFsaWQgZmlsZSB0eXBlLiBQbGVhc2UgdXBsb2FkIGEgSlBFRywgUE5HLCBvciBXZWJQIGltYWdlLicgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBWYWxpZGF0ZSBmaWxlIHNpemUgKG1heCA1TUIpXHJcbiAgICBjb25zdCBtYXhTaXplID0gNSAqIDEwMjQgKiAxMDI0OyAvLyA1TUIgaW4gYnl0ZXNcclxuICAgIGlmIChmaWxlLnNpemUgPiBtYXhTaXplKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ZpbGUgc2l6ZSB0b28gbGFyZ2UuIFBsZWFzZSB1cGxvYWQgYW4gaW1hZ2Ugc21hbGxlciB0aGFuIDVNQi4nIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gR2VuZXJhdGUgdW5pcXVlIGZpbGVuYW1lIHVzaW5nIGVtYWlsIGFuZCB0aW1lc3RhbXBcclxuICAgIGNvbnN0IGZpbGVFeHQgPSBmaWxlLm5hbWUuc3BsaXQoJy4nKS5wb3AoKTtcclxuICAgIGNvbnN0IGZpbGVOYW1lID0gYCR7ZW1haWwucmVwbGFjZSgvW15hLXpBLVowLTldL2csICdfJyl9XyR7RGF0ZS5ub3coKX0uJHtmaWxlRXh0fWA7XHJcbiAgICBjb25zdCBmaWxlUGF0aCA9IGBhdmF0YXJzLyR7ZmlsZU5hbWV9YDtcclxuXHJcbiAgICAvLyBDb252ZXJ0IEZpbGUgdG8gQXJyYXlCdWZmZXIgZm9yIHVwbG9hZFxyXG4gICAgY29uc3QgYXJyYXlCdWZmZXIgPSBhd2FpdCBmaWxlLmFycmF5QnVmZmVyKCk7XHJcbiAgICBjb25zdCBidWZmZXIgPSBCdWZmZXIuZnJvbShhcnJheUJ1ZmZlcik7XHJcblxyXG4gICAgLy8gVXBsb2FkIHRvIFN1cGFiYXNlIFN0b3JhZ2VcclxuICAgIGNvbnN0IHsgZGF0YTogdXBsb2FkRGF0YSwgZXJyb3I6IHVwbG9hZEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5zdG9yYWdlXHJcbiAgICAgIC5mcm9tKCdwcm9maWxlLXBpY3R1cmVzJylcclxuICAgICAgLnVwbG9hZChmaWxlUGF0aCwgYnVmZmVyLCB7XHJcbiAgICAgICAgY29udGVudFR5cGU6IGZpbGUudHlwZSxcclxuICAgICAgICB1cHNlcnQ6IGZhbHNlLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICBpZiAodXBsb2FkRXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBsb2FkaW5nIGZpbGU6JywgdXBsb2FkRXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHVwbG9hZEVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBHZXQgcHVibGljIFVSTFxyXG4gICAgY29uc3QgeyBkYXRhOiB1cmxEYXRhIH0gPSBzdXBhYmFzZS5zdG9yYWdlXHJcbiAgICAgIC5mcm9tKCdwcm9maWxlLXBpY3R1cmVzJylcclxuICAgICAgLmdldFB1YmxpY1VybChmaWxlUGF0aCk7XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdXJsOiB1cmxEYXRhLnB1YmxpY1VybCB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiB1cGxvYWRQcm9maWxlUGljdHVyZTonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byB1cGxvYWQgcHJvZmlsZSBwaWN0dXJlJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZGVsZXRlUHJvZmlsZVBpY3R1cmUoZW1haWw6IHN0cmluZywgYXZhdGFyVXJsOiBzdHJpbmcpOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgLy8gRXh0cmFjdCBmaWxlIHBhdGggZnJvbSBVUkxcclxuICAgIGNvbnN0IHVybFBhcnRzID0gYXZhdGFyVXJsLnNwbGl0KCcvcHJvZmlsZS1waWN0dXJlcy8nKTtcclxuICAgIGlmICh1cmxQYXJ0cy5sZW5ndGggPCAyKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ludmFsaWQgYXZhdGFyIFVSTCcgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBmaWxlUGF0aCA9IGBhdmF0YXJzLyR7dXJsUGFydHNbMV0uc3BsaXQoJy8nKS5wb3AoKX1gO1xyXG5cclxuICAgIC8vIERlbGV0ZSBmcm9tIHN0b3JhZ2VcclxuICAgIGNvbnN0IHsgZXJyb3I6IGRlbGV0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5zdG9yYWdlXHJcbiAgICAgIC5mcm9tKCdwcm9maWxlLXBpY3R1cmVzJylcclxuICAgICAgLnJlbW92ZShbZmlsZVBhdGhdKTtcclxuXHJcbiAgICBpZiAoZGVsZXRlRXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZGVsZXRpbmcgZmlsZTonLCBkZWxldGVFcnJvcik7XHJcbiAgICAgIC8vIERvbid0IGZhaWwgaWYgZmlsZSBkb2Vzbid0IGV4aXN0XHJcbiAgICAgIGlmIChkZWxldGVFcnJvci5tZXNzYWdlLmluY2x1ZGVzKCdub3QgZm91bmQnKSkge1xyXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGRlbGV0ZUVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGRlbGV0ZVByb2ZpbGVQaWN0dXJlOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGRlbGV0ZSBwcm9maWxlIHBpY3R1cmUnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGRhdGVDdXN0b21lclByb2ZpbGUoXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBkYXRhOiBQcm9maWxlVXBkYXRlSW5wdXRcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBwcm9maWxlPzogUHJvZmlsZTtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIFZhbGlkYXRlIGlucHV0XHJcbiAgICBpZiAoIWRhdGEuZmlyc3RfbmFtZT8udHJpbSgpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ZpcnN0IG5hbWUgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcbiAgICBpZiAoIWRhdGEubGFzdF9uYW1lPy50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTGFzdCBuYW1lIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG4gICAgaWYgKCFkYXRhLmVtYWlsPy50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRW1haWwgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcbiAgICBpZiAoIS9eW15cXHNAXStAW15cXHNAXStcXC5bXlxcc0BdKyQvLnRlc3QoZGF0YS5lbWFpbCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnSW52YWxpZCBlbWFpbCBmb3JtYXQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ2hlY2sgaWYgcHJvZmlsZSBleGlzdHNcclxuICAgIGNvbnN0IHsgZGF0YTogZXhpc3RpbmdQcm9maWxlIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgLmVxKCdlbWFpbCcsIGVtYWlsKVxyXG4gICAgICAubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgICAvLyBJZiBhdmF0YXJfdXJsIGlzIGJlaW5nIHJlbW92ZWQsIGRlbGV0ZSB0aGUgb2xkIGZpbGVcclxuICAgIGlmIChleGlzdGluZ1Byb2ZpbGU/LmF2YXRhcl91cmwgJiYgZGF0YS5hdmF0YXJfdXJsID09PSBudWxsKSB7XHJcbiAgICAgIGF3YWl0IGRlbGV0ZVByb2ZpbGVQaWN0dXJlKGVtYWlsLCBleGlzdGluZ1Byb2ZpbGUuYXZhdGFyX3VybCk7XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IHJlc3VsdDtcclxuICAgIGlmIChleGlzdGluZ1Byb2ZpbGUpIHtcclxuICAgICAgLy8gVXBkYXRlIGV4aXN0aW5nIHByb2ZpbGVcclxuICAgICAgLy8gSWYgZW1haWwgY2hhbmdlZCwgd2UgbmVlZCB0byBoYW5kbGUgaXQgY2FyZWZ1bGx5XHJcbiAgICAgIGlmIChkYXRhLmVtYWlsICE9PSBlbWFpbCkge1xyXG4gICAgICAgIC8vIENoZWNrIGlmIG5ldyBlbWFpbCBhbHJlYWR5IGV4aXN0c1xyXG4gICAgICAgIGNvbnN0IHsgZGF0YTogZW1haWxDaGVjayB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgICAgICAuc2VsZWN0KCdpZCcpXHJcbiAgICAgICAgICAuZXEoJ2VtYWlsJywgZGF0YS5lbWFpbClcclxuICAgICAgICAgIC5tYXliZVNpbmdsZSgpO1xyXG5cclxuICAgICAgICBpZiAoZW1haWxDaGVjaykge1xyXG4gICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRW1haWwgYWxyZWFkeSBleGlzdHMnIH07XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCB1cGRhdGVEYXRhOiBhbnkgPSB7XHJcbiAgICAgICAgZmlyc3RfbmFtZTogZGF0YS5maXJzdF9uYW1lLnRyaW0oKSxcclxuICAgICAgICBsYXN0X25hbWU6IGRhdGEubGFzdF9uYW1lLnRyaW0oKSxcclxuICAgICAgICBlbWFpbDogZGF0YS5lbWFpbC50cmltKCksXHJcbiAgICAgICAgcGhvbmU6IGRhdGEucGhvbmU/LnRyaW0oKSB8fCBudWxsLFxyXG4gICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8vIE9ubHkgdXBkYXRlIGF2YXRhcl91cmwgaWYgaXQncyBwcm92aWRlZFxyXG4gICAgICBpZiAoZGF0YS5hdmF0YXJfdXJsICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICB1cGRhdGVEYXRhLmF2YXRhcl91cmwgPSBkYXRhLmF2YXRhcl91cmw7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IHsgZGF0YTogdXBkYXRlZFByb2ZpbGUsIGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgIC51cGRhdGUodXBkYXRlRGF0YSlcclxuICAgICAgICAuZXEoJ2VtYWlsJywgZW1haWwpXHJcbiAgICAgICAgLnNlbGVjdCgpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgaWYgKHVwZGF0ZUVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBkYXRpbmcgcHJvZmlsZTonLCB1cGRhdGVFcnJvcik7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB1cGRhdGVFcnJvci5tZXNzYWdlIH07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJlc3VsdCA9IHVwZGF0ZWRQcm9maWxlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8gQ3JlYXRlIG5ldyBwcm9maWxlXHJcbiAgICAgIGNvbnN0IGluc2VydERhdGE6IGFueSA9IHtcclxuICAgICAgICBlbWFpbDogZGF0YS5lbWFpbC50cmltKCksXHJcbiAgICAgICAgcGhvbmU6IGRhdGEucGhvbmU/LnRyaW0oKSB8fCBudWxsLFxyXG4gICAgICAgIGZpcnN0X25hbWU6IGRhdGEuZmlyc3RfbmFtZS50cmltKCksXHJcbiAgICAgICAgbGFzdF9uYW1lOiBkYXRhLmxhc3RfbmFtZS50cmltKCksXHJcbiAgICAgIH07XHJcblxyXG4gICAgICAvLyBPbmx5IHNldCBhdmF0YXJfdXJsIGlmIGl0J3MgcHJvdmlkZWRcclxuICAgICAgaWYgKGRhdGEuYXZhdGFyX3VybCkge1xyXG4gICAgICAgIGluc2VydERhdGEuYXZhdGFyX3VybCA9IGRhdGEuYXZhdGFyX3VybDtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgeyBkYXRhOiBuZXdQcm9maWxlLCBlcnJvcjogaW5zZXJ0RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcclxuICAgICAgICAuaW5zZXJ0KGluc2VydERhdGEpXHJcbiAgICAgICAgLnNlbGVjdCgpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgaWYgKGluc2VydEVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYXRpbmcgcHJvZmlsZTonLCBpbnNlcnRFcnJvcik7XHJcbiAgICAgICAgLy8gQ2hlY2sgaWYgaXQncyBhIHVuaXF1ZSBjb25zdHJhaW50IHZpb2xhdGlvblxyXG4gICAgICAgIGlmIChpbnNlcnRFcnJvci5jb2RlID09PSAnMjM1MDUnKSB7XHJcbiAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdFbWFpbCBhbHJlYWR5IGV4aXN0cycgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBpbnNlcnRFcnJvci5tZXNzYWdlIH07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJlc3VsdCA9IG5ld1Byb2ZpbGU7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcHJvZmlsZTogcmVzdWx0IH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHVwZGF0ZUN1c3RvbWVyUHJvZmlsZTonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byB1cGRhdGUgcHJvZmlsZScsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEN1c3RvbWVyTG9jYXRpb25zKFxyXG4gIGVtYWlsOiBzdHJpbmcsXHJcbiAgcGhvbmU/OiBzdHJpbmdcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBsb2NhdGlvbnM/OiBMb2NhdGlvbltdO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgbGV0IHF1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2xvY2F0aW9ucycpXHJcbiAgICAgIC5zZWxlY3QoJyonKVxyXG4gICAgICAub3JkZXIoJ2lzX2RlZmF1bHQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcclxuICAgICAgLm9yZGVyKCdjcmVhdGVkX2F0JywgeyBhc2NlbmRpbmc6IGZhbHNlIH0pO1xyXG5cclxuICAgIC8vIEJ1aWxkIHF1ZXJ5IGZvciBlbWFpbC9waG9uZSBsb29rdXBcclxuICAgIGlmIChlbWFpbCAmJiBwaG9uZSkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5Lm9yKGBjdXN0b21lcl9lbWFpbC5lcS4ke2VtYWlsfSxjdXN0b21lcl9waG9uZS5lcS4ke3Bob25lfWApO1xyXG4gICAgfSBlbHNlIGlmIChlbWFpbCkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdjdXN0b21lcl9lbWFpbCcsIGVtYWlsKTtcclxuICAgIH0gZWxzZSBpZiAocGhvbmUpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnY3VzdG9tZXJfcGhvbmUnLCBwaG9uZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdFbWFpbCBvciBwaG9uZSBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBxdWVyeTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgbG9jYXRpb25zOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgbG9jYXRpb25zOiBkYXRhIHx8IFtdIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGdldEN1c3RvbWVyTG9jYXRpb25zOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGZldGNoIGxvY2F0aW9ucycsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUxvY2F0aW9uKFxyXG4gIGVtYWlsOiBzdHJpbmcsXHJcbiAgcGhvbmU6IHN0cmluZyB8IHVuZGVmaW5lZCxcclxuICBsb2NhdGlvbkRhdGE6IExvY2F0aW9uQ3JlYXRlSW5wdXRcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBsb2NhdGlvbj86IExvY2F0aW9uO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgLy8gVmFsaWRhdGUgaW5wdXRcclxuICAgIGlmICghbG9jYXRpb25EYXRhLm5pY2tuYW1lPy50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTmlja25hbWUgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcbiAgICBpZiAoIWxvY2F0aW9uRGF0YS5hZGRyZXNzPy50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnQWRkcmVzcyBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuICAgIGlmICghbG9jYXRpb25EYXRhLnN1YnVyYj8udHJpbSgpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ1N1YnVyYiBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuICAgIGlmICghbG9jYXRpb25EYXRhLmNpdHk/LnRyaW0oKSkge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdDaXR5IGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIElmIHNldHRpbmcgYXMgZGVmYXVsdCwgdW5zZXQgYWxsIG90aGVyIGRlZmF1bHRzIGZvciB0aGlzIGN1c3RvbWVyXHJcbiAgICBpZiAobG9jYXRpb25EYXRhLmlzX2RlZmF1bHQpIHtcclxuICAgICAgbGV0IHVwZGF0ZVF1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgnbG9jYXRpb25zJylcclxuICAgICAgICAudXBkYXRlKHsgaXNfZGVmYXVsdDogZmFsc2UgfSk7XHJcblxyXG4gICAgICBpZiAoZW1haWwgJiYgcGhvbmUpIHtcclxuICAgICAgICB1cGRhdGVRdWVyeSA9IHVwZGF0ZVF1ZXJ5Lm9yKGBjdXN0b21lcl9lbWFpbC5lcS4ke2VtYWlsfSxjdXN0b21lcl9waG9uZS5lcS4ke3Bob25lfWApO1xyXG4gICAgICB9IGVsc2UgaWYgKGVtYWlsKSB7XHJcbiAgICAgICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5lcSgnY3VzdG9tZXJfZW1haWwnLCBlbWFpbCk7XHJcbiAgICAgIH0gZWxzZSBpZiAocGhvbmUpIHtcclxuICAgICAgICB1cGRhdGVRdWVyeSA9IHVwZGF0ZVF1ZXJ5LmVxKCdjdXN0b21lcl9waG9uZScsIHBob25lKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgYXdhaXQgdXBkYXRlUXVlcnk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBkYXRhOiBuZXdMb2NhdGlvbiwgZXJyb3I6IGluc2VydEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnbG9jYXRpb25zJylcclxuICAgICAgLmluc2VydCh7XHJcbiAgICAgICAgY3VzdG9tZXJfZW1haWw6IGVtYWlsLFxyXG4gICAgICAgIGN1c3RvbWVyX3Bob25lOiBwaG9uZSB8fCBudWxsLFxyXG4gICAgICAgIG5pY2tuYW1lOiBsb2NhdGlvbkRhdGEubmlja25hbWUudHJpbSgpLFxyXG4gICAgICAgIGFkZHJlc3M6IGxvY2F0aW9uRGF0YS5hZGRyZXNzLnRyaW0oKSxcclxuICAgICAgICBhcHRfdW5pdDogbG9jYXRpb25EYXRhLmFwdF91bml0Py50cmltKCkgfHwgbnVsbCxcclxuICAgICAgICBzdWJ1cmI6IGxvY2F0aW9uRGF0YS5zdWJ1cmIudHJpbSgpLFxyXG4gICAgICAgIGNpdHk6IGxvY2F0aW9uRGF0YS5jaXR5LnRyaW0oKSxcclxuICAgICAgICBwb3N0YWxfY29kZTogbG9jYXRpb25EYXRhLnBvc3RhbF9jb2RlPy50cmltKCkgfHwgbnVsbCxcclxuICAgICAgICBpc19kZWZhdWx0OiBsb2NhdGlvbkRhdGEuaXNfZGVmYXVsdCB8fCBmYWxzZSxcclxuICAgICAgfSlcclxuICAgICAgLnNlbGVjdCgpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoaW5zZXJ0RXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYXRpbmcgbG9jYXRpb246JywgaW5zZXJ0RXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGluc2VydEVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBsb2NhdGlvbjogbmV3TG9jYXRpb24gfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gY3JlYXRlTG9jYXRpb246JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gY3JlYXRlIGxvY2F0aW9uJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlTG9jYXRpb24oXHJcbiAgbG9jYXRpb25JZDogc3RyaW5nLFxyXG4gIGxvY2F0aW9uRGF0YTogTG9jYXRpb25VcGRhdGVJbnB1dFxyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGxvY2F0aW9uPzogTG9jYXRpb247XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICAvLyBWYWxpZGF0ZSBpbnB1dCBpZiBwcm92aWRlZFxyXG4gICAgaWYgKGxvY2F0aW9uRGF0YS5uaWNrbmFtZSAhPT0gdW5kZWZpbmVkICYmICFsb2NhdGlvbkRhdGEubmlja25hbWUudHJpbSgpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ05pY2tuYW1lIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG4gICAgaWYgKGxvY2F0aW9uRGF0YS5hZGRyZXNzICE9PSB1bmRlZmluZWQgJiYgIWxvY2F0aW9uRGF0YS5hZGRyZXNzLnRyaW0oKSkge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdBZGRyZXNzIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG4gICAgaWYgKGxvY2F0aW9uRGF0YS5zdWJ1cmIgIT09IHVuZGVmaW5lZCAmJiAhbG9jYXRpb25EYXRhLnN1YnVyYi50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnU3VidXJiIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG4gICAgaWYgKGxvY2F0aW9uRGF0YS5jaXR5ICE9PSB1bmRlZmluZWQgJiYgIWxvY2F0aW9uRGF0YS5jaXR5LnRyaW0oKSkge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdDaXR5IGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEdldCBjdXJyZW50IGxvY2F0aW9uIHRvIGNoZWNrIGN1c3RvbWVyIGVtYWlsXHJcbiAgICBjb25zdCB7IGRhdGE6IGN1cnJlbnRMb2NhdGlvbiwgZXJyb3I6IGZldGNoRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdsb2NhdGlvbnMnKVxyXG4gICAgICAuc2VsZWN0KCdjdXN0b21lcl9lbWFpbCwgY3VzdG9tZXJfcGhvbmUnKVxyXG4gICAgICAuZXEoJ2lkJywgbG9jYXRpb25JZClcclxuICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgIGlmIChmZXRjaEVycm9yIHx8ICFjdXJyZW50TG9jYXRpb24pIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTG9jYXRpb24gbm90IGZvdW5kJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIElmIHNldHRpbmcgYXMgZGVmYXVsdCwgdW5zZXQgYWxsIG90aGVyIGRlZmF1bHRzIGZvciB0aGlzIGN1c3RvbWVyXHJcbiAgICBpZiAobG9jYXRpb25EYXRhLmlzX2RlZmF1bHQpIHtcclxuICAgICAgbGV0IHVwZGF0ZVF1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgnbG9jYXRpb25zJylcclxuICAgICAgICAudXBkYXRlKHsgaXNfZGVmYXVsdDogZmFsc2UgfSk7XHJcblxyXG4gICAgICBpZiAoY3VycmVudExvY2F0aW9uLmN1c3RvbWVyX2VtYWlsICYmIGN1cnJlbnRMb2NhdGlvbi5jdXN0b21lcl9waG9uZSkge1xyXG4gICAgICAgIHVwZGF0ZVF1ZXJ5ID0gdXBkYXRlUXVlcnkub3IoYGN1c3RvbWVyX2VtYWlsLmVxLiR7Y3VycmVudExvY2F0aW9uLmN1c3RvbWVyX2VtYWlsfSxjdXN0b21lcl9waG9uZS5lcS4ke2N1cnJlbnRMb2NhdGlvbi5jdXN0b21lcl9waG9uZX1gKTtcclxuICAgICAgfSBlbHNlIGlmIChjdXJyZW50TG9jYXRpb24uY3VzdG9tZXJfZW1haWwpIHtcclxuICAgICAgICB1cGRhdGVRdWVyeSA9IHVwZGF0ZVF1ZXJ5LmVxKCdjdXN0b21lcl9lbWFpbCcsIGN1cnJlbnRMb2NhdGlvbi5jdXN0b21lcl9lbWFpbCk7XHJcbiAgICAgIH0gZWxzZSBpZiAoY3VycmVudExvY2F0aW9uLmN1c3RvbWVyX3Bob25lKSB7XHJcbiAgICAgICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5lcSgnY3VzdG9tZXJfcGhvbmUnLCBjdXJyZW50TG9jYXRpb24uY3VzdG9tZXJfcGhvbmUpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBEb24ndCB1bnNldCB0aGUgY3VycmVudCBsb2NhdGlvblxyXG4gICAgICB1cGRhdGVRdWVyeSA9IHVwZGF0ZVF1ZXJ5Lm5lcSgnaWQnLCBsb2NhdGlvbklkKTtcclxuXHJcbiAgICAgIGF3YWl0IHVwZGF0ZVF1ZXJ5O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEJ1aWxkIHVwZGF0ZSBvYmplY3Qgd2l0aCBvbmx5IHByb3ZpZGVkIGZpZWxkc1xyXG4gICAgY29uc3QgdXBkYXRlRGF0YTogYW55ID0ge1xyXG4gICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICB9O1xyXG5cclxuICAgIGlmIChsb2NhdGlvbkRhdGEubmlja25hbWUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB1cGRhdGVEYXRhLm5pY2tuYW1lID0gbG9jYXRpb25EYXRhLm5pY2tuYW1lLnRyaW0oKTtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuYWRkcmVzcyAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHVwZGF0ZURhdGEuYWRkcmVzcyA9IGxvY2F0aW9uRGF0YS5hZGRyZXNzLnRyaW0oKTtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuYXB0X3VuaXQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB1cGRhdGVEYXRhLmFwdF91bml0ID0gbG9jYXRpb25EYXRhLmFwdF91bml0Py50cmltKCkgfHwgbnVsbDtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuc3VidXJiICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgdXBkYXRlRGF0YS5zdWJ1cmIgPSBsb2NhdGlvbkRhdGEuc3VidXJiLnRyaW0oKTtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuY2l0eSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHVwZGF0ZURhdGEuY2l0eSA9IGxvY2F0aW9uRGF0YS5jaXR5LnRyaW0oKTtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEucG9zdGFsX2NvZGUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB1cGRhdGVEYXRhLnBvc3RhbF9jb2RlID0gbG9jYXRpb25EYXRhLnBvc3RhbF9jb2RlPy50cmltKCkgfHwgbnVsbDtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuaXNfZGVmYXVsdCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHVwZGF0ZURhdGEuaXNfZGVmYXVsdCA9IGxvY2F0aW9uRGF0YS5pc19kZWZhdWx0O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgZGF0YTogdXBkYXRlZExvY2F0aW9uLCBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdsb2NhdGlvbnMnKVxyXG4gICAgICAudXBkYXRlKHVwZGF0ZURhdGEpXHJcbiAgICAgIC5lcSgnaWQnLCBsb2NhdGlvbklkKVxyXG4gICAgICAuc2VsZWN0KClcclxuICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgIGlmICh1cGRhdGVFcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciB1cGRhdGluZyBsb2NhdGlvbjonLCB1cGRhdGVFcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogdXBkYXRlRXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGxvY2F0aW9uOiB1cGRhdGVkTG9jYXRpb24gfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gdXBkYXRlTG9jYXRpb246JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gdXBkYXRlIGxvY2F0aW9uJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZGVsZXRlTG9jYXRpb24obG9jYXRpb25JZDogc3RyaW5nKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdsb2NhdGlvbnMnKVxyXG4gICAgICAuZGVsZXRlKClcclxuICAgICAgLmVxKCdpZCcsIGxvY2F0aW9uSWQpO1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBkZWxldGluZyBsb2NhdGlvbjonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gZGVsZXRlTG9jYXRpb246JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gZGVsZXRlIGxvY2F0aW9uJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2V0RGVmYXVsdExvY2F0aW9uKFxyXG4gIGxvY2F0aW9uSWQ6IHN0cmluZyxcclxuICBlbWFpbDogc3RyaW5nLFxyXG4gIHBob25lPzogc3RyaW5nXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgbG9jYXRpb24/OiBMb2NhdGlvbjtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIEdldCBjdXJyZW50IGxvY2F0aW9uIHRvIHZlcmlmeSBvd25lcnNoaXBcclxuICAgIGNvbnN0IHsgZGF0YTogY3VycmVudExvY2F0aW9uLCBlcnJvcjogZmV0Y2hFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2xvY2F0aW9ucycpXHJcbiAgICAgIC5zZWxlY3QoJ2N1c3RvbWVyX2VtYWlsLCBjdXN0b21lcl9waG9uZScpXHJcbiAgICAgIC5lcSgnaWQnLCBsb2NhdGlvbklkKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKGZldGNoRXJyb3IgfHwgIWN1cnJlbnRMb2NhdGlvbikge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdMb2NhdGlvbiBub3QgZm91bmQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVmVyaWZ5IG93bmVyc2hpcFxyXG4gICAgY29uc3QgaXNPd25lciA9IFxyXG4gICAgICBjdXJyZW50TG9jYXRpb24uY3VzdG9tZXJfZW1haWwgPT09IGVtYWlsIHx8XHJcbiAgICAgIChwaG9uZSAmJiBjdXJyZW50TG9jYXRpb24uY3VzdG9tZXJfcGhvbmUgPT09IHBob25lKTtcclxuXHJcbiAgICBpZiAoIWlzT3duZXIpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnVW5hdXRob3JpemVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFVuc2V0IGFsbCBvdGhlciBkZWZhdWx0cyBmb3IgdGhpcyBjdXN0b21lclxyXG4gICAgbGV0IHVwZGF0ZVF1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2xvY2F0aW9ucycpXHJcbiAgICAgIC51cGRhdGUoeyBpc19kZWZhdWx0OiBmYWxzZSB9KTtcclxuXHJcbiAgICBpZiAoZW1haWwgJiYgcGhvbmUpIHtcclxuICAgICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5vcihgY3VzdG9tZXJfZW1haWwuZXEuJHtlbWFpbH0sY3VzdG9tZXJfcGhvbmUuZXEuJHtwaG9uZX1gKTtcclxuICAgIH0gZWxzZSBpZiAoZW1haWwpIHtcclxuICAgICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5lcSgnY3VzdG9tZXJfZW1haWwnLCBlbWFpbCk7XHJcbiAgICB9IGVsc2UgaWYgKHBob25lKSB7XHJcbiAgICAgIHVwZGF0ZVF1ZXJ5ID0gdXBkYXRlUXVlcnkuZXEoJ2N1c3RvbWVyX3Bob25lJywgcGhvbmUpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIERvbid0IHVuc2V0IHRoZSBjdXJyZW50IGxvY2F0aW9uXHJcbiAgICB1cGRhdGVRdWVyeSA9IHVwZGF0ZVF1ZXJ5Lm5lcSgnaWQnLCBsb2NhdGlvbklkKTtcclxuXHJcbiAgICBhd2FpdCB1cGRhdGVRdWVyeTtcclxuXHJcbiAgICAvLyBTZXQgdGhpcyBsb2NhdGlvbiBhcyBkZWZhdWx0XHJcbiAgICBjb25zdCB7IGRhdGE6IHVwZGF0ZWRMb2NhdGlvbiwgZXJyb3I6IHVwZGF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnbG9jYXRpb25zJylcclxuICAgICAgLnVwZGF0ZSh7IGlzX2RlZmF1bHQ6IHRydWUgfSlcclxuICAgICAgLmVxKCdpZCcsIGxvY2F0aW9uSWQpXHJcbiAgICAgIC5zZWxlY3QoKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKHVwZGF0ZUVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHNldHRpbmcgZGVmYXVsdCBsb2NhdGlvbjonLCB1cGRhdGVFcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogdXBkYXRlRXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGxvY2F0aW9uOiB1cGRhdGVkTG9jYXRpb24gfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gc2V0RGVmYXVsdExvY2F0aW9uOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIHNldCBkZWZhdWx0IGxvY2F0aW9uJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0T3JDcmVhdGVSZWZlcnJhbENvZGUoXHJcbiAgZW1haWw6IHN0cmluZ1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIHJlZmVycmFsQ29kZT86IHN0cmluZztcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIENoZWNrIGlmIHByb2ZpbGUgZXhpc3RzIGFuZCBoYXMgYSByZWZlcnJhbCBjb2RlXHJcbiAgICBjb25zdCB7IGRhdGE6IHByb2ZpbGUsIGVycm9yOiBwcm9maWxlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgIC5zZWxlY3QoJ3JlZmVycmFsX2NvZGUnKVxyXG4gICAgICAuZXEoJ2VtYWlsJywgZW1haWwpXHJcbiAgICAgIC5tYXliZVNpbmdsZSgpO1xyXG5cclxuICAgIGlmIChwcm9maWxlRXJyb3IgJiYgcHJvZmlsZUVycm9yLmNvZGUgIT09ICdQR1JTVDExNicpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgcHJvZmlsZTonLCBwcm9maWxlRXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHByb2ZpbGVFcnJvci5tZXNzYWdlIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gSWYgcHJvZmlsZSBleGlzdHMgYW5kIGhhcyBhIHJlZmVycmFsIGNvZGUsIHJldHVybiBpdFxyXG4gICAgaWYgKHByb2ZpbGU/LnJlZmVycmFsX2NvZGUpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcmVmZXJyYWxDb2RlOiBwcm9maWxlLnJlZmVycmFsX2NvZGUgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBHZW5lcmF0ZSBhIG5ldyByZWZlcnJhbCBjb2RlXHJcbiAgICAvLyBUcnkgdXNpbmcgdGhlIGRhdGFiYXNlIGZ1bmN0aW9uIGZpcnN0LCBidXQgZmFsbGJhY2sgdG8gY2xpZW50LXNpZGUgZ2VuZXJhdGlvblxyXG4gICAgbGV0IGdlbmVyYXRlZENvZGU6IHN0cmluZyB8IG51bGwgPSBudWxsO1xyXG4gICAgXHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB7IGRhdGE6IGRiQ29kZSwgZXJyb3I6IGNvZGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAucnBjKCdnZW5lcmF0ZV9yZWZlcnJhbF9jb2RlJyk7XHJcbiAgICAgIFxyXG4gICAgICBpZiAoIWNvZGVFcnJvciAmJiBkYkNvZGUpIHtcclxuICAgICAgICBnZW5lcmF0ZWRDb2RlID0gZGJDb2RlO1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChycGNFcnJvcikge1xyXG4gICAgICAvLyBSUEMgZnVuY3Rpb24gbWlnaHQgbm90IGV4aXN0IHlldCwgdGhhdCdzIG9rYXlcclxuICAgICAgY29uc29sZS5sb2coJ1JQQyBmdW5jdGlvbiBub3QgYXZhaWxhYmxlLCB1c2luZyBmYWxsYmFjaycpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghZ2VuZXJhdGVkQ29kZSkge1xyXG4gICAgICAvLyBGYWxsYmFjazogZ2VuZXJhdGUgY29kZSBjbGllbnQtc2lkZSBzdHlsZVxyXG4gICAgICBjb25zdCBmYWxsYmFja0NvZGUgPSBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoMiwgOCkudG9VcHBlckNhc2UoKTtcclxuICAgICAgXHJcbiAgICAgIC8vIENoZWNrIGlmIGZhbGxiYWNrIGNvZGUgZXhpc3RzLCByZXRyeSBpZiBpdCBkb2VzXHJcbiAgICAgIGxldCBmaW5hbENvZGUgPSBmYWxsYmFja0NvZGU7XHJcbiAgICAgIGxldCBhdHRlbXB0cyA9IDA7XHJcbiAgICAgIGNvbnN0IG1heEF0dGVtcHRzID0gNTtcclxuXHJcbiAgICAgIHdoaWxlIChhdHRlbXB0cyA8IG1heEF0dGVtcHRzKSB7XHJcbiAgICAgICAgY29uc3QgeyBkYXRhOiBleGlzdGluZyB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgICAgICAuc2VsZWN0KCdpZCcpXHJcbiAgICAgICAgICAuZXEoJ3JlZmVycmFsX2NvZGUnLCBmaW5hbENvZGUpXHJcbiAgICAgICAgICAubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgICAgICAgaWYgKCFleGlzdGluZykge1xyXG4gICAgICAgICAgYnJlYWs7IC8vIENvZGUgaXMgdW5pcXVlXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBHZW5lcmF0ZSBhIG5ldyBjb2RlXHJcbiAgICAgICAgZmluYWxDb2RlID0gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIsIDgpLnRvVXBwZXJDYXNlKCk7XHJcbiAgICAgICAgYXR0ZW1wdHMrKztcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gVXBkYXRlIG9yIGluc2VydCBwcm9maWxlIHdpdGggcmVmZXJyYWwgY29kZVxyXG4gICAgICAvLyBGaXJzdCwgdHJ5IHRvIHVwZGF0ZSBleGlzdGluZyBwcm9maWxlXHJcbiAgICAgIGNvbnN0IHsgZGF0YTogZXhpc3RpbmdQcm9maWxlIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgICAgLnNlbGVjdCgnaWQsIGZpcnN0X25hbWUsIGxhc3RfbmFtZScpXHJcbiAgICAgICAgLmVxKCdlbWFpbCcsIGVtYWlsKVxyXG4gICAgICAgIC5tYXliZVNpbmdsZSgpO1xyXG5cclxuICAgICAgbGV0IHVwZGF0ZWRQcm9maWxlO1xyXG4gICAgICBpZiAoZXhpc3RpbmdQcm9maWxlKSB7XHJcbiAgICAgICAgLy8gVXBkYXRlIGV4aXN0aW5nIHByb2ZpbGVcclxuICAgICAgICBjb25zdCB7IGRhdGE6IHVwZGF0ZWQsIGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgICAgICAudXBkYXRlKHtcclxuICAgICAgICAgICAgcmVmZXJyYWxfY29kZTogZmluYWxDb2RlLFxyXG4gICAgICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgLmVxKCdlbWFpbCcsIGVtYWlsKVxyXG4gICAgICAgICAgLnNlbGVjdCgncmVmZXJyYWxfY29kZScpXHJcbiAgICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICAgIGlmICh1cGRhdGVFcnJvcikge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBkYXRpbmcgcmVmZXJyYWwgY29kZTonLCB1cGRhdGVFcnJvcik7XHJcbiAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHVwZGF0ZUVycm9yLm1lc3NhZ2UgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdXBkYXRlZFByb2ZpbGUgPSB1cGRhdGVkO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEluc2VydCBuZXcgcHJvZmlsZSB3aXRoIHJlZmVycmFsIGNvZGVcclxuICAgICAgICBjb25zdCB7IGRhdGE6IGluc2VydGVkLCBlcnJvcjogaW5zZXJ0RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgICAgLmluc2VydCh7XHJcbiAgICAgICAgICAgIGVtYWlsLFxyXG4gICAgICAgICAgICByZWZlcnJhbF9jb2RlOiBmaW5hbENvZGUsXHJcbiAgICAgICAgICAgIGZpcnN0X25hbWU6IGVtYWlsLnNwbGl0KCdAJylbMF0sXHJcbiAgICAgICAgICAgIGxhc3RfbmFtZTogJycsXHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgLnNlbGVjdCgncmVmZXJyYWxfY29kZScpXHJcbiAgICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICAgIGlmIChpbnNlcnRFcnJvcikge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYXRpbmcgcmVmZXJyYWwgY29kZTonLCBpbnNlcnRFcnJvcik7XHJcbiAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGluc2VydEVycm9yLm1lc3NhZ2UgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdXBkYXRlZFByb2ZpbGUgPSBpbnNlcnRlZDtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcmVmZXJyYWxDb2RlOiB1cGRhdGVkUHJvZmlsZT8ucmVmZXJyYWxfY29kZSB8fCBmaW5hbENvZGUgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBVc2UgdGhlIGdlbmVyYXRlZCBjb2RlIGZyb20gZGF0YWJhc2UgZnVuY3Rpb25cclxuICAgIC8vIFVwZGF0ZSBvciBpbnNlcnQgcHJvZmlsZSB3aXRoIGdlbmVyYXRlZCBjb2RlXHJcbiAgICBjb25zdCB7IGRhdGE6IGV4aXN0aW5nUHJvZmlsZSB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcclxuICAgICAgLnNlbGVjdCgnaWQsIGZpcnN0X25hbWUsIGxhc3RfbmFtZScpXHJcbiAgICAgIC5lcSgnZW1haWwnLCBlbWFpbClcclxuICAgICAgLm1heWJlU2luZ2xlKCk7XHJcblxyXG4gICAgbGV0IHVwZGF0ZWRQcm9maWxlO1xyXG4gICAgaWYgKGV4aXN0aW5nUHJvZmlsZSkge1xyXG4gICAgICAvLyBVcGRhdGUgZXhpc3RpbmcgcHJvZmlsZVxyXG4gICAgICBjb25zdCB7IGRhdGE6IHVwZGF0ZWQsIGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgIC51cGRhdGUoe1xyXG4gICAgICAgICAgcmVmZXJyYWxfY29kZTogZ2VuZXJhdGVkQ29kZSxcclxuICAgICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5lcSgnZW1haWwnLCBlbWFpbClcclxuICAgICAgICAuc2VsZWN0KCdyZWZlcnJhbF9jb2RlJylcclxuICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICBpZiAodXBkYXRlRXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciB1cGRhdGluZyByZWZlcnJhbCBjb2RlOicsIHVwZGF0ZUVycm9yKTtcclxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHVwZGF0ZUVycm9yLm1lc3NhZ2UgfTtcclxuICAgICAgfVxyXG4gICAgICB1cGRhdGVkUHJvZmlsZSA9IHVwZGF0ZWQ7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyBJbnNlcnQgbmV3IHByb2ZpbGUgd2l0aCByZWZlcnJhbCBjb2RlXHJcbiAgICAgIGNvbnN0IHsgZGF0YTogaW5zZXJ0ZWQsIGVycm9yOiBpbnNlcnRFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgIC5pbnNlcnQoe1xyXG4gICAgICAgICAgZW1haWwsXHJcbiAgICAgICAgICByZWZlcnJhbF9jb2RlOiBnZW5lcmF0ZWRDb2RlLFxyXG4gICAgICAgICAgZmlyc3RfbmFtZTogZW1haWwuc3BsaXQoJ0AnKVswXSxcclxuICAgICAgICAgIGxhc3RfbmFtZTogJycsXHJcbiAgICAgICAgfSlcclxuICAgICAgICAuc2VsZWN0KCdyZWZlcnJhbF9jb2RlJylcclxuICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICBpZiAoaW5zZXJ0RXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjcmVhdGluZyByZWZlcnJhbCBjb2RlOicsIGluc2VydEVycm9yKTtcclxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGluc2VydEVycm9yLm1lc3NhZ2UgfTtcclxuICAgICAgfVxyXG4gICAgICB1cGRhdGVkUHJvZmlsZSA9IGluc2VydGVkO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHJlZmVycmFsQ29kZTogdXBkYXRlZFByb2ZpbGU/LnJlZmVycmFsX2NvZGUgfHwgZ2VuZXJhdGVkQ29kZSB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBnZXRPckNyZWF0ZVJlZmVycmFsQ29kZTonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBnZXQgcmVmZXJyYWwgY29kZScsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNlbmRSZWZlcnJhbEludml0ZXMoXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBpbnZpdGVFbWFpbHM6IHN0cmluZ1tdLFxyXG4gIHJlZmVycmFsQ29kZTogc3RyaW5nXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgc2VudD86IG51bWJlcjtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIFZhbGlkYXRlIGVtYWlsIGFkZHJlc3Nlc1xyXG4gICAgY29uc3QgdmFsaWRFbWFpbHMgPSBpbnZpdGVFbWFpbHNcclxuICAgICAgLm1hcCgoZSkgPT4gZS50cmltKCkpXHJcbiAgICAgIC5maWx0ZXIoKGUpID0+IHtcclxuICAgICAgICBpZiAoIWUpIHJldHVybiBmYWxzZTtcclxuICAgICAgICByZXR1cm4gL15bXlxcc0BdK0BbXlxcc0BdK1xcLlteXFxzQF0rJC8udGVzdChlKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgaWYgKHZhbGlkRW1haWxzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdObyB2YWxpZCBlbWFpbCBhZGRyZXNzZXMgcHJvdmlkZWQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ3JlYXRlIHJlZmVycmFsIHJlY29yZHMgZm9yIHRyYWNraW5nXHJcbiAgICBjb25zdCByZWZlcnJhbFJlY29yZHMgPSB2YWxpZEVtYWlscy5tYXAoKHJlZmVycmVkRW1haWwpID0+ICh7XHJcbiAgICAgIHJlZmVycmVyX2VtYWlsOiBlbWFpbCxcclxuICAgICAgcmVmZXJyZWRfZW1haWw6IHJlZmVycmVkRW1haWwsXHJcbiAgICAgIHJlZmVycmFsX2NvZGU6IHJlZmVycmFsQ29kZSxcclxuICAgICAgc3RhdHVzOiAncGVuZGluZycsXHJcbiAgICB9KSk7XHJcblxyXG4gICAgY29uc3QgeyBlcnJvcjogaW5zZXJ0RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdyZWZlcnJhbHMnKVxyXG4gICAgICAuaW5zZXJ0KHJlZmVycmFsUmVjb3Jkcyk7XHJcblxyXG4gICAgaWYgKGluc2VydEVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIHJlZmVycmFsIHJlY29yZHM6JywgaW5zZXJ0RXJyb3IpO1xyXG4gICAgICAvLyBDb250aW51ZSBldmVuIGlmIGluc2VydCBmYWlscyAtIHdlIHN0aWxsIHdhbnQgdG8gc2VuZCBlbWFpbHNcclxuICAgIH1cclxuXHJcbiAgICAvLyBHZW5lcmF0ZSByZWZlcnJhbCBsaW5rXHJcbiAgICBjb25zdCBiYXNlVXJsID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU0lURV9VUkwgfHwgJ2h0dHBzOi8vc2hhbGVhbi5jby56YSc7XHJcbiAgICBjb25zdCByZWZlcnJhbExpbmsgPSBgJHtiYXNlVXJsfS9ib29raW5nL2RldGFpbHM/cmVmPSR7cmVmZXJyYWxDb2RlfWA7XHJcblxyXG4gICAgLy8gVE9ETzogSW1wbGVtZW50IGFjdHVhbCBlbWFpbCBzZW5kaW5nIHVzaW5nIHlvdXIgZW1haWwgc2VydmljZSAoUmVzZW5kLCBTZW5kR3JpZCwgZXRjLilcclxuICAgIC8vIEZvciBub3csIHdlJ2xsIGp1c3QgbG9nIHRoZSBlbWFpbHMgdGhhdCB3b3VsZCBiZSBzZW50XHJcbiAgICBjb25zb2xlLmxvZygnUmVmZXJyYWwgaW52aXRlcyB0byBzZW5kOicsIHtcclxuICAgICAgZnJvbTogZW1haWwsXHJcbiAgICAgIHRvOiB2YWxpZEVtYWlscyxcclxuICAgICAgcmVmZXJyYWxDb2RlLFxyXG4gICAgICByZWZlcnJhbExpbmssXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBJbiBhIHJlYWwgaW1wbGVtZW50YXRpb24sIHlvdSB3b3VsZCBzZW5kIGVtYWlscyBoZXJlXHJcbiAgICAvLyBFeGFtcGxlIHdpdGggUmVzZW5kOlxyXG4gICAgLy8gYXdhaXQgcmVzZW5kLmVtYWlscy5zZW5kKHtcclxuICAgIC8vICAgZnJvbTogJ1NoYWxlYW4gPG5vcmVwbHlAc2hhbGVhbi5jby56YT4nLFxyXG4gICAgLy8gICB0bzogdmFsaWRFbWFpbHMsXHJcbiAgICAvLyAgIHN1YmplY3Q6ICdZb3VcXCd2ZSBiZWVuIGludml0ZWQgdG8gdHJ5IFNoYWxlYW4gQ2xlYW5pbmcgU2VydmljZXMhJyxcclxuICAgIC8vICAgaHRtbDogYDxwPllvdXIgZnJpZW5kIGhhcyBpbnZpdGVkIHlvdSB0byB0cnkgU2hhbGVhbi4gVXNlIGNvZGUgJHtyZWZlcnJhbENvZGV9IHRvIGdldCBSMTUwIG9mZiB5b3VyIGZpcnN0IGJvb2tpbmchPC9wPjxwPjxhIGhyZWY9XCIke3JlZmVycmFsTGlua31cIj5Cb29rIE5vdzwvYT48L3A+YCxcclxuICAgIC8vIH0pO1xyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHNlbnQ6IHZhbGlkRW1haWxzLmxlbmd0aCB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBzZW5kUmVmZXJyYWxJbnZpdGVzOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIHNlbmQgaW52aXRlcycsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFJlZmVycmFsU3RhdHMoXHJcbiAgZW1haWw6IHN0cmluZ1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIHN0YXRzPzoge1xyXG4gICAgdG90YWxSZWZlcnJhbHM6IG51bWJlcjtcclxuICAgIGNvbXBsZXRlZFJlZmVycmFsczogbnVtYmVyO1xyXG4gICAgcGVuZGluZ1Jld2FyZHM6IG51bWJlcjtcclxuICAgIHRvdGFsUmV3YXJkczogbnVtYmVyO1xyXG4gIH07XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICBjb25zdCB7IGRhdGE6IHJlZmVycmFscywgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdyZWZlcnJhbHMnKVxyXG4gICAgICAuc2VsZWN0KCdzdGF0dXMsIHJlZmVycmVyX3Jld2FyZF9hbW91bnQsIHJlZmVycmVyX3Jld2FyZF9zdGF0dXMnKVxyXG4gICAgICAuZXEoJ3JlZmVycmVyX2VtYWlsJywgZW1haWwpO1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyByZWZlcnJhbCBzdGF0czonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHN0YXRzID0ge1xyXG4gICAgICB0b3RhbFJlZmVycmFsczogcmVmZXJyYWxzPy5sZW5ndGggfHwgMCxcclxuICAgICAgY29tcGxldGVkUmVmZXJyYWxzOlxyXG4gICAgICAgIHJlZmVycmFscz8uZmlsdGVyKChyKSA9PiByLnN0YXR1cyA9PT0gJ2NvbXBsZXRlZCcpLmxlbmd0aCB8fCAwLFxyXG4gICAgICBwZW5kaW5nUmV3YXJkczpcclxuICAgICAgICByZWZlcnJhbHM/LmZpbHRlcigocikgPT4gci5yZWZlcnJlcl9yZXdhcmRfc3RhdHVzID09PSAncGVuZGluZycpLmxlbmd0aCB8fCAwLFxyXG4gICAgICB0b3RhbFJld2FyZHM6XHJcbiAgICAgICAgcmVmZXJyYWxzXHJcbiAgICAgICAgICA/LmZpbHRlcigocikgPT4gci5yZWZlcnJlcl9yZXdhcmRfc3RhdHVzID09PSAnY3JlZGl0ZWQnKVxyXG4gICAgICAgICAgLnJlZHVjZSgoc3VtLCByKSA9PiBzdW0gKyAoci5yZWZlcnJlcl9yZXdhcmRfYW1vdW50IHx8IDApLCAwKSB8fCAwLFxyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBzdGF0cyB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBnZXRSZWZlcnJhbFN0YXRzOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGZldGNoIHJlZmVycmFsIHN0YXRzJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogSW5pdGlhbGl6ZSBhIGNyZWRpdCBwdXJjaGFzZSB3aXRoIFBheXN0YWNrXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaW5pdGlhbGl6ZUNyZWRpdFB1cmNoYXNlKFxyXG4gIGVtYWlsOiBzdHJpbmcsXHJcbiAgYW1vdW50OiBudW1iZXIsXHJcbiAgcGF5bWVudE1ldGhvZDogJ2NyZWRpdF9jYXJkJyB8ICdlZnQnXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgYXV0aG9yaXphdGlvblVybD86IHN0cmluZztcclxuICByZWZlcmVuY2U/OiBzdHJpbmc7XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgaWYgKGFtb3VudCA8IDIwIHx8IGFtb3VudCA+IDUwMDApIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogJ0Ftb3VudCBtdXN0IGJlIGJldHdlZW4gUjIwIGFuZCBSNTAwMCcsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gR2VuZXJhdGUgYSB1bmlxdWUgcmVmZXJlbmNlIGZvciB0aGlzIGNyZWRpdCBwdXJjaGFzZVxyXG4gICAgY29uc3QgcmVmZXJlbmNlID0gYENSRURJVF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIsIDkpfWA7XHJcblxyXG4gICAgLy8gQ3JlYXRlIGEgcGVuZGluZyBjcmVkaXQgdHJhbnNhY3Rpb25cclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcbiAgICBcclxuICAgIC8vIEdldCBvciBjcmVhdGUgcHJvZmlsZVxyXG4gICAgbGV0IHsgZGF0YTogcHJvZmlsZSB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcclxuICAgICAgLnNlbGVjdCgnaWQsIGNyZWRpdF9iYWxhbmNlJylcclxuICAgICAgLmVxKCdlbWFpbCcsIGVtYWlsKVxyXG4gICAgICAubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoIXByb2ZpbGUpIHtcclxuICAgICAgLy8gQ3JlYXRlIGEgYmFzaWMgcHJvZmlsZSBpZiBpdCBkb2Vzbid0IGV4aXN0XHJcbiAgICAgIGNvbnN0IHsgZGF0YTogbmV3UHJvZmlsZSwgZXJyb3I6IGNyZWF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgICAgLmluc2VydCh7XHJcbiAgICAgICAgICBlbWFpbCxcclxuICAgICAgICAgIGNyZWRpdF9iYWxhbmNlOiAwLFxyXG4gICAgICAgICAgZmlyc3RfbmFtZTogJycsXHJcbiAgICAgICAgICBsYXN0X25hbWU6ICcnLFxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnNlbGVjdCgnaWQsIGNyZWRpdF9iYWxhbmNlJylcclxuICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICBpZiAoY3JlYXRlRXJyb3IgfHwgIW5ld1Byb2ZpbGUpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICBlcnJvcjogJ0ZhaWxlZCB0byBjcmVhdGUgcHJvZmlsZScsXHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG4gICAgICBwcm9maWxlID0gbmV3UHJvZmlsZTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDcmVhdGUgcGVuZGluZyBjcmVkaXQgdHJhbnNhY3Rpb25cclxuICAgIGNvbnN0IHsgZXJyb3I6IHRyYW5zYWN0aW9uRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdjcmVkaXRfdHJhbnNhY3Rpb25zJylcclxuICAgICAgLmluc2VydCh7XHJcbiAgICAgICAgcHJvZmlsZV9pZDogcHJvZmlsZS5pZCxcclxuICAgICAgICBlbWFpbCxcclxuICAgICAgICB0cmFuc2FjdGlvbl90eXBlOiAncHVyY2hhc2UnLFxyXG4gICAgICAgIGFtb3VudCxcclxuICAgICAgICBiYWxhbmNlX2JlZm9yZTogcHJvZmlsZS5jcmVkaXRfYmFsYW5jZSB8fCAwLFxyXG4gICAgICAgIGJhbGFuY2VfYWZ0ZXI6IHByb2ZpbGUuY3JlZGl0X2JhbGFuY2UgfHwgMCwgLy8gV29uJ3QgdXBkYXRlIHVudGlsIHBheW1lbnQgc3VjY2VlZHNcclxuICAgICAgICBwYXltZW50X21ldGhvZDogcGF5bWVudE1ldGhvZCxcclxuICAgICAgICBwYXlzdGFja19yZWZlcmVuY2U6IHJlZmVyZW5jZSxcclxuICAgICAgICBwYXltZW50X3N0YXR1czogJ3BlbmRpbmcnLFxyXG4gICAgICAgIGRlc2NyaXB0aW9uOiBgUHVyY2hhc2Ugb2YgUiR7YW1vdW50fSBTaGFsZWFuQ3JlZGAsXHJcbiAgICAgIH0pO1xyXG5cclxuICAgIGlmICh0cmFuc2FjdGlvbkVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIGNyZWRpdCB0cmFuc2FjdGlvbjonLCB0cmFuc2FjdGlvbkVycm9yKTtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogJ0ZhaWxlZCB0byBjcmVhdGUgdHJhbnNhY3Rpb24gcmVjb3JkJyxcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBJbml0aWFsaXplIFBheXN0YWNrIHBheW1lbnRcclxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goJy9hcGkvcGF5c3RhY2svaW5pdGlhbGl6ZScsIHtcclxuICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxyXG4gICAgICB9LFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgZW1haWwsXHJcbiAgICAgICAgYW1vdW50LFxyXG4gICAgICAgIHJlZmVyZW5jZSxcclxuICAgICAgICBtZXRhZGF0YToge1xyXG4gICAgICAgICAgdHJhbnNhY3Rpb25fdHlwZTogJ2NyZWRpdF9wdXJjaGFzZScsXHJcbiAgICAgICAgICBwYXltZW50X21ldGhvZDogcGF5bWVudE1ldGhvZCxcclxuICAgICAgICB9LFxyXG4gICAgICB9KSxcclxuICAgIH0pO1xyXG5cclxuICAgIGlmICghcmVzcG9uc2Uub2spIHtcclxuICAgICAgY29uc3QgZXJyb3IgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6IGVycm9yLmVycm9yIHx8ICdGYWlsZWQgdG8gaW5pdGlhbGl6ZSBwYXltZW50JyxcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBwYXltZW50RGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcclxuXHJcbiAgICBpZiAoIXBheW1lbnREYXRhLnN0YXR1cykge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIGVycm9yOiBwYXltZW50RGF0YS5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gaW5pdGlhbGl6ZSBwYXltZW50JyxcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICBhdXRob3JpemF0aW9uVXJsOiBwYXltZW50RGF0YS5kYXRhLmF1dGhvcml6YXRpb25fdXJsLFxyXG4gICAgICByZWZlcmVuY2U6IHBheW1lbnREYXRhLmRhdGEucmVmZXJlbmNlLFxyXG4gICAgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW5pdGlhbGl6aW5nIGNyZWRpdCBwdXJjaGFzZTonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBpbml0aWFsaXplIHBheW1lbnQnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgVm91Y2hlclJlZGVtcHRpb24ge1xyXG4gIGlkOiBzdHJpbmc7XHJcbiAgdm91Y2hlcl9jb2RlOiBzdHJpbmc7XHJcbiAgYW1vdW50OiBudW1iZXI7XHJcbiAgcmVkZWVtZWRfYXQ6IHN0cmluZztcclxuICBib29raW5nX2lkPzogc3RyaW5nO1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVkZWVtVm91Y2hlcihcclxuICBjb2RlOiBzdHJpbmcsXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBwaG9uZT86IHN0cmluZ1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGFtb3VudD86IG51bWJlcjtcclxuICBuZXdCYWxhbmNlPzogbnVtYmVyO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgLy8gQ2FsbCB0aGUgZGF0YWJhc2UgZnVuY3Rpb24gdG8gcmVkZWVtIHRoZSB2b3VjaGVyXHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5ycGMoJ3JlZGVlbV92b3VjaGVyJywge1xyXG4gICAgICBwX2NvZGU6IGNvZGUudHJpbSgpLnRvVXBwZXJDYXNlKCksXHJcbiAgICAgIHBfZW1haWw6IGVtYWlsLnRyaW0oKSxcclxuICAgICAgcF9waG9uZTogcGhvbmU/LnRyaW0oKSB8fCBudWxsLFxyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHJlZGVlbWluZyB2b3VjaGVyOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZSB8fCAnRmFpbGVkIHRvIHJlZGVlbSB2b3VjaGVyJyxcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBQYXJzZSB0aGUgcmVzdWx0IGZyb20gdGhlIGZ1bmN0aW9uIChoYW5kbGUgYm90aCBvYmplY3QgYW5kIHN0cmluZyBKU09OQilcclxuICAgIGxldCByZXN1bHQgPSBkYXRhO1xyXG4gICAgaWYgKHR5cGVvZiBkYXRhID09PSAnc3RyaW5nJykge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIHJlc3VsdCA9IEpTT04ucGFyc2UoZGF0YSk7XHJcbiAgICAgIH0gY2F0Y2ggKHBhcnNlRXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBwYXJzaW5nIHZvdWNoZXIgcmVkZW1wdGlvbiByZXN1bHQ6JywgcGFyc2VFcnJvcik7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgZXJyb3I6ICdJbnZhbGlkIHJlc3BvbnNlIGZyb20gc2VydmVyJyxcclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHJlc3VsdCAmJiB0eXBlb2YgcmVzdWx0ID09PSAnb2JqZWN0JyAmJiAnc3VjY2VzcycgaW4gcmVzdWx0KSB7XHJcbiAgICAgIGlmIChyZXN1bHQuc3VjY2VzcyA9PT0gZmFsc2UpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICBlcnJvcjogcmVzdWx0LmVycm9yIHx8ICdGYWlsZWQgdG8gcmVkZWVtIHZvdWNoZXInLFxyXG4gICAgICAgIH07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICBhbW91bnQ6IHJlc3VsdC5hbW91bnQsXHJcbiAgICAgICAgbmV3QmFsYW5jZTogcmVzdWx0Lm5ld19iYWxhbmNlLFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogJ1VuZXhwZWN0ZWQgcmVzcG9uc2UgZnJvbSBzZXJ2ZXInLFxyXG4gICAgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gcmVkZWVtVm91Y2hlcjonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byByZWRlZW0gdm91Y2hlcicsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFZvdWNoZXJSZWRlbXB0aW9ucyhcclxuICBlbWFpbDogc3RyaW5nLFxyXG4gIHBob25lPzogc3RyaW5nXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgcmVkZW1wdGlvbnM/OiBWb3VjaGVyUmVkZW1wdGlvbltdO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgbGV0IHF1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ3ZvdWNoZXJfcmVkZW1wdGlvbnMnKVxyXG4gICAgICAuc2VsZWN0KCdpZCwgdm91Y2hlcl9jb2RlLCBhbW91bnQsIHJlZGVlbWVkX2F0LCBib29raW5nX2lkJylcclxuICAgICAgLm9yZGVyKCdyZWRlZW1lZF9hdCcsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KTtcclxuXHJcbiAgICAvLyBCdWlsZCBxdWVyeSBmb3IgZW1haWwvcGhvbmUgbG9va3VwXHJcbiAgICAvLyBQcmlvcml0aXplIGVtYWlsIGFzIGl0J3MgdGhlIHByaW1hcnkgaWRlbnRpZmllciB0byBwcmV2ZW50IGNyb3NzLWFjY291bnQgdmlzaWJpbGl0eVxyXG4gICAgaWYgKGVtYWlsKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ2VtYWlsJywgZW1haWwpO1xyXG4gICAgICAvLyBJZiBwaG9uZSBpcyBhbHNvIHByb3ZpZGVkLCB3ZSBjYW4gb3B0aW9uYWxseSBmaWx0ZXIgYnkgYm90aCBmb3IgZXh0cmEgc2VjdXJpdHlcclxuICAgICAgLy8gYnV0IGVtYWlsIGFsb25lIHNob3VsZCBiZSBzdWZmaWNpZW50IHNpbmNlIGl0J3MgdW5pcXVlXHJcbiAgICB9IGVsc2UgaWYgKHBob25lKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ3Bob25lJywgcGhvbmUpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRW1haWwgb3IgcGhvbmUgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgcXVlcnk7XHJcblxyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIHZvdWNoZXIgcmVkZW1wdGlvbnM6JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBUcmFuc2Zvcm0gdGhlIGRhdGEgdG8gbWF0Y2ggdGhlIGludGVyZmFjZVxyXG4gICAgY29uc3QgcmVkZW1wdGlvbnM6IFZvdWNoZXJSZWRlbXB0aW9uW10gPSAoZGF0YSB8fCBbXSkubWFwKChyZWRlbXB0aW9uKSA9PiAoe1xyXG4gICAgICBpZDogcmVkZW1wdGlvbi5pZCxcclxuICAgICAgdm91Y2hlcl9jb2RlOiByZWRlbXB0aW9uLnZvdWNoZXJfY29kZSxcclxuICAgICAgYW1vdW50OiByZWRlbXB0aW9uLmFtb3VudCxcclxuICAgICAgcmVkZWVtZWRfYXQ6IHJlZGVtcHRpb24ucmVkZWVtZWRfYXQsXHJcbiAgICAgIGJvb2tpbmdfaWQ6IHJlZGVtcHRpb24uYm9va2luZ19pZCB8fCB1bmRlZmluZWQsXHJcbiAgICB9KSk7XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcmVkZW1wdGlvbnMgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gZ2V0Vm91Y2hlclJlZGVtcHRpb25zOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGZldGNoIHZvdWNoZXIgcmVkZW1wdGlvbnMnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiMlJBdXJCc0IsNkxBQUEifQ==
}),
"[project]/app/dashboard/data:96f648 [app-ssr] (ecmascript) <text/javascript>", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "setDefaultLocation",
    ()=>$$RSC_SERVER_ACTION_12
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-ssr] (ecmascript)");
/* __next_internal_action_entry_do_not_use__ [{"70bb0744d56df2ae59ba51d8dd60a8f120df04299b":"setDefaultLocation"},"app/dashboard/actions.ts",""] */ "use turbopack no side effects";
;
const $$RSC_SERVER_ACTION_12 = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["createServerReference"])("70bb0744d56df2ae59ba51d8dd60a8f120df04299b", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["findSourceMapURL"], "setDefaultLocation");
;
 //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vYWN0aW9ucy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHNlcnZlcic7XHJcblxyXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAL2xpYi9zdXBhYmFzZS9zZXJ2ZXInO1xyXG5pbXBvcnQgeyBCb29raW5nIH0gZnJvbSAnQC90eXBlcy9ib29raW5nJztcclxuaW1wb3J0IHsgUHJvZmlsZSwgUHJvZmlsZVVwZGF0ZUlucHV0IH0gZnJvbSAnQC90eXBlcy9wcm9maWxlJztcclxuaW1wb3J0IHsgTG9jYXRpb24sIExvY2F0aW9uQ3JlYXRlSW5wdXQsIExvY2F0aW9uVXBkYXRlSW5wdXQgfSBmcm9tICdAL3R5cGVzL2xvY2F0aW9uJztcclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBdXRoZW50aWNhdGVkVXNlcigpOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGVtYWlsPzogc3RyaW5nO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcbiAgICBjb25zdCB7IGRhdGE6IHsgdXNlciB9LCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XHJcblxyXG4gICAgaWYgKGVycm9yIHx8ICF1c2VyKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ05vdCBhdXRoZW50aWNhdGVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGVtYWlsOiB1c2VyLmVtYWlsIHx8IHVuZGVmaW5lZCB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBnZXRBdXRoZW50aWNhdGVkVXNlcjonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBnZXQgdXNlcicsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEN1c3RvbWVyQm9va2luZ3MoXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBwaG9uZT86IHN0cmluZyxcclxuICBmaWx0ZXI/OiAnYWxsJyB8ICd1cGNvbWluZycgfCAnY29tcGxldGVkJyB8ICdjYW5jZWxsZWQnXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgYm9va2luZ3M/OiBCb29raW5nW107XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICBsZXQgcXVlcnkgPSBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnYm9va2luZ3MnKVxyXG4gICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgLm9yZGVyKCdzZXJ2aWNlX2RhdGUnLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcclxuICAgICAgLm9yZGVyKCdjcmVhdGVkX2F0JywgeyBhc2NlbmRpbmc6IGZhbHNlIH0pO1xyXG5cclxuICAgIC8vIEJ1aWxkIHF1ZXJ5IGZvciBlbWFpbC9waG9uZSBsb29rdXBcclxuICAgIGlmIChlbWFpbCAmJiBwaG9uZSkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5Lm9yKGBjdXN0b21lcl9lbWFpbC5lcS4ke2VtYWlsfSxjdXN0b21lcl9waG9uZS5lcS4ke3Bob25lfWApO1xyXG4gICAgfSBlbHNlIGlmIChlbWFpbCkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdjdXN0b21lcl9lbWFpbCcsIGVtYWlsKTtcclxuICAgIH0gZWxzZSBpZiAocGhvbmUpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnY3VzdG9tZXJfcGhvbmUnLCBwaG9uZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdFbWFpbCBvciBwaG9uZSBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBBcHBseSBzdGF0dXMgZmlsdGVyXHJcbiAgICBpZiAoZmlsdGVyICYmIGZpbHRlciAhPT0gJ2FsbCcpIHtcclxuICAgICAgaWYgKGZpbHRlciA9PT0gJ3VwY29taW5nJykge1xyXG4gICAgICAgIHF1ZXJ5ID0gcXVlcnkuaW4oJ3N0YXR1cycsIFsncGVuZGluZycsICdjb25maXJtZWQnXSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnc3RhdHVzJywgZmlsdGVyKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHF1ZXJ5O1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBib29raW5nczonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGJvb2tpbmdzOiBkYXRhIHx8IFtdIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGdldEN1c3RvbWVyQm9va2luZ3M6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gZmV0Y2ggYm9va2luZ3MnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDdXN0b21lckJvb2tpbmdTdGF0cyhcclxuICBlbWFpbDogc3RyaW5nLFxyXG4gIHBob25lPzogc3RyaW5nXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgc3RhdHM/OiB7XHJcbiAgICB0b3RhbDogbnVtYmVyO1xyXG4gICAgdXBjb21pbmc6IG51bWJlcjtcclxuICAgIGNvbXBsZXRlZDogbnVtYmVyO1xyXG4gICAgY2FuY2VsbGVkOiBudW1iZXI7XHJcbiAgICB0b3RhbFNwZW50OiBudW1iZXI7XHJcbiAgfTtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIGxldCBxdWVyeSA9IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdib29raW5ncycpXHJcbiAgICAgIC5zZWxlY3QoJ3N0YXR1cywgdG90YWxfYW1vdW50LCBwYXltZW50X3N0YXR1cycpO1xyXG5cclxuICAgIC8vIEJ1aWxkIHF1ZXJ5IGZvciBlbWFpbC9waG9uZSBsb29rdXBcclxuICAgIGlmIChlbWFpbCAmJiBwaG9uZSkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5Lm9yKGBjdXN0b21lcl9lbWFpbC5lcS4ke2VtYWlsfSxjdXN0b21lcl9waG9uZS5lcS4ke3Bob25lfWApO1xyXG4gICAgfSBlbHNlIGlmIChlbWFpbCkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdjdXN0b21lcl9lbWFpbCcsIGVtYWlsKTtcclxuICAgIH0gZWxzZSBpZiAocGhvbmUpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnY3VzdG9tZXJfcGhvbmUnLCBwaG9uZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdFbWFpbCBvciBwaG9uZSBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBxdWVyeTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgc3RhdHMgPSB7XHJcbiAgICAgIHRvdGFsOiBkYXRhPy5sZW5ndGggfHwgMCxcclxuICAgICAgdXBjb21pbmc6IGRhdGE/LmZpbHRlcigoYikgPT4gYi5zdGF0dXMgPT09ICdwZW5kaW5nJyB8fCBiLnN0YXR1cyA9PT0gJ2NvbmZpcm1lZCcpLmxlbmd0aCB8fCAwLFxyXG4gICAgICBjb21wbGV0ZWQ6IGRhdGE/LmZpbHRlcigoYikgPT4gYi5zdGF0dXMgPT09ICdjb21wbGV0ZWQnKS5sZW5ndGggfHwgMCxcclxuICAgICAgY2FuY2VsbGVkOiBkYXRhPy5maWx0ZXIoKGIpID0+IGIuc3RhdHVzID09PSAnY2FuY2VsbGVkJykubGVuZ3RoIHx8IDAsXHJcbiAgICAgIHRvdGFsU3BlbnQ6IGRhdGFcclxuICAgICAgICA/LmZpbHRlcigoYikgPT4gYi5wYXltZW50X3N0YXR1cyA9PT0gJ3BhaWQnKVxyXG4gICAgICAgIC5yZWR1Y2UoKHN1bSwgYikgPT4gc3VtICsgKGIudG90YWxfYW1vdW50IHx8IDApLCAwKSB8fCAwLFxyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBzdGF0cyB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBmZXRjaCBzdGF0cycsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEJvb2tpbmdCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGJvb2tpbmc/OiBCb29raW5nO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2Jvb2tpbmdzJylcclxuICAgICAgLnNlbGVjdCgnKicpXHJcbiAgICAgIC5lcSgnaWQnLCBpZClcclxuICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBib29raW5nOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnQm9va2luZyBub3QgZm91bmQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYm9va2luZzogZGF0YSB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdVbmV4cGVjdGVkIGVycm9yIGZldGNoaW5nIGJvb2tpbmc6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q3VzdG9tZXJQcm9maWxlKFxyXG4gIGVtYWlsOiBzdHJpbmcsXHJcbiAgcGhvbmU/OiBzdHJpbmdcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBwcm9maWxlPzogUHJvZmlsZTtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIEZpcnN0LCB0cnkgdG8gZ2V0IHByb2ZpbGUgZnJvbSBwcm9maWxlcyB0YWJsZVxyXG4gICAgbGV0IHF1ZXJ5ID0gc3VwYWJhc2UuZnJvbSgncHJvZmlsZXMnKS5zZWxlY3QoJyonKTtcclxuXHJcbiAgICBpZiAoZW1haWwpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnZW1haWwnLCBlbWFpbCk7XHJcbiAgICB9IGVsc2UgaWYgKHBob25lKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ3Bob25lJywgcGhvbmUpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRW1haWwgb3IgcGhvbmUgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBkYXRhOiBwcm9maWxlRGF0YSwgZXJyb3I6IHByb2ZpbGVFcnJvciB9ID0gYXdhaXQgcXVlcnkubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgICAvLyBJZiBwcm9maWxlIGV4aXN0cywgcmV0dXJuIGl0XHJcbiAgICBpZiAocHJvZmlsZURhdGEgJiYgIXByb2ZpbGVFcnJvcikge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBwcm9maWxlOiBwcm9maWxlRGF0YSB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIElmIG5vIHByb2ZpbGUgZXhpc3RzLCBkZXJpdmUgZnJvbSBtb3N0IHJlY2VudCBib29raW5nXHJcbiAgICBsZXQgYm9va2luZ1F1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2Jvb2tpbmdzJylcclxuICAgICAgLnNlbGVjdCgnY3VzdG9tZXJfZmlyc3RfbmFtZSwgY3VzdG9tZXJfbGFzdF9uYW1lLCBjdXN0b21lcl9lbWFpbCwgY3VzdG9tZXJfcGhvbmUnKVxyXG4gICAgICAub3JkZXIoJ2NyZWF0ZWRfYXQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcclxuICAgICAgLmxpbWl0KDEpO1xyXG5cclxuICAgIGlmIChlbWFpbCAmJiBwaG9uZSkge1xyXG4gICAgICBib29raW5nUXVlcnkgPSBib29raW5nUXVlcnkub3IoYGN1c3RvbWVyX2VtYWlsLmVxLiR7ZW1haWx9LGN1c3RvbWVyX3Bob25lLmVxLiR7cGhvbmV9YCk7XHJcbiAgICB9IGVsc2UgaWYgKGVtYWlsKSB7XHJcbiAgICAgIGJvb2tpbmdRdWVyeSA9IGJvb2tpbmdRdWVyeS5lcSgnY3VzdG9tZXJfZW1haWwnLCBlbWFpbCk7XHJcbiAgICB9IGVsc2UgaWYgKHBob25lKSB7XHJcbiAgICAgIGJvb2tpbmdRdWVyeSA9IGJvb2tpbmdRdWVyeS5lcSgnY3VzdG9tZXJfcGhvbmUnLCBwaG9uZSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBkYXRhOiBib29raW5nRGF0YSwgZXJyb3I6IGJvb2tpbmdFcnJvciB9ID0gYXdhaXQgYm9va2luZ1F1ZXJ5Lm1heWJlU2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKGJvb2tpbmdFcnJvciB8fCAhYm9va2luZ0RhdGEpIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogJ05vIHByb2ZpbGUgb3IgYm9va2luZyBmb3VuZC4gUGxlYXNlIGNyZWF0ZSBhIGJvb2tpbmcgZmlyc3QuJyxcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDcmVhdGUgYSBwcm9maWxlIG9iamVjdCBmcm9tIGJvb2tpbmcgZGF0YVxyXG4gICAgY29uc3QgZGVyaXZlZFByb2ZpbGU6IFByb2ZpbGUgPSB7XHJcbiAgICAgIGlkOiAnJywgLy8gV2lsbCBiZSBnZW5lcmF0ZWQgd2hlbiBzYXZlZFxyXG4gICAgICBlbWFpbDogYm9va2luZ0RhdGEuY3VzdG9tZXJfZW1haWwsXHJcbiAgICAgIHBob25lOiBib29raW5nRGF0YS5jdXN0b21lcl9waG9uZSB8fCBudWxsLFxyXG4gICAgICBmaXJzdF9uYW1lOiBib29raW5nRGF0YS5jdXN0b21lcl9maXJzdF9uYW1lLFxyXG4gICAgICBsYXN0X25hbWU6IGJvb2tpbmdEYXRhLmN1c3RvbWVyX2xhc3RfbmFtZSxcclxuICAgICAgY3JlYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHByb2ZpbGU6IGRlcml2ZWRQcm9maWxlIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGdldEN1c3RvbWVyUHJvZmlsZTonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBmZXRjaCBwcm9maWxlJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBsb2FkUHJvZmlsZVBpY3R1cmUoXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBmaWxlOiBGaWxlXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgdXJsPzogc3RyaW5nO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgLy8gVmFsaWRhdGUgZmlsZVxyXG4gICAgaWYgKCFmaWxlKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ05vIGZpbGUgcHJvdmlkZWQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVmFsaWRhdGUgZmlsZSB0eXBlXHJcbiAgICBjb25zdCB2YWxpZEltYWdlVHlwZXMgPSBbJ2ltYWdlL2pwZWcnLCAnaW1hZ2UvanBnJywgJ2ltYWdlL3BuZycsICdpbWFnZS93ZWJwJ107XHJcbiAgICBpZiAoIXZhbGlkSW1hZ2VUeXBlcy5pbmNsdWRlcyhmaWxlLnR5cGUpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ludmFsaWQgZmlsZSB0eXBlLiBQbGVhc2UgdXBsb2FkIGEgSlBFRywgUE5HLCBvciBXZWJQIGltYWdlLicgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBWYWxpZGF0ZSBmaWxlIHNpemUgKG1heCA1TUIpXHJcbiAgICBjb25zdCBtYXhTaXplID0gNSAqIDEwMjQgKiAxMDI0OyAvLyA1TUIgaW4gYnl0ZXNcclxuICAgIGlmIChmaWxlLnNpemUgPiBtYXhTaXplKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ZpbGUgc2l6ZSB0b28gbGFyZ2UuIFBsZWFzZSB1cGxvYWQgYW4gaW1hZ2Ugc21hbGxlciB0aGFuIDVNQi4nIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gR2VuZXJhdGUgdW5pcXVlIGZpbGVuYW1lIHVzaW5nIGVtYWlsIGFuZCB0aW1lc3RhbXBcclxuICAgIGNvbnN0IGZpbGVFeHQgPSBmaWxlLm5hbWUuc3BsaXQoJy4nKS5wb3AoKTtcclxuICAgIGNvbnN0IGZpbGVOYW1lID0gYCR7ZW1haWwucmVwbGFjZSgvW15hLXpBLVowLTldL2csICdfJyl9XyR7RGF0ZS5ub3coKX0uJHtmaWxlRXh0fWA7XHJcbiAgICBjb25zdCBmaWxlUGF0aCA9IGBhdmF0YXJzLyR7ZmlsZU5hbWV9YDtcclxuXHJcbiAgICAvLyBDb252ZXJ0IEZpbGUgdG8gQXJyYXlCdWZmZXIgZm9yIHVwbG9hZFxyXG4gICAgY29uc3QgYXJyYXlCdWZmZXIgPSBhd2FpdCBmaWxlLmFycmF5QnVmZmVyKCk7XHJcbiAgICBjb25zdCBidWZmZXIgPSBCdWZmZXIuZnJvbShhcnJheUJ1ZmZlcik7XHJcblxyXG4gICAgLy8gVXBsb2FkIHRvIFN1cGFiYXNlIFN0b3JhZ2VcclxuICAgIGNvbnN0IHsgZGF0YTogdXBsb2FkRGF0YSwgZXJyb3I6IHVwbG9hZEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5zdG9yYWdlXHJcbiAgICAgIC5mcm9tKCdwcm9maWxlLXBpY3R1cmVzJylcclxuICAgICAgLnVwbG9hZChmaWxlUGF0aCwgYnVmZmVyLCB7XHJcbiAgICAgICAgY29udGVudFR5cGU6IGZpbGUudHlwZSxcclxuICAgICAgICB1cHNlcnQ6IGZhbHNlLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICBpZiAodXBsb2FkRXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBsb2FkaW5nIGZpbGU6JywgdXBsb2FkRXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHVwbG9hZEVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBHZXQgcHVibGljIFVSTFxyXG4gICAgY29uc3QgeyBkYXRhOiB1cmxEYXRhIH0gPSBzdXBhYmFzZS5zdG9yYWdlXHJcbiAgICAgIC5mcm9tKCdwcm9maWxlLXBpY3R1cmVzJylcclxuICAgICAgLmdldFB1YmxpY1VybChmaWxlUGF0aCk7XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdXJsOiB1cmxEYXRhLnB1YmxpY1VybCB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiB1cGxvYWRQcm9maWxlUGljdHVyZTonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byB1cGxvYWQgcHJvZmlsZSBwaWN0dXJlJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZGVsZXRlUHJvZmlsZVBpY3R1cmUoZW1haWw6IHN0cmluZywgYXZhdGFyVXJsOiBzdHJpbmcpOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgLy8gRXh0cmFjdCBmaWxlIHBhdGggZnJvbSBVUkxcclxuICAgIGNvbnN0IHVybFBhcnRzID0gYXZhdGFyVXJsLnNwbGl0KCcvcHJvZmlsZS1waWN0dXJlcy8nKTtcclxuICAgIGlmICh1cmxQYXJ0cy5sZW5ndGggPCAyKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ludmFsaWQgYXZhdGFyIFVSTCcgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBmaWxlUGF0aCA9IGBhdmF0YXJzLyR7dXJsUGFydHNbMV0uc3BsaXQoJy8nKS5wb3AoKX1gO1xyXG5cclxuICAgIC8vIERlbGV0ZSBmcm9tIHN0b3JhZ2VcclxuICAgIGNvbnN0IHsgZXJyb3I6IGRlbGV0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5zdG9yYWdlXHJcbiAgICAgIC5mcm9tKCdwcm9maWxlLXBpY3R1cmVzJylcclxuICAgICAgLnJlbW92ZShbZmlsZVBhdGhdKTtcclxuXHJcbiAgICBpZiAoZGVsZXRlRXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZGVsZXRpbmcgZmlsZTonLCBkZWxldGVFcnJvcik7XHJcbiAgICAgIC8vIERvbid0IGZhaWwgaWYgZmlsZSBkb2Vzbid0IGV4aXN0XHJcbiAgICAgIGlmIChkZWxldGVFcnJvci5tZXNzYWdlLmluY2x1ZGVzKCdub3QgZm91bmQnKSkge1xyXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGRlbGV0ZUVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGRlbGV0ZVByb2ZpbGVQaWN0dXJlOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGRlbGV0ZSBwcm9maWxlIHBpY3R1cmUnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGRhdGVDdXN0b21lclByb2ZpbGUoXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBkYXRhOiBQcm9maWxlVXBkYXRlSW5wdXRcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBwcm9maWxlPzogUHJvZmlsZTtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIFZhbGlkYXRlIGlucHV0XHJcbiAgICBpZiAoIWRhdGEuZmlyc3RfbmFtZT8udHJpbSgpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ZpcnN0IG5hbWUgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcbiAgICBpZiAoIWRhdGEubGFzdF9uYW1lPy50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTGFzdCBuYW1lIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG4gICAgaWYgKCFkYXRhLmVtYWlsPy50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRW1haWwgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcbiAgICBpZiAoIS9eW15cXHNAXStAW15cXHNAXStcXC5bXlxcc0BdKyQvLnRlc3QoZGF0YS5lbWFpbCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnSW52YWxpZCBlbWFpbCBmb3JtYXQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ2hlY2sgaWYgcHJvZmlsZSBleGlzdHNcclxuICAgIGNvbnN0IHsgZGF0YTogZXhpc3RpbmdQcm9maWxlIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgLmVxKCdlbWFpbCcsIGVtYWlsKVxyXG4gICAgICAubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgICAvLyBJZiBhdmF0YXJfdXJsIGlzIGJlaW5nIHJlbW92ZWQsIGRlbGV0ZSB0aGUgb2xkIGZpbGVcclxuICAgIGlmIChleGlzdGluZ1Byb2ZpbGU/LmF2YXRhcl91cmwgJiYgZGF0YS5hdmF0YXJfdXJsID09PSBudWxsKSB7XHJcbiAgICAgIGF3YWl0IGRlbGV0ZVByb2ZpbGVQaWN0dXJlKGVtYWlsLCBleGlzdGluZ1Byb2ZpbGUuYXZhdGFyX3VybCk7XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IHJlc3VsdDtcclxuICAgIGlmIChleGlzdGluZ1Byb2ZpbGUpIHtcclxuICAgICAgLy8gVXBkYXRlIGV4aXN0aW5nIHByb2ZpbGVcclxuICAgICAgLy8gSWYgZW1haWwgY2hhbmdlZCwgd2UgbmVlZCB0byBoYW5kbGUgaXQgY2FyZWZ1bGx5XHJcbiAgICAgIGlmIChkYXRhLmVtYWlsICE9PSBlbWFpbCkge1xyXG4gICAgICAgIC8vIENoZWNrIGlmIG5ldyBlbWFpbCBhbHJlYWR5IGV4aXN0c1xyXG4gICAgICAgIGNvbnN0IHsgZGF0YTogZW1haWxDaGVjayB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgICAgICAuc2VsZWN0KCdpZCcpXHJcbiAgICAgICAgICAuZXEoJ2VtYWlsJywgZGF0YS5lbWFpbClcclxuICAgICAgICAgIC5tYXliZVNpbmdsZSgpO1xyXG5cclxuICAgICAgICBpZiAoZW1haWxDaGVjaykge1xyXG4gICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRW1haWwgYWxyZWFkeSBleGlzdHMnIH07XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCB1cGRhdGVEYXRhOiBhbnkgPSB7XHJcbiAgICAgICAgZmlyc3RfbmFtZTogZGF0YS5maXJzdF9uYW1lLnRyaW0oKSxcclxuICAgICAgICBsYXN0X25hbWU6IGRhdGEubGFzdF9uYW1lLnRyaW0oKSxcclxuICAgICAgICBlbWFpbDogZGF0YS5lbWFpbC50cmltKCksXHJcbiAgICAgICAgcGhvbmU6IGRhdGEucGhvbmU/LnRyaW0oKSB8fCBudWxsLFxyXG4gICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8vIE9ubHkgdXBkYXRlIGF2YXRhcl91cmwgaWYgaXQncyBwcm92aWRlZFxyXG4gICAgICBpZiAoZGF0YS5hdmF0YXJfdXJsICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICB1cGRhdGVEYXRhLmF2YXRhcl91cmwgPSBkYXRhLmF2YXRhcl91cmw7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IHsgZGF0YTogdXBkYXRlZFByb2ZpbGUsIGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgIC51cGRhdGUodXBkYXRlRGF0YSlcclxuICAgICAgICAuZXEoJ2VtYWlsJywgZW1haWwpXHJcbiAgICAgICAgLnNlbGVjdCgpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgaWYgKHVwZGF0ZUVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBkYXRpbmcgcHJvZmlsZTonLCB1cGRhdGVFcnJvcik7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB1cGRhdGVFcnJvci5tZXNzYWdlIH07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJlc3VsdCA9IHVwZGF0ZWRQcm9maWxlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8gQ3JlYXRlIG5ldyBwcm9maWxlXHJcbiAgICAgIGNvbnN0IGluc2VydERhdGE6IGFueSA9IHtcclxuICAgICAgICBlbWFpbDogZGF0YS5lbWFpbC50cmltKCksXHJcbiAgICAgICAgcGhvbmU6IGRhdGEucGhvbmU/LnRyaW0oKSB8fCBudWxsLFxyXG4gICAgICAgIGZpcnN0X25hbWU6IGRhdGEuZmlyc3RfbmFtZS50cmltKCksXHJcbiAgICAgICAgbGFzdF9uYW1lOiBkYXRhLmxhc3RfbmFtZS50cmltKCksXHJcbiAgICAgIH07XHJcblxyXG4gICAgICAvLyBPbmx5IHNldCBhdmF0YXJfdXJsIGlmIGl0J3MgcHJvdmlkZWRcclxuICAgICAgaWYgKGRhdGEuYXZhdGFyX3VybCkge1xyXG4gICAgICAgIGluc2VydERhdGEuYXZhdGFyX3VybCA9IGRhdGEuYXZhdGFyX3VybDtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgeyBkYXRhOiBuZXdQcm9maWxlLCBlcnJvcjogaW5zZXJ0RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcclxuICAgICAgICAuaW5zZXJ0KGluc2VydERhdGEpXHJcbiAgICAgICAgLnNlbGVjdCgpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgaWYgKGluc2VydEVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYXRpbmcgcHJvZmlsZTonLCBpbnNlcnRFcnJvcik7XHJcbiAgICAgICAgLy8gQ2hlY2sgaWYgaXQncyBhIHVuaXF1ZSBjb25zdHJhaW50IHZpb2xhdGlvblxyXG4gICAgICAgIGlmIChpbnNlcnRFcnJvci5jb2RlID09PSAnMjM1MDUnKSB7XHJcbiAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdFbWFpbCBhbHJlYWR5IGV4aXN0cycgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBpbnNlcnRFcnJvci5tZXNzYWdlIH07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJlc3VsdCA9IG5ld1Byb2ZpbGU7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcHJvZmlsZTogcmVzdWx0IH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHVwZGF0ZUN1c3RvbWVyUHJvZmlsZTonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byB1cGRhdGUgcHJvZmlsZScsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEN1c3RvbWVyTG9jYXRpb25zKFxyXG4gIGVtYWlsOiBzdHJpbmcsXHJcbiAgcGhvbmU/OiBzdHJpbmdcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBsb2NhdGlvbnM/OiBMb2NhdGlvbltdO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgbGV0IHF1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2xvY2F0aW9ucycpXHJcbiAgICAgIC5zZWxlY3QoJyonKVxyXG4gICAgICAub3JkZXIoJ2lzX2RlZmF1bHQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcclxuICAgICAgLm9yZGVyKCdjcmVhdGVkX2F0JywgeyBhc2NlbmRpbmc6IGZhbHNlIH0pO1xyXG5cclxuICAgIC8vIEJ1aWxkIHF1ZXJ5IGZvciBlbWFpbC9waG9uZSBsb29rdXBcclxuICAgIGlmIChlbWFpbCAmJiBwaG9uZSkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5Lm9yKGBjdXN0b21lcl9lbWFpbC5lcS4ke2VtYWlsfSxjdXN0b21lcl9waG9uZS5lcS4ke3Bob25lfWApO1xyXG4gICAgfSBlbHNlIGlmIChlbWFpbCkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdjdXN0b21lcl9lbWFpbCcsIGVtYWlsKTtcclxuICAgIH0gZWxzZSBpZiAocGhvbmUpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnY3VzdG9tZXJfcGhvbmUnLCBwaG9uZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdFbWFpbCBvciBwaG9uZSBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBxdWVyeTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgbG9jYXRpb25zOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgbG9jYXRpb25zOiBkYXRhIHx8IFtdIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGdldEN1c3RvbWVyTG9jYXRpb25zOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGZldGNoIGxvY2F0aW9ucycsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUxvY2F0aW9uKFxyXG4gIGVtYWlsOiBzdHJpbmcsXHJcbiAgcGhvbmU6IHN0cmluZyB8IHVuZGVmaW5lZCxcclxuICBsb2NhdGlvbkRhdGE6IExvY2F0aW9uQ3JlYXRlSW5wdXRcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBsb2NhdGlvbj86IExvY2F0aW9uO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgLy8gVmFsaWRhdGUgaW5wdXRcclxuICAgIGlmICghbG9jYXRpb25EYXRhLm5pY2tuYW1lPy50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTmlja25hbWUgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcbiAgICBpZiAoIWxvY2F0aW9uRGF0YS5hZGRyZXNzPy50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnQWRkcmVzcyBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuICAgIGlmICghbG9jYXRpb25EYXRhLnN1YnVyYj8udHJpbSgpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ1N1YnVyYiBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuICAgIGlmICghbG9jYXRpb25EYXRhLmNpdHk/LnRyaW0oKSkge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdDaXR5IGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIElmIHNldHRpbmcgYXMgZGVmYXVsdCwgdW5zZXQgYWxsIG90aGVyIGRlZmF1bHRzIGZvciB0aGlzIGN1c3RvbWVyXHJcbiAgICBpZiAobG9jYXRpb25EYXRhLmlzX2RlZmF1bHQpIHtcclxuICAgICAgbGV0IHVwZGF0ZVF1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgnbG9jYXRpb25zJylcclxuICAgICAgICAudXBkYXRlKHsgaXNfZGVmYXVsdDogZmFsc2UgfSk7XHJcblxyXG4gICAgICBpZiAoZW1haWwgJiYgcGhvbmUpIHtcclxuICAgICAgICB1cGRhdGVRdWVyeSA9IHVwZGF0ZVF1ZXJ5Lm9yKGBjdXN0b21lcl9lbWFpbC5lcS4ke2VtYWlsfSxjdXN0b21lcl9waG9uZS5lcS4ke3Bob25lfWApO1xyXG4gICAgICB9IGVsc2UgaWYgKGVtYWlsKSB7XHJcbiAgICAgICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5lcSgnY3VzdG9tZXJfZW1haWwnLCBlbWFpbCk7XHJcbiAgICAgIH0gZWxzZSBpZiAocGhvbmUpIHtcclxuICAgICAgICB1cGRhdGVRdWVyeSA9IHVwZGF0ZVF1ZXJ5LmVxKCdjdXN0b21lcl9waG9uZScsIHBob25lKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgYXdhaXQgdXBkYXRlUXVlcnk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBkYXRhOiBuZXdMb2NhdGlvbiwgZXJyb3I6IGluc2VydEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnbG9jYXRpb25zJylcclxuICAgICAgLmluc2VydCh7XHJcbiAgICAgICAgY3VzdG9tZXJfZW1haWw6IGVtYWlsLFxyXG4gICAgICAgIGN1c3RvbWVyX3Bob25lOiBwaG9uZSB8fCBudWxsLFxyXG4gICAgICAgIG5pY2tuYW1lOiBsb2NhdGlvbkRhdGEubmlja25hbWUudHJpbSgpLFxyXG4gICAgICAgIGFkZHJlc3M6IGxvY2F0aW9uRGF0YS5hZGRyZXNzLnRyaW0oKSxcclxuICAgICAgICBhcHRfdW5pdDogbG9jYXRpb25EYXRhLmFwdF91bml0Py50cmltKCkgfHwgbnVsbCxcclxuICAgICAgICBzdWJ1cmI6IGxvY2F0aW9uRGF0YS5zdWJ1cmIudHJpbSgpLFxyXG4gICAgICAgIGNpdHk6IGxvY2F0aW9uRGF0YS5jaXR5LnRyaW0oKSxcclxuICAgICAgICBwb3N0YWxfY29kZTogbG9jYXRpb25EYXRhLnBvc3RhbF9jb2RlPy50cmltKCkgfHwgbnVsbCxcclxuICAgICAgICBpc19kZWZhdWx0OiBsb2NhdGlvbkRhdGEuaXNfZGVmYXVsdCB8fCBmYWxzZSxcclxuICAgICAgfSlcclxuICAgICAgLnNlbGVjdCgpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoaW5zZXJ0RXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYXRpbmcgbG9jYXRpb246JywgaW5zZXJ0RXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGluc2VydEVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBsb2NhdGlvbjogbmV3TG9jYXRpb24gfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gY3JlYXRlTG9jYXRpb246JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gY3JlYXRlIGxvY2F0aW9uJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlTG9jYXRpb24oXHJcbiAgbG9jYXRpb25JZDogc3RyaW5nLFxyXG4gIGxvY2F0aW9uRGF0YTogTG9jYXRpb25VcGRhdGVJbnB1dFxyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGxvY2F0aW9uPzogTG9jYXRpb247XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICAvLyBWYWxpZGF0ZSBpbnB1dCBpZiBwcm92aWRlZFxyXG4gICAgaWYgKGxvY2F0aW9uRGF0YS5uaWNrbmFtZSAhPT0gdW5kZWZpbmVkICYmICFsb2NhdGlvbkRhdGEubmlja25hbWUudHJpbSgpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ05pY2tuYW1lIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG4gICAgaWYgKGxvY2F0aW9uRGF0YS5hZGRyZXNzICE9PSB1bmRlZmluZWQgJiYgIWxvY2F0aW9uRGF0YS5hZGRyZXNzLnRyaW0oKSkge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdBZGRyZXNzIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG4gICAgaWYgKGxvY2F0aW9uRGF0YS5zdWJ1cmIgIT09IHVuZGVmaW5lZCAmJiAhbG9jYXRpb25EYXRhLnN1YnVyYi50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnU3VidXJiIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG4gICAgaWYgKGxvY2F0aW9uRGF0YS5jaXR5ICE9PSB1bmRlZmluZWQgJiYgIWxvY2F0aW9uRGF0YS5jaXR5LnRyaW0oKSkge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdDaXR5IGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEdldCBjdXJyZW50IGxvY2F0aW9uIHRvIGNoZWNrIGN1c3RvbWVyIGVtYWlsXHJcbiAgICBjb25zdCB7IGRhdGE6IGN1cnJlbnRMb2NhdGlvbiwgZXJyb3I6IGZldGNoRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdsb2NhdGlvbnMnKVxyXG4gICAgICAuc2VsZWN0KCdjdXN0b21lcl9lbWFpbCwgY3VzdG9tZXJfcGhvbmUnKVxyXG4gICAgICAuZXEoJ2lkJywgbG9jYXRpb25JZClcclxuICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgIGlmIChmZXRjaEVycm9yIHx8ICFjdXJyZW50TG9jYXRpb24pIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTG9jYXRpb24gbm90IGZvdW5kJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIElmIHNldHRpbmcgYXMgZGVmYXVsdCwgdW5zZXQgYWxsIG90aGVyIGRlZmF1bHRzIGZvciB0aGlzIGN1c3RvbWVyXHJcbiAgICBpZiAobG9jYXRpb25EYXRhLmlzX2RlZmF1bHQpIHtcclxuICAgICAgbGV0IHVwZGF0ZVF1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgnbG9jYXRpb25zJylcclxuICAgICAgICAudXBkYXRlKHsgaXNfZGVmYXVsdDogZmFsc2UgfSk7XHJcblxyXG4gICAgICBpZiAoY3VycmVudExvY2F0aW9uLmN1c3RvbWVyX2VtYWlsICYmIGN1cnJlbnRMb2NhdGlvbi5jdXN0b21lcl9waG9uZSkge1xyXG4gICAgICAgIHVwZGF0ZVF1ZXJ5ID0gdXBkYXRlUXVlcnkub3IoYGN1c3RvbWVyX2VtYWlsLmVxLiR7Y3VycmVudExvY2F0aW9uLmN1c3RvbWVyX2VtYWlsfSxjdXN0b21lcl9waG9uZS5lcS4ke2N1cnJlbnRMb2NhdGlvbi5jdXN0b21lcl9waG9uZX1gKTtcclxuICAgICAgfSBlbHNlIGlmIChjdXJyZW50TG9jYXRpb24uY3VzdG9tZXJfZW1haWwpIHtcclxuICAgICAgICB1cGRhdGVRdWVyeSA9IHVwZGF0ZVF1ZXJ5LmVxKCdjdXN0b21lcl9lbWFpbCcsIGN1cnJlbnRMb2NhdGlvbi5jdXN0b21lcl9lbWFpbCk7XHJcbiAgICAgIH0gZWxzZSBpZiAoY3VycmVudExvY2F0aW9uLmN1c3RvbWVyX3Bob25lKSB7XHJcbiAgICAgICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5lcSgnY3VzdG9tZXJfcGhvbmUnLCBjdXJyZW50TG9jYXRpb24uY3VzdG9tZXJfcGhvbmUpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBEb24ndCB1bnNldCB0aGUgY3VycmVudCBsb2NhdGlvblxyXG4gICAgICB1cGRhdGVRdWVyeSA9IHVwZGF0ZVF1ZXJ5Lm5lcSgnaWQnLCBsb2NhdGlvbklkKTtcclxuXHJcbiAgICAgIGF3YWl0IHVwZGF0ZVF1ZXJ5O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEJ1aWxkIHVwZGF0ZSBvYmplY3Qgd2l0aCBvbmx5IHByb3ZpZGVkIGZpZWxkc1xyXG4gICAgY29uc3QgdXBkYXRlRGF0YTogYW55ID0ge1xyXG4gICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICB9O1xyXG5cclxuICAgIGlmIChsb2NhdGlvbkRhdGEubmlja25hbWUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB1cGRhdGVEYXRhLm5pY2tuYW1lID0gbG9jYXRpb25EYXRhLm5pY2tuYW1lLnRyaW0oKTtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuYWRkcmVzcyAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHVwZGF0ZURhdGEuYWRkcmVzcyA9IGxvY2F0aW9uRGF0YS5hZGRyZXNzLnRyaW0oKTtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuYXB0X3VuaXQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB1cGRhdGVEYXRhLmFwdF91bml0ID0gbG9jYXRpb25EYXRhLmFwdF91bml0Py50cmltKCkgfHwgbnVsbDtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuc3VidXJiICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgdXBkYXRlRGF0YS5zdWJ1cmIgPSBsb2NhdGlvbkRhdGEuc3VidXJiLnRyaW0oKTtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuY2l0eSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHVwZGF0ZURhdGEuY2l0eSA9IGxvY2F0aW9uRGF0YS5jaXR5LnRyaW0oKTtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEucG9zdGFsX2NvZGUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB1cGRhdGVEYXRhLnBvc3RhbF9jb2RlID0gbG9jYXRpb25EYXRhLnBvc3RhbF9jb2RlPy50cmltKCkgfHwgbnVsbDtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuaXNfZGVmYXVsdCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHVwZGF0ZURhdGEuaXNfZGVmYXVsdCA9IGxvY2F0aW9uRGF0YS5pc19kZWZhdWx0O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgZGF0YTogdXBkYXRlZExvY2F0aW9uLCBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdsb2NhdGlvbnMnKVxyXG4gICAgICAudXBkYXRlKHVwZGF0ZURhdGEpXHJcbiAgICAgIC5lcSgnaWQnLCBsb2NhdGlvbklkKVxyXG4gICAgICAuc2VsZWN0KClcclxuICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgIGlmICh1cGRhdGVFcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciB1cGRhdGluZyBsb2NhdGlvbjonLCB1cGRhdGVFcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogdXBkYXRlRXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGxvY2F0aW9uOiB1cGRhdGVkTG9jYXRpb24gfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gdXBkYXRlTG9jYXRpb246JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gdXBkYXRlIGxvY2F0aW9uJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZGVsZXRlTG9jYXRpb24obG9jYXRpb25JZDogc3RyaW5nKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdsb2NhdGlvbnMnKVxyXG4gICAgICAuZGVsZXRlKClcclxuICAgICAgLmVxKCdpZCcsIGxvY2F0aW9uSWQpO1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBkZWxldGluZyBsb2NhdGlvbjonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gZGVsZXRlTG9jYXRpb246JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gZGVsZXRlIGxvY2F0aW9uJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2V0RGVmYXVsdExvY2F0aW9uKFxyXG4gIGxvY2F0aW9uSWQ6IHN0cmluZyxcclxuICBlbWFpbDogc3RyaW5nLFxyXG4gIHBob25lPzogc3RyaW5nXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgbG9jYXRpb24/OiBMb2NhdGlvbjtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIEdldCBjdXJyZW50IGxvY2F0aW9uIHRvIHZlcmlmeSBvd25lcnNoaXBcclxuICAgIGNvbnN0IHsgZGF0YTogY3VycmVudExvY2F0aW9uLCBlcnJvcjogZmV0Y2hFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2xvY2F0aW9ucycpXHJcbiAgICAgIC5zZWxlY3QoJ2N1c3RvbWVyX2VtYWlsLCBjdXN0b21lcl9waG9uZScpXHJcbiAgICAgIC5lcSgnaWQnLCBsb2NhdGlvbklkKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKGZldGNoRXJyb3IgfHwgIWN1cnJlbnRMb2NhdGlvbikge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdMb2NhdGlvbiBub3QgZm91bmQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVmVyaWZ5IG93bmVyc2hpcFxyXG4gICAgY29uc3QgaXNPd25lciA9IFxyXG4gICAgICBjdXJyZW50TG9jYXRpb24uY3VzdG9tZXJfZW1haWwgPT09IGVtYWlsIHx8XHJcbiAgICAgIChwaG9uZSAmJiBjdXJyZW50TG9jYXRpb24uY3VzdG9tZXJfcGhvbmUgPT09IHBob25lKTtcclxuXHJcbiAgICBpZiAoIWlzT3duZXIpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnVW5hdXRob3JpemVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFVuc2V0IGFsbCBvdGhlciBkZWZhdWx0cyBmb3IgdGhpcyBjdXN0b21lclxyXG4gICAgbGV0IHVwZGF0ZVF1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2xvY2F0aW9ucycpXHJcbiAgICAgIC51cGRhdGUoeyBpc19kZWZhdWx0OiBmYWxzZSB9KTtcclxuXHJcbiAgICBpZiAoZW1haWwgJiYgcGhvbmUpIHtcclxuICAgICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5vcihgY3VzdG9tZXJfZW1haWwuZXEuJHtlbWFpbH0sY3VzdG9tZXJfcGhvbmUuZXEuJHtwaG9uZX1gKTtcclxuICAgIH0gZWxzZSBpZiAoZW1haWwpIHtcclxuICAgICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5lcSgnY3VzdG9tZXJfZW1haWwnLCBlbWFpbCk7XHJcbiAgICB9IGVsc2UgaWYgKHBob25lKSB7XHJcbiAgICAgIHVwZGF0ZVF1ZXJ5ID0gdXBkYXRlUXVlcnkuZXEoJ2N1c3RvbWVyX3Bob25lJywgcGhvbmUpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIERvbid0IHVuc2V0IHRoZSBjdXJyZW50IGxvY2F0aW9uXHJcbiAgICB1cGRhdGVRdWVyeSA9IHVwZGF0ZVF1ZXJ5Lm5lcSgnaWQnLCBsb2NhdGlvbklkKTtcclxuXHJcbiAgICBhd2FpdCB1cGRhdGVRdWVyeTtcclxuXHJcbiAgICAvLyBTZXQgdGhpcyBsb2NhdGlvbiBhcyBkZWZhdWx0XHJcbiAgICBjb25zdCB7IGRhdGE6IHVwZGF0ZWRMb2NhdGlvbiwgZXJyb3I6IHVwZGF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnbG9jYXRpb25zJylcclxuICAgICAgLnVwZGF0ZSh7IGlzX2RlZmF1bHQ6IHRydWUgfSlcclxuICAgICAgLmVxKCdpZCcsIGxvY2F0aW9uSWQpXHJcbiAgICAgIC5zZWxlY3QoKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKHVwZGF0ZUVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHNldHRpbmcgZGVmYXVsdCBsb2NhdGlvbjonLCB1cGRhdGVFcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogdXBkYXRlRXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGxvY2F0aW9uOiB1cGRhdGVkTG9jYXRpb24gfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gc2V0RGVmYXVsdExvY2F0aW9uOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIHNldCBkZWZhdWx0IGxvY2F0aW9uJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0T3JDcmVhdGVSZWZlcnJhbENvZGUoXHJcbiAgZW1haWw6IHN0cmluZ1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIHJlZmVycmFsQ29kZT86IHN0cmluZztcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIENoZWNrIGlmIHByb2ZpbGUgZXhpc3RzIGFuZCBoYXMgYSByZWZlcnJhbCBjb2RlXHJcbiAgICBjb25zdCB7IGRhdGE6IHByb2ZpbGUsIGVycm9yOiBwcm9maWxlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgIC5zZWxlY3QoJ3JlZmVycmFsX2NvZGUnKVxyXG4gICAgICAuZXEoJ2VtYWlsJywgZW1haWwpXHJcbiAgICAgIC5tYXliZVNpbmdsZSgpO1xyXG5cclxuICAgIGlmIChwcm9maWxlRXJyb3IgJiYgcHJvZmlsZUVycm9yLmNvZGUgIT09ICdQR1JTVDExNicpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgcHJvZmlsZTonLCBwcm9maWxlRXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHByb2ZpbGVFcnJvci5tZXNzYWdlIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gSWYgcHJvZmlsZSBleGlzdHMgYW5kIGhhcyBhIHJlZmVycmFsIGNvZGUsIHJldHVybiBpdFxyXG4gICAgaWYgKHByb2ZpbGU/LnJlZmVycmFsX2NvZGUpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcmVmZXJyYWxDb2RlOiBwcm9maWxlLnJlZmVycmFsX2NvZGUgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBHZW5lcmF0ZSBhIG5ldyByZWZlcnJhbCBjb2RlXHJcbiAgICAvLyBUcnkgdXNpbmcgdGhlIGRhdGFiYXNlIGZ1bmN0aW9uIGZpcnN0LCBidXQgZmFsbGJhY2sgdG8gY2xpZW50LXNpZGUgZ2VuZXJhdGlvblxyXG4gICAgbGV0IGdlbmVyYXRlZENvZGU6IHN0cmluZyB8IG51bGwgPSBudWxsO1xyXG4gICAgXHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB7IGRhdGE6IGRiQ29kZSwgZXJyb3I6IGNvZGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAucnBjKCdnZW5lcmF0ZV9yZWZlcnJhbF9jb2RlJyk7XHJcbiAgICAgIFxyXG4gICAgICBpZiAoIWNvZGVFcnJvciAmJiBkYkNvZGUpIHtcclxuICAgICAgICBnZW5lcmF0ZWRDb2RlID0gZGJDb2RlO1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChycGNFcnJvcikge1xyXG4gICAgICAvLyBSUEMgZnVuY3Rpb24gbWlnaHQgbm90IGV4aXN0IHlldCwgdGhhdCdzIG9rYXlcclxuICAgICAgY29uc29sZS5sb2coJ1JQQyBmdW5jdGlvbiBub3QgYXZhaWxhYmxlLCB1c2luZyBmYWxsYmFjaycpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghZ2VuZXJhdGVkQ29kZSkge1xyXG4gICAgICAvLyBGYWxsYmFjazogZ2VuZXJhdGUgY29kZSBjbGllbnQtc2lkZSBzdHlsZVxyXG4gICAgICBjb25zdCBmYWxsYmFja0NvZGUgPSBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoMiwgOCkudG9VcHBlckNhc2UoKTtcclxuICAgICAgXHJcbiAgICAgIC8vIENoZWNrIGlmIGZhbGxiYWNrIGNvZGUgZXhpc3RzLCByZXRyeSBpZiBpdCBkb2VzXHJcbiAgICAgIGxldCBmaW5hbENvZGUgPSBmYWxsYmFja0NvZGU7XHJcbiAgICAgIGxldCBhdHRlbXB0cyA9IDA7XHJcbiAgICAgIGNvbnN0IG1heEF0dGVtcHRzID0gNTtcclxuXHJcbiAgICAgIHdoaWxlIChhdHRlbXB0cyA8IG1heEF0dGVtcHRzKSB7XHJcbiAgICAgICAgY29uc3QgeyBkYXRhOiBleGlzdGluZyB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgICAgICAuc2VsZWN0KCdpZCcpXHJcbiAgICAgICAgICAuZXEoJ3JlZmVycmFsX2NvZGUnLCBmaW5hbENvZGUpXHJcbiAgICAgICAgICAubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgICAgICAgaWYgKCFleGlzdGluZykge1xyXG4gICAgICAgICAgYnJlYWs7IC8vIENvZGUgaXMgdW5pcXVlXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBHZW5lcmF0ZSBhIG5ldyBjb2RlXHJcbiAgICAgICAgZmluYWxDb2RlID0gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIsIDgpLnRvVXBwZXJDYXNlKCk7XHJcbiAgICAgICAgYXR0ZW1wdHMrKztcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gVXBkYXRlIG9yIGluc2VydCBwcm9maWxlIHdpdGggcmVmZXJyYWwgY29kZVxyXG4gICAgICAvLyBGaXJzdCwgdHJ5IHRvIHVwZGF0ZSBleGlzdGluZyBwcm9maWxlXHJcbiAgICAgIGNvbnN0IHsgZGF0YTogZXhpc3RpbmdQcm9maWxlIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgICAgLnNlbGVjdCgnaWQsIGZpcnN0X25hbWUsIGxhc3RfbmFtZScpXHJcbiAgICAgICAgLmVxKCdlbWFpbCcsIGVtYWlsKVxyXG4gICAgICAgIC5tYXliZVNpbmdsZSgpO1xyXG5cclxuICAgICAgbGV0IHVwZGF0ZWRQcm9maWxlO1xyXG4gICAgICBpZiAoZXhpc3RpbmdQcm9maWxlKSB7XHJcbiAgICAgICAgLy8gVXBkYXRlIGV4aXN0aW5nIHByb2ZpbGVcclxuICAgICAgICBjb25zdCB7IGRhdGE6IHVwZGF0ZWQsIGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgICAgICAudXBkYXRlKHtcclxuICAgICAgICAgICAgcmVmZXJyYWxfY29kZTogZmluYWxDb2RlLFxyXG4gICAgICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgLmVxKCdlbWFpbCcsIGVtYWlsKVxyXG4gICAgICAgICAgLnNlbGVjdCgncmVmZXJyYWxfY29kZScpXHJcbiAgICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICAgIGlmICh1cGRhdGVFcnJvcikge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBkYXRpbmcgcmVmZXJyYWwgY29kZTonLCB1cGRhdGVFcnJvcik7XHJcbiAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHVwZGF0ZUVycm9yLm1lc3NhZ2UgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdXBkYXRlZFByb2ZpbGUgPSB1cGRhdGVkO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEluc2VydCBuZXcgcHJvZmlsZSB3aXRoIHJlZmVycmFsIGNvZGVcclxuICAgICAgICBjb25zdCB7IGRhdGE6IGluc2VydGVkLCBlcnJvcjogaW5zZXJ0RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgICAgLmluc2VydCh7XHJcbiAgICAgICAgICAgIGVtYWlsLFxyXG4gICAgICAgICAgICByZWZlcnJhbF9jb2RlOiBmaW5hbENvZGUsXHJcbiAgICAgICAgICAgIGZpcnN0X25hbWU6IGVtYWlsLnNwbGl0KCdAJylbMF0sXHJcbiAgICAgICAgICAgIGxhc3RfbmFtZTogJycsXHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgLnNlbGVjdCgncmVmZXJyYWxfY29kZScpXHJcbiAgICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICAgIGlmIChpbnNlcnRFcnJvcikge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYXRpbmcgcmVmZXJyYWwgY29kZTonLCBpbnNlcnRFcnJvcik7XHJcbiAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGluc2VydEVycm9yLm1lc3NhZ2UgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdXBkYXRlZFByb2ZpbGUgPSBpbnNlcnRlZDtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcmVmZXJyYWxDb2RlOiB1cGRhdGVkUHJvZmlsZT8ucmVmZXJyYWxfY29kZSB8fCBmaW5hbENvZGUgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBVc2UgdGhlIGdlbmVyYXRlZCBjb2RlIGZyb20gZGF0YWJhc2UgZnVuY3Rpb25cclxuICAgIC8vIFVwZGF0ZSBvciBpbnNlcnQgcHJvZmlsZSB3aXRoIGdlbmVyYXRlZCBjb2RlXHJcbiAgICBjb25zdCB7IGRhdGE6IGV4aXN0aW5nUHJvZmlsZSB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcclxuICAgICAgLnNlbGVjdCgnaWQsIGZpcnN0X25hbWUsIGxhc3RfbmFtZScpXHJcbiAgICAgIC5lcSgnZW1haWwnLCBlbWFpbClcclxuICAgICAgLm1heWJlU2luZ2xlKCk7XHJcblxyXG4gICAgbGV0IHVwZGF0ZWRQcm9maWxlO1xyXG4gICAgaWYgKGV4aXN0aW5nUHJvZmlsZSkge1xyXG4gICAgICAvLyBVcGRhdGUgZXhpc3RpbmcgcHJvZmlsZVxyXG4gICAgICBjb25zdCB7IGRhdGE6IHVwZGF0ZWQsIGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgIC51cGRhdGUoe1xyXG4gICAgICAgICAgcmVmZXJyYWxfY29kZTogZ2VuZXJhdGVkQ29kZSxcclxuICAgICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5lcSgnZW1haWwnLCBlbWFpbClcclxuICAgICAgICAuc2VsZWN0KCdyZWZlcnJhbF9jb2RlJylcclxuICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICBpZiAodXBkYXRlRXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciB1cGRhdGluZyByZWZlcnJhbCBjb2RlOicsIHVwZGF0ZUVycm9yKTtcclxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHVwZGF0ZUVycm9yLm1lc3NhZ2UgfTtcclxuICAgICAgfVxyXG4gICAgICB1cGRhdGVkUHJvZmlsZSA9IHVwZGF0ZWQ7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyBJbnNlcnQgbmV3IHByb2ZpbGUgd2l0aCByZWZlcnJhbCBjb2RlXHJcbiAgICAgIGNvbnN0IHsgZGF0YTogaW5zZXJ0ZWQsIGVycm9yOiBpbnNlcnRFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgIC5pbnNlcnQoe1xyXG4gICAgICAgICAgZW1haWwsXHJcbiAgICAgICAgICByZWZlcnJhbF9jb2RlOiBnZW5lcmF0ZWRDb2RlLFxyXG4gICAgICAgICAgZmlyc3RfbmFtZTogZW1haWwuc3BsaXQoJ0AnKVswXSxcclxuICAgICAgICAgIGxhc3RfbmFtZTogJycsXHJcbiAgICAgICAgfSlcclxuICAgICAgICAuc2VsZWN0KCdyZWZlcnJhbF9jb2RlJylcclxuICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICBpZiAoaW5zZXJ0RXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjcmVhdGluZyByZWZlcnJhbCBjb2RlOicsIGluc2VydEVycm9yKTtcclxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGluc2VydEVycm9yLm1lc3NhZ2UgfTtcclxuICAgICAgfVxyXG4gICAgICB1cGRhdGVkUHJvZmlsZSA9IGluc2VydGVkO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHJlZmVycmFsQ29kZTogdXBkYXRlZFByb2ZpbGU/LnJlZmVycmFsX2NvZGUgfHwgZ2VuZXJhdGVkQ29kZSB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBnZXRPckNyZWF0ZVJlZmVycmFsQ29kZTonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBnZXQgcmVmZXJyYWwgY29kZScsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNlbmRSZWZlcnJhbEludml0ZXMoXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBpbnZpdGVFbWFpbHM6IHN0cmluZ1tdLFxyXG4gIHJlZmVycmFsQ29kZTogc3RyaW5nXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgc2VudD86IG51bWJlcjtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIFZhbGlkYXRlIGVtYWlsIGFkZHJlc3Nlc1xyXG4gICAgY29uc3QgdmFsaWRFbWFpbHMgPSBpbnZpdGVFbWFpbHNcclxuICAgICAgLm1hcCgoZSkgPT4gZS50cmltKCkpXHJcbiAgICAgIC5maWx0ZXIoKGUpID0+IHtcclxuICAgICAgICBpZiAoIWUpIHJldHVybiBmYWxzZTtcclxuICAgICAgICByZXR1cm4gL15bXlxcc0BdK0BbXlxcc0BdK1xcLlteXFxzQF0rJC8udGVzdChlKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgaWYgKHZhbGlkRW1haWxzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdObyB2YWxpZCBlbWFpbCBhZGRyZXNzZXMgcHJvdmlkZWQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ3JlYXRlIHJlZmVycmFsIHJlY29yZHMgZm9yIHRyYWNraW5nXHJcbiAgICBjb25zdCByZWZlcnJhbFJlY29yZHMgPSB2YWxpZEVtYWlscy5tYXAoKHJlZmVycmVkRW1haWwpID0+ICh7XHJcbiAgICAgIHJlZmVycmVyX2VtYWlsOiBlbWFpbCxcclxuICAgICAgcmVmZXJyZWRfZW1haWw6IHJlZmVycmVkRW1haWwsXHJcbiAgICAgIHJlZmVycmFsX2NvZGU6IHJlZmVycmFsQ29kZSxcclxuICAgICAgc3RhdHVzOiAncGVuZGluZycsXHJcbiAgICB9KSk7XHJcblxyXG4gICAgY29uc3QgeyBlcnJvcjogaW5zZXJ0RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdyZWZlcnJhbHMnKVxyXG4gICAgICAuaW5zZXJ0KHJlZmVycmFsUmVjb3Jkcyk7XHJcblxyXG4gICAgaWYgKGluc2VydEVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIHJlZmVycmFsIHJlY29yZHM6JywgaW5zZXJ0RXJyb3IpO1xyXG4gICAgICAvLyBDb250aW51ZSBldmVuIGlmIGluc2VydCBmYWlscyAtIHdlIHN0aWxsIHdhbnQgdG8gc2VuZCBlbWFpbHNcclxuICAgIH1cclxuXHJcbiAgICAvLyBHZW5lcmF0ZSByZWZlcnJhbCBsaW5rXHJcbiAgICBjb25zdCBiYXNlVXJsID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU0lURV9VUkwgfHwgJ2h0dHBzOi8vc2hhbGVhbi5jby56YSc7XHJcbiAgICBjb25zdCByZWZlcnJhbExpbmsgPSBgJHtiYXNlVXJsfS9ib29raW5nL2RldGFpbHM/cmVmPSR7cmVmZXJyYWxDb2RlfWA7XHJcblxyXG4gICAgLy8gVE9ETzogSW1wbGVtZW50IGFjdHVhbCBlbWFpbCBzZW5kaW5nIHVzaW5nIHlvdXIgZW1haWwgc2VydmljZSAoUmVzZW5kLCBTZW5kR3JpZCwgZXRjLilcclxuICAgIC8vIEZvciBub3csIHdlJ2xsIGp1c3QgbG9nIHRoZSBlbWFpbHMgdGhhdCB3b3VsZCBiZSBzZW50XHJcbiAgICBjb25zb2xlLmxvZygnUmVmZXJyYWwgaW52aXRlcyB0byBzZW5kOicsIHtcclxuICAgICAgZnJvbTogZW1haWwsXHJcbiAgICAgIHRvOiB2YWxpZEVtYWlscyxcclxuICAgICAgcmVmZXJyYWxDb2RlLFxyXG4gICAgICByZWZlcnJhbExpbmssXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBJbiBhIHJlYWwgaW1wbGVtZW50YXRpb24sIHlvdSB3b3VsZCBzZW5kIGVtYWlscyBoZXJlXHJcbiAgICAvLyBFeGFtcGxlIHdpdGggUmVzZW5kOlxyXG4gICAgLy8gYXdhaXQgcmVzZW5kLmVtYWlscy5zZW5kKHtcclxuICAgIC8vICAgZnJvbTogJ1NoYWxlYW4gPG5vcmVwbHlAc2hhbGVhbi5jby56YT4nLFxyXG4gICAgLy8gICB0bzogdmFsaWRFbWFpbHMsXHJcbiAgICAvLyAgIHN1YmplY3Q6ICdZb3VcXCd2ZSBiZWVuIGludml0ZWQgdG8gdHJ5IFNoYWxlYW4gQ2xlYW5pbmcgU2VydmljZXMhJyxcclxuICAgIC8vICAgaHRtbDogYDxwPllvdXIgZnJpZW5kIGhhcyBpbnZpdGVkIHlvdSB0byB0cnkgU2hhbGVhbi4gVXNlIGNvZGUgJHtyZWZlcnJhbENvZGV9IHRvIGdldCBSMTUwIG9mZiB5b3VyIGZpcnN0IGJvb2tpbmchPC9wPjxwPjxhIGhyZWY9XCIke3JlZmVycmFsTGlua31cIj5Cb29rIE5vdzwvYT48L3A+YCxcclxuICAgIC8vIH0pO1xyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHNlbnQ6IHZhbGlkRW1haWxzLmxlbmd0aCB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBzZW5kUmVmZXJyYWxJbnZpdGVzOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIHNlbmQgaW52aXRlcycsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFJlZmVycmFsU3RhdHMoXHJcbiAgZW1haWw6IHN0cmluZ1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIHN0YXRzPzoge1xyXG4gICAgdG90YWxSZWZlcnJhbHM6IG51bWJlcjtcclxuICAgIGNvbXBsZXRlZFJlZmVycmFsczogbnVtYmVyO1xyXG4gICAgcGVuZGluZ1Jld2FyZHM6IG51bWJlcjtcclxuICAgIHRvdGFsUmV3YXJkczogbnVtYmVyO1xyXG4gIH07XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICBjb25zdCB7IGRhdGE6IHJlZmVycmFscywgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdyZWZlcnJhbHMnKVxyXG4gICAgICAuc2VsZWN0KCdzdGF0dXMsIHJlZmVycmVyX3Jld2FyZF9hbW91bnQsIHJlZmVycmVyX3Jld2FyZF9zdGF0dXMnKVxyXG4gICAgICAuZXEoJ3JlZmVycmVyX2VtYWlsJywgZW1haWwpO1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyByZWZlcnJhbCBzdGF0czonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHN0YXRzID0ge1xyXG4gICAgICB0b3RhbFJlZmVycmFsczogcmVmZXJyYWxzPy5sZW5ndGggfHwgMCxcclxuICAgICAgY29tcGxldGVkUmVmZXJyYWxzOlxyXG4gICAgICAgIHJlZmVycmFscz8uZmlsdGVyKChyKSA9PiByLnN0YXR1cyA9PT0gJ2NvbXBsZXRlZCcpLmxlbmd0aCB8fCAwLFxyXG4gICAgICBwZW5kaW5nUmV3YXJkczpcclxuICAgICAgICByZWZlcnJhbHM/LmZpbHRlcigocikgPT4gci5yZWZlcnJlcl9yZXdhcmRfc3RhdHVzID09PSAncGVuZGluZycpLmxlbmd0aCB8fCAwLFxyXG4gICAgICB0b3RhbFJld2FyZHM6XHJcbiAgICAgICAgcmVmZXJyYWxzXHJcbiAgICAgICAgICA/LmZpbHRlcigocikgPT4gci5yZWZlcnJlcl9yZXdhcmRfc3RhdHVzID09PSAnY3JlZGl0ZWQnKVxyXG4gICAgICAgICAgLnJlZHVjZSgoc3VtLCByKSA9PiBzdW0gKyAoci5yZWZlcnJlcl9yZXdhcmRfYW1vdW50IHx8IDApLCAwKSB8fCAwLFxyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBzdGF0cyB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBnZXRSZWZlcnJhbFN0YXRzOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGZldGNoIHJlZmVycmFsIHN0YXRzJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogSW5pdGlhbGl6ZSBhIGNyZWRpdCBwdXJjaGFzZSB3aXRoIFBheXN0YWNrXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaW5pdGlhbGl6ZUNyZWRpdFB1cmNoYXNlKFxyXG4gIGVtYWlsOiBzdHJpbmcsXHJcbiAgYW1vdW50OiBudW1iZXIsXHJcbiAgcGF5bWVudE1ldGhvZDogJ2NyZWRpdF9jYXJkJyB8ICdlZnQnXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgYXV0aG9yaXphdGlvblVybD86IHN0cmluZztcclxuICByZWZlcmVuY2U/OiBzdHJpbmc7XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgaWYgKGFtb3VudCA8IDIwIHx8IGFtb3VudCA+IDUwMDApIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogJ0Ftb3VudCBtdXN0IGJlIGJldHdlZW4gUjIwIGFuZCBSNTAwMCcsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gR2VuZXJhdGUgYSB1bmlxdWUgcmVmZXJlbmNlIGZvciB0aGlzIGNyZWRpdCBwdXJjaGFzZVxyXG4gICAgY29uc3QgcmVmZXJlbmNlID0gYENSRURJVF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIsIDkpfWA7XHJcblxyXG4gICAgLy8gQ3JlYXRlIGEgcGVuZGluZyBjcmVkaXQgdHJhbnNhY3Rpb25cclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcbiAgICBcclxuICAgIC8vIEdldCBvciBjcmVhdGUgcHJvZmlsZVxyXG4gICAgbGV0IHsgZGF0YTogcHJvZmlsZSB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcclxuICAgICAgLnNlbGVjdCgnaWQsIGNyZWRpdF9iYWxhbmNlJylcclxuICAgICAgLmVxKCdlbWFpbCcsIGVtYWlsKVxyXG4gICAgICAubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoIXByb2ZpbGUpIHtcclxuICAgICAgLy8gQ3JlYXRlIGEgYmFzaWMgcHJvZmlsZSBpZiBpdCBkb2Vzbid0IGV4aXN0XHJcbiAgICAgIGNvbnN0IHsgZGF0YTogbmV3UHJvZmlsZSwgZXJyb3I6IGNyZWF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgICAgLmluc2VydCh7XHJcbiAgICAgICAgICBlbWFpbCxcclxuICAgICAgICAgIGNyZWRpdF9iYWxhbmNlOiAwLFxyXG4gICAgICAgICAgZmlyc3RfbmFtZTogJycsXHJcbiAgICAgICAgICBsYXN0X25hbWU6ICcnLFxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnNlbGVjdCgnaWQsIGNyZWRpdF9iYWxhbmNlJylcclxuICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICBpZiAoY3JlYXRlRXJyb3IgfHwgIW5ld1Byb2ZpbGUpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICBlcnJvcjogJ0ZhaWxlZCB0byBjcmVhdGUgcHJvZmlsZScsXHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG4gICAgICBwcm9maWxlID0gbmV3UHJvZmlsZTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDcmVhdGUgcGVuZGluZyBjcmVkaXQgdHJhbnNhY3Rpb25cclxuICAgIGNvbnN0IHsgZXJyb3I6IHRyYW5zYWN0aW9uRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdjcmVkaXRfdHJhbnNhY3Rpb25zJylcclxuICAgICAgLmluc2VydCh7XHJcbiAgICAgICAgcHJvZmlsZV9pZDogcHJvZmlsZS5pZCxcclxuICAgICAgICBlbWFpbCxcclxuICAgICAgICB0cmFuc2FjdGlvbl90eXBlOiAncHVyY2hhc2UnLFxyXG4gICAgICAgIGFtb3VudCxcclxuICAgICAgICBiYWxhbmNlX2JlZm9yZTogcHJvZmlsZS5jcmVkaXRfYmFsYW5jZSB8fCAwLFxyXG4gICAgICAgIGJhbGFuY2VfYWZ0ZXI6IHByb2ZpbGUuY3JlZGl0X2JhbGFuY2UgfHwgMCwgLy8gV29uJ3QgdXBkYXRlIHVudGlsIHBheW1lbnQgc3VjY2VlZHNcclxuICAgICAgICBwYXltZW50X21ldGhvZDogcGF5bWVudE1ldGhvZCxcclxuICAgICAgICBwYXlzdGFja19yZWZlcmVuY2U6IHJlZmVyZW5jZSxcclxuICAgICAgICBwYXltZW50X3N0YXR1czogJ3BlbmRpbmcnLFxyXG4gICAgICAgIGRlc2NyaXB0aW9uOiBgUHVyY2hhc2Ugb2YgUiR7YW1vdW50fSBTaGFsZWFuQ3JlZGAsXHJcbiAgICAgIH0pO1xyXG5cclxuICAgIGlmICh0cmFuc2FjdGlvbkVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIGNyZWRpdCB0cmFuc2FjdGlvbjonLCB0cmFuc2FjdGlvbkVycm9yKTtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogJ0ZhaWxlZCB0byBjcmVhdGUgdHJhbnNhY3Rpb24gcmVjb3JkJyxcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBJbml0aWFsaXplIFBheXN0YWNrIHBheW1lbnRcclxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goJy9hcGkvcGF5c3RhY2svaW5pdGlhbGl6ZScsIHtcclxuICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxyXG4gICAgICB9LFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgZW1haWwsXHJcbiAgICAgICAgYW1vdW50LFxyXG4gICAgICAgIHJlZmVyZW5jZSxcclxuICAgICAgICBtZXRhZGF0YToge1xyXG4gICAgICAgICAgdHJhbnNhY3Rpb25fdHlwZTogJ2NyZWRpdF9wdXJjaGFzZScsXHJcbiAgICAgICAgICBwYXltZW50X21ldGhvZDogcGF5bWVudE1ldGhvZCxcclxuICAgICAgICB9LFxyXG4gICAgICB9KSxcclxuICAgIH0pO1xyXG5cclxuICAgIGlmICghcmVzcG9uc2Uub2spIHtcclxuICAgICAgY29uc3QgZXJyb3IgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6IGVycm9yLmVycm9yIHx8ICdGYWlsZWQgdG8gaW5pdGlhbGl6ZSBwYXltZW50JyxcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBwYXltZW50RGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcclxuXHJcbiAgICBpZiAoIXBheW1lbnREYXRhLnN0YXR1cykge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIGVycm9yOiBwYXltZW50RGF0YS5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gaW5pdGlhbGl6ZSBwYXltZW50JyxcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICBhdXRob3JpemF0aW9uVXJsOiBwYXltZW50RGF0YS5kYXRhLmF1dGhvcml6YXRpb25fdXJsLFxyXG4gICAgICByZWZlcmVuY2U6IHBheW1lbnREYXRhLmRhdGEucmVmZXJlbmNlLFxyXG4gICAgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW5pdGlhbGl6aW5nIGNyZWRpdCBwdXJjaGFzZTonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBpbml0aWFsaXplIHBheW1lbnQnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgVm91Y2hlclJlZGVtcHRpb24ge1xyXG4gIGlkOiBzdHJpbmc7XHJcbiAgdm91Y2hlcl9jb2RlOiBzdHJpbmc7XHJcbiAgYW1vdW50OiBudW1iZXI7XHJcbiAgcmVkZWVtZWRfYXQ6IHN0cmluZztcclxuICBib29raW5nX2lkPzogc3RyaW5nO1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVkZWVtVm91Y2hlcihcclxuICBjb2RlOiBzdHJpbmcsXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBwaG9uZT86IHN0cmluZ1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGFtb3VudD86IG51bWJlcjtcclxuICBuZXdCYWxhbmNlPzogbnVtYmVyO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgLy8gQ2FsbCB0aGUgZGF0YWJhc2UgZnVuY3Rpb24gdG8gcmVkZWVtIHRoZSB2b3VjaGVyXHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5ycGMoJ3JlZGVlbV92b3VjaGVyJywge1xyXG4gICAgICBwX2NvZGU6IGNvZGUudHJpbSgpLnRvVXBwZXJDYXNlKCksXHJcbiAgICAgIHBfZW1haWw6IGVtYWlsLnRyaW0oKSxcclxuICAgICAgcF9waG9uZTogcGhvbmU/LnRyaW0oKSB8fCBudWxsLFxyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHJlZGVlbWluZyB2b3VjaGVyOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZSB8fCAnRmFpbGVkIHRvIHJlZGVlbSB2b3VjaGVyJyxcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBQYXJzZSB0aGUgcmVzdWx0IGZyb20gdGhlIGZ1bmN0aW9uIChoYW5kbGUgYm90aCBvYmplY3QgYW5kIHN0cmluZyBKU09OQilcclxuICAgIGxldCByZXN1bHQgPSBkYXRhO1xyXG4gICAgaWYgKHR5cGVvZiBkYXRhID09PSAnc3RyaW5nJykge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIHJlc3VsdCA9IEpTT04ucGFyc2UoZGF0YSk7XHJcbiAgICAgIH0gY2F0Y2ggKHBhcnNlRXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBwYXJzaW5nIHZvdWNoZXIgcmVkZW1wdGlvbiByZXN1bHQ6JywgcGFyc2VFcnJvcik7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgZXJyb3I6ICdJbnZhbGlkIHJlc3BvbnNlIGZyb20gc2VydmVyJyxcclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHJlc3VsdCAmJiB0eXBlb2YgcmVzdWx0ID09PSAnb2JqZWN0JyAmJiAnc3VjY2VzcycgaW4gcmVzdWx0KSB7XHJcbiAgICAgIGlmIChyZXN1bHQuc3VjY2VzcyA9PT0gZmFsc2UpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICBlcnJvcjogcmVzdWx0LmVycm9yIHx8ICdGYWlsZWQgdG8gcmVkZWVtIHZvdWNoZXInLFxyXG4gICAgICAgIH07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICBhbW91bnQ6IHJlc3VsdC5hbW91bnQsXHJcbiAgICAgICAgbmV3QmFsYW5jZTogcmVzdWx0Lm5ld19iYWxhbmNlLFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogJ1VuZXhwZWN0ZWQgcmVzcG9uc2UgZnJvbSBzZXJ2ZXInLFxyXG4gICAgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gcmVkZWVtVm91Y2hlcjonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byByZWRlZW0gdm91Y2hlcicsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFZvdWNoZXJSZWRlbXB0aW9ucyhcclxuICBlbWFpbDogc3RyaW5nLFxyXG4gIHBob25lPzogc3RyaW5nXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgcmVkZW1wdGlvbnM/OiBWb3VjaGVyUmVkZW1wdGlvbltdO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgbGV0IHF1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ3ZvdWNoZXJfcmVkZW1wdGlvbnMnKVxyXG4gICAgICAuc2VsZWN0KCdpZCwgdm91Y2hlcl9jb2RlLCBhbW91bnQsIHJlZGVlbWVkX2F0LCBib29raW5nX2lkJylcclxuICAgICAgLm9yZGVyKCdyZWRlZW1lZF9hdCcsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KTtcclxuXHJcbiAgICAvLyBCdWlsZCBxdWVyeSBmb3IgZW1haWwvcGhvbmUgbG9va3VwXHJcbiAgICAvLyBQcmlvcml0aXplIGVtYWlsIGFzIGl0J3MgdGhlIHByaW1hcnkgaWRlbnRpZmllciB0byBwcmV2ZW50IGNyb3NzLWFjY291bnQgdmlzaWJpbGl0eVxyXG4gICAgaWYgKGVtYWlsKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ2VtYWlsJywgZW1haWwpO1xyXG4gICAgICAvLyBJZiBwaG9uZSBpcyBhbHNvIHByb3ZpZGVkLCB3ZSBjYW4gb3B0aW9uYWxseSBmaWx0ZXIgYnkgYm90aCBmb3IgZXh0cmEgc2VjdXJpdHlcclxuICAgICAgLy8gYnV0IGVtYWlsIGFsb25lIHNob3VsZCBiZSBzdWZmaWNpZW50IHNpbmNlIGl0J3MgdW5pcXVlXHJcbiAgICB9IGVsc2UgaWYgKHBob25lKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ3Bob25lJywgcGhvbmUpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRW1haWwgb3IgcGhvbmUgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgcXVlcnk7XHJcblxyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIHZvdWNoZXIgcmVkZW1wdGlvbnM6JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBUcmFuc2Zvcm0gdGhlIGRhdGEgdG8gbWF0Y2ggdGhlIGludGVyZmFjZVxyXG4gICAgY29uc3QgcmVkZW1wdGlvbnM6IFZvdWNoZXJSZWRlbXB0aW9uW10gPSAoZGF0YSB8fCBbXSkubWFwKChyZWRlbXB0aW9uKSA9PiAoe1xyXG4gICAgICBpZDogcmVkZW1wdGlvbi5pZCxcclxuICAgICAgdm91Y2hlcl9jb2RlOiByZWRlbXB0aW9uLnZvdWNoZXJfY29kZSxcclxuICAgICAgYW1vdW50OiByZWRlbXB0aW9uLmFtb3VudCxcclxuICAgICAgcmVkZWVtZWRfYXQ6IHJlZGVtcHRpb24ucmVkZWVtZWRfYXQsXHJcbiAgICAgIGJvb2tpbmdfaWQ6IHJlZGVtcHRpb24uYm9va2luZ19pZCB8fCB1bmRlZmluZWQsXHJcbiAgICB9KSk7XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcmVkZW1wdGlvbnMgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gZ2V0Vm91Y2hlclJlZGVtcHRpb25zOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGZldGNoIHZvdWNoZXIgcmVkZW1wdGlvbnMnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiK1JBa3RCc0IsaU1BQUEifQ==
}),
"[project]/app/dashboard/data:9251d0 [app-ssr] (ecmascript) <text/javascript>", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "getAuthenticatedUser",
    ()=>$$RSC_SERVER_ACTION_0
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-ssr] (ecmascript)");
/* __next_internal_action_entry_do_not_use__ [{"00d62cc413d9b16ce2ea0ff37e9486d3704f49d049":"getAuthenticatedUser"},"app/dashboard/actions.ts",""] */ "use turbopack no side effects";
;
const $$RSC_SERVER_ACTION_0 = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["createServerReference"])("00d62cc413d9b16ce2ea0ff37e9486d3704f49d049", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["findSourceMapURL"], "getAuthenticatedUser");
;
 //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vYWN0aW9ucy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHNlcnZlcic7XHJcblxyXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAL2xpYi9zdXBhYmFzZS9zZXJ2ZXInO1xyXG5pbXBvcnQgeyBCb29raW5nIH0gZnJvbSAnQC90eXBlcy9ib29raW5nJztcclxuaW1wb3J0IHsgUHJvZmlsZSwgUHJvZmlsZVVwZGF0ZUlucHV0IH0gZnJvbSAnQC90eXBlcy9wcm9maWxlJztcclxuaW1wb3J0IHsgTG9jYXRpb24sIExvY2F0aW9uQ3JlYXRlSW5wdXQsIExvY2F0aW9uVXBkYXRlSW5wdXQgfSBmcm9tICdAL3R5cGVzL2xvY2F0aW9uJztcclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBdXRoZW50aWNhdGVkVXNlcigpOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGVtYWlsPzogc3RyaW5nO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcbiAgICBjb25zdCB7IGRhdGE6IHsgdXNlciB9LCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XHJcblxyXG4gICAgaWYgKGVycm9yIHx8ICF1c2VyKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ05vdCBhdXRoZW50aWNhdGVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGVtYWlsOiB1c2VyLmVtYWlsIHx8IHVuZGVmaW5lZCB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBnZXRBdXRoZW50aWNhdGVkVXNlcjonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBnZXQgdXNlcicsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEN1c3RvbWVyQm9va2luZ3MoXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBwaG9uZT86IHN0cmluZyxcclxuICBmaWx0ZXI/OiAnYWxsJyB8ICd1cGNvbWluZycgfCAnY29tcGxldGVkJyB8ICdjYW5jZWxsZWQnXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgYm9va2luZ3M/OiBCb29raW5nW107XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICBsZXQgcXVlcnkgPSBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnYm9va2luZ3MnKVxyXG4gICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgLm9yZGVyKCdzZXJ2aWNlX2RhdGUnLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcclxuICAgICAgLm9yZGVyKCdjcmVhdGVkX2F0JywgeyBhc2NlbmRpbmc6IGZhbHNlIH0pO1xyXG5cclxuICAgIC8vIEJ1aWxkIHF1ZXJ5IGZvciBlbWFpbC9waG9uZSBsb29rdXBcclxuICAgIGlmIChlbWFpbCAmJiBwaG9uZSkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5Lm9yKGBjdXN0b21lcl9lbWFpbC5lcS4ke2VtYWlsfSxjdXN0b21lcl9waG9uZS5lcS4ke3Bob25lfWApO1xyXG4gICAgfSBlbHNlIGlmIChlbWFpbCkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdjdXN0b21lcl9lbWFpbCcsIGVtYWlsKTtcclxuICAgIH0gZWxzZSBpZiAocGhvbmUpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnY3VzdG9tZXJfcGhvbmUnLCBwaG9uZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdFbWFpbCBvciBwaG9uZSBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBBcHBseSBzdGF0dXMgZmlsdGVyXHJcbiAgICBpZiAoZmlsdGVyICYmIGZpbHRlciAhPT0gJ2FsbCcpIHtcclxuICAgICAgaWYgKGZpbHRlciA9PT0gJ3VwY29taW5nJykge1xyXG4gICAgICAgIHF1ZXJ5ID0gcXVlcnkuaW4oJ3N0YXR1cycsIFsncGVuZGluZycsICdjb25maXJtZWQnXSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnc3RhdHVzJywgZmlsdGVyKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHF1ZXJ5O1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBib29raW5nczonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGJvb2tpbmdzOiBkYXRhIHx8IFtdIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGdldEN1c3RvbWVyQm9va2luZ3M6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gZmV0Y2ggYm9va2luZ3MnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDdXN0b21lckJvb2tpbmdTdGF0cyhcclxuICBlbWFpbDogc3RyaW5nLFxyXG4gIHBob25lPzogc3RyaW5nXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgc3RhdHM/OiB7XHJcbiAgICB0b3RhbDogbnVtYmVyO1xyXG4gICAgdXBjb21pbmc6IG51bWJlcjtcclxuICAgIGNvbXBsZXRlZDogbnVtYmVyO1xyXG4gICAgY2FuY2VsbGVkOiBudW1iZXI7XHJcbiAgICB0b3RhbFNwZW50OiBudW1iZXI7XHJcbiAgfTtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIGxldCBxdWVyeSA9IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdib29raW5ncycpXHJcbiAgICAgIC5zZWxlY3QoJ3N0YXR1cywgdG90YWxfYW1vdW50LCBwYXltZW50X3N0YXR1cycpO1xyXG5cclxuICAgIC8vIEJ1aWxkIHF1ZXJ5IGZvciBlbWFpbC9waG9uZSBsb29rdXBcclxuICAgIGlmIChlbWFpbCAmJiBwaG9uZSkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5Lm9yKGBjdXN0b21lcl9lbWFpbC5lcS4ke2VtYWlsfSxjdXN0b21lcl9waG9uZS5lcS4ke3Bob25lfWApO1xyXG4gICAgfSBlbHNlIGlmIChlbWFpbCkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdjdXN0b21lcl9lbWFpbCcsIGVtYWlsKTtcclxuICAgIH0gZWxzZSBpZiAocGhvbmUpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnY3VzdG9tZXJfcGhvbmUnLCBwaG9uZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdFbWFpbCBvciBwaG9uZSBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBxdWVyeTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgc3RhdHMgPSB7XHJcbiAgICAgIHRvdGFsOiBkYXRhPy5sZW5ndGggfHwgMCxcclxuICAgICAgdXBjb21pbmc6IGRhdGE/LmZpbHRlcigoYikgPT4gYi5zdGF0dXMgPT09ICdwZW5kaW5nJyB8fCBiLnN0YXR1cyA9PT0gJ2NvbmZpcm1lZCcpLmxlbmd0aCB8fCAwLFxyXG4gICAgICBjb21wbGV0ZWQ6IGRhdGE/LmZpbHRlcigoYikgPT4gYi5zdGF0dXMgPT09ICdjb21wbGV0ZWQnKS5sZW5ndGggfHwgMCxcclxuICAgICAgY2FuY2VsbGVkOiBkYXRhPy5maWx0ZXIoKGIpID0+IGIuc3RhdHVzID09PSAnY2FuY2VsbGVkJykubGVuZ3RoIHx8IDAsXHJcbiAgICAgIHRvdGFsU3BlbnQ6IGRhdGFcclxuICAgICAgICA/LmZpbHRlcigoYikgPT4gYi5wYXltZW50X3N0YXR1cyA9PT0gJ3BhaWQnKVxyXG4gICAgICAgIC5yZWR1Y2UoKHN1bSwgYikgPT4gc3VtICsgKGIudG90YWxfYW1vdW50IHx8IDApLCAwKSB8fCAwLFxyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBzdGF0cyB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBmZXRjaCBzdGF0cycsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEJvb2tpbmdCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGJvb2tpbmc/OiBCb29raW5nO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2Jvb2tpbmdzJylcclxuICAgICAgLnNlbGVjdCgnKicpXHJcbiAgICAgIC5lcSgnaWQnLCBpZClcclxuICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBib29raW5nOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnQm9va2luZyBub3QgZm91bmQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYm9va2luZzogZGF0YSB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdVbmV4cGVjdGVkIGVycm9yIGZldGNoaW5nIGJvb2tpbmc6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q3VzdG9tZXJQcm9maWxlKFxyXG4gIGVtYWlsOiBzdHJpbmcsXHJcbiAgcGhvbmU/OiBzdHJpbmdcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBwcm9maWxlPzogUHJvZmlsZTtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIEZpcnN0LCB0cnkgdG8gZ2V0IHByb2ZpbGUgZnJvbSBwcm9maWxlcyB0YWJsZVxyXG4gICAgbGV0IHF1ZXJ5ID0gc3VwYWJhc2UuZnJvbSgncHJvZmlsZXMnKS5zZWxlY3QoJyonKTtcclxuXHJcbiAgICBpZiAoZW1haWwpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnZW1haWwnLCBlbWFpbCk7XHJcbiAgICB9IGVsc2UgaWYgKHBob25lKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ3Bob25lJywgcGhvbmUpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRW1haWwgb3IgcGhvbmUgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBkYXRhOiBwcm9maWxlRGF0YSwgZXJyb3I6IHByb2ZpbGVFcnJvciB9ID0gYXdhaXQgcXVlcnkubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgICAvLyBJZiBwcm9maWxlIGV4aXN0cywgcmV0dXJuIGl0XHJcbiAgICBpZiAocHJvZmlsZURhdGEgJiYgIXByb2ZpbGVFcnJvcikge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBwcm9maWxlOiBwcm9maWxlRGF0YSB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIElmIG5vIHByb2ZpbGUgZXhpc3RzLCBkZXJpdmUgZnJvbSBtb3N0IHJlY2VudCBib29raW5nXHJcbiAgICBsZXQgYm9va2luZ1F1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2Jvb2tpbmdzJylcclxuICAgICAgLnNlbGVjdCgnY3VzdG9tZXJfZmlyc3RfbmFtZSwgY3VzdG9tZXJfbGFzdF9uYW1lLCBjdXN0b21lcl9lbWFpbCwgY3VzdG9tZXJfcGhvbmUnKVxyXG4gICAgICAub3JkZXIoJ2NyZWF0ZWRfYXQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcclxuICAgICAgLmxpbWl0KDEpO1xyXG5cclxuICAgIGlmIChlbWFpbCAmJiBwaG9uZSkge1xyXG4gICAgICBib29raW5nUXVlcnkgPSBib29raW5nUXVlcnkub3IoYGN1c3RvbWVyX2VtYWlsLmVxLiR7ZW1haWx9LGN1c3RvbWVyX3Bob25lLmVxLiR7cGhvbmV9YCk7XHJcbiAgICB9IGVsc2UgaWYgKGVtYWlsKSB7XHJcbiAgICAgIGJvb2tpbmdRdWVyeSA9IGJvb2tpbmdRdWVyeS5lcSgnY3VzdG9tZXJfZW1haWwnLCBlbWFpbCk7XHJcbiAgICB9IGVsc2UgaWYgKHBob25lKSB7XHJcbiAgICAgIGJvb2tpbmdRdWVyeSA9IGJvb2tpbmdRdWVyeS5lcSgnY3VzdG9tZXJfcGhvbmUnLCBwaG9uZSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBkYXRhOiBib29raW5nRGF0YSwgZXJyb3I6IGJvb2tpbmdFcnJvciB9ID0gYXdhaXQgYm9va2luZ1F1ZXJ5Lm1heWJlU2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKGJvb2tpbmdFcnJvciB8fCAhYm9va2luZ0RhdGEpIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogJ05vIHByb2ZpbGUgb3IgYm9va2luZyBmb3VuZC4gUGxlYXNlIGNyZWF0ZSBhIGJvb2tpbmcgZmlyc3QuJyxcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDcmVhdGUgYSBwcm9maWxlIG9iamVjdCBmcm9tIGJvb2tpbmcgZGF0YVxyXG4gICAgY29uc3QgZGVyaXZlZFByb2ZpbGU6IFByb2ZpbGUgPSB7XHJcbiAgICAgIGlkOiAnJywgLy8gV2lsbCBiZSBnZW5lcmF0ZWQgd2hlbiBzYXZlZFxyXG4gICAgICBlbWFpbDogYm9va2luZ0RhdGEuY3VzdG9tZXJfZW1haWwsXHJcbiAgICAgIHBob25lOiBib29raW5nRGF0YS5jdXN0b21lcl9waG9uZSB8fCBudWxsLFxyXG4gICAgICBmaXJzdF9uYW1lOiBib29raW5nRGF0YS5jdXN0b21lcl9maXJzdF9uYW1lLFxyXG4gICAgICBsYXN0X25hbWU6IGJvb2tpbmdEYXRhLmN1c3RvbWVyX2xhc3RfbmFtZSxcclxuICAgICAgY3JlYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHByb2ZpbGU6IGRlcml2ZWRQcm9maWxlIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGdldEN1c3RvbWVyUHJvZmlsZTonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBmZXRjaCBwcm9maWxlJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBsb2FkUHJvZmlsZVBpY3R1cmUoXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBmaWxlOiBGaWxlXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgdXJsPzogc3RyaW5nO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgLy8gVmFsaWRhdGUgZmlsZVxyXG4gICAgaWYgKCFmaWxlKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ05vIGZpbGUgcHJvdmlkZWQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVmFsaWRhdGUgZmlsZSB0eXBlXHJcbiAgICBjb25zdCB2YWxpZEltYWdlVHlwZXMgPSBbJ2ltYWdlL2pwZWcnLCAnaW1hZ2UvanBnJywgJ2ltYWdlL3BuZycsICdpbWFnZS93ZWJwJ107XHJcbiAgICBpZiAoIXZhbGlkSW1hZ2VUeXBlcy5pbmNsdWRlcyhmaWxlLnR5cGUpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ludmFsaWQgZmlsZSB0eXBlLiBQbGVhc2UgdXBsb2FkIGEgSlBFRywgUE5HLCBvciBXZWJQIGltYWdlLicgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBWYWxpZGF0ZSBmaWxlIHNpemUgKG1heCA1TUIpXHJcbiAgICBjb25zdCBtYXhTaXplID0gNSAqIDEwMjQgKiAxMDI0OyAvLyA1TUIgaW4gYnl0ZXNcclxuICAgIGlmIChmaWxlLnNpemUgPiBtYXhTaXplKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ZpbGUgc2l6ZSB0b28gbGFyZ2UuIFBsZWFzZSB1cGxvYWQgYW4gaW1hZ2Ugc21hbGxlciB0aGFuIDVNQi4nIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gR2VuZXJhdGUgdW5pcXVlIGZpbGVuYW1lIHVzaW5nIGVtYWlsIGFuZCB0aW1lc3RhbXBcclxuICAgIGNvbnN0IGZpbGVFeHQgPSBmaWxlLm5hbWUuc3BsaXQoJy4nKS5wb3AoKTtcclxuICAgIGNvbnN0IGZpbGVOYW1lID0gYCR7ZW1haWwucmVwbGFjZSgvW15hLXpBLVowLTldL2csICdfJyl9XyR7RGF0ZS5ub3coKX0uJHtmaWxlRXh0fWA7XHJcbiAgICBjb25zdCBmaWxlUGF0aCA9IGBhdmF0YXJzLyR7ZmlsZU5hbWV9YDtcclxuXHJcbiAgICAvLyBDb252ZXJ0IEZpbGUgdG8gQXJyYXlCdWZmZXIgZm9yIHVwbG9hZFxyXG4gICAgY29uc3QgYXJyYXlCdWZmZXIgPSBhd2FpdCBmaWxlLmFycmF5QnVmZmVyKCk7XHJcbiAgICBjb25zdCBidWZmZXIgPSBCdWZmZXIuZnJvbShhcnJheUJ1ZmZlcik7XHJcblxyXG4gICAgLy8gVXBsb2FkIHRvIFN1cGFiYXNlIFN0b3JhZ2VcclxuICAgIGNvbnN0IHsgZGF0YTogdXBsb2FkRGF0YSwgZXJyb3I6IHVwbG9hZEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5zdG9yYWdlXHJcbiAgICAgIC5mcm9tKCdwcm9maWxlLXBpY3R1cmVzJylcclxuICAgICAgLnVwbG9hZChmaWxlUGF0aCwgYnVmZmVyLCB7XHJcbiAgICAgICAgY29udGVudFR5cGU6IGZpbGUudHlwZSxcclxuICAgICAgICB1cHNlcnQ6IGZhbHNlLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICBpZiAodXBsb2FkRXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBsb2FkaW5nIGZpbGU6JywgdXBsb2FkRXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHVwbG9hZEVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBHZXQgcHVibGljIFVSTFxyXG4gICAgY29uc3QgeyBkYXRhOiB1cmxEYXRhIH0gPSBzdXBhYmFzZS5zdG9yYWdlXHJcbiAgICAgIC5mcm9tKCdwcm9maWxlLXBpY3R1cmVzJylcclxuICAgICAgLmdldFB1YmxpY1VybChmaWxlUGF0aCk7XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdXJsOiB1cmxEYXRhLnB1YmxpY1VybCB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiB1cGxvYWRQcm9maWxlUGljdHVyZTonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byB1cGxvYWQgcHJvZmlsZSBwaWN0dXJlJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZGVsZXRlUHJvZmlsZVBpY3R1cmUoZW1haWw6IHN0cmluZywgYXZhdGFyVXJsOiBzdHJpbmcpOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgLy8gRXh0cmFjdCBmaWxlIHBhdGggZnJvbSBVUkxcclxuICAgIGNvbnN0IHVybFBhcnRzID0gYXZhdGFyVXJsLnNwbGl0KCcvcHJvZmlsZS1waWN0dXJlcy8nKTtcclxuICAgIGlmICh1cmxQYXJ0cy5sZW5ndGggPCAyKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ludmFsaWQgYXZhdGFyIFVSTCcgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBmaWxlUGF0aCA9IGBhdmF0YXJzLyR7dXJsUGFydHNbMV0uc3BsaXQoJy8nKS5wb3AoKX1gO1xyXG5cclxuICAgIC8vIERlbGV0ZSBmcm9tIHN0b3JhZ2VcclxuICAgIGNvbnN0IHsgZXJyb3I6IGRlbGV0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5zdG9yYWdlXHJcbiAgICAgIC5mcm9tKCdwcm9maWxlLXBpY3R1cmVzJylcclxuICAgICAgLnJlbW92ZShbZmlsZVBhdGhdKTtcclxuXHJcbiAgICBpZiAoZGVsZXRlRXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZGVsZXRpbmcgZmlsZTonLCBkZWxldGVFcnJvcik7XHJcbiAgICAgIC8vIERvbid0IGZhaWwgaWYgZmlsZSBkb2Vzbid0IGV4aXN0XHJcbiAgICAgIGlmIChkZWxldGVFcnJvci5tZXNzYWdlLmluY2x1ZGVzKCdub3QgZm91bmQnKSkge1xyXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGRlbGV0ZUVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGRlbGV0ZVByb2ZpbGVQaWN0dXJlOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGRlbGV0ZSBwcm9maWxlIHBpY3R1cmUnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGRhdGVDdXN0b21lclByb2ZpbGUoXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBkYXRhOiBQcm9maWxlVXBkYXRlSW5wdXRcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBwcm9maWxlPzogUHJvZmlsZTtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIFZhbGlkYXRlIGlucHV0XHJcbiAgICBpZiAoIWRhdGEuZmlyc3RfbmFtZT8udHJpbSgpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ZpcnN0IG5hbWUgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcbiAgICBpZiAoIWRhdGEubGFzdF9uYW1lPy50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTGFzdCBuYW1lIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG4gICAgaWYgKCFkYXRhLmVtYWlsPy50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRW1haWwgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcbiAgICBpZiAoIS9eW15cXHNAXStAW15cXHNAXStcXC5bXlxcc0BdKyQvLnRlc3QoZGF0YS5lbWFpbCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnSW52YWxpZCBlbWFpbCBmb3JtYXQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ2hlY2sgaWYgcHJvZmlsZSBleGlzdHNcclxuICAgIGNvbnN0IHsgZGF0YTogZXhpc3RpbmdQcm9maWxlIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgLmVxKCdlbWFpbCcsIGVtYWlsKVxyXG4gICAgICAubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgICAvLyBJZiBhdmF0YXJfdXJsIGlzIGJlaW5nIHJlbW92ZWQsIGRlbGV0ZSB0aGUgb2xkIGZpbGVcclxuICAgIGlmIChleGlzdGluZ1Byb2ZpbGU/LmF2YXRhcl91cmwgJiYgZGF0YS5hdmF0YXJfdXJsID09PSBudWxsKSB7XHJcbiAgICAgIGF3YWl0IGRlbGV0ZVByb2ZpbGVQaWN0dXJlKGVtYWlsLCBleGlzdGluZ1Byb2ZpbGUuYXZhdGFyX3VybCk7XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IHJlc3VsdDtcclxuICAgIGlmIChleGlzdGluZ1Byb2ZpbGUpIHtcclxuICAgICAgLy8gVXBkYXRlIGV4aXN0aW5nIHByb2ZpbGVcclxuICAgICAgLy8gSWYgZW1haWwgY2hhbmdlZCwgd2UgbmVlZCB0byBoYW5kbGUgaXQgY2FyZWZ1bGx5XHJcbiAgICAgIGlmIChkYXRhLmVtYWlsICE9PSBlbWFpbCkge1xyXG4gICAgICAgIC8vIENoZWNrIGlmIG5ldyBlbWFpbCBhbHJlYWR5IGV4aXN0c1xyXG4gICAgICAgIGNvbnN0IHsgZGF0YTogZW1haWxDaGVjayB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgICAgICAuc2VsZWN0KCdpZCcpXHJcbiAgICAgICAgICAuZXEoJ2VtYWlsJywgZGF0YS5lbWFpbClcclxuICAgICAgICAgIC5tYXliZVNpbmdsZSgpO1xyXG5cclxuICAgICAgICBpZiAoZW1haWxDaGVjaykge1xyXG4gICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRW1haWwgYWxyZWFkeSBleGlzdHMnIH07XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCB1cGRhdGVEYXRhOiBhbnkgPSB7XHJcbiAgICAgICAgZmlyc3RfbmFtZTogZGF0YS5maXJzdF9uYW1lLnRyaW0oKSxcclxuICAgICAgICBsYXN0X25hbWU6IGRhdGEubGFzdF9uYW1lLnRyaW0oKSxcclxuICAgICAgICBlbWFpbDogZGF0YS5lbWFpbC50cmltKCksXHJcbiAgICAgICAgcGhvbmU6IGRhdGEucGhvbmU/LnRyaW0oKSB8fCBudWxsLFxyXG4gICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8vIE9ubHkgdXBkYXRlIGF2YXRhcl91cmwgaWYgaXQncyBwcm92aWRlZFxyXG4gICAgICBpZiAoZGF0YS5hdmF0YXJfdXJsICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICB1cGRhdGVEYXRhLmF2YXRhcl91cmwgPSBkYXRhLmF2YXRhcl91cmw7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IHsgZGF0YTogdXBkYXRlZFByb2ZpbGUsIGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgIC51cGRhdGUodXBkYXRlRGF0YSlcclxuICAgICAgICAuZXEoJ2VtYWlsJywgZW1haWwpXHJcbiAgICAgICAgLnNlbGVjdCgpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgaWYgKHVwZGF0ZUVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBkYXRpbmcgcHJvZmlsZTonLCB1cGRhdGVFcnJvcik7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB1cGRhdGVFcnJvci5tZXNzYWdlIH07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJlc3VsdCA9IHVwZGF0ZWRQcm9maWxlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8gQ3JlYXRlIG5ldyBwcm9maWxlXHJcbiAgICAgIGNvbnN0IGluc2VydERhdGE6IGFueSA9IHtcclxuICAgICAgICBlbWFpbDogZGF0YS5lbWFpbC50cmltKCksXHJcbiAgICAgICAgcGhvbmU6IGRhdGEucGhvbmU/LnRyaW0oKSB8fCBudWxsLFxyXG4gICAgICAgIGZpcnN0X25hbWU6IGRhdGEuZmlyc3RfbmFtZS50cmltKCksXHJcbiAgICAgICAgbGFzdF9uYW1lOiBkYXRhLmxhc3RfbmFtZS50cmltKCksXHJcbiAgICAgIH07XHJcblxyXG4gICAgICAvLyBPbmx5IHNldCBhdmF0YXJfdXJsIGlmIGl0J3MgcHJvdmlkZWRcclxuICAgICAgaWYgKGRhdGEuYXZhdGFyX3VybCkge1xyXG4gICAgICAgIGluc2VydERhdGEuYXZhdGFyX3VybCA9IGRhdGEuYXZhdGFyX3VybDtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgeyBkYXRhOiBuZXdQcm9maWxlLCBlcnJvcjogaW5zZXJ0RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcclxuICAgICAgICAuaW5zZXJ0KGluc2VydERhdGEpXHJcbiAgICAgICAgLnNlbGVjdCgpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgaWYgKGluc2VydEVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYXRpbmcgcHJvZmlsZTonLCBpbnNlcnRFcnJvcik7XHJcbiAgICAgICAgLy8gQ2hlY2sgaWYgaXQncyBhIHVuaXF1ZSBjb25zdHJhaW50IHZpb2xhdGlvblxyXG4gICAgICAgIGlmIChpbnNlcnRFcnJvci5jb2RlID09PSAnMjM1MDUnKSB7XHJcbiAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdFbWFpbCBhbHJlYWR5IGV4aXN0cycgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBpbnNlcnRFcnJvci5tZXNzYWdlIH07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJlc3VsdCA9IG5ld1Byb2ZpbGU7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcHJvZmlsZTogcmVzdWx0IH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHVwZGF0ZUN1c3RvbWVyUHJvZmlsZTonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byB1cGRhdGUgcHJvZmlsZScsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEN1c3RvbWVyTG9jYXRpb25zKFxyXG4gIGVtYWlsOiBzdHJpbmcsXHJcbiAgcGhvbmU/OiBzdHJpbmdcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBsb2NhdGlvbnM/OiBMb2NhdGlvbltdO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgbGV0IHF1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2xvY2F0aW9ucycpXHJcbiAgICAgIC5zZWxlY3QoJyonKVxyXG4gICAgICAub3JkZXIoJ2lzX2RlZmF1bHQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcclxuICAgICAgLm9yZGVyKCdjcmVhdGVkX2F0JywgeyBhc2NlbmRpbmc6IGZhbHNlIH0pO1xyXG5cclxuICAgIC8vIEJ1aWxkIHF1ZXJ5IGZvciBlbWFpbC9waG9uZSBsb29rdXBcclxuICAgIGlmIChlbWFpbCAmJiBwaG9uZSkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5Lm9yKGBjdXN0b21lcl9lbWFpbC5lcS4ke2VtYWlsfSxjdXN0b21lcl9waG9uZS5lcS4ke3Bob25lfWApO1xyXG4gICAgfSBlbHNlIGlmIChlbWFpbCkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdjdXN0b21lcl9lbWFpbCcsIGVtYWlsKTtcclxuICAgIH0gZWxzZSBpZiAocGhvbmUpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnY3VzdG9tZXJfcGhvbmUnLCBwaG9uZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdFbWFpbCBvciBwaG9uZSBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBxdWVyeTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgbG9jYXRpb25zOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgbG9jYXRpb25zOiBkYXRhIHx8IFtdIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGdldEN1c3RvbWVyTG9jYXRpb25zOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGZldGNoIGxvY2F0aW9ucycsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUxvY2F0aW9uKFxyXG4gIGVtYWlsOiBzdHJpbmcsXHJcbiAgcGhvbmU6IHN0cmluZyB8IHVuZGVmaW5lZCxcclxuICBsb2NhdGlvbkRhdGE6IExvY2F0aW9uQ3JlYXRlSW5wdXRcclxuKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBsb2NhdGlvbj86IExvY2F0aW9uO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgLy8gVmFsaWRhdGUgaW5wdXRcclxuICAgIGlmICghbG9jYXRpb25EYXRhLm5pY2tuYW1lPy50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTmlja25hbWUgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcbiAgICBpZiAoIWxvY2F0aW9uRGF0YS5hZGRyZXNzPy50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnQWRkcmVzcyBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuICAgIGlmICghbG9jYXRpb25EYXRhLnN1YnVyYj8udHJpbSgpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ1N1YnVyYiBpcyByZXF1aXJlZCcgfTtcclxuICAgIH1cclxuICAgIGlmICghbG9jYXRpb25EYXRhLmNpdHk/LnRyaW0oKSkge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdDaXR5IGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIElmIHNldHRpbmcgYXMgZGVmYXVsdCwgdW5zZXQgYWxsIG90aGVyIGRlZmF1bHRzIGZvciB0aGlzIGN1c3RvbWVyXHJcbiAgICBpZiAobG9jYXRpb25EYXRhLmlzX2RlZmF1bHQpIHtcclxuICAgICAgbGV0IHVwZGF0ZVF1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgnbG9jYXRpb25zJylcclxuICAgICAgICAudXBkYXRlKHsgaXNfZGVmYXVsdDogZmFsc2UgfSk7XHJcblxyXG4gICAgICBpZiAoZW1haWwgJiYgcGhvbmUpIHtcclxuICAgICAgICB1cGRhdGVRdWVyeSA9IHVwZGF0ZVF1ZXJ5Lm9yKGBjdXN0b21lcl9lbWFpbC5lcS4ke2VtYWlsfSxjdXN0b21lcl9waG9uZS5lcS4ke3Bob25lfWApO1xyXG4gICAgICB9IGVsc2UgaWYgKGVtYWlsKSB7XHJcbiAgICAgICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5lcSgnY3VzdG9tZXJfZW1haWwnLCBlbWFpbCk7XHJcbiAgICAgIH0gZWxzZSBpZiAocGhvbmUpIHtcclxuICAgICAgICB1cGRhdGVRdWVyeSA9IHVwZGF0ZVF1ZXJ5LmVxKCdjdXN0b21lcl9waG9uZScsIHBob25lKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgYXdhaXQgdXBkYXRlUXVlcnk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBkYXRhOiBuZXdMb2NhdGlvbiwgZXJyb3I6IGluc2VydEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnbG9jYXRpb25zJylcclxuICAgICAgLmluc2VydCh7XHJcbiAgICAgICAgY3VzdG9tZXJfZW1haWw6IGVtYWlsLFxyXG4gICAgICAgIGN1c3RvbWVyX3Bob25lOiBwaG9uZSB8fCBudWxsLFxyXG4gICAgICAgIG5pY2tuYW1lOiBsb2NhdGlvbkRhdGEubmlja25hbWUudHJpbSgpLFxyXG4gICAgICAgIGFkZHJlc3M6IGxvY2F0aW9uRGF0YS5hZGRyZXNzLnRyaW0oKSxcclxuICAgICAgICBhcHRfdW5pdDogbG9jYXRpb25EYXRhLmFwdF91bml0Py50cmltKCkgfHwgbnVsbCxcclxuICAgICAgICBzdWJ1cmI6IGxvY2F0aW9uRGF0YS5zdWJ1cmIudHJpbSgpLFxyXG4gICAgICAgIGNpdHk6IGxvY2F0aW9uRGF0YS5jaXR5LnRyaW0oKSxcclxuICAgICAgICBwb3N0YWxfY29kZTogbG9jYXRpb25EYXRhLnBvc3RhbF9jb2RlPy50cmltKCkgfHwgbnVsbCxcclxuICAgICAgICBpc19kZWZhdWx0OiBsb2NhdGlvbkRhdGEuaXNfZGVmYXVsdCB8fCBmYWxzZSxcclxuICAgICAgfSlcclxuICAgICAgLnNlbGVjdCgpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoaW5zZXJ0RXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYXRpbmcgbG9jYXRpb246JywgaW5zZXJ0RXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGluc2VydEVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBsb2NhdGlvbjogbmV3TG9jYXRpb24gfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gY3JlYXRlTG9jYXRpb246JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gY3JlYXRlIGxvY2F0aW9uJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlTG9jYXRpb24oXHJcbiAgbG9jYXRpb25JZDogc3RyaW5nLFxyXG4gIGxvY2F0aW9uRGF0YTogTG9jYXRpb25VcGRhdGVJbnB1dFxyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGxvY2F0aW9uPzogTG9jYXRpb247XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICAvLyBWYWxpZGF0ZSBpbnB1dCBpZiBwcm92aWRlZFxyXG4gICAgaWYgKGxvY2F0aW9uRGF0YS5uaWNrbmFtZSAhPT0gdW5kZWZpbmVkICYmICFsb2NhdGlvbkRhdGEubmlja25hbWUudHJpbSgpKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ05pY2tuYW1lIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG4gICAgaWYgKGxvY2F0aW9uRGF0YS5hZGRyZXNzICE9PSB1bmRlZmluZWQgJiYgIWxvY2F0aW9uRGF0YS5hZGRyZXNzLnRyaW0oKSkge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdBZGRyZXNzIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG4gICAgaWYgKGxvY2F0aW9uRGF0YS5zdWJ1cmIgIT09IHVuZGVmaW5lZCAmJiAhbG9jYXRpb25EYXRhLnN1YnVyYi50cmltKCkpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnU3VidXJiIGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG4gICAgaWYgKGxvY2F0aW9uRGF0YS5jaXR5ICE9PSB1bmRlZmluZWQgJiYgIWxvY2F0aW9uRGF0YS5jaXR5LnRyaW0oKSkge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdDaXR5IGlzIHJlcXVpcmVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEdldCBjdXJyZW50IGxvY2F0aW9uIHRvIGNoZWNrIGN1c3RvbWVyIGVtYWlsXHJcbiAgICBjb25zdCB7IGRhdGE6IGN1cnJlbnRMb2NhdGlvbiwgZXJyb3I6IGZldGNoRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdsb2NhdGlvbnMnKVxyXG4gICAgICAuc2VsZWN0KCdjdXN0b21lcl9lbWFpbCwgY3VzdG9tZXJfcGhvbmUnKVxyXG4gICAgICAuZXEoJ2lkJywgbG9jYXRpb25JZClcclxuICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgIGlmIChmZXRjaEVycm9yIHx8ICFjdXJyZW50TG9jYXRpb24pIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTG9jYXRpb24gbm90IGZvdW5kJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIElmIHNldHRpbmcgYXMgZGVmYXVsdCwgdW5zZXQgYWxsIG90aGVyIGRlZmF1bHRzIGZvciB0aGlzIGN1c3RvbWVyXHJcbiAgICBpZiAobG9jYXRpb25EYXRhLmlzX2RlZmF1bHQpIHtcclxuICAgICAgbGV0IHVwZGF0ZVF1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgnbG9jYXRpb25zJylcclxuICAgICAgICAudXBkYXRlKHsgaXNfZGVmYXVsdDogZmFsc2UgfSk7XHJcblxyXG4gICAgICBpZiAoY3VycmVudExvY2F0aW9uLmN1c3RvbWVyX2VtYWlsICYmIGN1cnJlbnRMb2NhdGlvbi5jdXN0b21lcl9waG9uZSkge1xyXG4gICAgICAgIHVwZGF0ZVF1ZXJ5ID0gdXBkYXRlUXVlcnkub3IoYGN1c3RvbWVyX2VtYWlsLmVxLiR7Y3VycmVudExvY2F0aW9uLmN1c3RvbWVyX2VtYWlsfSxjdXN0b21lcl9waG9uZS5lcS4ke2N1cnJlbnRMb2NhdGlvbi5jdXN0b21lcl9waG9uZX1gKTtcclxuICAgICAgfSBlbHNlIGlmIChjdXJyZW50TG9jYXRpb24uY3VzdG9tZXJfZW1haWwpIHtcclxuICAgICAgICB1cGRhdGVRdWVyeSA9IHVwZGF0ZVF1ZXJ5LmVxKCdjdXN0b21lcl9lbWFpbCcsIGN1cnJlbnRMb2NhdGlvbi5jdXN0b21lcl9lbWFpbCk7XHJcbiAgICAgIH0gZWxzZSBpZiAoY3VycmVudExvY2F0aW9uLmN1c3RvbWVyX3Bob25lKSB7XHJcbiAgICAgICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5lcSgnY3VzdG9tZXJfcGhvbmUnLCBjdXJyZW50TG9jYXRpb24uY3VzdG9tZXJfcGhvbmUpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBEb24ndCB1bnNldCB0aGUgY3VycmVudCBsb2NhdGlvblxyXG4gICAgICB1cGRhdGVRdWVyeSA9IHVwZGF0ZVF1ZXJ5Lm5lcSgnaWQnLCBsb2NhdGlvbklkKTtcclxuXHJcbiAgICAgIGF3YWl0IHVwZGF0ZVF1ZXJ5O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEJ1aWxkIHVwZGF0ZSBvYmplY3Qgd2l0aCBvbmx5IHByb3ZpZGVkIGZpZWxkc1xyXG4gICAgY29uc3QgdXBkYXRlRGF0YTogYW55ID0ge1xyXG4gICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICB9O1xyXG5cclxuICAgIGlmIChsb2NhdGlvbkRhdGEubmlja25hbWUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB1cGRhdGVEYXRhLm5pY2tuYW1lID0gbG9jYXRpb25EYXRhLm5pY2tuYW1lLnRyaW0oKTtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuYWRkcmVzcyAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHVwZGF0ZURhdGEuYWRkcmVzcyA9IGxvY2F0aW9uRGF0YS5hZGRyZXNzLnRyaW0oKTtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuYXB0X3VuaXQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB1cGRhdGVEYXRhLmFwdF91bml0ID0gbG9jYXRpb25EYXRhLmFwdF91bml0Py50cmltKCkgfHwgbnVsbDtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuc3VidXJiICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgdXBkYXRlRGF0YS5zdWJ1cmIgPSBsb2NhdGlvbkRhdGEuc3VidXJiLnRyaW0oKTtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuY2l0eSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHVwZGF0ZURhdGEuY2l0eSA9IGxvY2F0aW9uRGF0YS5jaXR5LnRyaW0oKTtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEucG9zdGFsX2NvZGUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB1cGRhdGVEYXRhLnBvc3RhbF9jb2RlID0gbG9jYXRpb25EYXRhLnBvc3RhbF9jb2RlPy50cmltKCkgfHwgbnVsbDtcclxuICAgIH1cclxuICAgIGlmIChsb2NhdGlvbkRhdGEuaXNfZGVmYXVsdCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHVwZGF0ZURhdGEuaXNfZGVmYXVsdCA9IGxvY2F0aW9uRGF0YS5pc19kZWZhdWx0O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgZGF0YTogdXBkYXRlZExvY2F0aW9uLCBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdsb2NhdGlvbnMnKVxyXG4gICAgICAudXBkYXRlKHVwZGF0ZURhdGEpXHJcbiAgICAgIC5lcSgnaWQnLCBsb2NhdGlvbklkKVxyXG4gICAgICAuc2VsZWN0KClcclxuICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgIGlmICh1cGRhdGVFcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciB1cGRhdGluZyBsb2NhdGlvbjonLCB1cGRhdGVFcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogdXBkYXRlRXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGxvY2F0aW9uOiB1cGRhdGVkTG9jYXRpb24gfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gdXBkYXRlTG9jYXRpb246JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gdXBkYXRlIGxvY2F0aW9uJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZGVsZXRlTG9jYXRpb24obG9jYXRpb25JZDogc3RyaW5nKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdsb2NhdGlvbnMnKVxyXG4gICAgICAuZGVsZXRlKClcclxuICAgICAgLmVxKCdpZCcsIGxvY2F0aW9uSWQpO1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBkZWxldGluZyBsb2NhdGlvbjonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gZGVsZXRlTG9jYXRpb246JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gZGVsZXRlIGxvY2F0aW9uJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2V0RGVmYXVsdExvY2F0aW9uKFxyXG4gIGxvY2F0aW9uSWQ6IHN0cmluZyxcclxuICBlbWFpbDogc3RyaW5nLFxyXG4gIHBob25lPzogc3RyaW5nXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgbG9jYXRpb24/OiBMb2NhdGlvbjtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIEdldCBjdXJyZW50IGxvY2F0aW9uIHRvIHZlcmlmeSBvd25lcnNoaXBcclxuICAgIGNvbnN0IHsgZGF0YTogY3VycmVudExvY2F0aW9uLCBlcnJvcjogZmV0Y2hFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2xvY2F0aW9ucycpXHJcbiAgICAgIC5zZWxlY3QoJ2N1c3RvbWVyX2VtYWlsLCBjdXN0b21lcl9waG9uZScpXHJcbiAgICAgIC5lcSgnaWQnLCBsb2NhdGlvbklkKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKGZldGNoRXJyb3IgfHwgIWN1cnJlbnRMb2NhdGlvbikge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdMb2NhdGlvbiBub3QgZm91bmQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVmVyaWZ5IG93bmVyc2hpcFxyXG4gICAgY29uc3QgaXNPd25lciA9IFxyXG4gICAgICBjdXJyZW50TG9jYXRpb24uY3VzdG9tZXJfZW1haWwgPT09IGVtYWlsIHx8XHJcbiAgICAgIChwaG9uZSAmJiBjdXJyZW50TG9jYXRpb24uY3VzdG9tZXJfcGhvbmUgPT09IHBob25lKTtcclxuXHJcbiAgICBpZiAoIWlzT3duZXIpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnVW5hdXRob3JpemVkJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFVuc2V0IGFsbCBvdGhlciBkZWZhdWx0cyBmb3IgdGhpcyBjdXN0b21lclxyXG4gICAgbGV0IHVwZGF0ZVF1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2xvY2F0aW9ucycpXHJcbiAgICAgIC51cGRhdGUoeyBpc19kZWZhdWx0OiBmYWxzZSB9KTtcclxuXHJcbiAgICBpZiAoZW1haWwgJiYgcGhvbmUpIHtcclxuICAgICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5vcihgY3VzdG9tZXJfZW1haWwuZXEuJHtlbWFpbH0sY3VzdG9tZXJfcGhvbmUuZXEuJHtwaG9uZX1gKTtcclxuICAgIH0gZWxzZSBpZiAoZW1haWwpIHtcclxuICAgICAgdXBkYXRlUXVlcnkgPSB1cGRhdGVRdWVyeS5lcSgnY3VzdG9tZXJfZW1haWwnLCBlbWFpbCk7XHJcbiAgICB9IGVsc2UgaWYgKHBob25lKSB7XHJcbiAgICAgIHVwZGF0ZVF1ZXJ5ID0gdXBkYXRlUXVlcnkuZXEoJ2N1c3RvbWVyX3Bob25lJywgcGhvbmUpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIERvbid0IHVuc2V0IHRoZSBjdXJyZW50IGxvY2F0aW9uXHJcbiAgICB1cGRhdGVRdWVyeSA9IHVwZGF0ZVF1ZXJ5Lm5lcSgnaWQnLCBsb2NhdGlvbklkKTtcclxuXHJcbiAgICBhd2FpdCB1cGRhdGVRdWVyeTtcclxuXHJcbiAgICAvLyBTZXQgdGhpcyBsb2NhdGlvbiBhcyBkZWZhdWx0XHJcbiAgICBjb25zdCB7IGRhdGE6IHVwZGF0ZWRMb2NhdGlvbiwgZXJyb3I6IHVwZGF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnbG9jYXRpb25zJylcclxuICAgICAgLnVwZGF0ZSh7IGlzX2RlZmF1bHQ6IHRydWUgfSlcclxuICAgICAgLmVxKCdpZCcsIGxvY2F0aW9uSWQpXHJcbiAgICAgIC5zZWxlY3QoKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKHVwZGF0ZUVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHNldHRpbmcgZGVmYXVsdCBsb2NhdGlvbjonLCB1cGRhdGVFcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogdXBkYXRlRXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGxvY2F0aW9uOiB1cGRhdGVkTG9jYXRpb24gfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gc2V0RGVmYXVsdExvY2F0aW9uOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIHNldCBkZWZhdWx0IGxvY2F0aW9uJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0T3JDcmVhdGVSZWZlcnJhbENvZGUoXHJcbiAgZW1haWw6IHN0cmluZ1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIHJlZmVycmFsQ29kZT86IHN0cmluZztcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIENoZWNrIGlmIHByb2ZpbGUgZXhpc3RzIGFuZCBoYXMgYSByZWZlcnJhbCBjb2RlXHJcbiAgICBjb25zdCB7IGRhdGE6IHByb2ZpbGUsIGVycm9yOiBwcm9maWxlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgIC5zZWxlY3QoJ3JlZmVycmFsX2NvZGUnKVxyXG4gICAgICAuZXEoJ2VtYWlsJywgZW1haWwpXHJcbiAgICAgIC5tYXliZVNpbmdsZSgpO1xyXG5cclxuICAgIGlmIChwcm9maWxlRXJyb3IgJiYgcHJvZmlsZUVycm9yLmNvZGUgIT09ICdQR1JTVDExNicpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgcHJvZmlsZTonLCBwcm9maWxlRXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHByb2ZpbGVFcnJvci5tZXNzYWdlIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gSWYgcHJvZmlsZSBleGlzdHMgYW5kIGhhcyBhIHJlZmVycmFsIGNvZGUsIHJldHVybiBpdFxyXG4gICAgaWYgKHByb2ZpbGU/LnJlZmVycmFsX2NvZGUpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcmVmZXJyYWxDb2RlOiBwcm9maWxlLnJlZmVycmFsX2NvZGUgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBHZW5lcmF0ZSBhIG5ldyByZWZlcnJhbCBjb2RlXHJcbiAgICAvLyBUcnkgdXNpbmcgdGhlIGRhdGFiYXNlIGZ1bmN0aW9uIGZpcnN0LCBidXQgZmFsbGJhY2sgdG8gY2xpZW50LXNpZGUgZ2VuZXJhdGlvblxyXG4gICAgbGV0IGdlbmVyYXRlZENvZGU6IHN0cmluZyB8IG51bGwgPSBudWxsO1xyXG4gICAgXHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB7IGRhdGE6IGRiQ29kZSwgZXJyb3I6IGNvZGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAucnBjKCdnZW5lcmF0ZV9yZWZlcnJhbF9jb2RlJyk7XHJcbiAgICAgIFxyXG4gICAgICBpZiAoIWNvZGVFcnJvciAmJiBkYkNvZGUpIHtcclxuICAgICAgICBnZW5lcmF0ZWRDb2RlID0gZGJDb2RlO1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChycGNFcnJvcikge1xyXG4gICAgICAvLyBSUEMgZnVuY3Rpb24gbWlnaHQgbm90IGV4aXN0IHlldCwgdGhhdCdzIG9rYXlcclxuICAgICAgY29uc29sZS5sb2coJ1JQQyBmdW5jdGlvbiBub3QgYXZhaWxhYmxlLCB1c2luZyBmYWxsYmFjaycpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghZ2VuZXJhdGVkQ29kZSkge1xyXG4gICAgICAvLyBGYWxsYmFjazogZ2VuZXJhdGUgY29kZSBjbGllbnQtc2lkZSBzdHlsZVxyXG4gICAgICBjb25zdCBmYWxsYmFja0NvZGUgPSBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoMiwgOCkudG9VcHBlckNhc2UoKTtcclxuICAgICAgXHJcbiAgICAgIC8vIENoZWNrIGlmIGZhbGxiYWNrIGNvZGUgZXhpc3RzLCByZXRyeSBpZiBpdCBkb2VzXHJcbiAgICAgIGxldCBmaW5hbENvZGUgPSBmYWxsYmFja0NvZGU7XHJcbiAgICAgIGxldCBhdHRlbXB0cyA9IDA7XHJcbiAgICAgIGNvbnN0IG1heEF0dGVtcHRzID0gNTtcclxuXHJcbiAgICAgIHdoaWxlIChhdHRlbXB0cyA8IG1heEF0dGVtcHRzKSB7XHJcbiAgICAgICAgY29uc3QgeyBkYXRhOiBleGlzdGluZyB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgICAgICAuc2VsZWN0KCdpZCcpXHJcbiAgICAgICAgICAuZXEoJ3JlZmVycmFsX2NvZGUnLCBmaW5hbENvZGUpXHJcbiAgICAgICAgICAubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgICAgICAgaWYgKCFleGlzdGluZykge1xyXG4gICAgICAgICAgYnJlYWs7IC8vIENvZGUgaXMgdW5pcXVlXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBHZW5lcmF0ZSBhIG5ldyBjb2RlXHJcbiAgICAgICAgZmluYWxDb2RlID0gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIsIDgpLnRvVXBwZXJDYXNlKCk7XHJcbiAgICAgICAgYXR0ZW1wdHMrKztcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gVXBkYXRlIG9yIGluc2VydCBwcm9maWxlIHdpdGggcmVmZXJyYWwgY29kZVxyXG4gICAgICAvLyBGaXJzdCwgdHJ5IHRvIHVwZGF0ZSBleGlzdGluZyBwcm9maWxlXHJcbiAgICAgIGNvbnN0IHsgZGF0YTogZXhpc3RpbmdQcm9maWxlIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgICAgLnNlbGVjdCgnaWQsIGZpcnN0X25hbWUsIGxhc3RfbmFtZScpXHJcbiAgICAgICAgLmVxKCdlbWFpbCcsIGVtYWlsKVxyXG4gICAgICAgIC5tYXliZVNpbmdsZSgpO1xyXG5cclxuICAgICAgbGV0IHVwZGF0ZWRQcm9maWxlO1xyXG4gICAgICBpZiAoZXhpc3RpbmdQcm9maWxlKSB7XHJcbiAgICAgICAgLy8gVXBkYXRlIGV4aXN0aW5nIHByb2ZpbGVcclxuICAgICAgICBjb25zdCB7IGRhdGE6IHVwZGF0ZWQsIGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgICAgICAudXBkYXRlKHtcclxuICAgICAgICAgICAgcmVmZXJyYWxfY29kZTogZmluYWxDb2RlLFxyXG4gICAgICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgLmVxKCdlbWFpbCcsIGVtYWlsKVxyXG4gICAgICAgICAgLnNlbGVjdCgncmVmZXJyYWxfY29kZScpXHJcbiAgICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICAgIGlmICh1cGRhdGVFcnJvcikge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBkYXRpbmcgcmVmZXJyYWwgY29kZTonLCB1cGRhdGVFcnJvcik7XHJcbiAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHVwZGF0ZUVycm9yLm1lc3NhZ2UgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdXBkYXRlZFByb2ZpbGUgPSB1cGRhdGVkO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEluc2VydCBuZXcgcHJvZmlsZSB3aXRoIHJlZmVycmFsIGNvZGVcclxuICAgICAgICBjb25zdCB7IGRhdGE6IGluc2VydGVkLCBlcnJvcjogaW5zZXJ0RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgICAgLmluc2VydCh7XHJcbiAgICAgICAgICAgIGVtYWlsLFxyXG4gICAgICAgICAgICByZWZlcnJhbF9jb2RlOiBmaW5hbENvZGUsXHJcbiAgICAgICAgICAgIGZpcnN0X25hbWU6IGVtYWlsLnNwbGl0KCdAJylbMF0sXHJcbiAgICAgICAgICAgIGxhc3RfbmFtZTogJycsXHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgLnNlbGVjdCgncmVmZXJyYWxfY29kZScpXHJcbiAgICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICAgIGlmIChpbnNlcnRFcnJvcikge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYXRpbmcgcmVmZXJyYWwgY29kZTonLCBpbnNlcnRFcnJvcik7XHJcbiAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGluc2VydEVycm9yLm1lc3NhZ2UgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdXBkYXRlZFByb2ZpbGUgPSBpbnNlcnRlZDtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcmVmZXJyYWxDb2RlOiB1cGRhdGVkUHJvZmlsZT8ucmVmZXJyYWxfY29kZSB8fCBmaW5hbENvZGUgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBVc2UgdGhlIGdlbmVyYXRlZCBjb2RlIGZyb20gZGF0YWJhc2UgZnVuY3Rpb25cclxuICAgIC8vIFVwZGF0ZSBvciBpbnNlcnQgcHJvZmlsZSB3aXRoIGdlbmVyYXRlZCBjb2RlXHJcbiAgICBjb25zdCB7IGRhdGE6IGV4aXN0aW5nUHJvZmlsZSB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcclxuICAgICAgLnNlbGVjdCgnaWQsIGZpcnN0X25hbWUsIGxhc3RfbmFtZScpXHJcbiAgICAgIC5lcSgnZW1haWwnLCBlbWFpbClcclxuICAgICAgLm1heWJlU2luZ2xlKCk7XHJcblxyXG4gICAgbGV0IHVwZGF0ZWRQcm9maWxlO1xyXG4gICAgaWYgKGV4aXN0aW5nUHJvZmlsZSkge1xyXG4gICAgICAvLyBVcGRhdGUgZXhpc3RpbmcgcHJvZmlsZVxyXG4gICAgICBjb25zdCB7IGRhdGE6IHVwZGF0ZWQsIGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgIC51cGRhdGUoe1xyXG4gICAgICAgICAgcmVmZXJyYWxfY29kZTogZ2VuZXJhdGVkQ29kZSxcclxuICAgICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5lcSgnZW1haWwnLCBlbWFpbClcclxuICAgICAgICAuc2VsZWN0KCdyZWZlcnJhbF9jb2RlJylcclxuICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICBpZiAodXBkYXRlRXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciB1cGRhdGluZyByZWZlcnJhbCBjb2RlOicsIHVwZGF0ZUVycm9yKTtcclxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHVwZGF0ZUVycm9yLm1lc3NhZ2UgfTtcclxuICAgICAgfVxyXG4gICAgICB1cGRhdGVkUHJvZmlsZSA9IHVwZGF0ZWQ7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyBJbnNlcnQgbmV3IHByb2ZpbGUgd2l0aCByZWZlcnJhbCBjb2RlXHJcbiAgICAgIGNvbnN0IHsgZGF0YTogaW5zZXJ0ZWQsIGVycm9yOiBpbnNlcnRFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgIC5pbnNlcnQoe1xyXG4gICAgICAgICAgZW1haWwsXHJcbiAgICAgICAgICByZWZlcnJhbF9jb2RlOiBnZW5lcmF0ZWRDb2RlLFxyXG4gICAgICAgICAgZmlyc3RfbmFtZTogZW1haWwuc3BsaXQoJ0AnKVswXSxcclxuICAgICAgICAgIGxhc3RfbmFtZTogJycsXHJcbiAgICAgICAgfSlcclxuICAgICAgICAuc2VsZWN0KCdyZWZlcnJhbF9jb2RlJylcclxuICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICBpZiAoaW5zZXJ0RXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjcmVhdGluZyByZWZlcnJhbCBjb2RlOicsIGluc2VydEVycm9yKTtcclxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGluc2VydEVycm9yLm1lc3NhZ2UgfTtcclxuICAgICAgfVxyXG4gICAgICB1cGRhdGVkUHJvZmlsZSA9IGluc2VydGVkO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHJlZmVycmFsQ29kZTogdXBkYXRlZFByb2ZpbGU/LnJlZmVycmFsX2NvZGUgfHwgZ2VuZXJhdGVkQ29kZSB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBnZXRPckNyZWF0ZVJlZmVycmFsQ29kZTonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBnZXQgcmVmZXJyYWwgY29kZScsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNlbmRSZWZlcnJhbEludml0ZXMoXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBpbnZpdGVFbWFpbHM6IHN0cmluZ1tdLFxyXG4gIHJlZmVycmFsQ29kZTogc3RyaW5nXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgc2VudD86IG51bWJlcjtcclxuICBlcnJvcj86IHN0cmluZztcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xyXG5cclxuICAgIC8vIFZhbGlkYXRlIGVtYWlsIGFkZHJlc3Nlc1xyXG4gICAgY29uc3QgdmFsaWRFbWFpbHMgPSBpbnZpdGVFbWFpbHNcclxuICAgICAgLm1hcCgoZSkgPT4gZS50cmltKCkpXHJcbiAgICAgIC5maWx0ZXIoKGUpID0+IHtcclxuICAgICAgICBpZiAoIWUpIHJldHVybiBmYWxzZTtcclxuICAgICAgICByZXR1cm4gL15bXlxcc0BdK0BbXlxcc0BdK1xcLlteXFxzQF0rJC8udGVzdChlKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgaWYgKHZhbGlkRW1haWxzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdObyB2YWxpZCBlbWFpbCBhZGRyZXNzZXMgcHJvdmlkZWQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ3JlYXRlIHJlZmVycmFsIHJlY29yZHMgZm9yIHRyYWNraW5nXHJcbiAgICBjb25zdCByZWZlcnJhbFJlY29yZHMgPSB2YWxpZEVtYWlscy5tYXAoKHJlZmVycmVkRW1haWwpID0+ICh7XHJcbiAgICAgIHJlZmVycmVyX2VtYWlsOiBlbWFpbCxcclxuICAgICAgcmVmZXJyZWRfZW1haWw6IHJlZmVycmVkRW1haWwsXHJcbiAgICAgIHJlZmVycmFsX2NvZGU6IHJlZmVycmFsQ29kZSxcclxuICAgICAgc3RhdHVzOiAncGVuZGluZycsXHJcbiAgICB9KSk7XHJcblxyXG4gICAgY29uc3QgeyBlcnJvcjogaW5zZXJ0RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdyZWZlcnJhbHMnKVxyXG4gICAgICAuaW5zZXJ0KHJlZmVycmFsUmVjb3Jkcyk7XHJcblxyXG4gICAgaWYgKGluc2VydEVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIHJlZmVycmFsIHJlY29yZHM6JywgaW5zZXJ0RXJyb3IpO1xyXG4gICAgICAvLyBDb250aW51ZSBldmVuIGlmIGluc2VydCBmYWlscyAtIHdlIHN0aWxsIHdhbnQgdG8gc2VuZCBlbWFpbHNcclxuICAgIH1cclxuXHJcbiAgICAvLyBHZW5lcmF0ZSByZWZlcnJhbCBsaW5rXHJcbiAgICBjb25zdCBiYXNlVXJsID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU0lURV9VUkwgfHwgJ2h0dHBzOi8vc2hhbGVhbi5jby56YSc7XHJcbiAgICBjb25zdCByZWZlcnJhbExpbmsgPSBgJHtiYXNlVXJsfS9ib29raW5nL2RldGFpbHM/cmVmPSR7cmVmZXJyYWxDb2RlfWA7XHJcblxyXG4gICAgLy8gVE9ETzogSW1wbGVtZW50IGFjdHVhbCBlbWFpbCBzZW5kaW5nIHVzaW5nIHlvdXIgZW1haWwgc2VydmljZSAoUmVzZW5kLCBTZW5kR3JpZCwgZXRjLilcclxuICAgIC8vIEZvciBub3csIHdlJ2xsIGp1c3QgbG9nIHRoZSBlbWFpbHMgdGhhdCB3b3VsZCBiZSBzZW50XHJcbiAgICBjb25zb2xlLmxvZygnUmVmZXJyYWwgaW52aXRlcyB0byBzZW5kOicsIHtcclxuICAgICAgZnJvbTogZW1haWwsXHJcbiAgICAgIHRvOiB2YWxpZEVtYWlscyxcclxuICAgICAgcmVmZXJyYWxDb2RlLFxyXG4gICAgICByZWZlcnJhbExpbmssXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBJbiBhIHJlYWwgaW1wbGVtZW50YXRpb24sIHlvdSB3b3VsZCBzZW5kIGVtYWlscyBoZXJlXHJcbiAgICAvLyBFeGFtcGxlIHdpdGggUmVzZW5kOlxyXG4gICAgLy8gYXdhaXQgcmVzZW5kLmVtYWlscy5zZW5kKHtcclxuICAgIC8vICAgZnJvbTogJ1NoYWxlYW4gPG5vcmVwbHlAc2hhbGVhbi5jby56YT4nLFxyXG4gICAgLy8gICB0bzogdmFsaWRFbWFpbHMsXHJcbiAgICAvLyAgIHN1YmplY3Q6ICdZb3VcXCd2ZSBiZWVuIGludml0ZWQgdG8gdHJ5IFNoYWxlYW4gQ2xlYW5pbmcgU2VydmljZXMhJyxcclxuICAgIC8vICAgaHRtbDogYDxwPllvdXIgZnJpZW5kIGhhcyBpbnZpdGVkIHlvdSB0byB0cnkgU2hhbGVhbi4gVXNlIGNvZGUgJHtyZWZlcnJhbENvZGV9IHRvIGdldCBSMTUwIG9mZiB5b3VyIGZpcnN0IGJvb2tpbmchPC9wPjxwPjxhIGhyZWY9XCIke3JlZmVycmFsTGlua31cIj5Cb29rIE5vdzwvYT48L3A+YCxcclxuICAgIC8vIH0pO1xyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHNlbnQ6IHZhbGlkRW1haWxzLmxlbmd0aCB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBzZW5kUmVmZXJyYWxJbnZpdGVzOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIHNlbmQgaW52aXRlcycsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFJlZmVycmFsU3RhdHMoXHJcbiAgZW1haWw6IHN0cmluZ1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIHN0YXRzPzoge1xyXG4gICAgdG90YWxSZWZlcnJhbHM6IG51bWJlcjtcclxuICAgIGNvbXBsZXRlZFJlZmVycmFsczogbnVtYmVyO1xyXG4gICAgcGVuZGluZ1Jld2FyZHM6IG51bWJlcjtcclxuICAgIHRvdGFsUmV3YXJkczogbnVtYmVyO1xyXG4gIH07XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuXHJcbiAgICBjb25zdCB7IGRhdGE6IHJlZmVycmFscywgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdyZWZlcnJhbHMnKVxyXG4gICAgICAuc2VsZWN0KCdzdGF0dXMsIHJlZmVycmVyX3Jld2FyZF9hbW91bnQsIHJlZmVycmVyX3Jld2FyZF9zdGF0dXMnKVxyXG4gICAgICAuZXEoJ3JlZmVycmVyX2VtYWlsJywgZW1haWwpO1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyByZWZlcnJhbCBzdGF0czonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHN0YXRzID0ge1xyXG4gICAgICB0b3RhbFJlZmVycmFsczogcmVmZXJyYWxzPy5sZW5ndGggfHwgMCxcclxuICAgICAgY29tcGxldGVkUmVmZXJyYWxzOlxyXG4gICAgICAgIHJlZmVycmFscz8uZmlsdGVyKChyKSA9PiByLnN0YXR1cyA9PT0gJ2NvbXBsZXRlZCcpLmxlbmd0aCB8fCAwLFxyXG4gICAgICBwZW5kaW5nUmV3YXJkczpcclxuICAgICAgICByZWZlcnJhbHM/LmZpbHRlcigocikgPT4gci5yZWZlcnJlcl9yZXdhcmRfc3RhdHVzID09PSAncGVuZGluZycpLmxlbmd0aCB8fCAwLFxyXG4gICAgICB0b3RhbFJld2FyZHM6XHJcbiAgICAgICAgcmVmZXJyYWxzXHJcbiAgICAgICAgICA/LmZpbHRlcigocikgPT4gci5yZWZlcnJlcl9yZXdhcmRfc3RhdHVzID09PSAnY3JlZGl0ZWQnKVxyXG4gICAgICAgICAgLnJlZHVjZSgoc3VtLCByKSA9PiBzdW0gKyAoci5yZWZlcnJlcl9yZXdhcmRfYW1vdW50IHx8IDApLCAwKSB8fCAwLFxyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBzdGF0cyB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBnZXRSZWZlcnJhbFN0YXRzOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGZldGNoIHJlZmVycmFsIHN0YXRzJyxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogSW5pdGlhbGl6ZSBhIGNyZWRpdCBwdXJjaGFzZSB3aXRoIFBheXN0YWNrXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaW5pdGlhbGl6ZUNyZWRpdFB1cmNoYXNlKFxyXG4gIGVtYWlsOiBzdHJpbmcsXHJcbiAgYW1vdW50OiBudW1iZXIsXHJcbiAgcGF5bWVudE1ldGhvZDogJ2NyZWRpdF9jYXJkJyB8ICdlZnQnXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgYXV0aG9yaXphdGlvblVybD86IHN0cmluZztcclxuICByZWZlcmVuY2U/OiBzdHJpbmc7XHJcbiAgZXJyb3I/OiBzdHJpbmc7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgaWYgKGFtb3VudCA8IDIwIHx8IGFtb3VudCA+IDUwMDApIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogJ0Ftb3VudCBtdXN0IGJlIGJldHdlZW4gUjIwIGFuZCBSNTAwMCcsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gR2VuZXJhdGUgYSB1bmlxdWUgcmVmZXJlbmNlIGZvciB0aGlzIGNyZWRpdCBwdXJjaGFzZVxyXG4gICAgY29uc3QgcmVmZXJlbmNlID0gYENSRURJVF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIsIDkpfWA7XHJcblxyXG4gICAgLy8gQ3JlYXRlIGEgcGVuZGluZyBjcmVkaXQgdHJhbnNhY3Rpb25cclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcbiAgICBcclxuICAgIC8vIEdldCBvciBjcmVhdGUgcHJvZmlsZVxyXG4gICAgbGV0IHsgZGF0YTogcHJvZmlsZSB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcclxuICAgICAgLnNlbGVjdCgnaWQsIGNyZWRpdF9iYWxhbmNlJylcclxuICAgICAgLmVxKCdlbWFpbCcsIGVtYWlsKVxyXG4gICAgICAubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoIXByb2ZpbGUpIHtcclxuICAgICAgLy8gQ3JlYXRlIGEgYmFzaWMgcHJvZmlsZSBpZiBpdCBkb2Vzbid0IGV4aXN0XHJcbiAgICAgIGNvbnN0IHsgZGF0YTogbmV3UHJvZmlsZSwgZXJyb3I6IGNyZWF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgICAgLmluc2VydCh7XHJcbiAgICAgICAgICBlbWFpbCxcclxuICAgICAgICAgIGNyZWRpdF9iYWxhbmNlOiAwLFxyXG4gICAgICAgICAgZmlyc3RfbmFtZTogJycsXHJcbiAgICAgICAgICBsYXN0X25hbWU6ICcnLFxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnNlbGVjdCgnaWQsIGNyZWRpdF9iYWxhbmNlJylcclxuICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICBpZiAoY3JlYXRlRXJyb3IgfHwgIW5ld1Byb2ZpbGUpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICBlcnJvcjogJ0ZhaWxlZCB0byBjcmVhdGUgcHJvZmlsZScsXHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG4gICAgICBwcm9maWxlID0gbmV3UHJvZmlsZTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDcmVhdGUgcGVuZGluZyBjcmVkaXQgdHJhbnNhY3Rpb25cclxuICAgIGNvbnN0IHsgZXJyb3I6IHRyYW5zYWN0aW9uRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdjcmVkaXRfdHJhbnNhY3Rpb25zJylcclxuICAgICAgLmluc2VydCh7XHJcbiAgICAgICAgcHJvZmlsZV9pZDogcHJvZmlsZS5pZCxcclxuICAgICAgICBlbWFpbCxcclxuICAgICAgICB0cmFuc2FjdGlvbl90eXBlOiAncHVyY2hhc2UnLFxyXG4gICAgICAgIGFtb3VudCxcclxuICAgICAgICBiYWxhbmNlX2JlZm9yZTogcHJvZmlsZS5jcmVkaXRfYmFsYW5jZSB8fCAwLFxyXG4gICAgICAgIGJhbGFuY2VfYWZ0ZXI6IHByb2ZpbGUuY3JlZGl0X2JhbGFuY2UgfHwgMCwgLy8gV29uJ3QgdXBkYXRlIHVudGlsIHBheW1lbnQgc3VjY2VlZHNcclxuICAgICAgICBwYXltZW50X21ldGhvZDogcGF5bWVudE1ldGhvZCxcclxuICAgICAgICBwYXlzdGFja19yZWZlcmVuY2U6IHJlZmVyZW5jZSxcclxuICAgICAgICBwYXltZW50X3N0YXR1czogJ3BlbmRpbmcnLFxyXG4gICAgICAgIGRlc2NyaXB0aW9uOiBgUHVyY2hhc2Ugb2YgUiR7YW1vdW50fSBTaGFsZWFuQ3JlZGAsXHJcbiAgICAgIH0pO1xyXG5cclxuICAgIGlmICh0cmFuc2FjdGlvbkVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIGNyZWRpdCB0cmFuc2FjdGlvbjonLCB0cmFuc2FjdGlvbkVycm9yKTtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogJ0ZhaWxlZCB0byBjcmVhdGUgdHJhbnNhY3Rpb24gcmVjb3JkJyxcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBJbml0aWFsaXplIFBheXN0YWNrIHBheW1lbnRcclxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goJy9hcGkvcGF5c3RhY2svaW5pdGlhbGl6ZScsIHtcclxuICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxyXG4gICAgICB9LFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgZW1haWwsXHJcbiAgICAgICAgYW1vdW50LFxyXG4gICAgICAgIHJlZmVyZW5jZSxcclxuICAgICAgICBtZXRhZGF0YToge1xyXG4gICAgICAgICAgdHJhbnNhY3Rpb25fdHlwZTogJ2NyZWRpdF9wdXJjaGFzZScsXHJcbiAgICAgICAgICBwYXltZW50X21ldGhvZDogcGF5bWVudE1ldGhvZCxcclxuICAgICAgICB9LFxyXG4gICAgICB9KSxcclxuICAgIH0pO1xyXG5cclxuICAgIGlmICghcmVzcG9uc2Uub2spIHtcclxuICAgICAgY29uc3QgZXJyb3IgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6IGVycm9yLmVycm9yIHx8ICdGYWlsZWQgdG8gaW5pdGlhbGl6ZSBwYXltZW50JyxcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBwYXltZW50RGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcclxuXHJcbiAgICBpZiAoIXBheW1lbnREYXRhLnN0YXR1cykge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIGVycm9yOiBwYXltZW50RGF0YS5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gaW5pdGlhbGl6ZSBwYXltZW50JyxcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICBhdXRob3JpemF0aW9uVXJsOiBwYXltZW50RGF0YS5kYXRhLmF1dGhvcml6YXRpb25fdXJsLFxyXG4gICAgICByZWZlcmVuY2U6IHBheW1lbnREYXRhLmRhdGEucmVmZXJlbmNlLFxyXG4gICAgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW5pdGlhbGl6aW5nIGNyZWRpdCBwdXJjaGFzZTonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBpbml0aWFsaXplIHBheW1lbnQnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgVm91Y2hlclJlZGVtcHRpb24ge1xyXG4gIGlkOiBzdHJpbmc7XHJcbiAgdm91Y2hlcl9jb2RlOiBzdHJpbmc7XHJcbiAgYW1vdW50OiBudW1iZXI7XHJcbiAgcmVkZWVtZWRfYXQ6IHN0cmluZztcclxuICBib29raW5nX2lkPzogc3RyaW5nO1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVkZWVtVm91Y2hlcihcclxuICBjb2RlOiBzdHJpbmcsXHJcbiAgZW1haWw6IHN0cmluZyxcclxuICBwaG9uZT86IHN0cmluZ1xyXG4pOiBQcm9taXNlPHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGFtb3VudD86IG51bWJlcjtcclxuICBuZXdCYWxhbmNlPzogbnVtYmVyO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgLy8gQ2FsbCB0aGUgZGF0YWJhc2UgZnVuY3Rpb24gdG8gcmVkZWVtIHRoZSB2b3VjaGVyXHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5ycGMoJ3JlZGVlbV92b3VjaGVyJywge1xyXG4gICAgICBwX2NvZGU6IGNvZGUudHJpbSgpLnRvVXBwZXJDYXNlKCksXHJcbiAgICAgIHBfZW1haWw6IGVtYWlsLnRyaW0oKSxcclxuICAgICAgcF9waG9uZTogcGhvbmU/LnRyaW0oKSB8fCBudWxsLFxyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHJlZGVlbWluZyB2b3VjaGVyOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZSB8fCAnRmFpbGVkIHRvIHJlZGVlbSB2b3VjaGVyJyxcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBQYXJzZSB0aGUgcmVzdWx0IGZyb20gdGhlIGZ1bmN0aW9uIChoYW5kbGUgYm90aCBvYmplY3QgYW5kIHN0cmluZyBKU09OQilcclxuICAgIGxldCByZXN1bHQgPSBkYXRhO1xyXG4gICAgaWYgKHR5cGVvZiBkYXRhID09PSAnc3RyaW5nJykge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIHJlc3VsdCA9IEpTT04ucGFyc2UoZGF0YSk7XHJcbiAgICAgIH0gY2F0Y2ggKHBhcnNlRXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBwYXJzaW5nIHZvdWNoZXIgcmVkZW1wdGlvbiByZXN1bHQ6JywgcGFyc2VFcnJvcik7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgZXJyb3I6ICdJbnZhbGlkIHJlc3BvbnNlIGZyb20gc2VydmVyJyxcclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHJlc3VsdCAmJiB0eXBlb2YgcmVzdWx0ID09PSAnb2JqZWN0JyAmJiAnc3VjY2VzcycgaW4gcmVzdWx0KSB7XHJcbiAgICAgIGlmIChyZXN1bHQuc3VjY2VzcyA9PT0gZmFsc2UpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICBlcnJvcjogcmVzdWx0LmVycm9yIHx8ICdGYWlsZWQgdG8gcmVkZWVtIHZvdWNoZXInLFxyXG4gICAgICAgIH07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICBhbW91bnQ6IHJlc3VsdC5hbW91bnQsXHJcbiAgICAgICAgbmV3QmFsYW5jZTogcmVzdWx0Lm5ld19iYWxhbmNlLFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogJ1VuZXhwZWN0ZWQgcmVzcG9uc2UgZnJvbSBzZXJ2ZXInLFxyXG4gICAgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gcmVkZWVtVm91Y2hlcjonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byByZWRlZW0gdm91Y2hlcicsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFZvdWNoZXJSZWRlbXB0aW9ucyhcclxuICBlbWFpbDogc3RyaW5nLFxyXG4gIHBob25lPzogc3RyaW5nXHJcbik6IFByb21pc2U8e1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgcmVkZW1wdGlvbnM/OiBWb3VjaGVyUmVkZW1wdGlvbltdO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XHJcblxyXG4gICAgbGV0IHF1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ3ZvdWNoZXJfcmVkZW1wdGlvbnMnKVxyXG4gICAgICAuc2VsZWN0KCdpZCwgdm91Y2hlcl9jb2RlLCBhbW91bnQsIHJlZGVlbWVkX2F0LCBib29raW5nX2lkJylcclxuICAgICAgLm9yZGVyKCdyZWRlZW1lZF9hdCcsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KTtcclxuXHJcbiAgICAvLyBCdWlsZCBxdWVyeSBmb3IgZW1haWwvcGhvbmUgbG9va3VwXHJcbiAgICAvLyBQcmlvcml0aXplIGVtYWlsIGFzIGl0J3MgdGhlIHByaW1hcnkgaWRlbnRpZmllciB0byBwcmV2ZW50IGNyb3NzLWFjY291bnQgdmlzaWJpbGl0eVxyXG4gICAgaWYgKGVtYWlsKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ2VtYWlsJywgZW1haWwpO1xyXG4gICAgICAvLyBJZiBwaG9uZSBpcyBhbHNvIHByb3ZpZGVkLCB3ZSBjYW4gb3B0aW9uYWxseSBmaWx0ZXIgYnkgYm90aCBmb3IgZXh0cmEgc2VjdXJpdHlcclxuICAgICAgLy8gYnV0IGVtYWlsIGFsb25lIHNob3VsZCBiZSBzdWZmaWNpZW50IHNpbmNlIGl0J3MgdW5pcXVlXHJcbiAgICB9IGVsc2UgaWYgKHBob25lKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ3Bob25lJywgcGhvbmUpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRW1haWwgb3IgcGhvbmUgaXMgcmVxdWlyZWQnIH07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgcXVlcnk7XHJcblxyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIHZvdWNoZXIgcmVkZW1wdGlvbnM6JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBUcmFuc2Zvcm0gdGhlIGRhdGEgdG8gbWF0Y2ggdGhlIGludGVyZmFjZVxyXG4gICAgY29uc3QgcmVkZW1wdGlvbnM6IFZvdWNoZXJSZWRlbXB0aW9uW10gPSAoZGF0YSB8fCBbXSkubWFwKChyZWRlbXB0aW9uKSA9PiAoe1xyXG4gICAgICBpZDogcmVkZW1wdGlvbi5pZCxcclxuICAgICAgdm91Y2hlcl9jb2RlOiByZWRlbXB0aW9uLnZvdWNoZXJfY29kZSxcclxuICAgICAgYW1vdW50OiByZWRlbXB0aW9uLmFtb3VudCxcclxuICAgICAgcmVkZWVtZWRfYXQ6IHJlZGVtcHRpb24ucmVkZWVtZWRfYXQsXHJcbiAgICAgIGJvb2tpbmdfaWQ6IHJlZGVtcHRpb24uYm9va2luZ19pZCB8fCB1bmRlZmluZWQsXHJcbiAgICB9KSk7XHJcblxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcmVkZW1wdGlvbnMgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gZ2V0Vm91Y2hlclJlZGVtcHRpb25zOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGZldGNoIHZvdWNoZXIgcmVkZW1wdGlvbnMnLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiaVNBT3NCLGlNQUFBIn0=
}),
"[project]/src/components/ui/badge.tsx [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "Badge",
    ()=>Badge,
    "badgeVariants",
    ()=>badgeVariants
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/ssr/react-jsx-dev-runtime.js [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$class$2d$variance$2d$authority$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/class-variance-authority/dist/index.mjs [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/utils.ts [app-ssr] (ecmascript)");
;
;
;
const badgeVariants = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$class$2d$variance$2d$authority$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["cva"])("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2", {
    variants: {
        variant: {
            default: "border-transparent bg-primary text-primary-foreground hover:bg-primary/80",
            secondary: "border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",
            destructive: "border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",
            outline: "text-foreground"
        }
    },
    defaultVariants: {
        variant: "default"
    }
});
function Badge({ className, variant, ...props }) {
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        className: (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["cn"])(badgeVariants({
            variant
        }), className),
        ...props
    }, void 0, false, {
        fileName: "[project]/src/components/ui/badge.tsx",
        lineNumber: 26,
        columnNumber: 10
    }, this);
}
;
}),
"[project]/app/dashboard/locations/components/LocationCard.tsx [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "LocationCard",
    ()=>LocationCard
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/ssr/react-jsx-dev-runtime.js [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$card$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/ui/card.tsx [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$badge$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/ui/badge.tsx [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$button$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/ui/button.tsx [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$map$2d$pin$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__default__as__MapPin$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/map-pin.js [app-ssr] (ecmascript) <export default as MapPin>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$square$2d$pen$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__default__as__Edit$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/square-pen.js [app-ssr] (ecmascript) <export default as Edit>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$trash$2d$2$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__default__as__Trash2$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/trash-2.js [app-ssr] (ecmascript) <export default as Trash2>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$star$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__default__as__Star$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/star.js [app-ssr] (ecmascript) <export default as Star>");
'use client';
;
;
;
;
;
function LocationCard({ location, onEdit, onDelete, onSetDefault, isDeleting = false }) {
    const fullAddress = [
        location.address,
        location.apt_unit,
        location.suburb,
        location.city,
        location.postal_code
    ].filter(Boolean).join(', ');
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$card$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Card"], {
        className: "hover:shadow-md transition-shadow border-border w-full max-w-full overflow-hidden",
        children: [
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$card$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["CardHeader"], {
                className: "pb-2 px-3 py-3 sm:px-4 sm:py-4 md:px-6 md:py-6",
                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    className: "flex items-start justify-between gap-2",
                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "flex-1 min-w-0",
                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "flex items-center gap-2",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("h3", {
                                    className: "font-semibold text-base sm:text-lg md:text-xl truncate",
                                    children: location.nickname
                                }, void 0, false, {
                                    fileName: "[project]/app/dashboard/locations/components/LocationCard.tsx",
                                    lineNumber: 40,
                                    columnNumber: 15
                                }, this),
                                location.is_default && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$badge$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Badge"], {
                                    className: "bg-primary text-primary-foreground text-xs sm:text-sm px-2 sm:px-3 py-0.5",
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$star$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__default__as__Star$3e$__["Star"], {
                                            className: "w-3 h-3 mr-1"
                                        }, void 0, false, {
                                            fileName: "[project]/app/dashboard/locations/components/LocationCard.tsx",
                                            lineNumber: 45,
                                            columnNumber: 19
                                        }, this),
                                        "Default"
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/app/dashboard/locations/components/LocationCard.tsx",
                                    lineNumber: 44,
                                    columnNumber: 17
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/app/dashboard/locations/components/LocationCard.tsx",
                            lineNumber: 39,
                            columnNumber: 13
                        }, this)
                    }, void 0, false, {
                        fileName: "[project]/app/dashboard/locations/components/LocationCard.tsx",
                        lineNumber: 38,
                        columnNumber: 11
                    }, this)
                }, void 0, false, {
                    fileName: "[project]/app/dashboard/locations/components/LocationCard.tsx",
                    lineNumber: 37,
                    columnNumber: 9
                }, this)
            }, void 0, false, {
                fileName: "[project]/app/dashboard/locations/components/LocationCard.tsx",
                lineNumber: 36,
                columnNumber: 7
            }, this),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$card$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["CardContent"], {
                className: "px-3 pb-3 sm:px-4 sm:pb-4 md:px-6 md:pb-6 pt-0",
                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    className: "space-y-3",
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "flex items-start gap-1.5 sm:gap-2 text-sm sm:text-base",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$map$2d$pin$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__default__as__MapPin$3e$__["MapPin"], {
                                    className: "w-4 h-4 sm:w-5 sm:h-5 text-muted-foreground mt-0.5 flex-shrink-0"
                                }, void 0, false, {
                                    fileName: "[project]/app/dashboard/locations/components/LocationCard.tsx",
                                    lineNumber: 57,
                                    columnNumber: 13
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                    className: "text-muted-foreground break-words leading-relaxed",
                                    children: fullAddress
                                }, void 0, false, {
                                    fileName: "[project]/app/dashboard/locations/components/LocationCard.tsx",
                                    lineNumber: 58,
                                    columnNumber: 13
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/app/dashboard/locations/components/LocationCard.tsx",
                            lineNumber: 56,
                            columnNumber: 11
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "flex flex-wrap gap-2 pt-2 border-t border-border",
                            children: [
                                !location.is_default && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$button$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Button"], {
                                    variant: "outline",
                                    size: "sm",
                                    onClick: ()=>onSetDefault(location.id),
                                    className: "text-xs sm:text-sm h-8 sm:h-9",
                                    disabled: isDeleting,
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$star$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__default__as__Star$3e$__["Star"], {
                                            className: "w-3 h-3 sm:w-4 sm:h-4 mr-1.5"
                                        }, void 0, false, {
                                            fileName: "[project]/app/dashboard/locations/components/LocationCard.tsx",
                                            lineNumber: 73,
                                            columnNumber: 17
                                        }, this),
                                        "Set Default"
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/app/dashboard/locations/components/LocationCard.tsx",
                                    lineNumber: 66,
                                    columnNumber: 15
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$button$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Button"], {
                                    variant: "outline",
                                    size: "sm",
                                    onClick: ()=>onEdit(location),
                                    className: "text-xs sm:text-sm h-8 sm:h-9",
                                    disabled: isDeleting,
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$square$2d$pen$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__default__as__Edit$3e$__["Edit"], {
                                            className: "w-3 h-3 sm:w-4 sm:h-4 mr-1.5"
                                        }, void 0, false, {
                                            fileName: "[project]/app/dashboard/locations/components/LocationCard.tsx",
                                            lineNumber: 84,
                                            columnNumber: 15
                                        }, this),
                                        "Edit"
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/app/dashboard/locations/components/LocationCard.tsx",
                                    lineNumber: 77,
                                    columnNumber: 13
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$button$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Button"], {
                                    variant: "outline",
                                    size: "sm",
                                    onClick: ()=>onDelete(location.id),
                                    className: "text-xs sm:text-sm h-8 sm:h-9 text-destructive hover:text-destructive",
                                    disabled: isDeleting,
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$trash$2d$2$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__default__as__Trash2$3e$__["Trash2"], {
                                            className: "w-3 h-3 sm:w-4 sm:h-4 mr-1.5"
                                        }, void 0, false, {
                                            fileName: "[project]/app/dashboard/locations/components/LocationCard.tsx",
                                            lineNumber: 94,
                                            columnNumber: 15
                                        }, this),
                                        "Delete"
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/app/dashboard/locations/components/LocationCard.tsx",
                                    lineNumber: 87,
                                    columnNumber: 13
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/app/dashboard/locations/components/LocationCard.tsx",
                            lineNumber: 64,
                            columnNumber: 11
                        }, this)
                    ]
                }, void 0, true, {
                    fileName: "[project]/app/dashboard/locations/components/LocationCard.tsx",
                    lineNumber: 54,
                    columnNumber: 9
                }, this)
            }, void 0, false, {
                fileName: "[project]/app/dashboard/locations/components/LocationCard.tsx",
                lineNumber: 53,
                columnNumber: 7
            }, this)
        ]
    }, void 0, true, {
        fileName: "[project]/app/dashboard/locations/components/LocationCard.tsx",
        lineNumber: 35,
        columnNumber: 5
    }, this);
}
}),
"[project]/src/components/ui/label.tsx [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "Label",
    ()=>Label
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/ssr/react-jsx-dev-runtime.js [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/ssr/react.js [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$radix$2d$ui$2f$react$2d$label$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@radix-ui/react-label/dist/index.mjs [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$class$2d$variance$2d$authority$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/class-variance-authority/dist/index.mjs [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/utils.ts [app-ssr] (ecmascript)");
;
;
;
;
;
const labelVariants = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$class$2d$variance$2d$authority$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["cva"])("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70");
const Label = /*#__PURE__*/ __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["forwardRef"](({ className, ...props }, ref)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$radix$2d$ui$2f$react$2d$label$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Root"], {
        ref: ref,
        className: (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["cn"])(labelVariants(), className),
        ...props
    }, void 0, false, {
        fileName: "[project]/src/components/ui/label.tsx",
        lineNumber: 13,
        columnNumber: 3
    }, ("TURBOPACK compile-time value", void 0)));
Label.displayName = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$radix$2d$ui$2f$react$2d$label$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Root"].displayName;
;
}),
"[project]/src/components/ui/checkbox.tsx [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "Checkbox",
    ()=>Checkbox
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/ssr/react-jsx-dev-runtime.js [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/ssr/react.js [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$radix$2d$ui$2f$react$2d$checkbox$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@radix-ui/react-checkbox/dist/index.mjs [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$check$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__default__as__Check$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/check.js [app-ssr] (ecmascript) <export default as Check>");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/utils.ts [app-ssr] (ecmascript)");
;
;
;
;
;
const Checkbox = /*#__PURE__*/ __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["forwardRef"](({ className, ...props }, ref)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$radix$2d$ui$2f$react$2d$checkbox$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Root"], {
        ref: ref,
        className: (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["cn"])("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50", className),
        ...props,
        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$radix$2d$ui$2f$react$2d$checkbox$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Indicator"], {
            className: (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["cn"])("flex items-center justify-center text-current"),
            children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$check$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__default__as__Check$3e$__["Check"], {
                className: "h-4 w-4"
            }, void 0, false, {
                fileName: "[project]/src/components/ui/checkbox.tsx",
                lineNumber: 20,
                columnNumber: 7
            }, ("TURBOPACK compile-time value", void 0))
        }, void 0, false, {
            fileName: "[project]/src/components/ui/checkbox.tsx",
            lineNumber: 19,
            columnNumber: 5
        }, ("TURBOPACK compile-time value", void 0))
    }, void 0, false, {
        fileName: "[project]/src/components/ui/checkbox.tsx",
        lineNumber: 11,
        columnNumber: 3
    }, ("TURBOPACK compile-time value", void 0)));
Checkbox.displayName = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$radix$2d$ui$2f$react$2d$checkbox$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Root"].displayName;
;
}),
"[project]/app/dashboard/locations/components/LocationForm.tsx [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "LocationForm",
    ()=>LocationForm
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/ssr/react-jsx-dev-runtime.js [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/ssr/react.js [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$card$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/ui/card.tsx [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$input$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/ui/input.tsx [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$label$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/ui/label.tsx [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$button$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/ui/button.tsx [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$checkbox$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/ui/checkbox.tsx [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$loader$2d$circle$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__default__as__Loader2$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/loader-circle.js [app-ssr] (ecmascript) <export default as Loader2>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$map$2d$pin$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__default__as__MapPin$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/map-pin.js [app-ssr] (ecmascript) <export default as MapPin>");
'use client';
;
;
;
;
;
;
;
;
function LocationForm({ initialData, onSubmit, onCancel, isLoading = false }) {
    const [formData, setFormData] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])({
        nickname: initialData?.nickname || '',
        address: initialData?.address || '',
        apt_unit: initialData?.apt_unit || '',
        suburb: initialData?.suburb || '',
        city: initialData?.city || '',
        postal_code: initialData?.postal_code || '',
        is_default: initialData?.is_default || false
    });
    const handleSubmit = async (e)=>{
        e.preventDefault();
        // Validation
        if (!formData.nickname.trim()) {
            return;
        }
        if (!formData.address.trim()) {
            return;
        }
        if (!formData.suburb.trim()) {
            return;
        }
        if (!formData.city.trim()) {
            return;
        }
        const submitData = {
            nickname: formData.nickname.trim(),
            address: formData.address.trim(),
            apt_unit: formData.apt_unit.trim() || null,
            suburb: formData.suburb.trim(),
            city: formData.city.trim(),
            postal_code: formData.postal_code.trim() || null,
            is_default: formData.is_default
        };
        await onSubmit(submitData);
    };
    const handleInputChange = (field, value)=>{
        setFormData((prev)=>({
                ...prev,
                [field]: value
            }));
    };
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$card$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Card"], {
        children: [
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$card$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["CardHeader"], {
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$card$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["CardTitle"], {
                        className: "flex items-center gap-2",
                        children: [
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$map$2d$pin$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__default__as__MapPin$3e$__["MapPin"], {
                                className: "w-5 h-5"
                            }, void 0, false, {
                                fileName: "[project]/app/dashboard/locations/components/LocationForm.tsx",
                                lineNumber: 77,
                                columnNumber: 11
                            }, this),
                            initialData ? 'Edit Location' : 'Add New Location'
                        ]
                    }, void 0, true, {
                        fileName: "[project]/app/dashboard/locations/components/LocationForm.tsx",
                        lineNumber: 76,
                        columnNumber: 9
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$card$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["CardDescription"], {
                        children: initialData ? 'Update your location details below.' : 'Save a location for quick access when booking services.'
                    }, void 0, false, {
                        fileName: "[project]/app/dashboard/locations/components/LocationForm.tsx",
                        lineNumber: 80,
                        columnNumber: 9
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/app/dashboard/locations/components/LocationForm.tsx",
                lineNumber: 75,
                columnNumber: 7
            }, this),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$card$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["CardContent"], {
                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("form", {
                    onSubmit: handleSubmit,
                    className: "space-y-4",
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "space-y-2",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$label$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Label"], {
                                    htmlFor: "nickname",
                                    children: "Nickname *"
                                }, void 0, false, {
                                    fileName: "[project]/app/dashboard/locations/components/LocationForm.tsx",
                                    lineNumber: 90,
                                    columnNumber: 13
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$input$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Input"], {
                                    id: "nickname",
                                    placeholder: "e.g., Home, Office, Apartment",
                                    value: formData.nickname,
                                    onChange: (e)=>handleInputChange('nickname', e.target.value),
                                    required: true,
                                    disabled: isLoading
                                }, void 0, false, {
                                    fileName: "[project]/app/dashboard/locations/components/LocationForm.tsx",
                                    lineNumber: 91,
                                    columnNumber: 13
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/app/dashboard/locations/components/LocationForm.tsx",
                            lineNumber: 89,
                            columnNumber: 11
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "space-y-2",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$label$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Label"], {
                                    htmlFor: "address",
                                    children: "Street Address *"
                                }, void 0, false, {
                                    fileName: "[project]/app/dashboard/locations/components/LocationForm.tsx",
                                    lineNumber: 103,
                                    columnNumber: 13
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$input$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Input"], {
                                    id: "address",
                                    placeholder: "123 Main Street",
                                    value: formData.address,
                                    onChange: (e)=>handleInputChange('address', e.target.value),
                                    required: true,
                                    disabled: isLoading
                                }, void 0, false, {
                                    fileName: "[project]/app/dashboard/locations/components/LocationForm.tsx",
                                    lineNumber: 104,
                                    columnNumber: 13
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/app/dashboard/locations/components/LocationForm.tsx",
                            lineNumber: 102,
                            columnNumber: 11
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "space-y-2",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$label$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Label"], {
                                    htmlFor: "apt_unit",
                                    children: "Apartment/Unit"
                                }, void 0, false, {
                                    fileName: "[project]/app/dashboard/locations/components/LocationForm.tsx",
                                    lineNumber: 116,
                                    columnNumber: 13
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$input$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Input"], {
                                    id: "apt_unit",
                                    placeholder: "Apt 4B, Unit 12, etc.",
                                    value: formData.apt_unit,
                                    onChange: (e)=>handleInputChange('apt_unit', e.target.value),
                                    disabled: isLoading
                                }, void 0, false, {
                                    fileName: "[project]/app/dashboard/locations/components/LocationForm.tsx",
                                    lineNumber: 117,
                                    columnNumber: 13
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/app/dashboard/locations/components/LocationForm.tsx",
                            lineNumber: 115,
                            columnNumber: 11
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "grid md:grid-cols-2 gap-4",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "space-y-2",
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$label$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Label"], {
                                            htmlFor: "suburb",
                                            children: "Suburb *"
                                        }, void 0, false, {
                                            fileName: "[project]/app/dashboard/locations/components/LocationForm.tsx",
                                            lineNumber: 129,
                                            columnNumber: 15
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$input$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Input"], {
                                            id: "suburb",
                                            placeholder: "Sandton",
                                            value: formData.suburb,
                                            onChange: (e)=>handleInputChange('suburb', e.target.value),
                                            required: true,
                                            disabled: isLoading
                                        }, void 0, false, {
                                            fileName: "[project]/app/dashboard/locations/components/LocationForm.tsx",
                                            lineNumber: 130,
                                            columnNumber: 15
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/app/dashboard/locations/components/LocationForm.tsx",
                                    lineNumber: 128,
                                    columnNumber: 13
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "space-y-2",
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$label$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Label"], {
                                            htmlFor: "city",
                                            children: "City *"
                                        }, void 0, false, {
                                            fileName: "[project]/app/dashboard/locations/components/LocationForm.tsx",
                                            lineNumber: 140,
                                            columnNumber: 15
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$input$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Input"], {
                                            id: "city",
                                            placeholder: "Johannesburg",
                                            value: formData.city,
                                            onChange: (e)=>handleInputChange('city', e.target.value),
                                            required: true,
                                            disabled: isLoading
                                        }, void 0, false, {
                                            fileName: "[project]/app/dashboard/locations/components/LocationForm.tsx",
                                            lineNumber: 141,
                                            columnNumber: 15
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/app/dashboard/locations/components/LocationForm.tsx",
                                    lineNumber: 139,
                                    columnNumber: 13
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/app/dashboard/locations/components/LocationForm.tsx",
                            lineNumber: 127,
                            columnNumber: 11
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "space-y-2",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$label$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Label"], {
                                    htmlFor: "postal_code",
                                    children: "Postal Code"
                                }, void 0, false, {
                                    fileName: "[project]/app/dashboard/locations/components/LocationForm.tsx",
                                    lineNumber: 154,
                                    columnNumber: 13
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$input$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Input"], {
                                    id: "postal_code",
                                    placeholder: "2196",
                                    value: formData.postal_code,
                                    onChange: (e)=>handleInputChange('postal_code', e.target.value),
                                    disabled: isLoading
                                }, void 0, false, {
                                    fileName: "[project]/app/dashboard/locations/components/LocationForm.tsx",
                                    lineNumber: 155,
                                    columnNumber: 13
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/app/dashboard/locations/components/LocationForm.tsx",
                            lineNumber: 153,
                            columnNumber: 11
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "flex items-center space-x-2 pt-2",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$checkbox$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Checkbox"], {
                                    id: "is_default",
                                    checked: formData.is_default,
                                    onCheckedChange: (checked)=>handleInputChange('is_default', checked === true),
                                    disabled: isLoading
                                }, void 0, false, {
                                    fileName: "[project]/app/dashboard/locations/components/LocationForm.tsx",
                                    lineNumber: 166,
                                    columnNumber: 13
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$label$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Label"], {
                                    htmlFor: "is_default",
                                    className: "text-sm font-normal cursor-pointer",
                                    children: "Set as default location"
                                }, void 0, false, {
                                    fileName: "[project]/app/dashboard/locations/components/LocationForm.tsx",
                                    lineNumber: 172,
                                    columnNumber: 13
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/app/dashboard/locations/components/LocationForm.tsx",
                            lineNumber: 165,
                            columnNumber: 11
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "flex justify-end gap-3 pt-4",
                            children: [
                                onCancel && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$button$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Button"], {
                                    type: "button",
                                    variant: "outline",
                                    onClick: onCancel,
                                    disabled: isLoading,
                                    children: "Cancel"
                                }, void 0, false, {
                                    fileName: "[project]/app/dashboard/locations/components/LocationForm.tsx",
                                    lineNumber: 183,
                                    columnNumber: 15
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$button$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Button"], {
                                    type: "submit",
                                    disabled: isLoading,
                                    children: isLoading ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Fragment"], {
                                        children: [
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$loader$2d$circle$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__default__as__Loader2$3e$__["Loader2"], {
                                                className: "w-4 h-4 mr-2 animate-spin"
                                            }, void 0, false, {
                                                fileName: "[project]/app/dashboard/locations/components/LocationForm.tsx",
                                                lineNumber: 195,
                                                columnNumber: 19
                                            }, this),
                                            initialData ? 'Updating...' : 'Creating...'
                                        ]
                                    }, void 0, true) : initialData ? 'Update Location' : 'Create Location'
                                }, void 0, false, {
                                    fileName: "[project]/app/dashboard/locations/components/LocationForm.tsx",
                                    lineNumber: 192,
                                    columnNumber: 13
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/app/dashboard/locations/components/LocationForm.tsx",
                            lineNumber: 181,
                            columnNumber: 11
                        }, this)
                    ]
                }, void 0, true, {
                    fileName: "[project]/app/dashboard/locations/components/LocationForm.tsx",
                    lineNumber: 87,
                    columnNumber: 9
                }, this)
            }, void 0, false, {
                fileName: "[project]/app/dashboard/locations/components/LocationForm.tsx",
                lineNumber: 86,
                columnNumber: 7
            }, this)
        ]
    }, void 0, true, {
        fileName: "[project]/app/dashboard/locations/components/LocationForm.tsx",
        lineNumber: 74,
        columnNumber: 5
    }, this);
}
}),
"[project]/app/dashboard/locations/page.tsx [app-ssr] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "default",
    ()=>LocationsPage
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/ssr/react-jsx-dev-runtime.js [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/ssr/react.js [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$tanstack$2f$react$2d$query$2f$build$2f$modern$2f$useQuery$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@tanstack/react-query/build/modern/useQuery.js [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$card$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/ui/card.tsx [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$button$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/ui/button.tsx [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$map$2d$pin$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__default__as__MapPin$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/map-pin.js [app-ssr] (ecmascript) <export default as MapPin>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$loader$2d$circle$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__default__as__Loader2$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/loader-circle.js [app-ssr] (ecmascript) <export default as Loader2>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$plus$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__default__as__Plus$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/plus.js [app-ssr] (ecmascript) <export default as Plus>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/sonner/dist/index.mjs [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$dashboard$2f$data$3a$ea305d__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__ = __turbopack_context__.i("[project]/app/dashboard/data:ea305d [app-ssr] (ecmascript) <text/javascript>");
var __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$dashboard$2f$data$3a$bba00b__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__ = __turbopack_context__.i("[project]/app/dashboard/data:bba00b [app-ssr] (ecmascript) <text/javascript>");
var __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$dashboard$2f$data$3a$2709a4__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__ = __turbopack_context__.i("[project]/app/dashboard/data:2709a4 [app-ssr] (ecmascript) <text/javascript>");
var __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$dashboard$2f$data$3a$487a6b__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__ = __turbopack_context__.i("[project]/app/dashboard/data:487a6b [app-ssr] (ecmascript) <text/javascript>");
var __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$dashboard$2f$data$3a$96f648__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__ = __turbopack_context__.i("[project]/app/dashboard/data:96f648 [app-ssr] (ecmascript) <text/javascript>");
var __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$dashboard$2f$data$3a$9251d0__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__ = __turbopack_context__.i("[project]/app/dashboard/data:9251d0 [app-ssr] (ecmascript) <text/javascript>");
var __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$dashboard$2f$locations$2f$components$2f$LocationCard$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/app/dashboard/locations/components/LocationCard.tsx [app-ssr] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$dashboard$2f$locations$2f$components$2f$LocationForm$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/app/dashboard/locations/components/LocationForm.tsx [app-ssr] (ecmascript)");
'use client';
;
;
;
;
;
;
;
;
;
;
function LocationsPage() {
    const [loading, setLoading] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(true);
    const [saving, setSaving] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(false);
    const [deleting, setDeleting] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(null);
    const [locations, setLocations] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])([]);
    const [editingLocation, setEditingLocation] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(null);
    const [showForm, setShowForm] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(false);
    const [userEmail, setUserEmail] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useState"])(null);
    // Get authenticated user's email
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$tanstack$2f$react$2d$query$2f$build$2f$modern$2f$useQuery$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useQuery"])({
        queryKey: [
            'authenticated-user'
        ],
        queryFn: async ()=>{
            const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$dashboard$2f$data$3a$9251d0__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["getAuthenticatedUser"])();
            if (result.success && result.email) {
                setUserEmail(result.email);
                return result.email;
            }
            return null;
        },
        staleTime: 5 * 60 * 1000
    });
    // Load locations data when user email is available
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["useEffect"])(()=>{
        const loadLocations = async ()=>{
            if (!userEmail) {
                setLoading(true);
                return;
            }
            try {
                setLoading(true);
                const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$dashboard$2f$data$3a$ea305d__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["getCustomerLocations"])(userEmail);
                if (result.success && result.locations) {
                    setLocations(result.locations);
                } else {
                    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["toast"].error(result.error || 'Failed to load locations');
                }
            } catch (error) {
                console.error('Error loading locations:', error);
                __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["toast"].error('An unexpected error occurred');
            } finally{
                setLoading(false);
            }
        };
        loadLocations();
    // eslint-disable-next-line react-hooks/exhaustive-deps
    }, [
        userEmail
    ]);
    const handleCreateLocation = async (data)=>{
        if (!userEmail) {
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["toast"].error('Please wait for authentication');
            return;
        }
        try {
            setSaving(true);
            const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$dashboard$2f$data$3a$bba00b__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["createLocation"])(userEmail, undefined, data);
            if (result.success && result.location) {
                setLocations((prev)=>[
                        result.location,
                        ...prev
                    ]);
                setShowForm(false);
                setEditingLocation(null);
                __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["toast"].success('Location created successfully!');
            } else {
                __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["toast"].error(result.error || 'Failed to create location');
            }
        } catch (error) {
            console.error('Error creating location:', error);
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["toast"].error('An unexpected error occurred');
        } finally{
            setSaving(false);
        }
    };
    const handleUpdateLocation = async (data)=>{
        if (!editingLocation) return;
        try {
            setSaving(true);
            const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$dashboard$2f$data$3a$2709a4__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["updateLocation"])(editingLocation.id, data);
            if (result.success && result.location) {
                setLocations((prev)=>prev.map((loc)=>loc.id === editingLocation.id ? result.location : loc));
                setShowForm(false);
                setEditingLocation(null);
                __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["toast"].success('Location updated successfully!');
            } else {
                __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["toast"].error(result.error || 'Failed to update location');
            }
        } catch (error) {
            console.error('Error updating location:', error);
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["toast"].error('An unexpected error occurred');
        } finally{
            setSaving(false);
        }
    };
    const handleDeleteLocation = async (locationId)=>{
        if (!confirm('Are you sure you want to delete this location?')) {
            return;
        }
        try {
            setDeleting(locationId);
            const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$dashboard$2f$data$3a$487a6b__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["deleteLocation"])(locationId);
            if (result.success) {
                setLocations((prev)=>prev.filter((loc)=>loc.id !== locationId));
                __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["toast"].success('Location deleted successfully!');
            } else {
                __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["toast"].error(result.error || 'Failed to delete location');
            }
        } catch (error) {
            console.error('Error deleting location:', error);
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["toast"].error('An unexpected error occurred');
        } finally{
            setDeleting(null);
        }
    };
    const handleSetDefault = async (locationId)=>{
        if (!userEmail) {
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["toast"].error('Please wait for authentication');
            return;
        }
        try {
            const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$app$2f$dashboard$2f$data$3a$96f648__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["setDefaultLocation"])(locationId, userEmail);
            if (result.success && result.location) {
                setLocations((prev)=>prev.map((loc)=>({
                            ...loc,
                            is_default: loc.id === locationId
                        })));
                __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["toast"].success('Default location updated!');
            } else {
                __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["toast"].error(result.error || 'Failed to set default location');
            }
        } catch (error) {
            console.error('Error setting default location:', error);
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["toast"].error('An unexpected error occurred');
        }
    };
    const handleEdit = (location)=>{
        setEditingLocation(location);
        setShowForm(true);
    };
    const handleCancelForm = ()=>{
        setShowForm(false);
        setEditingLocation(null);
    };
    const handleNewLocation = ()=>{
        setEditingLocation(null);
        setShowForm(true);
    };
    if (loading || !userEmail) {
        return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
            className: "space-y-6",
            children: [
                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("h1", {
                            className: "text-3xl font-bold",
                            children: "Locations"
                        }, void 0, false, {
                            fileName: "[project]/app/dashboard/locations/page.tsx",
                            lineNumber: 192,
                            columnNumber: 11
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                            className: "text-muted-foreground",
                            children: "Manage your saved locations"
                        }, void 0, false, {
                            fileName: "[project]/app/dashboard/locations/page.tsx",
                            lineNumber: 193,
                            columnNumber: 11
                        }, this)
                    ]
                }, void 0, true, {
                    fileName: "[project]/app/dashboard/locations/page.tsx",
                    lineNumber: 191,
                    columnNumber: 9
                }, this),
                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$card$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Card"], {
                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$card$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["CardContent"], {
                        className: "flex items-center justify-center py-12",
                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$loader$2d$circle$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__default__as__Loader2$3e$__["Loader2"], {
                            className: "w-8 h-8 animate-spin text-muted-foreground"
                        }, void 0, false, {
                            fileName: "[project]/app/dashboard/locations/page.tsx",
                            lineNumber: 197,
                            columnNumber: 13
                        }, this)
                    }, void 0, false, {
                        fileName: "[project]/app/dashboard/locations/page.tsx",
                        lineNumber: 196,
                        columnNumber: 11
                    }, this)
                }, void 0, false, {
                    fileName: "[project]/app/dashboard/locations/page.tsx",
                    lineNumber: 195,
                    columnNumber: 9
                }, this)
            ]
        }, void 0, true, {
            fileName: "[project]/app/dashboard/locations/page.tsx",
            lineNumber: 190,
            columnNumber: 7
        }, this);
    }
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        className: "space-y-6",
        children: [
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "flex items-center justify-between",
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        children: [
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("h1", {
                                className: "text-3xl font-bold",
                                children: "Locations"
                            }, void 0, false, {
                                fileName: "[project]/app/dashboard/locations/page.tsx",
                                lineNumber: 208,
                                columnNumber: 11
                            }, this),
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                className: "text-muted-foreground",
                                children: "Manage your saved locations"
                            }, void 0, false, {
                                fileName: "[project]/app/dashboard/locations/page.tsx",
                                lineNumber: 209,
                                columnNumber: 11
                            }, this)
                        ]
                    }, void 0, true, {
                        fileName: "[project]/app/dashboard/locations/page.tsx",
                        lineNumber: 207,
                        columnNumber: 9
                    }, this),
                    !showForm && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$button$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Button"], {
                        onClick: handleNewLocation,
                        className: "flex items-center gap-2",
                        children: [
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$plus$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__default__as__Plus$3e$__["Plus"], {
                                className: "w-4 h-4"
                            }, void 0, false, {
                                fileName: "[project]/app/dashboard/locations/page.tsx",
                                lineNumber: 213,
                                columnNumber: 13
                            }, this),
                            "Add Location"
                        ]
                    }, void 0, true, {
                        fileName: "[project]/app/dashboard/locations/page.tsx",
                        lineNumber: 212,
                        columnNumber: 11
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/app/dashboard/locations/page.tsx",
                lineNumber: 206,
                columnNumber: 7
            }, this),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "grid lg:grid-cols-2 gap-6",
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "space-y-4",
                        children: [
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("h2", {
                                className: "text-xl font-semibold",
                                children: "Saved Locations"
                            }, void 0, false, {
                                fileName: "[project]/app/dashboard/locations/page.tsx",
                                lineNumber: 222,
                                columnNumber: 11
                            }, this),
                            locations.length === 0 ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$card$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Card"], {
                                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$card$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["CardContent"], {
                                    className: "flex flex-col items-center justify-center py-12",
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$map$2d$pin$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__default__as__MapPin$3e$__["MapPin"], {
                                            className: "w-12 h-12 text-muted-foreground mb-4"
                                        }, void 0, false, {
                                            fileName: "[project]/app/dashboard/locations/page.tsx",
                                            lineNumber: 226,
                                            columnNumber: 17
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                            className: "text-muted-foreground text-center mb-4",
                                            children: "You don't have any saved locations yet."
                                        }, void 0, false, {
                                            fileName: "[project]/app/dashboard/locations/page.tsx",
                                            lineNumber: 227,
                                            columnNumber: 17
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$button$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Button"], {
                                            onClick: handleNewLocation,
                                            variant: "outline",
                                            children: [
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$plus$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__default__as__Plus$3e$__["Plus"], {
                                                    className: "w-4 h-4 mr-2"
                                                }, void 0, false, {
                                                    fileName: "[project]/app/dashboard/locations/page.tsx",
                                                    lineNumber: 231,
                                                    columnNumber: 19
                                                }, this),
                                                "Add Your First Location"
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/app/dashboard/locations/page.tsx",
                                            lineNumber: 230,
                                            columnNumber: 17
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/app/dashboard/locations/page.tsx",
                                    lineNumber: 225,
                                    columnNumber: 15
                                }, this)
                            }, void 0, false, {
                                fileName: "[project]/app/dashboard/locations/page.tsx",
                                lineNumber: 224,
                                columnNumber: 13
                            }, this) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "space-y-3",
                                children: locations.map((location)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$app$2f$dashboard$2f$locations$2f$components$2f$LocationCard$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["LocationCard"], {
                                        location: location,
                                        onEdit: handleEdit,
                                        onDelete: handleDeleteLocation,
                                        onSetDefault: handleSetDefault,
                                        isDeleting: deleting === location.id
                                    }, location.id, false, {
                                        fileName: "[project]/app/dashboard/locations/page.tsx",
                                        lineNumber: 239,
                                        columnNumber: 17
                                    }, this))
                            }, void 0, false, {
                                fileName: "[project]/app/dashboard/locations/page.tsx",
                                lineNumber: 237,
                                columnNumber: 13
                            }, this)
                        ]
                    }, void 0, true, {
                        fileName: "[project]/app/dashboard/locations/page.tsx",
                        lineNumber: 221,
                        columnNumber: 9
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "space-y-4",
                        children: showForm ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$app$2f$dashboard$2f$locations$2f$components$2f$LocationForm$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["LocationForm"], {
                            initialData: editingLocation || undefined,
                            onSubmit: editingLocation ? handleUpdateLocation : handleCreateLocation,
                            onCancel: handleCancelForm,
                            isLoading: saving
                        }, void 0, false, {
                            fileName: "[project]/app/dashboard/locations/page.tsx",
                            lineNumber: 255,
                            columnNumber: 13
                        }, this) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$card$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["Card"], {
                            children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$ui$2f$card$2e$tsx__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["CardContent"], {
                                className: "flex flex-col items-center justify-center py-12",
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$map$2d$pin$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__$3c$export__default__as__MapPin$3e$__["MapPin"], {
                                        className: "w-12 h-12 text-muted-foreground mb-4"
                                    }, void 0, false, {
                                        fileName: "[project]/app/dashboard/locations/page.tsx",
                                        lineNumber: 264,
                                        columnNumber: 17
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$ssr$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$ssr$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                        className: "text-muted-foreground text-center",
                                        children: locations.length === 0 ? 'Create a new location to get started' : 'Click "Add Location" to create a new location'
                                    }, void 0, false, {
                                        fileName: "[project]/app/dashboard/locations/page.tsx",
                                        lineNumber: 265,
                                        columnNumber: 17
                                    }, this)
                                ]
                            }, void 0, true, {
                                fileName: "[project]/app/dashboard/locations/page.tsx",
                                lineNumber: 263,
                                columnNumber: 15
                            }, this)
                        }, void 0, false, {
                            fileName: "[project]/app/dashboard/locations/page.tsx",
                            lineNumber: 262,
                            columnNumber: 13
                        }, this)
                    }, void 0, false, {
                        fileName: "[project]/app/dashboard/locations/page.tsx",
                        lineNumber: 253,
                        columnNumber: 9
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/app/dashboard/locations/page.tsx",
                lineNumber: 219,
                columnNumber: 7
            }, this)
        ]
    }, void 0, true, {
        fileName: "[project]/app/dashboard/locations/page.tsx",
        lineNumber: 205,
        columnNumber: 5
    }, this);
}
}),
];

//# sourceMappingURL=_7fa66f1c._.js.map