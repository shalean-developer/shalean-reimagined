{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/27825/shalean-v2/shalean-reimagined/src/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr'\r\nimport { cookies } from 'next/headers'\r\n\r\nexport async function createClient() {\r\n  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL\r\n  const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY\r\n\r\n  if (!supabaseUrl || !supabaseAnonKey) {\r\n    console.error('Missing Supabase environment variables: NEXT_PUBLIC_SUPABASE_URL or NEXT_PUBLIC_SUPABASE_ANON_KEY')\r\n    throw new Error('Supabase configuration is missing. Please check your environment variables.')\r\n  }\r\n\r\n  try {\r\n    const cookieStore = await cookies()\r\n\r\n    return createServerClient(\r\n      supabaseUrl,\r\n      supabaseAnonKey,\r\n      {\r\n        cookies: {\r\n          getAll() {\r\n            return cookieStore.getAll()\r\n          },\r\n          setAll(cookiesToSet) {\r\n            try {\r\n              cookiesToSet.forEach(({ name, value, options }) =>\r\n                cookieStore.set(name, value, options)\r\n              )\r\n            } catch {\r\n              // The `setAll` method was called from a Server Component.\r\n              // This can be ignored if you have middleware refreshing\r\n              // user sessions.\r\n            }\r\n          },\r\n        },\r\n      }\r\n    )\r\n  } catch (error) {\r\n    console.error('Error creating Supabase client:', error)\r\n    throw error\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEO,eAAe;IACpB,MAAM;IACN,MAAM;IAEN;;IAKA,IAAI;QACF,MAAM,cAAc,MAAM,IAAA,4IAAO;QAEjC,OAAO,IAAA,iMAAkB,EACvB,aACA,iBACA;YACE,SAAS;gBACP;oBACE,OAAO,YAAY,MAAM;gBAC3B;gBACA,QAAO,YAAY;oBACjB,IAAI;wBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC5C,YAAY,GAAG,CAAC,MAAM,OAAO;oBAEjC,EAAE,OAAM;oBACN,0DAA0D;oBAC1D,wDAAwD;oBACxD,iBAAiB;oBACnB;gBACF;YACF;QACF;IAEJ,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mCAAmC;QACjD,MAAM;IACR;AACF"}},
    {"offset": {"line": 87, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/27825/shalean-v2/shalean-reimagined/app/api/credit/transactions/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { createClient } from '@/lib/supabase/server';\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const supabase = await createClient();\r\n    \r\n    // Get authenticated user\r\n    const { data: { user }, error: authError } = await supabase.auth.getUser();\r\n    \r\n    if (authError || !user) {\r\n      return NextResponse.json(\r\n        { error: 'Unauthorized' },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    const email = user.email;\r\n    if (!email) {\r\n      return NextResponse.json(\r\n        { error: 'User email not found' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const page = parseInt(searchParams.get('page') || '1');\r\n    const limit = parseInt(searchParams.get('limit') || '25');\r\n\r\n    // Calculate offset for pagination\r\n    const offset = (page - 1) * limit;\r\n\r\n    // Fetch transactions with pagination\r\n    const { data: transactions, error: fetchError } = await supabase\r\n      .from('credit_transactions')\r\n      .select('*')\r\n      .eq('email', email)\r\n      .order('created_at', { ascending: false })\r\n      .range(offset, offset + limit - 1);\r\n\r\n    if (fetchError) {\r\n      console.error('Error fetching transactions:', fetchError);\r\n      return NextResponse.json(\r\n        { error: 'Failed to fetch transactions' },\r\n        { status: 500 }\r\n      );\r\n    }\r\n\r\n    // Get total count for pagination\r\n    const { count, error: countError } = await supabase\r\n      .from('credit_transactions')\r\n      .select('*', { count: 'exact', head: true })\r\n      .eq('email', email);\r\n\r\n    if (countError) {\r\n      console.error('Error counting transactions:', countError);\r\n    }\r\n\r\n    // Format transactions for display\r\n    const formattedTransactions = (transactions || []).map((tx) => ({\r\n      id: tx.id,\r\n      date: tx.created_at,\r\n      description: tx.description || getTransactionDescription(tx.transaction_type, tx.amount),\r\n      amount: parseFloat(tx.amount.toString()),\r\n      type: tx.transaction_type === 'purchase' || tx.transaction_type === 'referral_reward' ? 'credit' : 'debit',\r\n      transactionType: tx.transaction_type,\r\n      paymentStatus: tx.payment_status,\r\n      balanceBefore: parseFloat(tx.balance_before?.toString() || '0'),\r\n      balanceAfter: parseFloat(tx.balance_after?.toString() || '0'),\r\n      paymentMethod: tx.payment_method,\r\n    }));\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      transactions: formattedTransactions,\r\n      total: count || 0,\r\n      page,\r\n      limit,\r\n      totalPages: Math.ceil((count || 0) / limit),\r\n    });\r\n  } catch (error) {\r\n    console.error('Error in transactions API:', error);\r\n    return NextResponse.json(\r\n      {\r\n        error: 'Failed to fetch transactions',\r\n        message: error instanceof Error ? error.message : 'Unknown error',\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nfunction getTransactionDescription(transactionType: string, amount: number): string {\r\n  switch (transactionType) {\r\n    case 'purchase':\r\n      return `Purchase of R${amount} ShaleanCred`;\r\n    case 'usage':\r\n      return `Used R${amount} ShaleanCred for booking`;\r\n    case 'refund':\r\n      return `Refund of R${amount} ShaleanCred`;\r\n    case 'referral_reward':\r\n      return `Referral reward: R${amount} ShaleanCred`;\r\n    default:\r\n      return `Transaction: R${amount}`;\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":"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"}}]
}