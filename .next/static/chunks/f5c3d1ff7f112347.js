(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,93479,e=>{"use strict";var r=e.i(43476),s=e.i(71645),a=e.i(75157);let t=s.forwardRef(({className:e,type:s,...t},d)=>(0,r.jsx)("input",{type:s,className:(0,a.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:d,...t}));t.displayName="Input",e.s(["Input",()=>t])},19455,e=>{"use strict";var r=e.i(43476),s=e.i(71645),a=e.i(91918),t=e.i(25913),d=e.i(75157);let n=(0,t.cva)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-semibold ring-offset-background transition-all duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-button hover:shadow-lg hover:-translate-y-0.5",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",hero:"bg-primary text-primary-foreground shadow-button hover:shadow-lg hover:-translate-y-0.5 hover:bg-primary/90",heroOutline:"border-2 border-primary bg-transparent text-primary hover:bg-primary hover:text-primary-foreground",cta:"bg-primary text-primary-foreground shadow-button hover:shadow-lg hover:-translate-y-1 hover:bg-primary/90"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-12 rounded-lg px-6",xl:"h-14 rounded-xl px-8 text-base",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),i=s.forwardRef(({className:e,variant:s,size:t,asChild:i=!1,...l},o)=>{let c=i?a.Slot:"button";return(0,r.jsx)(c,{className:(0,d.cn)(n({variant:s,size:t,className:e})),ref:o,...l})});i.displayName="Button",e.s(["Button",()=>i,"buttonVariants",()=>n])},15288,e=>{"use strict";var r=e.i(43476),s=e.i(71645),a=e.i(75157);let t=s.forwardRef(({className:e,...s},t)=>(0,r.jsx)("div",{ref:t,className:(0,a.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...s}));t.displayName="Card";let d=s.forwardRef(({className:e,...s},t)=>(0,r.jsx)("div",{ref:t,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",e),...s}));d.displayName="CardHeader";let n=s.forwardRef(({className:e,...s},t)=>(0,r.jsx)("h3",{ref:t,className:(0,a.cn)("text-2xl font-semibold leading-none tracking-tight",e),...s}));n.displayName="CardTitle";let i=s.forwardRef(({className:e,...s},t)=>(0,r.jsx)("p",{ref:t,className:(0,a.cn)("text-sm text-muted-foreground",e),...s}));i.displayName="CardDescription";let l=s.forwardRef(({className:e,...s},t)=>(0,r.jsx)("div",{ref:t,className:(0,a.cn)("p-6 pt-0",e),...s}));l.displayName="CardContent",s.forwardRef(({className:e,...s},t)=>(0,r.jsx)("div",{ref:t,className:(0,a.cn)("flex items-center p-6 pt-0",e),...s})).displayName="CardFooter",e.s(["Card",()=>t,"CardContent",()=>l,"CardDescription",()=>i,"CardHeader",()=>d,"CardTitle",()=>n])},49149,e=>{"use strict";var r=e.i(43476),s=e.i(71645),a=e.i(19455),t=e.i(15288),d=e.i(93479),n=e.i(46696);function i(){let[e,i]=(0,s.useState)(!1),[l,o]=(0,s.useState)(null),[c,m]=(0,s.useState)(null),[x,f]=(0,s.useState)(null),[u,p]=(0,s.useState)(!1),[h,g]=(0,s.useState)(null),[b,j]=(0,s.useState)(!1),[y,N]=(0,s.useState)(""),[v,w]=(0,s.useState)("849E23"),[R,C]=(0,s.useState)("farachits@gmail.com"),k=async(e,r)=>{let s=e||v,a=r||R;p(!0),f(null);try{let e=await fetch(`/api/referrals/check?referralCode=${encodeURIComponent(s)}&referredEmail=${encodeURIComponent(a)}`),r=await e.json();f(r)}catch(e){console.error("Error checking referral:",e)}finally{p(!1)}};(0,s.useEffect)(()=>{v&&R&&k(v,R)},[]);let S=async(e,r)=>{let s=e||v,a=r||R;i(!0),o(null),m(null);try{let e=await fetch("/api/bookings/verify-payments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({referralCode:s,referredEmail:a})}),r=await e.json();if(!e.ok){m(r.error||"Failed to verify payments"),o(r),i(!1);return}if(r.updatedBookings>0||r.results?.some(e=>e.success)){let e=await fetch("/api/referrals/process",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({referralCode:s,referredEmail:a})}),t=await e.json();e.ok?(o({paymentVerification:r,referralProcessing:t,success:t.success}),n.toast.success("Referral reward processed successfully!"),await k(s,a)):(m(t.error||"Failed to process referral"),o({paymentVerification:r,referralProcessing:t}))}else{let e=await fetch("/api/referrals/process",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({referralCode:s,referredEmail:a})}),t=await e.json();e.ok?(o({paymentVerification:r,referralProcessing:t,success:t.success}),n.toast.success("Referral reward processed successfully!"),await k(s,a)):(m(t.error||"Failed to process referral"),o({paymentVerification:r,referralProcessing:t}))}}catch(e){m(e instanceof Error?e.message:"Unknown error occurred"),n.toast.error("Failed to process referral")}finally{i(!1)}};return(0,r.jsx)("div",{className:"container mx-auto py-10 max-w-4xl",children:(0,r.jsxs)(t.Card,{children:[(0,r.jsxs)(t.CardHeader,{children:[(0,r.jsx)(t.CardTitle,{children:"Fix Missing Referral Reward"}),(0,r.jsx)(t.CardDescription,{children:"Process missing referral rewards for any referral code and email combination"})]}),(0,r.jsxs)(t.CardContent,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Referral Code"}),(0,r.jsx)(d.Input,{type:"text",placeholder:"Enter referral code (e.g., 849E23)",value:v,onChange:e=>w(e.target.value.toUpperCase()),className:"font-mono"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Referred Email"}),(0,r.jsx)(d.Input,{type:"email",placeholder:"Enter referred email (e.g., farachits@gmail.com)",value:R,onChange:e=>C(e.target.value)})]}),(0,r.jsxs)("p",{className:"text-sm text-muted-foreground",children:[(0,r.jsx)("strong",{children:"Reward Amount:"})," R150.00"]})]}),(0,r.jsx)(a.Button,{onClick:()=>S(v,R),disabled:e||!v||!R,className:"w-full",children:e?"Processing...":"Process Referral Reward"}),c&&(0,r.jsxs)("div",{className:"p-4 bg-destructive/10 border border-destructive/20 rounded-md",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-destructive",children:"Error:"}),(0,r.jsx)("p",{className:"text-sm text-destructive/80",children:c})]}),l&&(0,r.jsxs)("div",{className:"p-4 bg-muted rounded-md",children:[(0,r.jsx)("p",{className:"text-sm font-medium mb-2",children:"Result:"}),(0,r.jsx)("pre",{className:"text-xs overflow-auto bg-background p-3 rounded border",children:JSON.stringify(l,null,2)})]}),l?.referralProcessing?.success&&(0,r.jsxs)("div",{className:"p-4 bg-green-50 border border-green-200 rounded-md",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-green-800",children:"✅ Success!"}),l.referralProcessing?.results?.map((e,s)=>(0,r.jsx)("div",{className:"mt-2 text-sm text-green-700",children:e.success?(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{children:["Booking ",e.bookingId,": R",e.rewardAmount," credited to ",e.referrerEmail]}),(0,r.jsxs)("p",{className:"text-xs",children:["Balance: R",e.balanceBefore," → R",e.balanceAfter]})]}):(0,r.jsxs)("p",{className:"text-amber-700",children:["⚠️ ",e.error]})},s))]}),(0,r.jsxs)("div",{className:"mt-6 border-t pt-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold",children:"Referral Status Details"}),(0,r.jsx)(a.Button,{onClick:k,disabled:u,variant:"outline",size:"sm",children:u?"Checking...":"Refresh Status"})]}),x&&(0,r.jsx)("div",{className:"space-y-4",children:x.success?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-md",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-blue-800 mb-2",children:"Referrer Information"}),(0,r.jsxs)("p",{className:"text-sm text-blue-700",children:[(0,r.jsx)("strong",{children:"Email:"})," ",x.referrer.email]}),(0,r.jsxs)("p",{className:"text-sm text-blue-700",children:[(0,r.jsx)("strong",{children:"Name:"})," ",x.referrer.name]}),(0,r.jsxs)("p",{className:"text-sm text-blue-700 font-semibold",children:[(0,r.jsx)("strong",{children:"Current Credit Balance:"})," R",x.referrer.creditBalance.toFixed(2)]})]}),(0,r.jsxs)("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-md",children:[(0,r.jsx)("p",{className:"text-sm font-medium mb-2",children:"Summary"}),(0,r.jsxs)("ul",{className:"text-sm space-y-1",children:[(0,r.jsxs)("li",{children:["Total Bookings: ",x.summary.totalBookings]}),(0,r.jsxs)("li",{children:["Paid Bookings: ",x.summary.paidBookings]}),(0,r.jsxs)("li",{children:["Total Referrals: ",x.summary.totalReferrals]}),(0,r.jsxs)("li",{children:["Credited Referrals: ",x.summary.creditedReferrals]}),(0,r.jsxs)("li",{className:"font-semibold text-green-700",children:["Total Rewards Credited: R",x.summary.totalRewardsCredited.toFixed(2)]})]})]}),x.rewardTransactions&&x.rewardTransactions.length>0&&(0,r.jsxs)("div",{className:"p-4 bg-green-50 border border-green-200 rounded-md",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-green-800 mb-2",children:"Reward Transactions"}),x.rewardTransactions.map((e,s)=>(0,r.jsxs)("div",{className:"text-sm text-green-700 mb-2 pb-2 border-b border-green-200 last:border-0",children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Amount:"})," R",e.amount.toFixed(2)]}),(0,r.jsxs)("p",{className:"text-xs",children:[(0,r.jsx)("strong",{children:"Date:"})," ",new Date(e.created_at).toLocaleString()]}),(0,r.jsxs)("p",{className:"text-xs",children:[(0,r.jsx)("strong",{children:"Balance:"})," R",e.balance_before.toFixed(2)," → R",e.balance_after.toFixed(2)]}),e.description&&(0,r.jsxs)("p",{className:"text-xs",children:[(0,r.jsx)("strong",{children:"Description:"})," ",e.description]})]},s))]}),x.referrals&&x.referrals.length>0&&(0,r.jsxs)("div",{className:"p-4 bg-purple-50 border border-purple-200 rounded-md",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-purple-800 mb-2",children:"Referral Records"}),x.referrals.map((e,s)=>(0,r.jsxs)("div",{className:"text-sm text-purple-700 mb-2 pb-2 border-b border-purple-200 last:border-0",children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Status:"})," ",e.status]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Reward Status:"})," ",e.referrer_reward_status]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Reward Amount:"})," R",e.referrer_reward_amount.toFixed(2)]}),(0,r.jsxs)("p",{className:"text-xs",children:[(0,r.jsx)("strong",{children:"Created:"})," ",new Date(e.created_at).toLocaleString()]}),e.updated_at&&(0,r.jsxs)("p",{className:"text-xs",children:[(0,r.jsx)("strong",{children:"Updated:"})," ",new Date(e.updated_at).toLocaleString()]})]},s))]})]}):(0,r.jsx)("div",{className:"p-4 bg-red-50 border border-red-200 rounded-md",children:(0,r.jsx)("p",{className:"text-sm text-red-800",children:x.error})})})]}),h&&(0,r.jsxs)("div",{className:"border-t pt-6 mt-6",children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold mb-4",children:["Debug Results for ",y]}),h.success?(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-md",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-blue-800 mb-2",children:"Analysis Summary"}),(0,r.jsxs)("ul",{className:"text-sm space-y-1",children:[(0,r.jsxs)("li",{children:["Total Bookings: ",h.analysis.totalBookings]}),(0,r.jsxs)("li",{children:["Paid Bookings: ",h.analysis.paidBookings]}),(0,r.jsxs)("li",{children:["Bookings with Referral Code: ",h.analysis.bookingsWithReferralCode]}),(0,r.jsxs)("li",{children:["Paid Bookings with Referral Code: ",h.analysis.paidBookingsWithReferralCode]}),(0,r.jsxs)("li",{children:["Total Referral Records: ",h.analysis.totalReferrals]}),(0,r.jsxs)("li",{children:["Completed Referrals: ",h.analysis.completedReferrals]}),(0,r.jsxs)("li",{children:["Credited Referrals: ",h.analysis.creditedReferrals]})]})]}),h.bookings&&h.bookings.length>0&&(0,r.jsxs)("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-md",children:[(0,r.jsx)("p",{className:"text-sm font-medium mb-2",children:"Bookings"}),h.bookings.map((e,s)=>(0,r.jsxs)("div",{className:"text-sm mb-2 pb-2 border-b last:border-0",children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Booking:"})," ",e.booking_number]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Referral Code:"})," ",e.referral_code||"None"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Payment Status:"})," ",e.payment_status]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Status:"})," ",e.status]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Paystack Reference:"})," ",e.paystack_reference||"None"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Transaction ID:"})," ",e.paystack_transaction_id||"None"]}),(0,r.jsxs)("p",{className:"text-xs text-gray-600",children:["Created: ",new Date(e.created_at).toLocaleString()]})]},s))]}),h.referrers&&h.referrers.length>0&&(0,r.jsxs)("div",{className:"p-4 bg-green-50 border border-green-200 rounded-md",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-green-800 mb-2",children:"Referrer(s)"}),h.referrers.map((e,s)=>(0,r.jsxs)("div",{className:"text-sm mb-3 pb-3 border-b border-green-200 last:border-0",children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Email:"})," ",e.email]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Referral Code:"})," ",e.referralCode]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Credit Balance:"})," R",e.credit_balance.toFixed(2)]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Reward Transactions:"})," ",e.rewardTransactions.length]}),e.rewardTransactions.length>0&&(0,r.jsx)("div",{className:"mt-2 text-xs",children:e.rewardTransactions.map((e,s)=>(0,r.jsxs)("div",{className:"mb-1",children:["R",e.amount.toFixed(2)," - ",new Date(e.created_at).toLocaleString()]},s))})]},s))]}),h.referrals&&h.referrals.length>0&&(0,r.jsxs)("div",{className:"p-4 bg-purple-50 border border-purple-200 rounded-md",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-purple-800 mb-2",children:"Referral Records"}),h.referrals.map((e,s)=>(0,r.jsxs)("div",{className:"text-sm mb-2 pb-2 border-b border-purple-200 last:border-0",children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Referrer:"})," ",e.referrer_email]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Code:"})," ",e.referral_code]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Status:"})," ",e.status]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Reward Status:"})," ",e.referrer_reward_status]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Reward Amount:"})," R",e.referrer_reward_amount.toFixed(2)]})]},s))]}),h.analysis.paidBookingsWithReferralCode>0&&0===h.analysis.creditedReferrals&&(0,r.jsxs)("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-md",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-yellow-800 mb-2",children:"⚠️ Issue Detected: Paid bookings with referral code but no credited rewards"}),(0,r.jsx)(a.Button,{onClick:async()=>{let e=h.bookings.find(e=>"paid"===e.payment_status&&e.referral_code);if(e&&y){i(!0),m(null);try{let r=await fetch("/api/bookings/verify-payments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({referralCode:e.referral_code,referredEmail:y})});await r.json();let s=await fetch("/api/referrals/process",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({referralCode:e.referral_code,referredEmail:y})}),a=await s.json();if(s.ok&&a.success){n.toast.success("Referral reward processed successfully!");let e=await fetch(`/api/referrals/debug?referredEmail=${encodeURIComponent(y)}`),r=await e.json();g(r)}else n.toast.error(a.error||"Failed to process referral"),m(a.error||"Failed to process referral")}catch(e){n.toast.error("Failed to process referral"),m(e instanceof Error?e.message:"Unknown error")}finally{i(!1)}}},className:"mt-2",disabled:e,children:e?"Processing...":"Process Missing Reward"})]})]}):(0,r.jsx)("div",{className:"p-4 bg-red-50 border border-red-200 rounded-md",children:(0,r.jsx)("p",{className:"text-sm text-red-800",children:h.error})})]})]})]})})}e.s(["default",()=>i])}]);