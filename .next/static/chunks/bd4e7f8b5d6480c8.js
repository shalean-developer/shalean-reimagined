(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,15288,e=>{"use strict";var a=e.i(43476),t=e.i(71645),r=e.i(75157);let s=t.forwardRef(({className:e,...t},s)=>(0,a.jsx)("div",{ref:s,className:(0,r.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));s.displayName="Card";let l=t.forwardRef(({className:e,...t},s)=>(0,a.jsx)("div",{ref:s,className:(0,r.cn)("flex flex-col space-y-1.5 p-6",e),...t}));l.displayName="CardHeader";let i=t.forwardRef(({className:e,...t},s)=>(0,a.jsx)("h3",{ref:s,className:(0,r.cn)("text-2xl font-semibold leading-none tracking-tight",e),...t}));i.displayName="CardTitle";let o=t.forwardRef(({className:e,...t},s)=>(0,a.jsx)("p",{ref:s,className:(0,r.cn)("text-sm text-muted-foreground",e),...t}));o.displayName="CardDescription";let n=t.forwardRef(({className:e,...t},s)=>(0,a.jsx)("div",{ref:s,className:(0,r.cn)("p-6 pt-0",e),...t}));n.displayName="CardContent",t.forwardRef(({className:e,...t},s)=>(0,a.jsx)("div",{ref:s,className:(0,r.cn)("flex items-center p-6 pt-0",e),...t})).displayName="CardFooter",e.s(["Card",()=>s,"CardContent",()=>n,"CardDescription",()=>o,"CardHeader",()=>l,"CardTitle",()=>i])},95187,(e,a,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={callServer:function(){return l.callServer},createServerReference:function(){return o.createServerReference},findSourceMapURL:function(){return i.findSourceMapURL}};for(var s in r)Object.defineProperty(t,s,{enumerable:!0,get:r[s]});let l=e.r(32120),i=e.r(92245),o=e.r(35326)},31278,e=>{"use strict";let a=(0,e.i(75254).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>a],31278)},10204,e=>{"use strict";var a=e.i(43476),t=e.i(71645),r=e.i(48425),s=t.forwardRef((e,t)=>(0,a.jsx)(r.Primitive.label,{...e,ref:t,onMouseDown:a=>{a.target.closest("button, input, select, textarea")||(e.onMouseDown?.(a),!a.defaultPrevented&&a.detail>1&&a.preventDefault())}}));s.displayName="Label";var l=e.i(25913),i=e.i(75157);let o=(0,l.cva)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),n=t.forwardRef(({className:e,...t},r)=>(0,a.jsx)(s,{ref:r,className:(0,i.cn)(o(),e),...t}));n.displayName=s.displayName,e.s(["Label",()=>n],10204)},89464,e=>{"use strict";var a=e.i(95187);let t=(0,a.createServerReference)("007ae27d199cf53fb689e175ab48f42148ebb8360a",a.callServer,void 0,a.findSourceMapURL,"getAuthenticatedUser");e.s(["getAuthenticatedUser",()=>t])},73375,e=>{"use strict";let a=(0,e.i(75254).default)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);e.s(["ChevronLeft",()=>a],73375)},77572,e=>{"use strict";var a=e.i(43476),t=e.i(71645),r=e.i(81140),s=e.i(30030),l=e.i(42727),i=e.i(96626),o=e.i(48425),n=e.i(86318),d=e.i(69340),c=e.i(10772),u="Tabs",[m,h]=(0,s.createContextScope)(u,[l.createRovingFocusGroupScope]),f=(0,l.createRovingFocusGroupScope)(),[x,b]=m(u),v=t.forwardRef((e,t)=>{let{__scopeTabs:r,value:s,onValueChange:l,defaultValue:i,orientation:m="horizontal",dir:h,activationMode:f="automatic",...b}=e,v=(0,n.useDirection)(h),[p,j]=(0,d.useControllableState)({prop:s,onChange:l,defaultProp:i??"",caller:u});return(0,a.jsx)(x,{scope:r,baseId:(0,c.useId)(),value:p,onValueChange:j,orientation:m,dir:v,activationMode:f,children:(0,a.jsx)(o.Primitive.div,{dir:v,"data-orientation":m,...b,ref:t})})});v.displayName=u;var p="TabsList",j=t.forwardRef((e,t)=>{let{__scopeTabs:r,loop:s=!0,...i}=e,n=b(p,r),d=f(r);return(0,a.jsx)(l.Root,{asChild:!0,...d,orientation:n.orientation,dir:n.dir,loop:s,children:(0,a.jsx)(o.Primitive.div,{role:"tablist","aria-orientation":n.orientation,...i,ref:t})})});j.displayName=p;var g="TabsTrigger",y=t.forwardRef((e,t)=>{let{__scopeTabs:s,value:i,disabled:n=!1,...d}=e,c=b(g,s),u=f(s),m=C(c.baseId,i),h=T(c.baseId,i),x=i===c.value;return(0,a.jsx)(l.Item,{asChild:!0,...u,focusable:!n,active:x,children:(0,a.jsx)(o.Primitive.button,{type:"button",role:"tab","aria-selected":x,"aria-controls":h,"data-state":x?"active":"inactive","data-disabled":n?"":void 0,disabled:n,id:m,...d,ref:t,onMouseDown:(0,r.composeEventHandlers)(e.onMouseDown,e=>{n||0!==e.button||!1!==e.ctrlKey?e.preventDefault():c.onValueChange(i)}),onKeyDown:(0,r.composeEventHandlers)(e.onKeyDown,e=>{[" ","Enter"].includes(e.key)&&c.onValueChange(i)}),onFocus:(0,r.composeEventHandlers)(e.onFocus,()=>{let e="manual"!==c.activationMode;x||n||!e||c.onValueChange(i)})})})});y.displayName=g;var N="TabsContent",w=t.forwardRef((e,r)=>{let{__scopeTabs:s,value:l,forceMount:n,children:d,...c}=e,u=b(N,s),m=C(u.baseId,l),h=T(u.baseId,l),f=l===u.value,x=t.useRef(f);return t.useEffect(()=>{let e=requestAnimationFrame(()=>x.current=!1);return()=>cancelAnimationFrame(e)},[]),(0,a.jsx)(i.Presence,{present:n||f,children:({present:t})=>(0,a.jsx)(o.Primitive.div,{"data-state":f?"active":"inactive","data-orientation":u.orientation,role:"tabpanel","aria-labelledby":m,hidden:!t,id:h,tabIndex:0,...c,ref:r,style:{...e.style,animationDuration:x.current?"0s":void 0},children:t&&d})})});function C(e,a){return`${e}-trigger-${a}`}function T(e,a){return`${e}-content-${a}`}w.displayName=N;var S=e.i(75157);let R=t.forwardRef(({className:e,...t},r)=>(0,a.jsx)(j,{ref:r,className:(0,S.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...t}));R.displayName=j.displayName;let I=t.forwardRef(({className:e,...t},r)=>(0,a.jsx)(y,{ref:r,className:(0,S.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",e),...t}));I.displayName=y.displayName;let L=t.forwardRef(({className:e,...t},r)=>(0,a.jsx)(w,{ref:r,className:(0,S.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));L.displayName=w.displayName,e.s(["Tabs",()=>v,"TabsContent",()=>L,"TabsList",()=>R,"TabsTrigger",()=>I],77572)},84774,e=>{"use strict";var a=e.i(43476),t=e.i(71645),r=e.i(75157);let s=t.forwardRef(({className:e,...t},s)=>(0,a.jsx)("div",{className:"relative w-full overflow-auto",children:(0,a.jsx)("table",{ref:s,className:(0,r.cn)("w-full caption-bottom text-sm",e),...t})}));s.displayName="Table";let l=t.forwardRef(({className:e,...t},s)=>(0,a.jsx)("thead",{ref:s,className:(0,r.cn)("[&_tr]:border-b",e),...t}));l.displayName="TableHeader";let i=t.forwardRef(({className:e,...t},s)=>(0,a.jsx)("tbody",{ref:s,className:(0,r.cn)("[&_tr:last-child]:border-0",e),...t}));i.displayName="TableBody",t.forwardRef(({className:e,...t},s)=>(0,a.jsx)("tfoot",{ref:s,className:(0,r.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t})).displayName="TableFooter";let o=t.forwardRef(({className:e,...t},s)=>(0,a.jsx)("tr",{ref:s,className:(0,r.cn)("border-b transition-colors data-[state=selected]:bg-muted hover:bg-muted/50",e),...t}));o.displayName="TableRow";let n=t.forwardRef(({className:e,...t},s)=>(0,a.jsx)("th",{ref:s,className:(0,r.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...t}));n.displayName="TableHead";let d=t.forwardRef(({className:e,...t},s)=>(0,a.jsx)("td",{ref:s,className:(0,r.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...t}));d.displayName="TableCell",t.forwardRef(({className:e,...t},s)=>(0,a.jsx)("caption",{ref:s,className:(0,r.cn)("mt-4 text-sm text-muted-foreground",e),...t})).displayName="TableCaption",e.s(["Table",()=>s,"TableBody",()=>i,"TableCell",()=>d,"TableHead",()=>n,"TableHeader",()=>l,"TableRow",()=>o])},63659,e=>{"use strict";var a=e.i(43476),t=e.i(71645),r=e.i(18566),s=e.i(77572),l=e.i(84774),i=e.i(15288),o=e.i(19455),n=e.i(67489),d=e.i(73375),c=e.i(63059),u=e.i(31278),m=e.i(93479),h=e.i(10204),f=e.i(46696),x=e.i(95187);let b=(0,x.createServerReference)("7081e40464f3c3699fd146e4be7b7e793fd9b413be",x.callServer,void 0,x.findSourceMapURL,"redeemVoucher"),v=(0,x.createServerReference)("6003e3002eac71bb39708c3f3b82e5b64ef1e083f9",x.callServer,void 0,x.findSourceMapURL,"getVoucherRedemptions");var p=e.i(89464);function j(){let e=(0,r.useSearchParams)(),x=(0,r.useRouter)(),[j,g]=(0,t.useState)("redeem"),[y,N]=(0,t.useState)(""),[w,C]=(0,t.useState)(5),[T,S]=(0,t.useState)(1),[R,I]=(0,t.useState)(""),[L,V]=(0,t.useState)(""),[H,D]=(0,t.useState)([]),[B,_]=(0,t.useState)([]),[k,F]=(0,t.useState)(!1),[A,P]=(0,t.useState)(!1),[E,M]=(0,t.useState)(!1),[U,G]=(0,t.useState)(!1);(0,t.useEffect)(()=>{z()},[]),(0,t.useEffect)(()=>{(async()=>{let a=await (0,p.getAuthenticatedUser)(),t="",r="";if(a.success&&a.email)t=a.email;else{let a=e.get("email"),s=e.get("phone"),l=localStorage.getItem("dashboard_email"),i=localStorage.getItem("dashboard_phone");t=a||l||"",r=s||i||""}(t||r)&&(I(t),V(r),G(!0),$(t,r||void 0))})()},[e]),(0,t.useEffect)(()=>{"history"===j&&R&&$(R,L||void 0)},[j,R,L]);let z=async()=>{try{P(!0);let e=await fetch("/api/voucher/list?status=active&limit=100"),a=await e.json();e.ok&&a.success&&a.vouchers?_(a.vouchers):console.error("Error loading vouchers:",a.error)}catch(e){console.error("Error loading vouchers:",e)}finally{P(!1)}},$=async(e,a)=>{try{F(!0);let t=await v(e,a);t.success&&t.redemptions?D(t.redemptions):t.error&&(console.error("Error loading voucher history:",t.error),"No redemptions found"!==t.error&&f.toast.error(t.error))}catch(e){console.error("Error loading voucher history:",e),f.toast.error("Failed to load voucher history")}finally{F(!1)}},K=async e=>{if(e.preventDefault(),!y.trim())return void f.toast.error("Please enter a voucher code");if(!R&&!L)return void f.toast.error("Please provide your email or phone number");try{M(!0);let e=await b(y.trim(),R,L||void 0);e.success?(f.toast.success(`Voucher redeemed successfully! R${e.amount?.toFixed(2)} has been added to your ShaleanCred balance.`),N(""),"history"===j&&R&&$(R,L||void 0)):f.toast.error(e.error||"Failed to redeem voucher")}catch(e){console.error("Error redeeming voucher:",e),f.toast.error("An unexpected error occurred")}finally{M(!1)}},O=H.length,Z=Math.ceil(O/w)||1,Y=(T-1)*w,q=Y+w,J=H.slice(Y,q),Q=0===O?0:Y+1,W=Math.min(q,O),X=e=>new Date(e).toLocaleDateString("en-ZA",{year:"numeric",month:"short",day:"numeric"});return(0,a.jsxs)("div",{className:"space-y-4 sm:space-y-6 w-full max-w-full overflow-x-hidden",children:[(0,a.jsx)("div",{children:(0,a.jsx)("h1",{className:"text-2xl sm:text-3xl md:text-4xl font-bold",children:"Vouchers"})}),(0,a.jsxs)(s.Tabs,{value:j,onValueChange:g,className:"w-full",children:[(0,a.jsxs)(s.TabsList,{className:"h-auto bg-transparent p-0 gap-6 border-b border-border rounded-none",children:[(0,a.jsx)(s.TabsTrigger,{value:"redeem",className:"px-0 py-2 rounded-none border-b-2 border-transparent data-[state=active]:border-primary data-[state=active]:bg-transparent data-[state=active]:shadow-none",children:"Redeem"}),(0,a.jsx)(s.TabsTrigger,{value:"history",className:"px-0 py-2 rounded-none border-b-2 border-transparent data-[state=active]:border-primary data-[state=active]:bg-transparent data-[state=active]:shadow-none",children:"History"})]}),(0,a.jsxs)(s.TabsContent,{value:"redeem",className:"mt-6 space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h2",{className:"text-xl font-bold",children:"Redeem Gift Voucher"}),(0,a.jsxs)("form",{onSubmit:K,className:"space-y-3",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(h.Label,{htmlFor:"voucher-code",children:"Gift Voucher Code"}),(0,a.jsx)(m.Input,{id:"voucher-code",type:"text",placeholder:"Enter voucher code",value:y,onChange:e=>N(e.target.value.toUpperCase()),className:"w-full",disabled:E})]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Gift voucher will be redeemed into ShaleanCred"}),(0,a.jsx)(o.Button,{variant:"default",className:"w-full sm:w-auto",type:"submit",disabled:E||!y.trim(),children:E?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Redeeming..."]}):"Redeem Gift Voucher"})]})]}),(0,a.jsx)("div",{className:"border-t border-border"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h2",{className:"text-xl font-bold",children:"Available Gift Vouchers"}),A?(0,a.jsxs)("div",{className:"py-8 text-center",children:[(0,a.jsx)(u.Loader2,{className:"h-6 w-6 animate-spin mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Loading vouchers..."})]}):0===B.length?(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"No available vouchers at this time."}):(0,a.jsx)("div",{className:"border rounded-lg overflow-hidden",children:(0,a.jsxs)(l.Table,{children:[(0,a.jsx)(l.TableHeader,{children:(0,a.jsxs)(l.TableRow,{children:[(0,a.jsx)(l.TableHead,{children:"Voucher Code"}),(0,a.jsx)(l.TableHead,{children:"Amount"}),(0,a.jsx)(l.TableHead,{children:"Status"}),(0,a.jsx)(l.TableHead,{children:"Created"}),(0,a.jsx)(l.TableHead,{children:"Valid Until"})]})}),(0,a.jsx)(l.TableBody,{children:B.map(e=>(0,a.jsxs)(l.TableRow,{children:[(0,a.jsx)(l.TableCell,{className:"text-sm font-mono",children:e.code}),(0,a.jsxs)(l.TableCell,{className:"text-sm font-medium",children:["R",e.amount.toFixed(2)]}),(0,a.jsx)(l.TableCell,{className:"text-sm",children:(0,a.jsx)("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${"active"===e.status?"bg-green-100 text-green-800":"redeemed"===e.status?"bg-gray-100 text-gray-800":"bg-red-100 text-red-800"}`,children:e.status})}),(0,a.jsx)(l.TableCell,{className:"text-sm text-muted-foreground",children:e.created_at?"string"==typeof e.created_at?X(e.created_at):new Date(e.created_at).toLocaleDateString("en-ZA",{year:"numeric",month:"short",day:"numeric"}):"N/A"}),(0,a.jsx)(l.TableCell,{className:"text-sm text-muted-foreground",children:e.valid_until?"string"==typeof e.valid_until&&e.valid_until.includes("T")?X(e.valid_until):new Date(e.valid_until).toLocaleDateString("en-ZA",{year:"numeric",month:"short",day:"numeric"}):"No expiry"})]},e.id))})]})})]}),(0,a.jsx)("div",{className:"border-t border-border"}),(0,a.jsxs)(i.Card,{children:[(0,a.jsx)(i.CardHeader,{children:(0,a.jsx)(i.CardTitle,{children:"Buy a Gift Voucher"})}),(0,a.jsxs)(i.CardContent,{className:"space-y-4",children:[(0,a.jsx)("p",{className:"text-muted-foreground",children:"Looking to buy a gift voucher? You buy a gift voucher and send it to someone special who's in need of a good clean."}),(0,a.jsx)(o.Button,{variant:"default",onClick:()=>x.push("/get-voucher"),children:"Buy Vouchers"})]})]})]}),(0,a.jsxs)(s.TabsContent,{value:"history",className:"mt-6 space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[k?(0,a.jsxs)("div",{className:"py-12 text-center",children:[(0,a.jsx)(u.Loader2,{className:"h-6 w-6 animate-spin mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Loading voucher history..."})]}):(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("div",{className:"border rounded-lg overflow-hidden",children:(0,a.jsxs)(l.Table,{children:[(0,a.jsx)(l.TableHeader,{children:(0,a.jsxs)(l.TableRow,{children:[(0,a.jsx)(l.TableHead,{children:"Date"}),(0,a.jsx)(l.TableHead,{children:"Voucher Code"}),(0,a.jsx)(l.TableHead,{children:"Amount"})]})}),(0,a.jsx)(l.TableBody,{children:0===J.length?(0,a.jsx)(l.TableRow,{children:(0,a.jsx)(l.TableCell,{colSpan:3,className:"text-center py-8 text-muted-foreground",children:"No voucher redemptions found"})}):J.map(e=>(0,a.jsxs)(l.TableRow,{children:[(0,a.jsx)(l.TableCell,{className:"text-sm",children:X(e.redeemed_at)}),(0,a.jsx)(l.TableCell,{className:"text-sm font-mono",children:e.voucher_code}),(0,a.jsxs)(l.TableCell,{className:"text-sm font-medium",children:["R",e.amount.toFixed(2)]})]},e.id))})]})})}),O>0&&(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsxs)(n.Select,{value:w.toString(),onValueChange:e=>{C(Number(e)),S(1)},children:[(0,a.jsx)(n.SelectTrigger,{className:"w-[120px] h-9",children:(0,a.jsx)(n.SelectValue,{})}),(0,a.jsxs)(n.SelectContent,{children:[(0,a.jsx)(n.SelectItem,{value:"5",children:"5 Items"}),(0,a.jsx)(n.SelectItem,{value:"10",children:"10 Items"}),(0,a.jsx)(n.SelectItem,{value:"20",children:"20 Items"}),(0,a.jsx)(n.SelectItem,{value:"50",children:"50 Items"})]})]})}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(o.Button,{variant:"default",size:"sm",onClick:()=>{T>1&&S(T-1)},disabled:1===T,className:"h-9",children:(0,a.jsx)(d.ChevronLeft,{className:"h-4 w-4"})}),(0,a.jsxs)("span",{className:"text-sm text-muted-foreground px-2",children:[Q,"-",W," of ",O]}),(0,a.jsx)(o.Button,{variant:"default",size:"sm",onClick:()=>{T<Z&&S(T+1)},disabled:T>=Z,className:"h-9",children:(0,a.jsx)(c.ChevronRight,{className:"h-4 w-4"})})]})]}),0===O&&(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsxs)(n.Select,{value:w.toString(),onValueChange:e=>{C(Number(e)),S(1)},children:[(0,a.jsx)(n.SelectTrigger,{className:"w-[120px] h-9",children:(0,a.jsx)(n.SelectValue,{})}),(0,a.jsxs)(n.SelectContent,{children:[(0,a.jsx)(n.SelectItem,{value:"5",children:"5 Items"}),(0,a.jsx)(n.SelectItem,{value:"10",children:"10 Items"}),(0,a.jsx)(n.SelectItem,{value:"20",children:"20 Items"}),(0,a.jsx)(n.SelectItem,{value:"50",children:"50 Items"})]})]})}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(o.Button,{variant:"default",size:"sm",disabled:!0,className:"h-9",children:(0,a.jsx)(d.ChevronLeft,{className:"h-4 w-4"})}),(0,a.jsx)("span",{className:"text-sm text-muted-foreground px-2",children:"1-0 of 0"}),(0,a.jsx)(o.Button,{variant:"default",size:"sm",disabled:!0,className:"h-9",children:(0,a.jsx)(c.ChevronRight,{className:"h-4 w-4"})})]})]})]}),(0,a.jsxs)(i.Card,{children:[(0,a.jsx)(i.CardHeader,{children:(0,a.jsx)(i.CardTitle,{children:"Buy a Gift Voucher"})}),(0,a.jsxs)(i.CardContent,{className:"space-y-4",children:[(0,a.jsx)("p",{className:"text-muted-foreground",children:"Looking to buy a gift voucher? You buy a gift voucher and send it to someone special who's in need of a good clean."}),(0,a.jsx)(o.Button,{variant:"default",onClick:()=>x.push("/get-voucher"),children:"Buy Vouchers"})]})]})]})]})]})}e.s(["default",()=>j],63659)}]);