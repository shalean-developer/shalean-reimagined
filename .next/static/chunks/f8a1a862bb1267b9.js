(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,19455,e=>{"use strict";var s=e.i(43476),t=e.i(71645),r=e.i(91918),a=e.i(25913),i=e.i(75157);let n=(0,a.cva)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-semibold ring-offset-background transition-all duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-button hover:shadow-lg hover:-translate-y-0.5",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",hero:"bg-primary text-primary-foreground shadow-button hover:shadow-lg hover:-translate-y-0.5 hover:bg-primary/90",heroOutline:"border-2 border-primary bg-transparent text-primary hover:bg-primary hover:text-primary-foreground",cta:"bg-primary text-primary-foreground shadow-button hover:shadow-lg hover:-translate-y-1 hover:bg-primary/90"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-12 rounded-lg px-6",xl:"h-14 rounded-xl px-8 text-base",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),l=t.forwardRef(({className:e,variant:t,size:a,asChild:l=!1,...o},d)=>{let c=l?r.Slot:"button";return(0,s.jsx)(c,{className:(0,i.cn)(n({variant:t,size:a,className:e})),ref:d,...o})});l.displayName="Button",e.s(["Button",()=>l,"buttonVariants",()=>n])},93479,e=>{"use strict";var s=e.i(43476),t=e.i(71645),r=e.i(75157);let a=t.forwardRef(({className:e,type:t,...a},i)=>(0,s.jsx)("input",{type:t,className:(0,r.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:i,...a}));a.displayName="Input",e.s(["Input",()=>a])},10204,e=>{"use strict";var s=e.i(43476),t=e.i(71645),r=e.i(48425),a=t.forwardRef((e,t)=>(0,s.jsx)(r.Primitive.label,{...e,ref:t,onMouseDown:s=>{s.target.closest("button, input, select, textarea")||(e.onMouseDown?.(s),!s.defaultPrevented&&s.detail>1&&s.preventDefault())}}));a.displayName="Label";var i=e.i(25913),n=e.i(75157);let l=(0,i.cva)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),o=t.forwardRef(({className:e,...t},r)=>(0,s.jsx)(a,{ref:r,className:(0,n.cn)(l(),e),...t}));o.displayName=a.displayName,e.s(["Label",()=>o],10204)},84614,e=>{"use strict";let s=(0,e.i(75254).default)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);e.s(["User",()=>s],84614)},71689,e=>{"use strict";let s=(0,e.i(75254).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>s],71689)},94351,e=>{"use strict";let s=(0,e.i(75254).default)("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);e.s(["Home",()=>s],94351)},88699,e=>{"use strict";let s=(0,e.i(75254).default)("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);e.s(["Pencil",()=>s],88699)},70756,e=>{"use strict";let s=(0,e.i(75254).default)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);e.s(["Lock",()=>s],70756)},54284,e=>{"use strict";var s=e.i(43476),t=e.i(18566),r=e.i(71645),a=e.i(66027),i=e.i(19455),n=e.i(71689),l=e.i(68320),o=e.i(10204),d=e.i(93479),c=e.i(84614),m=e.i(63488),u=e.i(43432),x=e.i(46897),h=e.i(87316),p=e.i(3116),f=e.i(88699),b=e.i(70756),g=e.i(94351),v=e.i(75254);let y=(0,v.default)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),j=(0,v.default)("Package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["path",{d:"m3.3 7 7.703 4.734a2 2 0 0 0 1.994 0L20.7 7",key:"yx3hmr"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]),N=(0,v.default)("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]),w=(0,v.default)("Coins",[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]]);var k=e.i(45919),C=e.i(4552),S=e.i(88719),A=e.i(11795),F=e.i(10596),M=e.i(85580);function P({formData:e,priceBreakdown:t,updateFormData:n,onValidateDiscountCode:l,onProceedToPayment:v,isProcessing:P=!1}){var R;let[I,L]=(0,r.useState)(e.discountCode||""),[q,T]=(0,r.useState)(!1),[D,O]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(async()=>{let e=(0,A.createClient)(),{data:{user:s}}=await e.auth.getUser();O(!!s)})();let{data:{subscription:e}}=(0,A.createClient)().auth.onAuthStateChange((e,s)=>{O(!!s?.user)});return()=>{e.unsubscribe()}},[]);let{data:E=0,isLoading:B}=(0,a.useQuery)({queryKey:["credit-balance",D],queryFn:async()=>{try{let e=await fetch("/api/profile/balance");if(401===e.status)return O(!1),0;if(e.ok){let s=await e.json();return s.success&&s.balance||0}return console.warn("Failed to fetch credit balance:",e.status,e.statusText),0}catch(e){return console.error("Error fetching credit balance:",e),0}},enabled:D,staleTime:3e4,retry:!1}),{data:U=[]}=(0,a.useQuery)({queryKey:["services"],queryFn:C.getServices,staleTime:3e5}),{data:z=[]}=(0,a.useQuery)({queryKey:["additional-services",e.serviceId],queryFn:()=>(0,S.getAdditionalServices)(e.serviceId||void 0),enabled:!!e.serviceId,staleTime:3e5}),$=U.find(s=>s.id===e.serviceId),H=$?.name||"Standard Cleaning",K=H?.toLowerCase().includes("carpet")??!1,Q=(0,M.requiresTeamBooking)(H),_=e.additionalServices.map(e=>z.find(s=>s.id===e)).filter(e=>void 0!==e),{data:V=[]}=(0,a.useQuery)({queryKey:["cleaners",JSON.stringify(e.preferredCleanerIds)],queryFn:async()=>{if(!e.preferredCleanerIds||0===e.preferredCleanerIds.length)return[];let s=(0,A.createClient)(),{data:t}=await s.from("cleaners").select("id, name, avatar_url, photo_url").in("id",e.preferredCleanerIds);return t||[]},enabled:!Q&&e.preferredCleanerIds&&e.preferredCleanerIds.length>0,staleTime:3e5}),W=t.subtotal-t.frequencyDiscountAmount-t.discountAmount,J=(0,M.supportsRecurringBookings)(H),Y="one-time"!==e.cleaningFrequency,G=!!e.serviceDate,X=Y&&G&&J,Z=e.tipAmount||0,ee=1,es=t.totalAmount+Z;if(X)try{let s=new Date(e.serviceDate);ee=(0,F.calculateBookingDatesForMonth)(s,e.cleaningFrequency).length,es=t.totalAmount*ee+Z}catch(e){console.error("Error calculating recurring total:",e),ee=1,es=t.totalAmount+Z}let et=X?es:t.totalAmount+Z,er=e.useCredits||!1,ea=Math.round(100*et)/100,ei=Math.round(100*E)/100,en=Math.round(100*(e.creditsAmount||0))/100,el=er?Math.min(en,ei,ea):0,eo=Math.max(0,Math.round((ea-el)*100)/100),ed=async()=>{T(!0),await l(I),T(!1)};return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-foreground mb-1",children:"Review Your Booking"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Please review your booking details before confirming."})]}),(0,s.jsxs)("div",{className:"bg-white rounded-xl p-4 border border-border",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:Q?"Team":"Cleaner"}),(0,s.jsx)("button",{type:"button",className:"text-primary",children:(0,s.jsx)(f.Pencil,{className:"w-4 h-4"})})]}),(0,s.jsxs)("div",{className:"bg-primary text-primary-foreground rounded-lg p-3 mb-3",children:[(0,s.jsx)("p",{className:"text-xs mb-1",children:"An upfront tip for"}),Q?e.teamNumber?(0,s.jsxs)("p",{className:"font-bold text-base",children:["Team ",e.teamNumber]}):(0,s.jsx)("p",{className:"font-bold text-base",children:"No team selected"}):V.length>0?(0,s.jsx)("div",{className:"space-y-1",children:V.map(e=>(0,s.jsx)("p",{className:"font-bold text-base",children:e.name},e.id))}):(0,s.jsx)("p",{className:"font-bold text-base",children:"No preference - Best available"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)(o.Label,{className:"mb-2 block text-sm",children:["Tip amount",Y&&X&&(0,s.jsx)("span",{className:"text-xs text-muted-foreground font-normal ml-1",children:"(one-time, first booking only)"})]}),(0,s.jsxs)("div",{className:"flex gap-2 flex-wrap items-center",children:[[0,25,50,75,100].map(t=>(0,s.jsxs)("button",{type:"button",onClick:()=>n({tipAmount:t}),className:`px-3 py-1.5 rounded-full border-2 transition-all text-sm ${e.tipAmount===t?"border-primary bg-primary text-primary-foreground":"border-border hover:border-primary/50"}`,children:["R",t]},t)),(0,s.jsx)(d.Input,{type:"number",value:e.tipAmount||"",onChange:e=>n({tipAmount:parseFloat(e.target.value)||0}),placeholder:"Custom",className:"w-24 h-8 text-sm"})]})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-xl p-4 border border-border",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"Contact & Address"}),(0,s.jsx)("button",{type:"button",className:"text-primary",children:(0,s.jsx)(f.Pencil,{className:"w-4 h-4"})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(o.Label,{children:"First Name *"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(c.User,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),(0,s.jsx)(d.Input,{placeholder:"e.g., Thabo",className:"pl-10",value:e.customerFirstName,onChange:e=>n({customerFirstName:e.target.value})})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(o.Label,{children:"Last Name *"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(c.User,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),(0,s.jsx)(d.Input,{placeholder:"e.g., Mokoena",className:"pl-10",value:e.customerLastName,onChange:e=>n({customerLastName:e.target.value})})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(o.Label,{children:"Email Address *"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(m.Mail,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),(0,s.jsx)(d.Input,{type:"email",placeholder:"e.g., thabo@example.com",className:"pl-10",value:e.customerEmail,onChange:e=>n({customerEmail:e.target.value})})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(o.Label,{children:"Phone Number *"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(u.Phone,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),(0,s.jsx)(d.Input,{placeholder:"0821234567 or +27821234567",className:"pl-10",value:e.customerPhone,onChange:e=>n({customerPhone:e.target.value})})]})]}),(0,s.jsxs)("div",{className:"space-y-2 md:col-span-2",children:[(0,s.jsx)(o.Label,{children:"Address *"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(x.MapPin,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),(0,s.jsx)(d.Input,{placeholder:"Street address, Suburb, City",className:"pl-10",value:[e.serviceAddress,e.serviceAptUnit,e.serviceSuburb,e.serviceCity].filter(Boolean).join(", "),onChange:e=>{n({serviceAddress:e.target.value})}})]})]})]})]}),(0,s.jsx)("div",{className:"space-y-3",children:(0,s.jsxs)("div",{className:"bg-white rounded-xl p-4 border border-border",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"What You're Booking"}),(0,s.jsx)("button",{type:"button",className:"text-primary",children:(0,s.jsx)(f.Pencil,{className:"w-4 h-4"})})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"pb-3 border-b border-border",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)(N,{className:"w-4 h-4 text-primary"}),(0,s.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Service"})]}),(0,s.jsx)("p",{className:"text-base font-semibold text-foreground",children:H}),e.cleaningFrequency&&"one-time"!==e.cleaningFrequency&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["Frequency: ",{"one-time":"One-time",weekly:"Weekly","bi-weekly":"Bi-weekly",monthly:"Monthly"}[R=e.cleaningFrequency]||R]})]}),K?(e.carpetTypes.length>0||e.numberOfFittedRooms||e.numberOfLooseCarpets||e.roomStatus)&&(0,s.jsxs)("div",{className:"pb-3 border-b border-border",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)(g.Home,{className:"w-4 h-4 text-primary"}),(0,s.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Carpet Details"})]}),(0,s.jsxs)("div",{className:"space-y-2 text-sm",children:[e.carpetTypes.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Carpet Types: "}),(0,s.jsx)("span",{className:"font-medium capitalize",children:e.carpetTypes.join(", ")})]}),e.numberOfFittedRooms&&(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Fitted Rooms: "}),(0,s.jsx)("span",{className:"font-medium",children:e.numberOfFittedRooms})]}),e.numberOfLooseCarpets&&(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Loose Carpets/Rugs: "}),(0,s.jsx)("span",{className:"font-medium",children:e.numberOfLooseCarpets})]}),e.roomStatus&&(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Room Status: "}),(0,s.jsx)("span",{className:"font-medium capitalize",children:e.roomStatus.replace(/-/g," ")})]})]})]}):(parseInt(e.bedrooms)>0||parseInt(e.bathrooms)>0)&&(0,s.jsxs)("div",{className:"pb-3 border-b border-border",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)(g.Home,{className:"w-4 h-4 text-primary"}),(0,s.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Property Details"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Bedrooms: "}),(0,s.jsx)("span",{className:"font-medium",children:e.bedrooms})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Bathrooms: "}),(0,s.jsx)("span",{className:"font-medium",children:e.bathrooms})]})]})]}),_.length>0&&(0,s.jsxs)("div",{className:"pb-3 border-b border-border",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)(N,{className:"w-4 h-4 text-primary"}),(0,s.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Additional Services"})]}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:_.map(e=>(0,s.jsx)("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-primary/10 text-primary border border-primary/20",children:e.name},e.id))})]}),(e.numberOfCleaners>1||"yes"===e.cleaningEquipment||e.serviceDuration)&&(0,s.jsxs)("div",{className:"pb-3 border-b border-border space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)(j,{className:"w-4 h-4 text-primary"}),(0,s.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Service Options"})]}),e.numberOfCleaners>1&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(y,{className:"w-4 h-4 text-primary"}),(0,s.jsxs)("span",{className:"text-sm text-muted-foreground",children:[(0,s.jsx)("span",{className:"font-medium",children:e.numberOfCleaners})," cleaner",e.numberOfCleaners>1?"s":""," assigned",e.numberOfCleaners>1&&(0,s.jsxs)("span",{className:"text-xs ml-1",children:["(+R",((e.numberOfCleaners-1)*250).toFixed(2),")"]})]})]}),"yes"===e.cleaningEquipment&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(j,{className:"w-4 h-4 text-primary"}),(0,s.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Equipment & supplies included",t.equipmentSupplyPrice>0&&(0,s.jsxs)("span",{className:"text-xs ml-1",children:["(+R",t.equipmentSupplyPrice.toFixed(2),")"]})]})]}),e.serviceDuration&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(p.Clock,{className:"w-4 h-4 text-primary"}),(0,s.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Estimated duration: ",(0,s.jsxs)("span",{className:"font-medium",children:[e.serviceDuration," hours"]})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,s.jsx)(h.Calendar,{className:"w-4 h-4 text-primary"}),(0,s.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Schedule"})]}),(0,s.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Date"}),(0,s.jsx)("span",{className:"font-medium",children:e.serviceDate?(0,k.format)(new Date(e.serviceDate),"EEE, MMM d, yyyy"):"Not set"})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Time"}),(0,s.jsx)("span",{className:"font-medium",children:e.serviceTime||"Not set"})]})]})]})]})]})}),(0,s.jsxs)("div",{className:"bg-primary/5 rounded-xl p-4 border border-primary/20",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:X?`Total Amount (${ee} ${1===ee?"booking":"bookings"} this month)`:"Total Amount"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:X?`${(()=>{switch(e.cleaningFrequency){case"weekly":return"Weekly";case"bi-weekly":return"Bi-Weekly";case"monthly":return"Monthly";default:return""}})()} recurring - All fees included`:Y&&!G?"Select a date to see monthly total":"All fees included"})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsxs)("p",{className:`text-2xl font-bold ${er&&el>0?"line-through text-muted-foreground":"text-primary"}`,children:["R",X?es.toFixed(2):(t.totalAmount+Z).toFixed(2)]}),er&&el>0&&(0,s.jsxs)("p",{className:"text-2xl font-bold text-primary mt-1",children:["R",eo.toFixed(2)]})]})]}),X&&ee>1&&(0,s.jsxs)("div",{className:"mb-3 text-xs text-muted-foreground text-right",children:["(R",t.totalAmount.toFixed(2)," Ã— ",ee,") ",Z>0?`+ R${Z.toFixed(2)} tip`:""," = R",es.toFixed(2)]}),(0,s.jsxs)("div",{className:"space-y-1.5 mb-3 pt-3 border-t border-border",children:[(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Service & rooms"}),(0,s.jsxs)("span",{children:["R",Math.max(0,W).toFixed(2)]})]}),(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Service fee"}),(0,s.jsxs)("span",{children:["+R",t.serviceFee.toFixed(2)]})]}),Z>0&&(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsxs)("span",{className:"text-muted-foreground",children:["Tip",Y&&X?" (one-time, first booking only)":""]}),(0,s.jsxs)("span",{children:["+R",Z.toFixed(2)]})]})]}),(0,s.jsxs)("div",{className:"mb-3",children:[(0,s.jsx)(o.Label,{className:"mb-1.5 block text-sm",children:"Have a discount code?"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(d.Input,{placeholder:"Enter discount code",value:I,onChange:e=>L(e.target.value),className:"h-9 text-sm"}),(0,s.jsx)(i.Button,{type:"button",variant:"outline",onClick:ed,disabled:q||!I,className:"h-9",children:"Apply"})]})]}),D&&(0,s.jsxs)("div",{className:"mb-3 p-3 bg-secondary/50 rounded-lg border border-border",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)(w,{className:"w-4 h-4 text-primary"}),(0,s.jsx)(o.Label,{className:"text-sm font-medium",children:"Use ShaleanCred"})]}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground mb-2",children:["You have ",(0,s.jsxs)("span",{className:"font-semibold text-primary",children:["R",E.toFixed(2)]})," ShaleanCred available"]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)("input",{type:"checkbox",id:"use-credits",checked:er,disabled:B||E<=0,onChange:e=>{if(B||E<=0)return;let s=e.target.checked;n({useCredits:s,creditsAmount:s?Math.min(E,et):0})},className:"w-4 h-4 rounded border-gray-300 text-primary focus:ring-primary disabled:opacity-50 disabled:cursor-not-allowed"}),(0,s.jsxs)("label",{htmlFor:"use-credits",className:`text-sm ${!B&&E>0?"cursor-pointer":"cursor-not-allowed opacity-50"}`,children:["Use ShaleanCred for this booking",B&&(0,s.jsx)("span",{className:"text-xs text-muted-foreground block mt-1",children:"Loading balance..."}),!B&&E<=0&&(0,s.jsx)("span",{className:"text-xs text-muted-foreground block mt-1",children:"No ShaleanCred available"})]})]}),er&&(0,s.jsxs)("div",{className:"mt-2",children:[(0,s.jsxs)(o.Label,{className:"mb-1.5 block text-xs",children:["Amount to use (max R",Math.min(E,et).toFixed(2),")"]}),(0,s.jsx)(d.Input,{type:"number",min:"0",max:Math.min(E,et),step:"0.01",value:el>0?el.toFixed(2):"",onChange:e=>{n({creditsAmount:Math.round(100*Math.min(Math.max(0,Math.round(100*(parseFloat(e.target.value.replace(",","."))||0))/100),Math.min(E,et)))/100})},onBlur:e=>{el>0&&n({creditsAmount:Math.min(Math.round(100*el)/100,Math.min(E,et))})},className:"h-9 text-sm",placeholder:"0.00"}),el>0&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["Remaining to pay: ",(0,s.jsxs)("span",{className:"font-semibold",children:["R",eo.toFixed(2)]})]})]})]}),er&&el>0&&(0,s.jsxs)("div",{className:"mb-3 p-2 bg-primary/10 rounded border border-primary/20",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"After ShaleanCred:"}),(0,s.jsxs)("span",{className:"font-bold text-primary",children:["R",eo.toFixed(2)]})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center text-xs text-muted-foreground mt-1",children:[(0,s.jsx)("span",{children:"Credits applied:"}),(0,s.jsxs)("span",{children:["-R",el.toFixed(2)]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mb-3",children:[(0,s.jsx)(b.Lock,{className:"w-3.5 h-3.5"}),(0,s.jsx)("span",{children:"Secure payment powered by Paystack"})]}),(0,s.jsx)(i.Button,{type:"button",className:"w-full",size:"lg",onClick:v,disabled:P,children:P?"Processing...":"Confirm & Pay"})]})]})}var R=e.i(95187);let I=(0,R.createServerReference)("401cc942bd1fec2a89e1c8763701789a801eea4e1a",R.callServer,void 0,R.findSourceMapURL,"createBookingDraft"),L=(0,R.createServerReference)("404aead3639ed9de2f929e911fb1265e0d2203b602",R.callServer,void 0,R.findSourceMapURL,"initializePaymentForBooking"),q=(0,R.createServerReference)("604c7c923397241e6d37d64bf3a465ebd2b1552a85",R.callServer,void 0,R.findSourceMapURL,"validateDiscountCode");var T=e.i(87562),D=e.i(37929),O=e.i(29825),E=e.i(46696);function B(){let e=(0,t.useParams)(),o=(0,t.useRouter)(),d=(0,t.useSearchParams)(),c=e.serviceSlug,{formData:m,updateFormData:u,validateCurrentStep:x,previousStep:h,getDiscountAmount:p,setDiscountAmount:f,setServicesForSlug:b}=(0,l.useBookingFormContext)(),[g,v]=(0,r.useState)(0),[y,j]=(0,r.useState)(!1),[N,w]=(0,r.useState)(null),k=(0,r.useRef)(m.serviceId),{data:A=[]}=(0,a.useQuery)({queryKey:["services"],queryFn:C.getServices,staleTime:3e5});(0,r.useEffect)(()=>{A.length>0&&b(A)},[A,b]),(0,r.useEffect)(()=>{let e=d.get("ref");e&&!m.referralCode&&(u({referralCode:e}),localStorage.setItem("shalean_referral_code",e))},[d,m.referralCode,u]),(0,r.useEffect)(()=>{if(A.length>0){if(!c)return void o.replace("/booking/details");let e=(0,O.findServiceBySlug)(A,c);if(!e){E.toast.error("Invalid service selected"),o.replace("/booking/details");return}m.serviceId&&m.serviceId===e.id||u({serviceId:e.id})}},[c,A.length]),(0,r.useEffect)(()=>{let e=()=>{v(p())};return window.addEventListener("discountUpdated",e),e(),()=>{window.removeEventListener("discountUpdated",e)}},[p]),(0,r.useEffect)(()=>{let e=k.current,s=m.serviceId;e&&e!==s&&(u({additionalServices:[],bedrooms:"0",bathrooms:"1",carpetTypes:[],roomStatus:"",numberOfFittedRooms:"",numberOfLooseCarpets:"",cleaningEquipment:"",serviceDate:"",serviceTime:"",serviceDuration:3.5,discountCode:""}),v(0)),k.current=s},[m.serviceId,u]);let{data:F=[]}=(0,a.useQuery)({queryKey:["pricing-rules"],queryFn:T.getPricingRulesClient,staleTime:6e5}),{data:R=[]}=(0,a.useQuery)({queryKey:["additional-services",m.serviceId],queryFn:()=>(0,S.getAdditionalServices)(m.serviceId||void 0),enabled:!0,staleTime:3e5}),B=A.find(e=>e.id===m.serviceId),U=B?.name.toLowerCase().includes("carpet")??!1,z=(0,r.useMemo)(()=>{if(!(U?m.serviceId&&F.length>0:m.serviceId&&m.bedrooms&&m.bathrooms&&F.length>0))return{basePrice:0,bedroomsPrice:0,bathroomsPrice:0,fittedRoomsPrice:0,looseCarpetsPrice:0,additionalServicesPrice:0,equipmentSupplyPrice:0,additionalCleanersPrice:0,subtotal:0,frequencyDiscountPercent:0,frequencyDiscountAmount:0,discountAmount:g,serviceFee:0,totalAmount:0};let e=m.additionalServices.filter(e=>R.some(s=>s.id===e));return(0,D.calculatePriceBreakdownClient)(F,m.serviceId,m.bedrooms||"0",m.bathrooms||"1",e,m.cleaningFrequency,g,m.numberOfFittedRooms||"",m.numberOfLooseCarpets||"",U,B?.name,m.cleaningEquipment,m.numberOfCleaners||1)},[F,m.serviceId,m.bedrooms,m.bathrooms,JSON.stringify(m.additionalServices),m.cleaningFrequency,m.numberOfFittedRooms,m.numberOfLooseCarpets,m.cleaningEquipment,m.numberOfCleaners,g,U,R,B?.name]),$=async e=>{if(!e.trim())return void E.toast.error("Please enter a discount code");let s=z.subtotal-z.frequencyDiscountAmount,t=await q(e,s);t.valid?(u({discountCode:e}),v(t.discountAmount),f(t.discountAmount),window.dispatchEvent(new Event("discountUpdated")),E.toast.success("Discount code applied successfully!")):E.toast.error(t.error||"Invalid discount code")},H=async()=>{let e=x();if(!e.valid)return void e.errors.forEach(e=>E.toast.error(e));if(B){if((0,M.requiresTeamBooking)(B.name)){if(!m.teamNumber||m.teamNumber<1||m.teamNumber>3)return void E.toast.error("Please select a team (1, 2, or 3) for this service")}else if(null!==m.teamNumber&&void 0!==m.teamNumber)return void E.toast.error("Team selection is only available for Deep Cleaning and Move In/Out services")}j(!0);try{let e=await I(m);if(!e.success||!e.bookingId&&!e.bookingIds){E.toast.error(e.error||"Failed to create booking"),j(!1);return}let s=e.bookingIds||(e.bookingId?[e.bookingId]:[]);if(w(s[0]),m.useCredits&&m.creditsAmount&&m.creditsAmount>0)try{let e=await fetch("/api/bookings/use-credits",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bookingIds:s,creditsAmount:m.creditsAmount})}),t=await e.json();if(!e.ok||!t.success){E.toast.error(t.error||"Failed to use ShaleanCred"),j(!1);return}E.toast.success(`Applied R${m.creditsAmount.toFixed(2)} ShaleanCred to your booking`)}catch(e){console.error("Error using credits:",e),E.toast.error("Failed to use ShaleanCred. Please try again."),j(!1);return}let t=await L(s.length>1?s:s[0]);if(!t.success){E.toast.error(t.error||"Failed to initialize payment"),j(!1);return}if(!t.authorizationUrl){E.toast.success("Booking confirmed! Payment completed with ShaleanCred."),o.push(`/booking/confirmation/${s[0]}`);return}window.location.href=t.authorizationUrl}catch(e){console.error("Error processing payment:",e),E.toast.error("An unexpected error occurred. Please try again."),j(!1)}};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"bg-white rounded-xl p-6 max-w-[576px] mx-auto",children:(0,s.jsx)(P,{formData:m,priceBreakdown:z,updateFormData:u,onValidateDiscountCode:$,onProceedToPayment:H,isProcessing:y})}),(0,s.jsx)("div",{className:"flex justify-between max-w-[576px] mx-auto mt-6",children:(0,s.jsxs)(i.Button,{variant:"outline",onClick:()=>{if(c){let e=m.referralCode||d.get("ref"),s=e?`/booking/worker/${c}?ref=${e}`:`/booking/worker/${c}`;o.push(s)}else h()},children:[(0,s.jsx)(n.ArrowLeft,{className:"w-4 h-4 mr-2"}),"Back"]})})]})}function U(){return(0,s.jsx)(r.Suspense,{fallback:(0,s.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,s.jsx)("div",{className:"text-center",children:(0,s.jsx)("p",{className:"text-muted-foreground",children:"Loading..."})})}),children:(0,s.jsx)(B,{})})}e.s(["default",()=>U],54284)}]);